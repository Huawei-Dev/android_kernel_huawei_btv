/*
* Copyright (C) Huawei Technologies Co., Ltd. 2012-2015. All rights reserved.
* foss@huawei.com
*
* If distributed as part of the Linux kernel, the following license terms
* apply:
*
* * This program is free software; you can redistribute it and/or modify
* * it under the terms of the GNU General Public License version 2 and
* * only version 2 as published by the Free Software Foundation.
* *
* * This program is distributed in the hope that it will be useful,
* * but WITHOUT ANY WARRANTY; without even the implied warranty of
* * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
* * GNU General Public License for more details.
* *
* * You should have received a copy of the GNU General Public License
* * along with this program; if not, write to the Free Software
* * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA
*
* Otherwise, the following license terms apply:
*
* * Redistribution and use in source and binary forms, with or without
* * modification, are permitted provided that the following conditions
* * are met:
* * 1) Redistributions of source code must retain the above copyright
* *    notice, this list of conditions and the following disclaimer.
* * 2) Redistributions in binary form must reproduce the above copyright
* *    notice, this list of conditions and the following disclaimer in the
* *    documentation and/or other materials provided with the distribution.
* * 3) Neither the name of Huawei nor the names of its contributors may
* *    be used to endorse or promote products derived from this software
* *    without specific prior written permission.
*
* * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
* AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
* IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
* ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
* LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
* CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
* SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
* INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
* CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
* ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
* POSSIBILITY OF SUCH DAMAGE.
*
*/

/*****************************************************************************
   1 ??????????
*****************************************************************************/
#include "mdrv.h"
#include "ATCmdProc.h"
#include "AtInputProc.h"
#include "AtCheckFunc.h"
#include "AtParseCmd.h"
#include "PppInterface.h"
#include "AtMsgPrint.h"
#include "Taf_MmiStrParse.h"
#include "siappstk.h"
#include "siapppih.h"
#include "siapppb.h"
#include "AtPhyInterface.h"
#include "AtDataProc.h"
#include "AtInputProc.h"
#include "TafDrvAgent.h"
#include "MnCommApi.h"
#include "AtCmdMsgProc.h"

#include "AtRabmInterface.h"
#include "AtSndMsg.h"
#include "AtDeviceCmd.h"
#include "AtRnicInterface.h"
#include "AtTafAgentInterface.h"
#include "TafAgentInterface.h"
#include "TafAppXsmsInterface.h"

#include "AtMtaInterface.h"
#include "phyoaminterface.h"

/* Added by l00167671 for NV???????? , 2013-05-17, begin */
#include "NasNvInterface.h"
#include "TafNvInterface.h"
/* Added by l00167671 for NV???????? , 2013-05-17, end*/

/* Add by w00199382 for V7????????, 2012-04-07, Begin   */
#include "msp_nvim.h"
#include "msp_nv_def.h"
#include "msp_nv_id.h"
#include "at_common.h"
#include "gen_msg.h"
/* ADD by c64416 for V9R1/V7R1 AT, 2013/09/18 begin */
#include "at_lte_common.h"
/* ADD by c64416 for V9R1/V7R1 AT, 2013/09/18 end */
/* Add by w00199382 for V7????????, 2012-04-07, End   */
/* Added by s00217060 for ????????AT??????????????C??, 2013-4-8, begin */
#include "MnCallApi.h"
#include "AtCtx.h"
/* Added by s00217060 for ????????AT??????????????C??, 2013-4-8, end */
#include "AppVcApi.h"
#include "AtImsaInterface.h"
#include "AtInit.h"

#include "mdrv.h"
#include "gunas_errno.h"

#include <linux/version.h>
#if (LINUX_VERSION_CODE >= KERNEL_VERSION(3, 13, 0))
#include <huawei_platform/connectivity/huawei_gps.h>
#else
#include <linux/huawei/gps/huawei_gps.h>
#endif /* #if (LINUX_VERSION_CODE >= KERNEL_VERSION(3, 13, 0)) */

#include <linux/mtd/hisi_nve_interface.h>

#include "CssAtInterface.h"

/* Added by L47619 for V9R1 vSIM Project, 2013-8-27, begin */
#include "AtCmdSimProc.h"
/* Added by L47619 for V9R1 vSIM Project, 2013-8-27, end */
/* Added by s00261364 for L-C??????????, 2014-1-27, begin */
#include "TafAppMma.h"
/* Added by s00261364 for L-C??????????, 2014-1-27, end */

/* Add by j00174725 for K3V3 ??????????????, 2014-06-16, Begin */
#include "TafMtcApi.h"
/* Add by j00174725 for K3V3 ??????????????, 2014-06-16, End */
#include <product_config.h>

#include "siapppih.h"

#include "product_config.h"
#include "TafAppCall.h"


/*****************************************************************************
    ??????????????????????.C??????????
*****************************************************************************/
/*lint -e767 -e960 ??????:???? 107747;??????:??????65952;????:Log????*/
#define    THIS_FILE_ID        PS_FILE_ID_AT_SETPARACMD_C
/*lint +e767 +e960 ??????:???? 107747;??????:sunshaohua*/


/*****************************************************************************
   2 ????????????
*****************************************************************************/
/* Modify by h00135900 for V7????????, 2012-04-07, Begin   */
AT_SET_PORT_PARA_MAP_STRU    g_astSetPortParaMap[AT_SETPORT_DEV_MAP_LEN]
                                = {{"A1", AT_DEV_CDROM,        "CDROM"        },
                                   {"A2", AT_DEV_SD,           "SD"           },
                                   {"A3", AT_DEV_RNDIS,        "RNDIS"        },
                                   {"A",  AT_DEV_BLUE_TOOTH,   "BLUE TOOTH"   },
                                   {"B",  AT_DEV_FINGER_PRINT, "FINGER PRINT" },
                                   {"D",  AT_DEV_MMS,          "MMS"          },
                                   {"E",  AT_DEV_PC_VOICE,     "3G PC VOICE"  },
                                   {"1",  AT_DEV_MODEM,        "3G MODEM"     },
                                   {"2",  AT_DEV_PCUI,         "3G PCUI"      },
                                   {"3",  AT_DEV_DIAG,         "3G DIAG"      },
                                   {"4",  AT_DEV_PCSC,         "PCSC"         },
                                   {"5",  AT_DEV_GPS,          "3G GPS"       },
                                   {"6",  AT_DEV_GPS_CONTROL,  "GPS CONTROL"  },
                                   {"7",  AT_DEV_NDIS,         "3G NDIS"      },
                                   {"16", AT_DEV_NCM,          "NCM"          },
                                   {"10",AT_DEV_4G_MODEM,      "4G MODEM"        },
                                   {"11",AT_DEV_4G_NDIS,       "4G NDIS"         },
                                   {"12",AT_DEV_4G_PCUI,       "4G PCUI"         },
                                   {"13",AT_DEV_4G_DIAG,       "4G DIAG"         },
                                   {"14",AT_DEV_4G_GPS,        "4G GPS"          },
                                   {"15",AT_DEV_4G_PCVOICE,    "4G PCVOICE"      },
                                   {"FF", AT_DEV_NONE,         "NO FIRST PORT"}
                                  };
/* Modify by h00135900 for V7????????, 2012-04-07, End   */

TAF_UINT8                               gucSTKCmdQualify    =0x0;

/*AT/OM??????????????*/
TAF_UINT8                               gucAtOmIndex        = AT_MAX_CLIENT_NUM;

/*????????????????????*/
TAF_UINT32                              gulErrType          = 1;

/* Added by ??????/f62575 for E5????????????????????, 2011/11/15, begin */
/* Added by ??????/f62575 for E5????????????????????, 2011/11/15, end */

/*NAS????APP????NDIS??????????slice*/
VOS_UINT32                              g_ulRcvAppNdisdupSlice;

VOS_BOOL                                g_bSetFlg = VOS_FALSE;

VOS_UINT32                              g_ulWifiFreq;
VOS_UINT32                              g_ulWifiRate;
VOS_UINT32                              g_ulWifiMode;
VOS_INT32                               g_lWifiPower;
/* Add by w00199382 for V7????????, 2012-04-07, Begin   */
VOS_UINT32                              g_ulWifiRF = 0xffffffffU;
AT_TMODE_RAT_FLAG_STRU g_stTmodeRat = {0};
VOS_UINT32 g_ulTmodeNum             = 0;
VOS_UINT32 g_ulGuTmodeCnfNum        = 0;
VOS_UINT32 g_ulLteOnly              = 0;
VOS_UINT32 g_ulGuOnly               = 0;
VOS_UINT32 g_ulLteIsSend2Dsp        = 0;

/* Add by w00199382 for V7????????, 2012-04-07, End   */
/* Added by L00171473 for DTS2012020106679,AT WT???? 2012-01-17  Begin */
VOS_UINT                                g_ulUcastWifiRxPkts;
VOS_UINT                                g_ulMcastWifiRxPkts;
/* Added by L00171473 for DTS2012020106679,AT WT???? 2012-01-17  End */

/* +CLCK????????CLASS??Service Type Code?????? */
AT_CLCK_CLASS_SERVICE_TBL_STRU          g_astClckClassServiceTbl[] = {
    {AT_CLCK_PARA_CLASS_VOICE,                      TAF_SS_TELE_SERVICE,        TAF_ALL_SPEECH_TRANSMISSION_SERVICES_TSCODE},
    {AT_CLCK_PARA_CLASS_DATA,                       TAF_SS_BEARER_SERVICE,      TAF_ALL_BEARERSERVICES_BSCODE},
    {AT_CLCK_PARA_CLASS_FAX,                        TAF_SS_TELE_SERVICE,        TAF_ALL_FACSIMILE_TRANSMISSION_SERVICES_TSCODE},
    {AT_CLCK_PARA_CLASS_VOICE_FAX,                  TAF_SS_TELE_SERVICE,        TAF_ALL_TELESERVICES_EXEPTSMS_TSCODE},
    {AT_CLCK_PARA_CLASS_VOICE_DATA_FAX,             TAF_SS_TELE_SERVICE,        TAF_ALL_TELESERVICES_EXEPTSMS_TSCODE},
    {AT_CLCK_PARA_CLASS_SMS,                        TAF_SS_TELE_SERVICE,        TAF_ALL_SMS_SERVICES_TSCODE},
    {AT_CLCK_PARA_CLASS_VOICE_FAX_SMS,              TAF_SS_TELE_SERVICE,        TAF_ALL_TELESERVICES_TSCODE},
    {AT_CLCK_PARA_CLASS_VOICE_DATA_FAX_SMS,         TAF_SS_TELE_SERVICE,        TAF_ALL_TELESERVICES_TSCODE},
    {AT_CLCK_PARA_CLASS_DATA_SYNC,                  TAF_SS_BEARER_SERVICE,      TAF_ALL_DATA_CIRCUIT_SYNCHRONOUS_BSCODE},
    {AT_CLCK_PARA_CLASS_DATA_ASYNC,                 TAF_SS_BEARER_SERVICE,      TAF_ALL_DATA_CIRCUIT_ASYNCHRONOUS_BSCODE},
    {AT_CLCK_PARA_CLASS_DATA_PKT,                   TAF_SS_BEARER_SERVICE,      TAF_ALL_DATAPDS_SERVICES_BSCODE},
    {AT_CLCK_PARA_CLASS_DATA_SYNC_PKT,              TAF_SS_BEARER_SERVICE,      TAF_ALL_SYNCHRONOUS_SERVICES_BSCODE},
    {AT_CLCK_PARA_CLASS_DATA_PAD,                   TAF_SS_BEARER_SERVICE,      TAF_ALL_PADACCESSCA_SERVICES_BSCODE},
    {AT_CLCK_PARA_CLASS_DATA_ASYNC_PAD,             TAF_SS_BEARER_SERVICE,      TAF_ALL_ASYNCHRONOUS_SERVICES_BSCODE},
    {AT_CLCK_PARA_CLASS_DATA_SYNC_ASYNC_PKT_PKT,    TAF_SS_BEARER_SERVICE,      TAF_ALL_BEARERSERVICES_BSCODE},
};

AT_MTA_BODY_SAR_STATE_ENUM_UINT16       g_enAtBodySarState = AT_MTA_BODY_SAR_OFF;



/*****************************************************************************
   3 ??????????????
*****************************************************************************/

extern void       TTF_SetGcfTestFlag(VOS_UINT32 ulGctTestFlag);



/*****************************************************************************
   4 ????????
*****************************************************************************/

/******************************************************************************
 Function:      AT_CtrlGetPDPAuthType
 Description:    ????PC??????PDP??????????????????????
 Calls:
 Data Accessed:
 Data Updated:
 Input:
                 usTotalLen     PDP??????????????
 Output:
 Return:        0   no auth
                1   pap
                2   chap
 Others:
   1.Date        : 2009-08-03
    Author      : S62952
    Modification: Created function
******************************************************************************/
PPP_AUTH_TYPE_ENUM_UINT8 AT_CtrlGetPDPAuthType(
    VOS_UINT32                          Value,
    VOS_UINT16                          usTotalLen
)
{
    /*????????????*/
    if (0 == usTotalLen)
    {
        return TAF_PDP_AUTH_TYPE_NONE;
    }
    else
    {
        if(0 == Value)
        {
            return TAF_PDP_AUTH_TYPE_NONE;
        }
        else if (1 == Value)
        {
            return TAF_PDP_AUTH_TYPE_PAP;
        }
        else
        {
            return TAF_PDP_AUTH_TYPE_CHAP;
        }
    }
}


/*****************************************************************************
 ?? ?? ??  : AT_ClGetPdpAuthType
 ????????  : CL????????????????????ppp????????????
 ????????  : ??
 ????????  : ??
 ?? ?? ??  : TAF_PDP_AUTH_TYPE_ENUM_UINT8
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??12??9??
    ??    ??   : y00322978
    ????????   : ??????????

*****************************************************************************/
TAF_PDP_AUTH_TYPE_ENUM_UINT8 AT_ClGetPdpAuthType(
    VOS_UINT32                          Value,
    VOS_UINT16                          usTotalLen
)
{
    /*????????????*/
    if (0 == usTotalLen)
    {
        return TAF_PDP_AUTH_TYPE_NONE;
    }
    else
    {
        switch (Value)
        {
            case 0:
                return TAF_PDP_AUTH_TYPE_NONE;
            case 1:
                return TAF_PDP_AUTH_TYPE_PAP;
            case 2:
                return TAF_PDP_AUTH_TYPE_CHAP;
            case 3:
                return TAF_PDP_AUTH_TYPE_PAP_OR_CHAP;
            default :
                return TAF_PDP_AUTH_TYPE_BUTT;

        }
    }
}
/*****************************************************************************
 Prototype      : At_SsPrint2Class
 Description    :
 Input          : ucClass --- SSA??CLASS
 Output         : ---
 Return Value   : ulRtn????????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.Date        : 2010-09-19
    Author      : z00161729
    Modification: DTS2010092001723??VP??????????CCFC??CCWA??CLCK????
  3.??    ??   : 2012??12??29??
    ??    ??   : l00198894
    ????????   : DTS2012122900551: ????+CLCK??????????????????????
*****************************************************************************/
TAF_UINT32 At_SsPrint2Class(TAF_SS_BASIC_SERVICE_STRU *pBsService,TAF_UINT8 ucClass)
{
    VOS_UINT32                          ulLoop;
    VOS_UINT32                          ulItemsNum;

    ulItemsNum = sizeof(g_astClckClassServiceTbl) / sizeof(AT_CLCK_CLASS_SERVICE_TBL_STRU);

    /* ????????????Class?????????????????? */
    for (ulLoop = 0; ulLoop < ulItemsNum; ulLoop++)
    {
        if (g_astClckClassServiceTbl[ulLoop].enClass == ucClass)
        {
            pBsService->BsType = g_astClckClassServiceTbl[ulLoop].enServiceType;
            pBsService->BsServiceCode = g_astClckClassServiceTbl[ulLoop].enServiceCode;
            return AT_SUCCESS;
        }
    }

    return AT_FAILURE;
}

/*****************************************************************************
 Prototype      : At_SsPrint2Code
 Description    :
 Input          : ucClass --- SSA??Code
 Output         : ---
 Return Value   : ulRtn????????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_VOID At_SsPrint2Code(TAF_SS_CODE *pSsCode,TAF_UINT8 ucType)
{
    switch(ucType)
    {
    case AT_CLCK_AO_TYPE:
        *pSsCode = TAF_BAOC_SS_CODE;
        break;

    case AT_CLCK_OI_TYPE:
        *pSsCode = TAF_BOIC_SS_CODE;
        break;

    case AT_CLCK_OX_TYPE:
        *pSsCode = TAF_BOICEXHC_SS_CODE;
        break;

    case AT_CLCK_AI_TYPE:
        *pSsCode = TAF_BAIC_SS_CODE;
        break;

    case AT_CLCK_IR_TYPE:
        *pSsCode = TAF_BICROAM_SS_CODE;
        break;

    case AT_CLCK_AB_TYPE:
        *pSsCode = TAF_ALL_BARRING_SS_CODE;
        break;

    case AT_CLCK_AG_TYPE:
        *pSsCode = TAF_BARRING_OF_OUTGOING_CALLS_SS_CODE;
        break;

    default:
        *pSsCode = TAF_BARRING_OF_INCOMING_CALLS_SS_CODE;
        break;
    }
}

/*****************************************************************************
 Prototype      : At_AsciiNum2HexString
 Description    : ????16??????????????????
 Input          : nptr --- ??????
 Output         :
 Return Value   : AT_SUCCESS --- ????
                  AT_FAILURE --- ????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
  3.??    ??   : 2012??04??21??
    ??    ??   : l00198894
    ????????   : AP-Modem????????????, ????????????????
*****************************************************************************/
TAF_UINT32 At_AsciiNum2HexString(TAF_UINT8 *pucSrc, TAF_UINT16 *pusSrcLen)
{
    TAF_UINT16 usChkLen = 0;
    TAF_UINT16 usTmp = 0;
    TAF_UINT8  ucLeft = 0;
    TAF_UINT16 usSrcLen = *pusSrcLen;
    TAF_UINT8 *pucDst = pucSrc;

    /* ???????????????????????????? */
    if(0 != (usSrcLen % 2))
    {
        return AT_FAILURE;
    }

    while(usChkLen < usSrcLen)
    {
        if( (pucSrc[usChkLen] >= '0') && (pucSrc[usChkLen] <= '9') ) /* the number is 0-9 */
        {
            ucLeft = pucSrc[usChkLen] - '0';
        }
        else if( (pucSrc[usChkLen] >= 'a') && (pucSrc[usChkLen] <= 'f') ) /* the number is 0-9 */
        {
            ucLeft = (pucSrc[usChkLen] - 'a') + 0x0a;
        }
        else if( (pucSrc[usChkLen] >= 'A') && (pucSrc[usChkLen] <= 'F') ) /* the number is 0-9 */
        {
            ucLeft = (pucSrc[usChkLen] - 'A') + 0x0a;
        }
        else
        {
            return AT_FAILURE;
        }

        pucDst[usTmp] = 0xf0 & (ucLeft << 4);
        usChkLen += 1;

        if( (pucSrc[usChkLen] >= '0') && (pucSrc[usChkLen] <= '9') ) /* the number is 0-9 */
        {
            pucDst[usTmp] |= pucSrc[usChkLen] - '0';
        }
        else if( (pucSrc[usChkLen] >= 'a') && (pucSrc[usChkLen] <= 'f') ) /* the number is 0-9 */
        {
            pucDst[usTmp] |= (pucSrc[usChkLen] - 'a') + 0x0a;
        }
        else if( (pucSrc[usChkLen] >= 'A') && (pucSrc[usChkLen] <= 'F') ) /* the number is 0-9 */
        {
            pucDst[usTmp] |= (pucSrc[usChkLen] - 'A') + 0x0a;
        }
        else
        {
            return AT_FAILURE;
        }

        usChkLen += 1;
        usTmp += 1;
    }

    *pusSrcLen = usSrcLen / 2;
    return AT_SUCCESS;
}
/*****************************************************************************
 Prototype      : At_AsciiString2HexText
 Description    : ????16??????????????
 Input          : nptr --- ??????
 Output         :
 Return Value   : AT_SUCCESS --- ????
                  AT_FAILURE --- ????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
*****************************************************************************/
TAF_UINT32 At_AsciiString2HexText(SI_STK_TEXT_STRING_STRU *pTextStr,TAF_UINT8 *pucSrc,TAF_UINT16 usSrcLen)
{
    TAF_UINT16 usChkLen = 0;
    TAF_UINT8  ucTmp = 0;
    TAF_UINT8  ucLeft = 0;
    TAF_UINT8 *pucDst = pTextStr->pucText;

    if(usSrcLen < 2)
    {
        return AT_FAILURE;
    }

    while(usChkLen < usSrcLen)
    {
        if( (pucSrc[usChkLen] >= '0') && (pucSrc[usChkLen] <= '9') ) /* the number is 0-9 */
        {
            ucLeft = pucSrc[usChkLen] - '0';
        }
        else if( (pucSrc[usChkLen] >= 'a') && (pucSrc[usChkLen] <= 'f') ) /* the number is 0-9 */
        {
            ucLeft = (pucSrc[usChkLen] - 'a') + 0x0a;
        }
        else if( (pucSrc[usChkLen] >= 'A') && (pucSrc[usChkLen] <= 'F') ) /* the number is 0-9 */
        {
            ucLeft = (pucSrc[usChkLen] - 'A') + 0x0a;
        }
        else
        {
            return AT_FAILURE;
        }

        pucDst[ucTmp] = 0xf0 & (ucLeft << 4);

        usChkLen += 1;

        if( (pucSrc[usChkLen] >= '0') && (pucSrc[usChkLen] <= '9') ) /* the number is 0-9 */
        {
            pucDst[ucTmp] |= pucSrc[usChkLen] - '0';
        }
        else if( (pucSrc[usChkLen] >= 'a') && (pucSrc[usChkLen] <= 'f') ) /* the number is 0-9 */
        {
            pucDst[ucTmp] |= (pucSrc[usChkLen] - 'a') + 0x0a;
        }
        else if( (pucSrc[usChkLen] >= 'A') && (pucSrc[usChkLen] <= 'F') ) /* the number is 0-9 */
        {
            pucDst[ucTmp] |= (pucSrc[usChkLen] - 'A') + 0x0a;
        }
        else
        {
            return AT_FAILURE;
        }

        usChkLen += 1;

        ucTmp += 1;
    }

    pTextStr->ucLen = ucTmp;

    return AT_SUCCESS;
}

/*****************************************************************************
 Prototype      : At_AsciiString2HexSimple
 Description    : ????16??????????????
 Input          : nptr --- ??????
 Output         :
 Return Value   : AT_SUCCESS --- ????
                  AT_FAILURE --- ????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
*****************************************************************************/
TAF_UINT32 At_AsciiString2HexSimple(TAF_UINT8 *pTextStr,TAF_UINT8 *pucSrc,TAF_UINT16 usSrcLen)
{
    TAF_UINT16 usChkLen = 0;
    TAF_UINT8  ucTmp = 0;
    TAF_UINT8  ucLeft = 0;
    TAF_UINT8 *pucDst = pTextStr;

    if(usSrcLen == 0)
    {
        return AT_FAILURE;
    }

    while(usChkLen < usSrcLen)
    {
        if ( (pucSrc[usChkLen] >= '0') && (pucSrc[usChkLen] <= '9') ) /* the number is 0-9 */
        {
            ucLeft = pucSrc[usChkLen] - '0';
        }
        else if ( (pucSrc[usChkLen] >= 'a') && (pucSrc[usChkLen] <= 'f') ) /* the number is 0-9 */
        {
            ucLeft = (pucSrc[usChkLen] - 'a') + 0x0a;
        }
        else if ( (pucSrc[usChkLen] >= 'A') && (pucSrc[usChkLen] <= 'F') ) /* the number is 0-9 */
        {
            ucLeft = (pucSrc[usChkLen] - 'A') + 0x0a;
        }
        else
        {
            return AT_FAILURE;
        }

        pucDst[ucTmp] = 0xf0 & (ucLeft << 4);

        usChkLen += 1;

        if ( (pucSrc[usChkLen] >= '0') && (pucSrc[usChkLen] <= '9') ) /* the number is 0-9 */
        {
            pucDst[ucTmp] |= pucSrc[usChkLen] - '0';
        }
        else if ( (pucSrc[usChkLen] >= 'a') && (pucSrc[usChkLen] <= 'f') ) /* the number is 0-9 */
        {
            pucDst[ucTmp] |= (pucSrc[usChkLen] - 'a') + 0x0a;
        }
        else if ( (pucSrc[usChkLen] >= 'A') && (pucSrc[usChkLen] <= 'F') ) /* the number is 0-9 */
        {
            pucDst[ucTmp] |= (pucSrc[usChkLen] - 'A') + 0x0a;
        }
        else
        {
            return AT_FAILURE;
        }

        usChkLen += 1;

        ucTmp += 1;
    }

    return AT_SUCCESS;
}

/* Del At_AbortCmdProc */

/*****************************************************************************
 ?? ?? ??  : AT_HexToAsciiString
 ????????  : ??hex ??????ascii??????  0x123456->"123456"
 ????????  : TAF_UINT8                          *pSrcStr,
             TAF_UINT8                          *pucDstStr,
             TAF_UINT16                          usSrcLen
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??11??3??
    ??    ??   : y00322978
    ????????   : ??????????

*****************************************************************************/
TAF_UINT32 AT_HexToAsciiString(
    TAF_UINT8                          *pSrcStr,
    TAF_UINT8                          *pucDstStr,
    TAF_UINT16                          usSrcLen
)
{
    TAF_UINT16 usChkLen = 0;
    TAF_UINT8 *pWrite = pucDstStr;
    TAF_UINT8 *pRead = pSrcStr;
    TAF_UINT8  ucHigh = 0;
    TAF_UINT8  ucLow = 0;

    if ((VOS_NULL_PTR == pSrcStr)||(VOS_NULL_PTR == pucDstStr)||(0 == usSrcLen))
    {
        return AT_ERROR;
    }

    /* ???????????? */
    while ( usChkLen++ < usSrcLen )
    {
        ucHigh = 0x0F & (*pRead >> 4);
        ucLow = 0x0F & *pRead;

        if (0x09 >= ucHigh)
        {
            /* 0-9 */
            *pWrite++ = ucHigh + 0x30;
        }
        else
        {
            /* A-F */
            *pWrite++ = ucHigh + 0x37;
        }

        if (0x09 >= ucLow)
        {
            *pWrite++ = ucLow + 0x30;
        }
        else
        {
            *pWrite++ = ucLow + 0x37;
        }

        /* ?????????? */
        pRead++;
    }
    *pWrite = '\0';
    return AT_OK;
}

/*****************************************************************************
 Prototype      : At_AsciiNum2BcdNum
 Description    : ????????ASCII????????????BCD????pucDst????????????pucSrc??????????
 Input          : pucDst   --- ????????
                  usDstLen --- ????????????
                  pucSrc   --- ??????
                  usSrcLen --- ??????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
*****************************************************************************/
TAF_UINT32 At_AsciiNum2BcdNum (TAF_UINT8 *pucDst, TAF_UINT8 *pucSrc, TAF_UINT16 usSrcLen)
{
    TAF_UINT16 usChkLen = 0;
    TAF_UINT8  ucTmp = 0;
    TAF_UINT8  ucBcdCode;

    for(usChkLen = 0; usChkLen < usSrcLen; usChkLen++)
    {
        ucTmp = usChkLen % 2;   /* ?????????? */

        if ((pucSrc[usChkLen] >= 0x30) && (pucSrc[usChkLen] <= 0x39)) /* the number is 0-9 */
        {
            ucBcdCode = pucSrc[usChkLen] - 0x30;
        }
        else if ('*' == pucSrc[usChkLen])
        {
            ucBcdCode = 0x0a;
        }
        else if ('#' == pucSrc[usChkLen])
        {
            ucBcdCode = 0x0b;
        }
        else if (('a' == pucSrc[usChkLen])
              || ('b' == pucSrc[usChkLen])
              || ('c' == pucSrc[usChkLen]))
        {
            ucBcdCode = (VOS_UINT8)((pucSrc[usChkLen] - 'a') + 0x0c);
        }
        else
        {
            return AT_FAILURE;
        }

        ucTmp = usChkLen % 2;   /* ?????????? */
        if(0 == ucTmp)
        {
            pucDst[usChkLen/2] = ucBcdCode;   /* ???? */
        }
        else
        {
            pucDst[usChkLen/2] |= (TAF_UINT8)(ucBcdCode << 4);   /* ???? */
        }
    }

    if(1 == (usSrcLen % 2))
    {
        pucDst[usSrcLen/2] |= 0xf0; /* ???? */
    }

    return AT_SUCCESS;
}
/*****************************************************************************
 Prototype      : At_AsciiNum2Num
 Description    : ????????ASCII????????????BCD????pucDst????????????pucSrc??????????
 Input          : pucDst   --- ????????
                  usDstLen --- ????????????
                  pucSrc   --- ??????
                  usSrcLen --- ??????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
*****************************************************************************/
TAF_UINT32 At_AsciiNum2Num (TAF_UINT8 *pucDst, TAF_UINT8 *pucSrc, TAF_UINT16 usSrcLen)
{
    TAF_UINT16 usChkLen = 0;

    for(usChkLen = 0; usChkLen < usSrcLen; usChkLen++)
    {

        if( (pucSrc[usChkLen] >= 0x30) && (pucSrc[usChkLen] <= 0x39) ) /* the number is 0-9 */
        {
                pucDst[usChkLen] = pucSrc[usChkLen] - 0x30;   /* ???? */
        }
        else
        {
            return AT_FAILURE;
        }
    }

    return AT_SUCCESS;
}
/*****************************************************************************
 Prototype      : At_CheckDialString
 Description    : ??????????????????
 Input          :
 Output         :
 Return Value   : AT_SUCCESS --- ????
                  AT_FAILURE --- ????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
  3.??    ??   : 2012??12??03??
    ??    ??   : Y00213812
    ????????   : DTS2012120303885,????BCD????????????????
*****************************************************************************/
TAF_UINT32 At_CheckDialString(TAF_UINT8 *pData, TAF_UINT16 usLen)
{
    TAF_UINT16 usCount = 0;
    TAF_UINT8 *pTmp = pData;

    if ('+' == *pTmp)
    {
        pTmp++;
        usCount++;
    }

    while(usCount++ < usLen)
    {
        if ((*pTmp >= '0') && (*pTmp <= '9'))
        {
        }
        else if ((*pTmp >= 'a') && (*pTmp <= 'c'))
        {
        }
        else if ((*pTmp >= 'A') && (*pTmp <= 'C'))
        {
        }
        else if (('*' == *pTmp) || ('#' == *pTmp))
        {
        }
        else
        {
            return AT_FAILURE;
        }
        pTmp++;
    }
    return AT_SUCCESS;
}

/*****************************************************************************
 Prototype      : At_CheckPBString
 Description    : ??????????????????
 Input          :
 Output         :
 Return Value   : AT_SUCCESS --- ????
                  AT_FAILURE --- ????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2007-05-30
    Author      : H59254
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_CheckPBString(TAF_UINT8 *pData, TAF_UINT16 *pusLen)
{
    TAF_UINT16 usCount = 0;
    TAF_UINT8 *pTmp = pData;
    TAF_UINT8  usInvalidNum = 0;

    while(usCount++ < *pusLen)
    {
        if(('(' == *pTmp)||(')' == *pTmp)||('-' == *pTmp)||('"' == *pTmp))
        {
            VOS_MemCpy(pTmp, pTmp+1, (VOS_SIZE_T)(*pusLen - usCount));
            usInvalidNum++;
        }
        else
        {
            pTmp++;
        }
    }

    usCount = 0;
    pTmp = pData;
    *pusLen -= usInvalidNum;

    while(usCount++ < *pusLen)
    {
        if(!( (('0' <= *pTmp) && ('9' >= *pTmp))
           || ('*' == *pTmp) || ('#' == *pTmp) || ('?' == *pTmp)
           || (',' == *pTmp) || ('P' == *pTmp) || ('p' == *pTmp)))
        {
            return AT_FAILURE;
        }
        pTmp++;
    }
    return AT_SUCCESS;
}

/*****************************************************************************
 Prototype      : At_CheckNumLen
 Description    :
 Input          :
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32  At_CheckNumLen(TAF_UINT16 usMax,TAF_UINT16 usLen)
{
    /* ?????????????????????????? */
    if(AT_CSCS_UCS2_CODE == gucAtCscsType)
    {
        if((usMax * 4) < usLen)
        {
            return AT_FAILURE;
        }
    }
    else
    {
        if(usMax < usLen)
        {
            return AT_FAILURE;
        }
    }
    return AT_SUCCESS;
}
/*****************************************************************************
 Prototype      : At_CheckUssdNumLen
 Description    :
 Input          :
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2009-07-16
    Author      : S62952
    Modification: Created function
 2.??    ??   : 2010??03??02??
    ??    ??   : s62952
    ????????   : ????????:A32D16511
  3.??    ??   : 2013??2??25??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  4.??    ??   : 2013??11??29??
    ??    ??   : z00234330
    ????????   : dts2012112912543
*****************************************************************************/
TAF_UINT32  At_CheckUssdNumLen(
    VOS_UINT8                           ucIndex,
    TAF_SS_DATA_CODING_SCHEME           dcs,
    TAF_UINT16                          usLen
)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, Begin */
    AT_MODEM_SS_CTX_STRU               *pstSsCtx = VOS_NULL_PTR;

    pstSsCtx = AT_GetModemSsCtxAddrFromClientId(ucIndex);




    if(AT_USSD_NON_TRAN_MODE == pstSsCtx->usUssdTransMode)
    {
        if(TAF_SS_MAX_USSDSTRING_LEN < usLen)
        {
            return AT_FAILURE;
        }
    }
    else
    {
        if((TAF_SS_MAX_USS_CHAR * 2) < usLen)
        {
            return AT_FAILURE;
        }

    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, End */

    return AT_SUCCESS;
}

/*****************************************************************************
 Prototype      : At_UnicodeTransferTo81CalcLength
 Description    : ????UCS2????????????????81??????????????????????????????????????????????????
 Input          : pucData ??????UCS????
                : usLen   ??????UCS????????
 Output         : pusBaseCode ????81????????Basecode
                : pusDstLen   ????81????????????
 Return Value   : AT_FAILURE  --- ????????81????
                  AT_SUCCESS  --- ??????81????

 History        :
  1.Date        : 2009-08-19
    Author      : H59254
    Modification: Created function
  2.Date        : 2011-01-19
    Author      : j00168360
    Modification: ??????????????????
*****************************************************************************/
TAF_UINT32 At_UnicodeTransferTo81CalcLength(const TAF_UINT8 *pucData,
                                            TAF_UINT16      usLen,
                                            TAF_UINT16      *pusBaseCode,
                                            TAF_UINT16      *pusDstLen)
{
    TAF_UINT16      usUnicodeChar;
    TAF_UINT16      usBaseCode = 0;
    TAF_UINT16      usIndex;
    TAF_BOOL        bIsBaseSet = TAF_FALSE;
    TAF_UINT16      usDstLen = 0;
    TAF_UINT8       aucGsmData[2];
    TAF_UINT16      usGsmDataLen = 0;

    /* ?????????????? */
    *pusDstLen = 0;
    *pusBaseCode = 0;

    for (usIndex = 0; usIndex < (usLen >> 1); usIndex++)
    {
        usUnicodeChar = (*pucData << 8) | (*(pucData + 1));

        pucData += 2;

        /* ????????GSM??UCS???????????????? */
        if (AT_SUCCESS == At_OneUnicodeToGsm(usUnicodeChar, aucGsmData, &usGsmDataLen))
        {
            usDstLen += usGsmDataLen;

            continue;
        }

        /* 81????????8????15bit????????????0hhh hhhh hXXX XXXX????????16bit??1????????????81???? */
        if (0 != (usUnicodeChar & 0x8000))
        {
            AT_ERR_LOG("At_UnicodeTransferTo81CalcLength error: no16 bit is 1");

            return AT_FAILURE;
        }

        if (TAF_FALSE == bIsBaseSet)
        {
            /* ????????UCS2????8????15bit????BaseCode??BaseCode????7???????????? */
            bIsBaseSet = TAF_TRUE;
            usBaseCode = usUnicodeChar & AT_PB_81_CODE_BASE_POINTER;
        }
        else
        {
            if (usBaseCode != (usUnicodeChar & AT_PB_81_CODE_BASE_POINTER))
            {
                AT_ERR_LOG("At_UnicodeTransferTo81CalcLength error: code base error");

               return AT_FAILURE;
            }
        }

        usDstLen++;
    }

    /* ??????81??????????????????81?????????? */
    *pusBaseCode = usBaseCode;
    *pusDstLen   = usDstLen + AT_PB_81CODE_HEADER_LEN;

    return AT_SUCCESS;
}

/*****************************************************************************
 Prototype      : At_UnicodeTransferTo82CalcLength
 Description    : ????UCS2????????????????82??????????????????????????????????????????????????
 Input          : pucData ??????UCS????
                : usLen   ??????UCS????????
 Output         : pusBaseCode ????82????????Basecode
                : pusDstLen   ????82????????????
 Return Value   : AT_FAILURE  --- ????????82????
                  AT_SUCCESS  --- ??????82????

 History        :
  1.Date        : 2009-08-19
    Author      : H59254
    Modification: Created function
  2.Date        : 2011-01-19
    Author      : j00168360
    Modification: ??????????????????
*****************************************************************************/
TAF_UINT32 At_UnicodeTransferTo82CalcLength(const TAF_UINT8 *pucData,
                                            TAF_UINT16      usLen,
                                            TAF_UINT16      *pusBaseCode,
                                            TAF_UINT16      *pusDstLen)
{
    TAF_UINT16      usUnicodeChar;
    TAF_UINT16      usIndex;
    TAF_BOOL        bIsBaseSet = TAF_FALSE;
    TAF_UINT16      us82BaseHigh = 0;
    TAF_UINT16      us82BaseLow = 0;
    TAF_UINT16      usDstLen = 0;
    TAF_UINT8       aucGsmData[2];
    TAF_UINT16      usGsmDataLen = 0;

    /* ?????????????? */
    *pusDstLen = 0;
    *pusBaseCode = 0;

    for (usIndex = 0; usIndex < (usLen >> 1); usIndex++)
    {
        usUnicodeChar = (*pucData << 8) | (*(pucData + 1));

        pucData += 2;

        /* ????????GSM??UCS???????????????? */
        if (AT_SUCCESS == At_OneUnicodeToGsm(usUnicodeChar, aucGsmData, &usGsmDataLen))
        {
            usDstLen += usGsmDataLen;

            continue;
        }


        if (TAF_FALSE == bIsBaseSet)
        {
            bIsBaseSet = TAF_TRUE;
            us82BaseHigh = usUnicodeChar;
            us82BaseLow  = usUnicodeChar;
        }
        else
        {
            if (usUnicodeChar < us82BaseLow)
            {
                us82BaseLow = usUnicodeChar;
            }

            if (usUnicodeChar > us82BaseHigh)
            {
                us82BaseHigh = usUnicodeChar;
            }

            /* UCS2????????????????????????????????127??????????82???? */
            if (AT_PB_GSM7_CODE_MAX_VALUE < (us82BaseHigh - us82BaseLow))
            {
                 AT_ERR_LOG("At_UnicodeTransferTo82CalcLength error: code base error");

                return AT_FAILURE;
            }
        }

        usDstLen++;
    }

    /* ??????82??????????????????82?????????? */
    *pusBaseCode = us82BaseLow;
    *pusDstLen   = usDstLen + AT_PB_82CODE_HEADER_LEN;

    return AT_SUCCESS;
}

/*****************************************************************************
 Prototype      : At_UnicodeTransferTo81
 Description    : ??????????81????????????
 Input          : pucData ??????UCS????
                : usLen   ??????UCS????????
                : pusBaseCode ????81????????Basecode
 Output         : pucDest     ????81????????????
 Return Value   : AT_XXX  --- ATC??????

 History        :
  1.Date        : 2009-08-19
    Author      : H59254
    Modification: Created function
  2.Date        : 2011-01-19
    Author      : j00168360
    Modification: [????????????]
*****************************************************************************/
TAF_UINT32 At_UnicodeTransferTo81(const TAF_UINT8 *pucData,
                                  TAF_UINT16      usLen,
                                  TAF_UINT16      usCodeBase,
                                  TAF_UINT8       *pucDest)
{
    TAF_UINT16      usUnicodeChar;
    TAF_UINT16      i;
    TAF_UINT8       aucGsmData[2];
    TAF_UINT16      usGsmDataLen = 0;
    TAF_UINT16      usDstLen     = AT_PB_81CODE_HEADER_LEN;

    for (i = 0; i < (usLen >> 1); i++)
    {
        usUnicodeChar = (*pucData << 8) | (*(pucData + 1));

        pucData += 2;

        /* ????????GSM??UCS???????????????? */
        if (AT_SUCCESS == At_OneUnicodeToGsm(usUnicodeChar, aucGsmData, &usGsmDataLen))
        {
            VOS_MemCpy((pucDest + usDstLen), aucGsmData, usGsmDataLen);
            usDstLen += usGsmDataLen;

            continue;
        }

        /* ???????? */
        if ((usCodeBase | (usUnicodeChar & AT_PB_GSM7_CODE_MAX_VALUE)) == usUnicodeChar)
        {
            /* ????81?????????? */
            pucDest[usDstLen++] =(TAF_UINT8)( AT_PB_CODE_NO8_BIT | (usUnicodeChar & AT_PB_GSM7_CODE_MAX_VALUE));
        }
        else
        {
            AT_ERR_LOG("At_UnicodeTransferTo81 error");

            return AT_FAILURE;
        }
    }

    /* ????81????header???? */
    pucDest[0] = SI_PB_ALPHATAG_TYPE_UCS2_81;
    pucDest[1] = (TAF_UINT8)(usDstLen - AT_PB_81CODE_HEADER_LEN);
    pucDest[2] = (TAF_UINT8)((usCodeBase & AT_PB_81_CODE_BASE_POINTER)>>7);

    return AT_SUCCESS;
}

/*****************************************************************************
 Prototype      : At_UnicodeTransferTo82
 Description    : ??????????82????????????
 Input          : pucData ??????UCS????
                : usLen   ??????UCS????????
                : pusBaseCode ????82????????Basecode
 Output         : pucDest     ????82????????????
 Return Value   : AT_XXX  --- ATC??????

 History        :
  1.Date        : 2009-08-19
    Author      : H59254
    Modification: Created function
  2.Date        : 2011-01-19
    Author      : j00168360
    Modification: [????????????]
*****************************************************************************/
TAF_UINT32 At_UnicodeTransferTo82(const TAF_UINT8 *pucData,
                                  TAF_UINT16      usLen,
                                  TAF_UINT16      usCodeBase,
                                  TAF_UINT8       *pucDest)
{
    TAF_UINT16      usUnicodeChar;
    TAF_UINT16      i;
    TAF_UINT8       aucGsmData[2];
    TAF_UINT16      usGsmDataLen = 0;
    TAF_UINT16      usDstLen     = AT_PB_82CODE_HEADER_LEN;

    for (i = 0; i < (usLen >> 1); i++)
    {
        usUnicodeChar = (*pucData << 8) | (*(pucData + 1));

        pucData += 2;

        /* ????????GSM??UCS???????????????? */
        if (AT_SUCCESS == At_OneUnicodeToGsm(usUnicodeChar, aucGsmData, &usGsmDataLen))
        {
            VOS_MemCpy(pucDest + usDstLen, aucGsmData, usGsmDataLen);
            usDstLen += usGsmDataLen;

            continue;
        }

        /* ???????? */
        if ((usUnicodeChar - usCodeBase) <= AT_PB_GSM7_CODE_MAX_VALUE)
        {
            /* ????82?????????? */
            pucDest[usDstLen++] = ((TAF_UINT8)(usUnicodeChar - usCodeBase)) |  AT_PB_CODE_NO8_BIT;
        }
        else
        {
            AT_ERR_LOG("At_UnicodeTransferTo81 error");

            return AT_FAILURE;
        }
    }

    /* ????82????header???? */
    pucDest[0] = SI_PB_ALPHATAG_TYPE_UCS2_82;
    pucDest[1] = (TAF_UINT8)(usDstLen - AT_PB_82CODE_HEADER_LEN);
    pucDest[2] = (TAF_UINT8)((usCodeBase & 0xff00)>> 8);
    pucDest[3] = (TAF_UINT8)(usCodeBase & 0x00ff);

    return AT_SUCCESS;
}

/*****************************************************************************
 Prototype      : At_Gsm7BitFormat
 Description    : GSM7bit??????????????
 Input          : pucSrc -- ??????GSM????
                : ulSrcLen -- ??????GSM????????
 Output         : pucDst -- ??????????????GSM????
                : pulDstLen -- ??????????????GSM????????
 Return Value   : AT_FAILURE -- ????
                  AT_SUCCESS -- ????
 History        :
  1.Date        : 2010-12-17
    Author      : J00168360
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_Gsm7BitFormat(TAF_UINT8   *pucSrc,
                            TAF_UINT16  usSrcLen,
                            TAF_UINT8   *pucDst,
                            TAF_UINT8   *pucDstLen)
{
   TAF_UINT16       usIndex;

   for (usIndex = 0; usIndex < usSrcLen; usIndex++)
   {
        /* GSM??????????????????0x7f???????????????????????????? */
        if (AT_PB_GSM7_CODE_MAX_VALUE < pucSrc[usIndex])
        {
            return AT_FAILURE;
        }

        pucDst[usIndex] = pucSrc[usIndex];
   }

   *pucDstLen = (TAF_UINT8)usSrcLen;

   return AT_SUCCESS;
}

/*****************************************************************************
 Prototype      : At_UnicodePrint2Unicode
 Description    : ascii??????unicode??2??????unicode??????
 Input          : pData --- ??????
                  pLen  --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
*****************************************************************************/
TAF_UINT32 At_UnicodePrint2Unicode(TAF_UINT8 *pData,TAF_UINT16 *pLen)
{
    TAF_UINT8 *pCheck   = pData;
    TAF_UINT8 *pWrite   = pData;
    TAF_UINT8 *pRead    = pData;
    TAF_UINT16 usLen    = 0;
    TAF_UINT16 usChkLen = 0;
    TAF_UINT8  ucHigh   = 0;
    TAF_UINT8  ucLow    = 0;

    /* ????????'0'-'9','a'-'f','A'-'F' */
    while( usChkLen++ < *pLen )
    {
        if( (*pCheck >= '0') && (*pCheck <= '9') )
        {
            *pCheck = *pCheck - '0';
        }
        else if( (*pCheck >= 'a') && (*pCheck <= 'f') )
        {
            *pCheck = (*pCheck - 'a') + 10;
        }
        else if( (*pCheck >= 'A') && (*pCheck <= 'F') )
        {
            *pCheck = (*pCheck - 'A') + 10;
        }
        else
        {
            return AT_FAILURE;
        }
        pCheck++;
    }

    while(usLen < *pLen)                    /* ???????? */
    {
        ucHigh = *pRead++;                  /* ???? */
        usLen++;
        ucLow  = *pRead++;                  /* ???? */
        usLen++;

        *pWrite++ = (TAF_UINT8)(ucHigh * 16) + ucLow;    /* ????UNICODE?????????? */
    }

    *pLen = usLen >> 1;
    return AT_SUCCESS;
}

/*****************************************************************************
 Prototype      : At_UnicodePrintToAscii
 Description    : unicode??1??????Ascii??????
 Input          : pData --- ??????
                  pLen  --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.??    ?? : 2014-05-22
    ??    ?? : g00261581
    ???????? : ????????:DTS2014042601879
*****************************************************************************/
TAF_UINT32 At_UnicodePrintToAscii(TAF_UINT8 *pData,TAF_UINT16 *pLen)
{
    TAF_UINT8 *pCheck        = pData;
    TAF_UINT8 *pWrite        = pData;
    TAF_UINT8 *pRead         = pData;
    TAF_UINT16 usLen         = 0;
    TAF_UINT16 usChkLen      = 0;
    TAF_UINT8  ucFirstByte   = 0;
    TAF_UINT8  ucSecondByte  = 0;
    TAF_UINT8  ucHigh        = 0;
    TAF_UINT8  ucLow         = 0;

    /* ????????'0'-'9','a'-'f','A'-'F' */
    while (usChkLen++ < *pLen)
    {
        if ((*pCheck >= '0') && (*pCheck <= '9'))
        {
            *pCheck = *pCheck - '0';
        }
        else if ((*pCheck >= 'a') && (*pCheck <= 'f'))
        {
            *pCheck = (*pCheck - 'a') + 10;
        }
        else if ((*pCheck >= 'A') && (*pCheck <= 'F'))
        {
            *pCheck = (*pCheck - 'A') + 10;
        }
        else
        {
            return AT_FAILURE;
        }
        pCheck++;
    }

    while(usLen < *pLen)                                                        /* ???????? */
    {
        ucFirstByte  = *pRead++;                                                /* ????????????0 */
        usLen++;
        ucSecondByte = *pRead++;
        usLen++;

        if ((0 != ucFirstByte) || (0 != ucSecondByte))
        {
            return AT_FAILURE;
        }

        ucHigh       = *pRead++;                                                /* ???? */
        usLen++;
        ucLow        = *pRead++;                                                /* ???? */
        usLen++;

        *pWrite++ = (TAF_UINT8)(ucHigh * 16) + ucLow;                          /* ????Unicode?????????? */
    }

    *pLen = usLen >> 2;
    return AT_SUCCESS;
}

/*****************************************************************************
 Prototype      : At_UnicodePrint2Ascii
 Description    : CSCS????,????????Unicode??????????Ascii
 Input          : pucDst   --- ????????
                  pucSrc   --- ??????
                  usSrcLen --- ??????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
*****************************************************************************/
TAF_UINT32 At_UnicodePrint2Ascii(TAF_UINT8 *pucDst, TAF_UINT8 *pucSrc, TAF_UINT16 usSrcLen)
{
    TAF_UINT8 *pWrite   = pucDst;
    TAF_UINT8 *pRead    = pucSrc;
    TAF_UINT8  aucTmp[4];
    TAF_UINT16 usChkLen = 0;
    TAF_UINT8  ucIndex = 0;

    /* ??4??????????????????ASCII?? */
    if(0 != (usSrcLen % 4))
    {
        return AT_FAILURE;
    }

    /* ???????????? */
    PS_MEM_SET(aucTmp,0x00,4);

    /* ????????'0'-'9','a'-'f','A'-'F' */
    while( usChkLen++ < usSrcLen )
    {
        if( (*pRead >= '0') && (*pRead <= '9') )
        {
            aucTmp[ucIndex++] = *pRead - '0';
        }
        else if( (*pRead >= 'a') && (*pRead <= 'f') )
        {
            aucTmp[ucIndex++] = (*pRead - 'a') + 10;
        }
        else if( (*pRead >= 'A') && (*pRead <= 'F') )
        {
            aucTmp[ucIndex++] = (*pRead - 'A') + 10;
        }
        else
        {
            return AT_FAILURE;
        }

        /* ?????????????????????? */
        if(4 == ucIndex)
        {
            /* ?????????????? */
            if((0 != aucTmp[0]) || (0 != aucTmp[1]))
            {
                return AT_FAILURE;
            }

            *pWrite++ = (TAF_UINT8)(aucTmp[2] * 16) + aucTmp[3];    /* ???????????? */
            if(AT_FAILURE == At_CheckDialNum(*(pWrite-1)))
            {
                return AT_FAILURE;
            }
            /* ???????? */
            ucIndex = 0;
        }

        /* ?????????? */
        pRead++;
    }

    return AT_SUCCESS;
}

/*****************************************************************************
 ?? ?? ??  : At_CheckNameUCS2Code
 ????????  : ??????????UCS2????????????
 ????????  : pucData: ??????????UCS2????
             pusLen: ????????

 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??05??05??
    ??    ??   : w00184875
    ????????   : DTS2012042607569,??????ucs2??????????

*****************************************************************************/
TAF_UINT32 At_CheckNameUCS2Code(TAF_UINT8 *pucData, TAF_UINT16 *pusLen)
{
    TAF_UINT8 ucAlphType = *pucData;
    TAF_UINT16 usAlphLen = *(pucData+1);

    if ((SI_PB_ALPHATAG_TYPE_UCS2_80 == ucAlphType) && (((*pusLen-1)%2) == 0))
    {
        /* 80???????????????????????????????????????? */
        return AT_SUCCESS;
    }

    if ((SI_PB_ALPHATAG_TYPE_UCS2_81 == ucAlphType) && ((*pusLen-3) >= usAlphLen))
    {
        /* 81???????????????????????????????????????????? */
        *pusLen = usAlphLen + 3;
        return AT_SUCCESS;
    }

    if ((SI_PB_ALPHATAG_TYPE_UCS2_82 == ucAlphType) && ((*pusLen-4) >= usAlphLen))
    {
        /* 82????????????????????????2?????? */
        *pusLen = usAlphLen + 4;
        return AT_SUCCESS;
    }

    return AT_FAILURE;

}

/*****************************************************************************
 ?? ?? ??  : AT_PhSendRestoreFactParm
 ????????  : E5????????????????????????
 ????????  : ??
 ????????  : ??
 ?? ?? ??  : VOS_VOID
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??11??23??
    ??    ??   : zhoujun /40661
    ????????   : ??????????

*****************************************************************************/
VOS_VOID AT_PhSendRestoreFactParm( VOS_VOID )
{
    VOS_UINT16                          usLength;
    VOS_UINT32                          i;

    for(i = 0; i < AT_MAX_CLIENT_NUM; i++)
    {
        if (AT_APP_USER == gastAtClientTab[i].UserType)
        {
            break;
        }
    }

    /* ??????E5 User,?????????? */
    if ( i >= AT_MAX_CLIENT_NUM )
    {
        return ;
    }

    usLength = 0;
    usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                     (VOS_CHAR *)pgucAtSndCodeAddr,
                                     (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                     "%s",gaucAtCrLf);
    usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                      (VOS_CHAR *)pgucAtSndCodeAddr,
                                      (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                      "^FACTORY");
    usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                     (VOS_CHAR *)pgucAtSndCodeAddr,
                                     (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                     "%s",gaucAtCrLf);

    At_SendResultData((VOS_UINT8)i,pgucAtSndCodeAddr,usLength);
}

/*****************************************************************************
 ?? ?? ??  : AT_PhSendRestoreFactParmNoReset
 ????????  : E5????????????????????????
 ????????  : ??
 ????????  : ??
 ?? ?? ??  : VOS_VOID
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??03??23??
    ??    ??   : ???? /l00204556
    ????????   : ??????????

*****************************************************************************/
VOS_VOID AT_PhSendRestoreFactParmNoReset( VOS_VOID )
{
    VOS_UINT16                          usLength;
    VOS_UINT32                          i;

    for(i = 0; i < AT_MAX_CLIENT_NUM; i++)
    {
        if (AT_APP_USER == gastAtClientTab[i].UserType)
        {
            break;
        }
    }

    /* ??????E5 User,?????????? */
    if ( i >= AT_MAX_CLIENT_NUM )
    {
        return ;
    }

    usLength = 0;
    usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                     (VOS_CHAR *)pgucAtSndCodeAddr,
                                     (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                     "%s",gaucAtCrLf);
    usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                      (VOS_CHAR *)pgucAtSndCodeAddr,
                                      (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                      "^NORSTFACT");
    usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                     (VOS_CHAR *)pgucAtSndCodeAddr,
                                     (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                     "%s",gaucAtCrLf);

    At_SendResultData((VOS_UINT8)i,pgucAtSndCodeAddr,usLength);
}


/*****************************************************************************
 Prototype      : At_SetNumTypePara
 Description    : ????UNICODE????ASCII??????????
 Input          : pucDst   --- ????????
                  pucSrc   --- ??????
                  usSrcLen --- ??????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetNumTypePara(TAF_UINT8 *pucDst, TAF_UINT8 *pucSrc, TAF_UINT16 usSrcLen)
{
    TAF_UINT32                          ulRet;
    TAF_UINT16                          usAsciiStrLen;

    if(AT_CSCS_UCS2_CODE == gucAtCscsType)
    {
        ulRet = At_UnicodePrint2Ascii(pucDst,pucSrc,usSrcLen);
        if (AT_SUCCESS != ulRet)
        {
            return ulRet;
        }
    }
    else
    {
        PS_MEM_CPY(pucDst,pucSrc,usSrcLen);
    }

    usAsciiStrLen = (TAF_UINT16)VOS_StrLen((TAF_CHAR *)pucDst);
    if(AT_SUCCESS == At_CheckDialString(pucDst, usAsciiStrLen))
    {
        return AT_SUCCESS;
    }
    else
    {
        return AT_FAILURE;
    }
}

/* Deleted by l00198894 for V9R1 STK????, 2013/07/11 */

/*****************************************************************************
 ?? ?? ??  : At_UpdateMsgRcvAct
 ????????  : ??????????????????MT??DS??????????????????????????????????????????
 ????????  : ucIndex --- ????????
             ucCsmsVersion      --- ??????????????
             CnmiMtType         --- ????????????
             CnmiDsType         --- ????????????????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  --- ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??10??16??
    ??    ??   : ?????? 62575
    ????????   : ??????????
  2.??    ??   : 2012??11??28??
    ??    ??   : ??????/f62575
    ????????   : DTS2012112706267????????????????????????MODEM????????????????????????
                 ??????????????????????????????????
  3.??    ??   : 2013??2??25??
    ??    ??   : L60609
    ????????   : DSDA PHASE III

  4.??    ??   : 2013??10??17??
    ??    ??   : w00167002
    ????????   : NETSCAN:??CNMI??????MT type??????????TAF????<MT>=3??????CLASS3
                 ??????????????CMT??????????
  5.??    ??   : 2014??03??04??
    ??    ??   : f62575
    ????????   : DTS2014030801193, +CNMI????<MT>3??????????
  6.??    ??   : 2015??12??26??
    ??    ??   : f00179208
    ????????   : Coverity????????
*****************************************************************************/
TAF_UINT32 At_UpdateMsgRcvAct(
    TAF_UINT8                           ucIndex,
    AT_CSMS_MSG_VERSION_ENUM_U8         ucCsmsVersion,
    AT_CNMI_MT_TYPE                     CnmiMtType,
    AT_CNMI_DS_TYPE                     CnmiDsType
)
{
    MN_MSG_SET_RCVMSG_PATH_PARM_STRU    stRcvPath;
    MN_MSG_RCVMSG_ACT_ENUM_U8           enRcvSmAct[AT_CNMI_MT_TYPE_MAX] = {MN_MSG_RCVMSG_ACT_STORE,
                                                                           MN_MSG_RCVMSG_ACT_STORE,
                                                                           MN_MSG_RCVMSG_ACT_TRANSFER_AND_ACK,
                                                                           MN_MSG_RCVMSG_ACT_STORE};
    MN_MSG_RCVMSG_ACT_ENUM_U8           enRcvStaRptAct[AT_CNMI_DS_TYPE_MAX] = {MN_MSG_RCVMSG_ACT_STORE,
                                                                               MN_MSG_RCVMSG_ACT_TRANSFER_AND_ACK,
                                                                               MN_MSG_RCVMSG_ACT_STORE};

    /* Modified by l60609 for DSDA Phase III, 2013-2-25, Begin */
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);

    PS_MEM_SET(&stRcvPath, 0, sizeof(MN_MSG_SET_RCVMSG_PATH_PARM_STRU));

    if ((CnmiMtType >= AT_CNMI_MT_TYPE_MAX)
     || (CnmiDsType >= AT_CNMI_DS_TYPE_MAX))
    {
        return AT_ERROR;
    }

    PS_MEM_CPY(&stRcvPath, &(pstSmsCtx->stCpmsInfo.stRcvPath), sizeof(stRcvPath));
    if (AT_CSMS_MSG_VERSION_PHASE2_PLUS == ucCsmsVersion)
    {
        enRcvSmAct[2] = MN_MSG_RCVMSG_ACT_TRANSFER_ONLY;
        enRcvStaRptAct[1] = MN_MSG_RCVMSG_ACT_TRANSFER_ONLY;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, End */

    stRcvPath.enRcvSmAct        = enRcvSmAct[CnmiMtType];
    stRcvPath.enRcvStaRptAct    = enRcvStaRptAct[CnmiDsType];
    stRcvPath.enSmsServVersion  = ucCsmsVersion;

    PS_MEM_SET(stRcvPath.aucReserve1, 0, sizeof(stRcvPath.aucReserve1));


    /* ??CNMI??????MT type??????????TAF,??<MT>=3??????CLASS3??????????????CMT???????? */
    stRcvPath.enCnmiMtType      = CnmiMtType;

    if (MN_ERR_NO_ERROR != MN_MSG_SetRcvMsgPath(gastAtClientTab[ucIndex].usClientId,
                                                gastAtClientTab[ucIndex].opId,
                                                &stRcvPath))
    {
        return AT_ERROR;
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_ReadActiveMessage
 ????????  : ??NVIM??????????????????
 ????????  : MODEM_ID_ENUM_UINT16                enModemId
             MN_MSG_ACTIVE_MESSAGE_STRU         *pstActiveMessage  ??????????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32 MN_ERR_NO_ERROR ????????????????????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??10??22??
    ??    ??   : f62575
    ????????   : ?????????? ????C??MN_MSG_ReadActiveMessage??????A??

  2.??    ??   : 2013??3??4??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
VOS_UINT32 AT_ReadActiveMessage(
    MODEM_ID_ENUM_UINT16                enModemId,
    MN_MSG_ACTIVE_MESSAGE_STRU         *pstActiveMessage
)
{
    VOS_UINT32                          ulRet;
    VOS_UINT8                          *pucActiveMessageInfo;
    VOS_UINT8                          *pucEvaluate;

    pucActiveMessageInfo = (VOS_UINT8 *)PS_MEM_ALLOC(WUEPS_PID_AT,
                                                     MN_MSG_ACTIVE_MESSAGE_PARA_LEN);
    if (VOS_NULL_PTR == pucActiveMessageInfo)
    {
        AT_WARN_LOG("AT_ReadActiveMessage : fail to alloc memory . ");
        return MN_ERR_NOMEM;
    }

    /* Modified by l60609 for DSDA Phase III, 2013-3-4, Begin */
    ulRet = NV_ReadEx(enModemId,
                      en_NV_Item_SMS_ActiveMessage_Para,
                      pucActiveMessageInfo,
                      MN_MSG_ACTIVE_MESSAGE_PARA_LEN);
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, End */
    if (NV_OK != ulRet)
    {
        AT_WARN_LOG("AT_ReadActiveMessage : fail to read NVIM . ");
        PS_MEM_FREE(WUEPS_PID_AT, pucActiveMessageInfo);
        return MN_ERR_CLASS_SMS_NVIM;
    }

    pucEvaluate                         = pucActiveMessageInfo;

    pstActiveMessage->enActiveStatus    = *pucEvaluate;
    pucEvaluate++;

    pstActiveMessage->enMsgCoding       = *pucEvaluate;
    pucEvaluate++;

    pstActiveMessage->stUrl.ulLen       = *pucEvaluate;
    pucEvaluate++;
    pstActiveMessage->stUrl.ulLen      |= (VOS_UINT32)(*pucEvaluate) << 8;
    pucEvaluate++;
    pstActiveMessage->stUrl.ulLen      |= (VOS_UINT32)(*pucEvaluate) << 16;
    pucEvaluate++;
    pstActiveMessage->stUrl.ulLen      |= (VOS_UINT32)(*pucEvaluate) << 24;
    pucEvaluate++;

    if (pstActiveMessage->stUrl.ulLen > MN_MSG_ACTIVE_MESSAGE_MAX_URL_LEN)
    {
        AT_WARN_LOG("AT_ReadActiveMessage : fail to read NVIM . ");
        pstActiveMessage->stUrl.ulLen = MN_MSG_ACTIVE_MESSAGE_MAX_URL_LEN;
    }

    PS_MEM_CPY(pstActiveMessage->stUrl.aucUrl,
               pucEvaluate,
               (VOS_UINT16)pstActiveMessage->stUrl.ulLen);

    PS_MEM_FREE(WUEPS_PID_AT, pucActiveMessageInfo);
    return MN_ERR_NO_ERROR;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetRstriggerPara
 ????????  : ????????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : AT_XXX  --- ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??3??15??
    ??    ??   : f62575
    ????????   : ??????????

  2.??    ??   : 2013??3??4??
    ??    ??   : L60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 AT_SetRstriggerPara(
    TAF_UINT8                           ucIndex
)
{
    MN_MSG_ACTIVE_MESSAGE_STRU          stActiveMessage;
    MN_MSG_ACTIVE_MESSAGE_STRU          stOrgActiveMessage;
    TAF_UINT32                          ulRet;
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, Begin */
    MODEM_ID_ENUM_UINT16                enModemId;
    VOS_UINT32                          ulRslt;

    enModemId = MODEM_ID_0;

    /* ???????? ??
       ??????0????AT_CME_INCORRECT_PARAMETERS
       ??????2????AT_TOO_MANY_PARA
    */
    if (gucAtParaIndex > 2)
    {
        return AT_TOO_MANY_PARA;
    }

    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ulRslt = AT_GetModemIdFromClient(ucIndex, &enModemId);

    if (VOS_OK != ulRslt)
    {
        AT_ERR_LOG("AT_SetRstriggerPara: Get modem id fail.");
        return AT_ERROR;
    }

    ulRet = AT_ReadActiveMessage(enModemId, &stOrgActiveMessage);
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, End */
    if (MN_ERR_NO_ERROR != ulRet)
    {
        AT_LOG1("AT_SetRstriggerPara: fail to get active message information , cause is %d",
                ulRet);
        return AT_ERROR;
    }

    /*URL:????????????URL,??????NVIM????URL????;????????????????URL????NVIM??????*/
    if (2 == gucAtParaIndex)
    {
        if (gastAtParaList[1].usParaLen > MN_MSG_ACTIVE_MESSAGE_MAX_URL_LEN)
        {
            stActiveMessage.stUrl.ulLen = MN_MSG_ACTIVE_MESSAGE_MAX_URL_LEN;
        }
        else
        {
            stActiveMessage.stUrl.ulLen = gastAtParaList[1].usParaLen;
        }
        PS_MEM_CPY(stActiveMessage.stUrl.aucUrl,
                   gastAtParaList[1].aucPara,
                   (VOS_UINT16)stActiveMessage.stUrl.ulLen);

        stActiveMessage.enMsgCoding    = MN_MSG_MSG_CODING_8_BIT;
    }
    else
    {
        PS_MEM_CPY(&stActiveMessage.stUrl, &stOrgActiveMessage.stUrl, sizeof(stActiveMessage.stUrl));
        stActiveMessage.enMsgCoding    = stOrgActiveMessage.enMsgCoding;
    }

    /*ACTIVE STATUS:*/
    stActiveMessage.enActiveStatus = (MN_MSG_ACTIVE_MESSAGE_STATUS_ENUM_UINT8)gastAtParaList[0].ulParaValue;

    /*????AT_WriteActiveMessage??????????????????????URL??????NVIM??*/
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, Begin */
    ulRet = AT_WriteActiveMessage(enModemId, &stOrgActiveMessage, &stActiveMessage);
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, End */
    if (MN_ERR_NO_ERROR != ulRet)
    {
        return AT_ERROR;
    }

    return AT_OK;

}

/*****************************************************************************
 Prototype      : At_SetCsmsPara
 Description    : +CSMS=<service>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2008??04??18??
    ??    ?? : f62575
    ???????? : CM????
  2.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCsmsPara(TAF_UINT8 ucIndex)
{
    VOS_UINT32                          ulRet;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);

    /* ????????: ?????????????????????????????? */
    if ((gucAtParaIndex != 1)
     || (0 == gastAtParaList[0].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    gastAtClientTab[ucIndex].opId = At_GetOpId();
    ulRet = At_UpdateMsgRcvAct(ucIndex,
                                (AT_CSMS_MSG_VERSION_ENUM_U8)gastAtParaList[0].ulParaValue,
                                pstSmsCtx->stCnmiType.CnmiMtType,
                                pstSmsCtx->stCnmiType.CnmiDsType);
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

    if (AT_OK != ulRet)
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CSMS_SET;
    return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */

}
/*****************************************************************************
 Prototype      : At_SetCgsmsPara
 Description    : +CGSMS=[<service>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2012??8??10??
    ??    ??   : y00213812
    ????????   : DTS2012082204471, TQE????
  3.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  4.??    ??   : 2013??5??17??
    ??    ??   : l00167671
    ????????   : NV??????????, ??NV??????????????????
*****************************************************************************/
TAF_UINT32 At_SetCgsmsPara(TAF_UINT8 ucIndex)
{
    AT_NVIM_SEND_DOMAIN_STRU            stSendDomain;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    MODEM_ID_ENUM_UINT16                enModemId;
    VOS_UINT32                          ulRslt;
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;
    VOS_UINT32                          ulLength;

    enModemId = MODEM_ID_0;
    ulLength  = 0;

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(0 == gastAtParaList[0].usParaLen)
    {
        /*->f62575*/
        gastAtParaList[0].ulParaValue = MN_MSG_SEND_DOMAIN_CS;
        /*<-f62575*/
    }
/*->f62575*/

    ulRslt = AT_GetModemIdFromClient(ucIndex, &enModemId);

    if (VOS_OK != ulRslt)
    {
        AT_ERR_LOG("At_SetCgsmsPara:Get modem id fail");
        return AT_ERROR;
    }

    pstSmsCtx = AT_GetModemSmsCtxAddrFromModemId(enModemId);

    pstSmsCtx->stCgsmsSendDomain.enSendDomain = (AT_CGSMS_SEND_DOMAIN_ENUM_U8)gastAtParaList[0].ulParaValue;

    /* ????CGSMS??,????NVIM??????????,??????????????????????????NV???????? */
    if (VOS_TRUE  == pstSmsCtx->stCgsmsSendDomain.ucActFlg)
    {
        PS_MEM_SET(&stSendDomain,0,sizeof(stSendDomain));
        (VOS_VOID)NV_GetLength(en_NV_Item_SMS_SEND_DOMAIN, &ulLength);
        if (NV_OK == NV_ReadEx(enModemId, en_NV_Item_SMS_SEND_DOMAIN, &stSendDomain, ulLength))
        {
            if ( (stSendDomain.ucSendDomain == At_SendDomainProtoToNvim(pstSmsCtx->stCgsmsSendDomain.enSendDomain))
                && (stSendDomain.ucActFlg == pstSmsCtx->stCgsmsSendDomain.ucActFlg) )
            {
                AT_INFO_LOG("At_SetCgsmsPara():The content to write is same as NV's");
                return AT_OK;
            }
        }
        stSendDomain.ucSendDomain = (VOS_UINT8)At_SendDomainProtoToNvim(pstSmsCtx->stCgsmsSendDomain.enSendDomain);
        stSendDomain.ucActFlg = pstSmsCtx->stCgsmsSendDomain.ucActFlg;

        /*modified by Y00213812 for DTS2012082204471 TQE????, 2012-08-10, begin*/
        (VOS_VOID)NV_GetLength(en_NV_Item_SMS_SEND_DOMAIN, &ulLength);
        if (NV_OK != NV_WriteEx(enModemId, en_NV_Item_SMS_SEND_DOMAIN, &stSendDomain, ulLength))
        {
            AT_INFO_LOG("At_SetCgsmsPara():ERROR: en_NV_Item_SMS_SEND_DOMAIN wirte failed");
            return AT_ERROR;
        }
        /*modified by Y00213812 for DTS2012082204471 TQE????, 2012-08-10, end*/
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */
    return AT_OK;
/*<-f62575*/
}

/*****************************************************************************
 ?? ?? ??  : At_GetSmsStorage
 ????????  : ????MN??????????????
 ????????  : VOS_UINT8 ucIndex                          ????????
             MN_MSG_MEM_STORE_ENUM_U8 enMemReadorDelete ????????????????????????????
             MN_MSG_MEM_STORE_ENUM_U8 enMemSendorWrite  ??????????????????????????
             MN_MSG_MEM_STORE_ENUM_U8 enMemRcv          ??????????????????????
 ????????  : ??
 ?? ?? ??  : AT_OK    ????????????????????????????
             AT_ERROR ????????????????????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??12??18??
    ??    ??   : ??????/f62575
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 At_GetSmsStorage(
    VOS_UINT8                           ucIndex,
    MN_MSG_MEM_STORE_ENUM_U8            enMemReadorDelete,
    MN_MSG_MEM_STORE_ENUM_U8            enMemSendorWrite,
    MN_MSG_MEM_STORE_ENUM_U8            enMemRcv
)
{
    MN_MSG_GET_STORAGE_STATUS_PARM_STRU stMemParm;

    if ((MN_MSG_MEM_STORE_SIM == enMemReadorDelete)
     || (MN_MSG_MEM_STORE_SIM == enMemSendorWrite)
     || (MN_MSG_MEM_STORE_SIM == enMemRcv))
    {
        stMemParm.enMem1Store = MN_MSG_MEM_STORE_SIM;
        gastAtClientTab[ucIndex].AtSmsData.bWaitForUsimStorageStatus = VOS_TRUE;
    }
    else
    {
        stMemParm.enMem1Store = MN_MSG_MEM_STORE_NONE;
        gastAtClientTab[ucIndex].AtSmsData.bWaitForUsimStorageStatus = VOS_FALSE;
    }

    if ((MN_MSG_MEM_STORE_NV == enMemReadorDelete)
     || (MN_MSG_MEM_STORE_NV == enMemSendorWrite)
     || (MN_MSG_MEM_STORE_NV == enMemRcv))
    {
        stMemParm.enMem2Store = MN_MSG_MEM_STORE_NV;
        gastAtClientTab[ucIndex].AtSmsData.bWaitForNvStorageStatus = VOS_TRUE;
    }
    else
    {
        stMemParm.enMem2Store = MN_MSG_MEM_STORE_NONE;
        gastAtClientTab[ucIndex].AtSmsData.bWaitForNvStorageStatus = VOS_FALSE;
    }

    if (MN_ERR_NO_ERROR != MN_MSG_GetStorageStatus(gastAtClientTab[ucIndex].usClientId,
                                                   gastAtClientTab[ucIndex].opId,
                                                   &stMemParm))
    {
        return AT_ERROR;
    }

    return AT_OK;
}

/*****************************************************************************
 Prototype      : At_SetCpmsPara
 Description    : +CPMS=<mem1>[,<mem2>[,<mem3>]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2008??04??18??
    ??    ?? : f62575
    ???????? : CM????
  3.??    ??   : 2011??1??12??
    ??    ??   : ??????/f62575
    ????????   : DTAS2011011200351 ????ORANGE????????PIN??????????????
  4.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  5.??    ??   : 2013??10??17??
    ??    ??   : w00167002
    ????????   : NETSCAN:??CNMI??????MT type??????????TAF????<MT>=3??????CLASS3
                 ??????????????CMT??????????
*****************************************************************************/
TAF_UINT32 At_SetCpmsPara(TAF_UINT8 ucIndex)
{
    MN_MSG_SET_RCVMSG_PATH_PARM_STRU    stRcvPath;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);

    PS_MEM_SET(&stRcvPath, 0, sizeof(MN_MSG_SET_RCVMSG_PATH_PARM_STRU));
    /* ???????? */
    if ((gucAtParaIndex > 3)
     || (0 == gucAtParaIndex)
     || (0 == gastAtParaList[0].usParaLen))
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    pstSmsCtx->stCpmsInfo.enTmpMemReadorDelete = (MN_MSG_MEM_STORE_ENUM_U8)(gastAtParaList[0].ulParaValue + 1);

    if (0 != gastAtParaList[1].usParaLen)
    {
        pstSmsCtx->stCpmsInfo.enTmpMemSendorWrite = (MN_MSG_MEM_STORE_ENUM_U8)(gastAtParaList[1].ulParaValue + 1);
    }
    else
    {
        pstSmsCtx->stCpmsInfo.enTmpMemSendorWrite = pstSmsCtx->stCpmsInfo.enMemSendorWrite;
    }

    /* ???????????? */
    gastAtClientTab[ucIndex].opId = At_GetOpId();
    PS_MEM_CPY(&stRcvPath, &(pstSmsCtx->stCpmsInfo.stRcvPath), sizeof(stRcvPath));


    /* ??CNMI??????MT type??????????TAF,??<MT>=3??????CLASS3??????????????CMT???????? */
    stRcvPath.enCnmiMtType = pstSmsCtx->stCnmiType.CnmiMtType;

    if (0 != gastAtParaList[2].usParaLen)
    {
        stRcvPath.enStaRptMemStore = (MN_MSG_MEM_STORE_ENUM_U8)(gastAtParaList[2].ulParaValue + 1);
        stRcvPath.enSmMemStore = (MN_MSG_MEM_STORE_ENUM_U8)(gastAtParaList[2].ulParaValue + 1);
    }

    if ((MN_MSG_MEM_STORE_NV == pstSmsCtx->stCpmsInfo.enTmpMemReadorDelete)
     || (MN_MSG_MEM_STORE_NV == pstSmsCtx->stCpmsInfo.enTmpMemSendorWrite)
     || (MN_MSG_MEM_STORE_NV == stRcvPath.enSmMemStore))
    {
        if (MN_MSG_ME_STORAGE_ENABLE != pstSmsCtx->enMsgMeStorageStatus)
        {
            return AT_ERROR;
        }
    }

    if (MN_ERR_NO_ERROR != MN_MSG_SetRcvMsgPath(gastAtClientTab[ucIndex].usClientId,
                                                gastAtClientTab[ucIndex].opId,
                                                &stRcvPath))
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].AtSmsData.bWaitForCpmsSetRsp = TAF_TRUE;

    if (AT_OK != At_GetSmsStorage(ucIndex,
                                  pstSmsCtx->stCpmsInfo.enTmpMemReadorDelete,
                                  pstSmsCtx->stCpmsInfo.enTmpMemSendorWrite,
                                  stRcvPath.enSmMemStore))
    {
        return AT_ERROR;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPMS_SET;
    return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */

}

/*****************************************************************************
 Prototype      : At_SetCmgfPara
 Description    : +CMGF=[<mode>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
 2.??    ?? : 2008??04??18??
   ??    ?? : f62575
   ???????? : CM????
  3.??    ??   : 2013??2??20??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCmgfPara(TAF_UINT8 ucIndex)
{
    /* Added by l60609 for DSDA Phase III, 2013-2-20, Begin */
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);
    /* Added by l60609 for DSDA Phase III, 2013-2-20, End */

    /* ???????? */
    if ((AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
     || (gucAtParaIndex > 1))
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ???????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        gastAtParaList[0].ulParaValue = AT_CMGF_MSG_FORMAT_PDU;
    }

    /* Modified by l60609 for DSDA Phase III, 2013-2-20, Begin */
    pstSmsCtx->enCmgfMsgFormat = (AT_CMGF_MSG_FORMAT_ENUM_U8)gastAtParaList[0].ulParaValue;
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, End */
    return AT_OK;
}
/*end add by zhoujun40661 2006-10-24 for CNMA*/

/*****************************************************************************
 ?? ?? ??  : At_SetCscaPara
 ????????  : +CSCA=<sca>[,<tosca>]
 ????????  : TAF_UINT8 ucIndex  ????????
 ????????  : ??
 ?? ?? ??  : TAF_UINT32 ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ?? : 2008??04??18??
    ??    ?? : f62575
    ????????   : ??????????
  2.??    ??   : 2013??2??25??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCscaPara(TAF_UINT8 ucIndex)
{
    TAF_UINT8                           aucAsciiNum[MN_MAX_ASCII_ADDRESS_NUM + 2];   /*array  of ASCII Num*/
    TAF_UINT8                           ucScaType;
    TAF_UINT32                          ulRet;
    MN_MSG_WRITE_SRV_PARAM_STRU         stServParm;
    TAF_UINT8                          *pucNum;                                /*????????????????????+??????????*/
    MN_MSG_SRV_PARAM_STRU               stParmInUsim;
    MN_OPERATION_ID_T                   opId                = At_GetOpId();
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, Begin */
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, End */

    PS_MEM_SET(&stServParm,   0, sizeof(MN_MSG_WRITE_SRV_PARAM_STRU));
    PS_MEM_SET(&stParmInUsim, 0, sizeof(MN_MSG_SRV_PARAM_STRU));

    /* ???????? */
    if ((0 == gastAtParaList[0].usParaLen)
     || (gucAtParaIndex > 2))
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ????<sca>?????????????????????? */
    if (AT_FAILURE == At_CheckNumLen((MN_MAX_ASCII_ADDRESS_NUM + 1), gastAtParaList[0].usParaLen))
    {
        return AT_ERROR;
    }

    /* ?????? */
    PS_MEM_SET(aucAsciiNum, 0x00, sizeof(aucAsciiNum));
    /* ????<sca> , ??UCS2????????ASCII??*/
    ulRet = At_SetNumTypePara(aucAsciiNum, gastAtParaList[0].aucPara, gastAtParaList[0].usParaLen);
    if (AT_SUCCESS != ulRet)
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    ucScaType = (TAF_UINT8)At_GetCodeType(aucAsciiNum[0]);
    if (AT_MSG_INTERNAL_ISDN_ADDR_TYPE == ucScaType)
    {
        pucNum = &aucAsciiNum[1];
    }
    else
    {
        pucNum = aucAsciiNum;
    }

    /* ????<tosca> */
    if (0 != gastAtParaList[1].usParaLen)
    {
        if (AT_MSG_INTERNAL_ISDN_ADDR_TYPE == ucScaType)
        {
            if (ucScaType != ((TAF_UINT8)gastAtParaList[1].ulParaValue))
            {
                return AT_CMS_OPERATION_NOT_ALLOWED;
            }
        }
        else
        {
            ucScaType = (TAF_UINT8)gastAtParaList[1].ulParaValue;
        }
    }

    /* ???????????? */
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, Begin */
    PS_MEM_CPY(&stParmInUsim, &(pstSmsCtx->stCscaCsmpInfo.stParmInUsim), sizeof(stParmInUsim));
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, End */

    stParmInUsim.ucParmInd &= ~MN_MSG_SRV_PARM_MASK_SC_ADDR;
    stParmInUsim.stScAddr.addrType = ucScaType;
    ulRet = AT_AsciiNumberToBcd((TAF_CHAR *)pucNum,
                                stParmInUsim.stScAddr.aucBcdNum,
                                &stParmInUsim.stScAddr.ucBcdLen);
    if (MN_ERR_NO_ERROR != ulRet)
    {
        return AT_ERROR;
    }
    stServParm.enMemStore = MN_MSG_MEM_STORE_SIM;
    stServParm.enWriteMode = MN_MSG_WRITE_MODE_REPLACE;
    stServParm.ulIndex = AT_CSCA_CSMP_STORAGE_INDEX;
    PS_MEM_CPY(&stServParm.stSrvParm, &stParmInUsim, sizeof(stServParm.stSrvParm));
    gastAtClientTab[ucIndex].opId = opId;
    if (MN_ERR_NO_ERROR == MN_MSG_WriteSrvParam(gastAtClientTab[ucIndex].usClientId, opId, &stServParm))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CSCA_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}
/*****************************************************************************
 Prototype      : At_SetCsmpPara
 Description    : +CSMP=[<fo>[,<vp>[,<pid>[,<dcs>]]]]
                  b7  b6   b5   b4   b3  b2  b1  b0
                  RP  UDHI SRR  VPF      RD  MTI
                  0   0    0    2        1   2
                  ????: ????????????????????????????????????????????????????????????????????????
                  <vp>????????????????????BCD??
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
  3. ??    ??   : 2007??04??04??
     ??    ??   : ?????? id:41410
     ????????   : ????????:A32D10081
  4. ??    ?? : 2008??04??18??
     ??    ?? : f62575
     ???????? : CM????
  5.??    ??   : 2013??2??25??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  6.??    ??   : 2015??12??26??
    ??    ??   : f00179208
    ????????   : Coverity????????
*****************************************************************************/
TAF_UINT32 At_SetCsmpPara(TAF_UINT8 ucIndex)
{
    MN_MSG_WRITE_SRV_PARAM_STRU         stServParm;
    MN_MSG_SRV_PARAM_STRU               stParmInUsim;
    TAF_UINT32                          ulRet;
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, Begin */
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);

    PS_MEM_SET(&stServParm,   0, sizeof(MN_MSG_WRITE_SRV_PARAM_STRU));
    PS_MEM_SET(&stParmInUsim, 0, sizeof(MN_MSG_SRV_PARAM_STRU));

    /* ???????? */
    if ((AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
     || (gucAtParaIndex > 4))
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ????<fo> */
    if(0 != gastAtParaList[0].usParaLen)
    {
        ulRet = At_ParseCsmpFo(&(pstSmsCtx->stCscaCsmpInfo.ucTmpFo));
        if (AT_SUCCESS != ulRet)
        {
            return ulRet;
        }
    }
    else
    {
        pstSmsCtx->stCscaCsmpInfo.ucTmpFo = pstSmsCtx->stCscaCsmpInfo.ucFo;
    }

    PS_MEM_CPY(&stParmInUsim, &(pstSmsCtx->stCscaCsmpInfo.stParmInUsim), sizeof(stParmInUsim));

    /* ????<vp> */
    ulRet =  At_ParseCsmpVp(ucIndex, &(pstSmsCtx->stCscaCsmpInfo.stTmpVp));
    if (AT_SUCCESS != ulRet)
    {
        return ulRet;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, End */

    /* ????<pid> */
    if(0 != gastAtParaList[2].usParaLen)
    {
        /* ????: gastAtParaList[2].ulParaValue?????????????????????????????????????? */
        if(AT_FAILURE == At_Auc2ul(gastAtParaList[2].aucPara,gastAtParaList[2].usParaLen,&gastAtParaList[2].ulParaValue))
        {
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }

        if(gastAtParaList[2].ulParaValue <= 255)
        {
            stParmInUsim.ucParmInd &= ~MN_MSG_SRV_PARM_MASK_PID;
            stParmInUsim.ucPid = (TAF_UINT8)gastAtParaList[2].ulParaValue;
        }
        else
        {
            AT_NORM_LOG("At_SetCsmpPara: unsupport VP type.");
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }
    }

    /* ????<dcs> */
    if(0 != gastAtParaList[3].usParaLen)
    {
        /* ????: gastAtParaList[3].ulParaValue?????????????????????????????????????? */
        if(AT_FAILURE == At_Auc2ul(gastAtParaList[3].aucPara,gastAtParaList[3].usParaLen,&gastAtParaList[3].ulParaValue))
        {
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }

        if(gastAtParaList[3].ulParaValue <= 255)
        {
            stParmInUsim.ucParmInd &= ~MN_MSG_SRV_PARM_MASK_DCS;
            stParmInUsim.ucDcs = (TAF_UINT8)gastAtParaList[3].ulParaValue;
        }
        else
        {
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }
    }

    /* ???????????? */
    stServParm.enMemStore = MN_MSG_MEM_STORE_SIM;
    stServParm.enWriteMode = MN_MSG_WRITE_MODE_REPLACE;
    stServParm.ulIndex = AT_CSCA_CSMP_STORAGE_INDEX;
    PS_MEM_CPY(&stServParm.stSrvParm, &stParmInUsim, sizeof(stServParm.stSrvParm));
    gastAtClientTab[ucIndex].opId = At_GetOpId();
    if (MN_ERR_NO_ERROR == MN_MSG_WriteSrvParam(gastAtClientTab[ucIndex].usClientId, gastAtClientTab[ucIndex].opId, &stServParm))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CSMP_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}
/*****************************************************************************
 Prototype      : At_SetCsdhPara
 Description    : +CSDH=[<show>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCsdhPara(TAF_UINT8 ucIndex)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ?????????? */
    if(0 != gastAtParaList[0].usParaLen)
    {
        pstSmsCtx->ucCsdhType = (AT_CSDH_TYPE)gastAtParaList[0].ulParaValue;
    }
    else
    {
        pstSmsCtx->ucCsdhType = AT_CSDH_NOT_SHOW_TYPE;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */
    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetCnmiPara
 Description    : +CNMI=[<mode>[,<mt>[,<bm>[,<ds>[,<bfr>]]]]]

 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2008??04??18??
    ??    ?? : f62575
    ???????? : CM????
  3.??    ??   : 2009-09-12
    ??    ??   : F62575
    ????????   : ????????: CNMI????????????????????E1220??E176????????

  4.??    ??   : 2010??5??13??
    ??    ??   : zhoujun /z40661
    ????????   : ????CBS??????
  5.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  6.??  ?? : 2013-12-06
    ??  ??        : f62575
    ????????       : DTS2013111308256????????AT+CNMI=????????????AT+CNMI
*****************************************************************************/
TAF_UINT32 At_SetCnmiPara(TAF_UINT8 ucIndex)
{
    TAF_UINT32                          ulRet;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);

    /* ?????????????????????? */
    /* ?????????????????????????????????????????? */
    if (AT_CMD_OPT_SET_CMD_NO_PARA == g_stATParseCmd.ucCmdOptType)
    {
        pstSmsCtx->stCnmiType.CnmiTmpModeType = AT_CNMI_MODE_BUFFER_TYPE;
        pstSmsCtx->stCnmiType.CnmiTmpMtType   = AT_CNMI_MT_NO_SEND_TYPE;
        pstSmsCtx->stCnmiType.CnmiTmpBmType   = AT_CNMI_BM_NO_SEND_TYPE;
        pstSmsCtx->stCnmiType.CnmiTmpDsType   = AT_CNMI_DS_NO_SEND_TYPE;
        pstSmsCtx->stCnmiType.CnmiTmpBfrType  = AT_CNMI_BFR_SEND_TYPE;
    }

    if (AT_CMD_OPT_SET_PARA_CMD == g_stATParseCmd.ucCmdOptType)
    {
        /* ????????????????????????????????0?????????????????????? */
        if ((0 == gucAtParaIndex)
         || (gucAtParaIndex > 5))
        {
            return AT_CMS_OPERATION_NOT_SUPPORTED;
        }

        /* ?????????????????????????????????????????? */
        pstSmsCtx->stCnmiType.CnmiTmpModeType = pstSmsCtx->stCnmiType.CnmiModeType;
        pstSmsCtx->stCnmiType.CnmiTmpMtType   = pstSmsCtx->stCnmiType.CnmiMtType;
        pstSmsCtx->stCnmiType.CnmiTmpBmType   = pstSmsCtx->stCnmiType.CnmiBmType;
        pstSmsCtx->stCnmiType.CnmiTmpDsType   = pstSmsCtx->stCnmiType.CnmiDsType;
        pstSmsCtx->stCnmiType.CnmiTmpBfrType  = pstSmsCtx->stCnmiType.CnmiBfrType;

        if (0 != gastAtParaList[0].usParaLen)
        {
            pstSmsCtx->stCnmiType.CnmiTmpModeType = (AT_CNMI_MODE_TYPE)gastAtParaList[0].ulParaValue;
        }

        if (0 != gastAtParaList[1].usParaLen)
        {
            pstSmsCtx->stCnmiType.CnmiTmpMtType = (AT_CNMI_MT_TYPE)gastAtParaList[1].ulParaValue;
        }

        if (0 != gastAtParaList[2].usParaLen)
        {
            pstSmsCtx->stCnmiType.CnmiTmpBmType = (AT_CNMI_BM_TYPE)gastAtParaList[2].ulParaValue;
            if ( ( AT_CNMI_BM_CBM_TYPE != pstSmsCtx->stCnmiType.CnmiTmpBmType )
               && (AT_CNMI_BM_NO_SEND_TYPE != pstSmsCtx->stCnmiType.CnmiTmpBmType ))
            {
                return AT_CMS_OPERATION_NOT_SUPPORTED;
            }
        }

        if (0 != gastAtParaList[3].usParaLen)
        {
            pstSmsCtx->stCnmiType.CnmiTmpDsType = (AT_CNMI_DS_TYPE)gastAtParaList[3].ulParaValue;
        }

        if (0 != gastAtParaList[4].usParaLen)
        {
            pstSmsCtx->stCnmiType.CnmiTmpBfrType = (AT_CNMI_BFR_TYPE)gastAtParaList[4].ulParaValue;
        }

        if ((AT_CNMI_MODE_BUFFER_TYPE == pstSmsCtx->stCnmiType.CnmiTmpModeType)
         || (AT_CNMI_MODE_SEND_OR_BUFFER_TYPE == pstSmsCtx->stCnmiType.CnmiTmpModeType))
        {
            if ((AT_CNMI_MT_CMT_TYPE == pstSmsCtx->stCnmiType.CnmiTmpMtType)
             || (AT_CNMI_MT_CLASS3_TYPE == pstSmsCtx->stCnmiType.CnmiTmpMtType))
            {
                return AT_CMS_OPERATION_NOT_SUPPORTED;
            }

            if (AT_CNMI_DS_CDS_TYPE == pstSmsCtx->stCnmiType.CnmiTmpDsType)
            {
                return AT_CMS_OPERATION_NOT_SUPPORTED;
            }

        }
    }

    gastAtClientTab[ucIndex].opId = At_GetOpId();
    ulRet = At_UpdateMsgRcvAct(ucIndex,
                               pstSmsCtx->enCsmsMsgVersion,
                               pstSmsCtx->stCnmiType.CnmiTmpMtType,
                               pstSmsCtx->stCnmiType.CnmiTmpDsType);
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */
    if (AT_OK != ulRet)
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CNMI_SET;
    return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
}
/*****************************************************************************
 Prototype      : At_SetCmglPara
 Description    : TEXT: +CMGL[=<stat>[,<chg>]]
                  PDU : +CMGL[=<stat>[,<chg>]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
  3.??    ?? : 2007-11-24
    ??    ?? : z40661
    ???????? : ????????:A32D13596
  4.??    ?? : 2008??04??18??
    ??    ?? : f62575
    ???????? : CM????????????<stat>??????????????
  5.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  6.??    ??   : 2013??9??27??
    ??    ??   : w00167002
    ????????   : DTS2013092100149:????C??TASKDELAY????????V9????????????????
                   TASKDELAY????????????????AT??????????????
*****************************************************************************/
TAF_UINT32 At_SetCmglPara(TAF_UINT8 ucIndex)
{
    MN_MSG_LIST_PARM_STRU               stListParm;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);

    /* ???????? */
    if ((AT_CMD_OPT_SET_PARA_CMD == g_stATParseCmd.ucCmdOptType) && (0 == gastAtParaList[0].usParaLen))
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ?????? */
    PS_MEM_SET(&stListParm,0x00,sizeof(stListParm));

    stListParm.ucIsFirstTimeReq = VOS_TRUE;

    /* ????<stat> */
    if (0 != gastAtParaList[0].usParaLen)
    {
        stListParm.enStatus = (TAF_UINT8)gastAtParaList[0].ulParaValue;
    }
    else
    {
        stListParm.enStatus = (TAF_UINT8)MN_MSG_STATUS_MT_NOT_READ;
    }

    /* ?????????????? */
    stListParm.enMemStore = pstSmsCtx->stCpmsInfo.enMemReadorDelete;

    if(0 == pstSmsCtx->ucParaCmsr)
    {
        stListParm.bChangeFlag = TAF_TRUE;
    }
    else
    {
        stListParm.bChangeFlag = TAF_FALSE;
        if(gucAtParaIndex > 1)
        {
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

    /* ???????????? */
    gastAtClientTab[ucIndex].opId = At_GetOpId();
    if (MN_ERR_NO_ERROR == MN_MSG_List(gastAtClientTab[ucIndex].usClientId, gastAtClientTab[ucIndex].opId,&stListParm))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CMGL_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 Prototype      : At_SetCmgrPara
 Description    : TEXT: +CMGR=<index>[,<chg>]
                  PDU : +CMGR=<index>[,<chg>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2008??04??18??
    ??    ?? : f62575
    ???????? : CM????
  3.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCmgrPara(TAF_UINT8 ucIndex)
{
    MN_MSG_READ_PARM_STRU               stReadParm;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);

    /* ???????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ?????? */
    PS_MEM_SET(&stReadParm,0x00,sizeof(stReadParm));

    /* ???????? */
    stReadParm.ulIndex = gastAtParaList[0].ulParaValue;

    /* ?????????????? */
    stReadParm.enMemStore = pstSmsCtx->stCpmsInfo.enMemReadorDelete;

    if(0 == pstSmsCtx->ucParaCmsr)
    {
        stReadParm.bChangeFlag = TAF_TRUE;
    }
    else
    {
        stReadParm.bChangeFlag = TAF_FALSE;
        if(gucAtParaIndex > 1)
        {
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

    /* ???????????? */
    gastAtClientTab[ucIndex].opId = At_GetOpId();
    if(MN_ERR_NO_ERROR == MN_MSG_Read(gastAtClientTab[ucIndex].usClientId, gastAtClientTab[ucIndex].opId, &stReadParm))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CMGR_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}
/*begin add by zhoujun40661 2006-10-10 for cnma*/
/*****************************************************************************
 Prototype      : At_SetCnmaPara
 Description    : +CNMA[=<n>[,<length>[<CR> PDU is given<ctrl-Z/ESC>]]]
                  +CNMA
 Input          :
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2008??04??18??
    ??    ?? : f62575
    ???????? : CM????
  3.??    ??   : 2013??2??20??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCnmaPara(TAF_UINT8 ucIndex)
{
    TAF_UINT32                          ulRet;
    TAF_BOOL                            bRpAck              = TAF_TRUE;
    MN_MSG_SEND_ACK_PARM_STRU           *pstAckParm;
    /* Added by l60609 for DSDA Phase III, 2013-2-20, Begin */
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);
    /* Added by l60609 for DSDA Phase III, 2013-2-20, End */

    if (gucAtParaIndex > 2)
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ?????? */
    PS_MEM_SET(&gastAtClientTab[ucIndex].AtSmsData, 0x00, sizeof(gastAtClientTab[ucIndex].AtSmsData));
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, Begin */
    if (AT_CMGF_MSG_FORMAT_TEXT == pstSmsCtx->enCmgfMsgFormat)    /* TEXT???? */
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, End */
    {
        if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
        {
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }
    }
    else    /* PDU???? */
    {
        if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
        {
            if(0 == gastAtParaList[0].usParaLen)
            {
                return AT_CMS_OPERATION_NOT_ALLOWED;
            }
            else
            {
                /* ????<n> */
                gastAtClientTab[ucIndex].AtSmsData.ucCnmaType = (TAF_UINT8)gastAtParaList[0].ulParaValue;
            }

            /*????????<n>,????????????RP-ACK??RP-ERROR*/
            if ((0 != gastAtParaList[1].usParaLen)
             && (0 != gastAtParaList[1].ulParaValue))
            {
                if (0 == gastAtClientTab[ucIndex].AtSmsData.ucCnmaType)
                {
                    return AT_ERROR;
                }

                /* ????<length> */
                if (gastAtParaList[1].ulParaValue > AT_MSG_MAX_TPDU_LEN)
                {
                    AT_NORM_LOG("At_SetCnmaPara: the length of PDU is not support.");
                    return AT_CMS_OPERATION_NOT_ALLOWED;    /* ???????????? */
                }

                gastAtClientTab[ucIndex].AtSmsData.ucPduLen = (TAF_UINT8)gastAtParaList[1].ulParaValue;
                At_SetMode(ucIndex,AT_CMD_MODE,AT_SMS_MODE);         /* ?????????????? */
                /* ???????????????? */
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CNMA_PDU_SET;
                return AT_WAIT_SMS_INPUT;   /* ???????????????????????? */
            }
            else
            {
                if (2 == gastAtClientTab[ucIndex].AtSmsData.ucCnmaType)
                {
                    bRpAck = TAF_FALSE;
                }
            }
        }
    }

    /*CMGF??????????????, ??CNMA??????????CNMA??????<length>??0*/
    pstAckParm = At_GetAckMsgMem();
    PS_MEM_SET(pstAckParm, 0x00, sizeof(MN_MSG_SEND_ACK_PARM_STRU));

    if (TAF_TRUE == bRpAck)
    {
        pstAckParm->bRpAck = TAF_TRUE;
        pstAckParm->stTsRawData.enTpduType = MN_MSG_TPDU_DELIVER_RPT_ACK;
    }
    else
    {
        pstAckParm->bRpAck = TAF_FALSE;
        pstAckParm->enRpCause = MN_MSG_RP_CAUSE_PROTOCOL_ERR_UNSPECIFIED;
        pstAckParm->stTsRawData.enTpduType = MN_MSG_TPDU_DELIVER_RPT_ERR;
        pstAckParm->stTsRawData.ulLen = 2;
        pstAckParm->stTsRawData.aucData[0] = 0;
        pstAckParm->stTsRawData.aucData[1] = 0xff;
    }

    /* ???????????? */
    gastAtClientTab[ucIndex].opId = At_GetOpId();
    if (MN_ERR_NO_ERROR == MN_MSG_SendAck(gastAtClientTab[ucIndex].usClientId, gastAtClientTab[ucIndex].opId, pstAckParm))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CNMA_TEXT_SET;
        ulRet = AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        ulRet = AT_ERROR;
    }

    return ulRet;
}

/*end add by zhoujun40661 2006-10-10 for cnma*/
/*****************************************************************************
 Prototype      : At_SetCmgsPara
 Description    : TEXT: +CMGS=<da>[,<toda>]<CR>text is entered<ctrl-Z/ESC>
                  PDU : +CMGS=<length><CR>PDU is given<ctrl-Z/ESC>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2008??04??18??
    ??    ?? : f62575
    ???????? : CM????
  3.??    ??   : 2013??2??20??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCmgsPara(TAF_UINT8 ucIndex)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, Begin */
    TAF_UINT8                           ucSmSFormat;
    TAF_UINT32                          ulRet;

    ucSmSFormat = AT_GetModemSmsCtxAddrFromClientId(ucIndex)->enCmgfMsgFormat;

    /* ??????????????<da>????????<length>???????????????????? */
    if (0 == gastAtParaList[0].usParaLen )
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ?????? */
    PS_MEM_SET(&gastAtClientTab[ucIndex].AtSmsData,0x00,sizeof(gastAtClientTab[ucIndex].AtSmsData));

    if (AT_CMGF_MSG_FORMAT_TEXT == ucSmSFormat)    /* TEXT???????????? */
    {
        if (gucAtParaIndex > 2)  /* ???????? */
        {
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }

        /* ???????? */
        /* ????<da> <toda>*/
        ulRet = At_GetAsciiOrBcdAddr(gastAtParaList[0].aucPara,
                                     gastAtParaList[0].usParaLen,
                                     (TAF_UINT8)gastAtParaList[1].ulParaValue,
                                     gastAtParaList[1].usParaLen,
                                     &gastAtClientTab[ucIndex].AtSmsData.stAsciiAddr,
                                     TAF_NULL_PTR);
        if ((AT_OK != ulRet)
         || (0 == gastAtClientTab[ucIndex].AtSmsData.stAsciiAddr.ulLen))
        {
            AT_NORM_LOG("At_SetCmgsPara: no da.");
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }


    }
    else    /* PDU???????????? */
    {
        if (gucAtParaIndex > 1)  /* ???????? */
        {
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }
        /* ????<length> */
        gastAtClientTab[ucIndex].AtSmsData.ucPduLen = (TAF_UINT8)gastAtParaList[0].ulParaValue;
    }

    At_SetMode(ucIndex,AT_CMD_MODE,AT_SMS_MODE);         /* ?????????????? */
    /* ???????????????? */
    if (AT_CMGF_MSG_FORMAT_TEXT == ucSmSFormat)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CMGS_TEXT_SET;
    }
    else
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CMGS_PDU_SET;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, End */
    return AT_WAIT_SMS_INPUT;   /* ???????????????????????? */
}

/*****************************************************************************
 Prototype      : At_SetCmssPara
 Description    : TEXT: +CMSS=<index>[,<da>[,<toda>]]
                  PDU : +CMSS=<index>[,<da>[,<toda>]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2008??04??18??
    ??    ?? : f62575
    ???????? : CM????
  3.??    ??   : 2013??2??22??
    ??    ??   : L60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCmssPara(TAF_UINT8 ucIndex)
{
    MN_MSG_SEND_FROMMEM_PARM_STRU       stSendFromMemParm;
    TAF_UINT32                          ulRet;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);

    /* ??????????????<index>???????????????????? */
    if ((0 == gastAtParaList[0].usParaLen)
     || (gucAtParaIndex > 3))
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ????<da> */
    ulRet = At_GetAsciiOrBcdAddr(gastAtParaList[1].aucPara,
                                 gastAtParaList[1].usParaLen,
                                 (TAF_UINT8)gastAtParaList[2].ulParaValue,
                                 gastAtParaList[2].usParaLen,
                                 VOS_NULL_PTR,
                                 &stSendFromMemParm.stDestAddr);
    if (AT_OK != ulRet)
    {
        return AT_ERROR;
    }

    stSendFromMemParm.enDomain = pstSmsCtx->stCgsmsSendDomain.enSendDomain;
    /* ?????????????? */
    stSendFromMemParm.enMemStore = pstSmsCtx->stCpmsInfo.enMemSendorWrite;
    stSendFromMemParm.ulIndex = gastAtParaList[0].ulParaValue;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

    /* ???????????? */
    gastAtClientTab[ucIndex].opId = At_GetOpId();
    if (MN_ERR_NO_ERROR == MN_MSG_SendFromMem(gastAtClientTab[ucIndex].usClientId, gastAtClientTab[ucIndex].opId, &stSendFromMemParm))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CMSS_SET;
        gastAtClientTab[ucIndex].AtSmsData.ucMsgSentSmNum = 1;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}
/*****************************************************************************
 Prototype      : At_SetCmgwPara
 Description    : TEXT: +CMGW[=<oa/da>[,<tooa/toda>[,<stat>]]]<CR>text is entered<ctrl-Z/ESC>
                  PDU : +CMGW=<length>[,<stat>]<CR>PDU is given<ctrl-Z/ESC>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
  3.??    ?? : 2008??04??18??
    ??    ?? : f62575
    ???????? : CM??????
  4.??    ??   : 2013??2??25??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCmgwPara(TAF_UINT8 ucIndex)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, Begin */
    TAF_UINT8                           ucSmSFormat;
    TAF_UINT32                          ulRet;
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);

    ucSmSFormat = pstSmsCtx->enCmgfMsgFormat;

    /* ?????? */
    PS_MEM_SET(&gastAtClientTab[ucIndex].AtSmsData,0x00,sizeof(gastAtClientTab[ucIndex].AtSmsData));
    if (AT_CMGF_MSG_FORMAT_TEXT == ucSmSFormat)    /* TEXT???????????? */
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, End */
    {
        /* ???????? */
        if ((AT_CMD_OPT_SET_PARA_CMD == g_stATParseCmd.ucCmdOptType)
         && (0 == gastAtParaList[0].usParaLen))
        {
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }

        if (gucAtParaIndex > 3)  /* ???????? */
        {
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }

        /* ????<oa/da> */
        ulRet = At_GetAsciiOrBcdAddr(gastAtParaList[0].aucPara,
                                     gastAtParaList[0].usParaLen,
                                     (TAF_UINT8)gastAtParaList[1].ulParaValue,
                                     gastAtParaList[1].usParaLen,
                                     &gastAtClientTab[ucIndex].AtSmsData.stAsciiAddr,
                                     TAF_NULL_PTR);
        if (AT_OK != ulRet)
        {
            return ulRet;
        }

        /* ????<stat> */
        if (0 != gastAtParaList[2].usParaLen)
        {
            gastAtClientTab[ucIndex].AtSmsData.SmState = (TAF_UINT8)gastAtParaList[2].ulParaValue;
        }
        else
        {
            gastAtClientTab[ucIndex].AtSmsData.SmState = MN_MSG_STATUS_MO_NOT_SENT;
        }

        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CMGW_TEXT_SET;
    }
    else    /* PDU???????????? */
    {
        /* ???????? */
        if (0 == gastAtParaList[0].usParaLen)
        {
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }

        if (gucAtParaIndex > 2)  /* ???????? */
        {
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }

        if (gastAtParaList[0].ulParaValue > AT_MSG_MAX_TPDU_LEN)
        {
            AT_NORM_LOG("At_SendPduMsgOrCmd: invalid tpdu data length.");
            return AT_ERROR;
        }
        gastAtClientTab[ucIndex].AtSmsData.ucPduLen = (TAF_UINT8)gastAtParaList[0].ulParaValue;

        /* ????<stat> */
        if (0 != gastAtParaList[1].usParaLen)
        {
            gastAtClientTab[ucIndex].AtSmsData.SmState = (TAF_UINT8)gastAtParaList[1].ulParaValue;
        }
        else
        {
            gastAtClientTab[ucIndex].AtSmsData.SmState = MN_MSG_STATUS_MO_NOT_SENT;
        }

        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CMGW_PDU_SET;
    }

    if ((MN_MSG_STATUS_MT_NOT_READ != gastAtClientTab[ucIndex].AtSmsData.SmState)
     && (MN_MSG_STATUS_MT_READ != gastAtClientTab[ucIndex].AtSmsData.SmState)
     && (MN_MSG_STATUS_MO_NOT_SENT != gastAtClientTab[ucIndex].AtSmsData.SmState)
     && (MN_MSG_STATUS_MO_SENT != gastAtClientTab[ucIndex].AtSmsData.SmState))
    {
        AT_NORM_LOG("At_SetCmgwPara: invalid sm status.");
        return AT_ERROR;
    }

    At_SetMode(ucIndex,AT_CMD_MODE,AT_SMS_MODE);         /* ?????????????? */

    return AT_WAIT_SMS_INPUT;   /* ???????????????????????? */
}


/*****************************************************************************
 Prototype      : At_SetCmgdPara
 Description    : +CMGD=<index>[,<delflag>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2008??04??18??
    ??    ?? : f62575
    ???????? : CM????
  3.??    ??   : 2012??8??10??
    ??    ??   : L00171473
    ????????   : DTS2012082204471, TQE????
  4.??    ??   : 2013??2??25??
    ??    ??   : L60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCmgdPara(TAF_UINT8 ucIndex)
{
    MN_MSG_DELETE_PARAM_STRU            stDelete;
    MN_OPERATION_ID_T                   opId                = At_GetOpId();
    TAF_UINT32                          ulDeleteTypeIndex   = 0;
    TAF_UINT32                          ulDeleteTypes[5]    = {AT_MSG_DELETE_SINGLE,
                                                               AT_MSG_DELETE_READ,
                                                               (AT_MSG_DELETE_READ + AT_MSG_DELETE_SENT),
                                                               (AT_MSG_DELETE_READ + AT_MSG_DELETE_SENT + AT_MSG_DELETE_UNSENT),
                                                               AT_MSG_DELETE_ALL};
    TAF_UINT32                          ulRet;
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, Begin */
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);


    PS_MEM_SET(&stDelete, 0x00, sizeof(stDelete));


    /* ???????? */
    if (gucAtParaIndex > 2)
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ????<index> */
    stDelete.ulIndex = gastAtParaList[0].ulParaValue;

    /* ?????????????? */
    stDelete.enMemStore = pstSmsCtx->stCpmsInfo.enMemReadorDelete;
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, End */

    /* ????<delflag> */
    if (0 != gastAtParaList[1].usParaLen)
    {
        ulDeleteTypeIndex = gastAtParaList[1].ulParaValue;
    }
    else
    {
        ulDeleteTypeIndex = 0;
    }

    gastAtClientTab[ucIndex].AtSmsData.ucMsgDeleteTypes = (TAF_UINT8)ulDeleteTypes[ulDeleteTypeIndex];
    if (AT_MSG_DELETE_SINGLE == gastAtClientTab[ucIndex].AtSmsData.ucMsgDeleteTypes)
    {
        if(0 == gastAtParaList[0].usParaLen)
        {
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }
    }

    /* ???????????? */
    ulRet = At_MsgDeleteCmdProc(ucIndex, opId, stDelete, gastAtClientTab[ucIndex].AtSmsData.ucMsgDeleteTypes);
    if (AT_OK != ulRet)
    {
        return ulRet;
    }

    gastAtClientTab[ucIndex].opId = opId;
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CMGD_SET;
    return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
}

/*****************************************************************************
 Prototype      : At_SetCmgcPara
 Description    : TEXT: +CMGC=<fo>,<ct>[,<pid>[,<mn>[,<da>[,<toda>]]]]<CR>text is entered<ctrl-Z/ESC>
                  PDU : +CMGC=<length><CR>PDU is given<ctrl-Z/ESC>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2008??04??18??
    ??    ?? : f62575
    ???????? : CM????
  3.??    ?? : 2010??06??24??
    ??    ?? : f62575
    ???????? : ????????DTS2010062200622????????????????<DA>??????????????????????????
               ????<DA>??????????
  4.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCmgcPara(TAF_UINT8 ucIndex)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    TAF_UINT8                           ucSmSFormat;
    TAF_UINT32                          ulRet;
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);

    ucSmSFormat = pstSmsCtx->enCmgfMsgFormat;

    /* ?????? */
    PS_MEM_SET(&gastAtClientTab[ucIndex].AtSmsData,0x00,sizeof(gastAtClientTab[ucIndex].AtSmsData));

    if (AT_CMGF_MSG_FORMAT_TEXT == ucSmSFormat)    /* TEXT????*/
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */
    {
        /* ????<ct>??<fo>???????????????????? */
        if ((0 == gastAtParaList[1].usParaLen)
         || (0 == gastAtParaList[0].usParaLen))
        {
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }

        if (gucAtParaIndex > 6)  /* ???????? */
        {
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }

        /* ????<fo>.SRR */
        gastAtClientTab[ucIndex].AtSmsData.ucFo         = (TAF_UINT8)gastAtParaList[0].ulParaValue;

        /* ????<ct> */
        gastAtClientTab[ucIndex].AtSmsData.CommandType  = (TAF_UINT8)gastAtParaList[1].ulParaValue;

        /* ????<pid> */
        if (0 != gastAtParaList[2].usParaLen)
        {
            gastAtClientTab[ucIndex].AtSmsData.enPid    = (TAF_UINT8)gastAtParaList[2].ulParaValue;
        }
        else
        {
            gastAtClientTab[ucIndex].AtSmsData.enPid    = 0;
        }

        /* ????<mn> */
        if (0 == gastAtParaList[3].usParaLen)
        {
            gastAtClientTab[ucIndex].AtSmsData.ucMessageNumber  = 0;
        }
        else
        {
            gastAtClientTab[ucIndex].AtSmsData.ucMessageNumber  = (TAF_UINT8)gastAtParaList[3].ulParaValue;
        }

        /* ????<oa/da> */
        ulRet = At_GetAsciiOrBcdAddr(gastAtParaList[4].aucPara,
                                     gastAtParaList[4].usParaLen,
                                     (TAF_UINT8)gastAtParaList[5].ulParaValue,
                                     gastAtParaList[5].usParaLen,
                                     &gastAtClientTab[ucIndex].AtSmsData.stAsciiAddr,
                                     TAF_NULL_PTR);
        if (AT_OK != ulRet)
        {
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }

        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CMGC_TEXT_SET;
    }
    else    /* PDU????*/
    {
        /* ????<length>???????????????????? */
        if (0 == gastAtParaList[0].usParaLen)
        {
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }

        if (gucAtParaIndex > 1)  /* ???????? */
        {
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }

        gastAtClientTab[ucIndex].AtSmsData.ucPduLen = (TAF_UINT8)gastAtParaList[0].ulParaValue;
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CMGC_PDU_SET;
    }

    At_SetMode(ucIndex,AT_CMD_MODE,AT_SMS_MODE);         /* ?????????????? */

    return AT_WAIT_SMS_INPUT;   /* ???????????????????????? */
}
/*****************************************************************************
 Prototype      : At_SetCmstPara
 Description    : TEXT: ^CMST=<index>[,<da>[,<toda>]],<time>
                  PDU : ^CMST=<index>[,<da>[,<toda>]],<time>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
  3.??    ?? : 2008??04??18??
    ??    ?? : f62575
    ???????? : CM????
  4.??    ??   : 2013??2??22??
    ??    ??   : L60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCmstPara(TAF_UINT8 ucIndex)
{
    MN_MSG_SEND_FROMMEM_PARM_STRU       stSendFromMemParm;
    TAF_UINT32                          ulRet;
    TAF_UINT32                          ulLoop;
    MN_OPERATION_ID_T                   opId                = At_GetOpId();
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);

    /* ??????????????<index>???????????????????? */
    if((0 == gastAtParaList[0].usParaLen)
    || (0 == gastAtParaList[3].usParaLen)
    || (gucAtParaIndex > 4)
    || (gastAtParaList[3].ulParaValue < 1))
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ????<da> */
    ulRet = At_GetAsciiOrBcdAddr(gastAtParaList[1].aucPara,
                                 gastAtParaList[1].usParaLen,
                                 (TAF_UINT8)gastAtParaList[2].ulParaValue,
                                 gastAtParaList[2].usParaLen,
                                 VOS_NULL_PTR,
                                 &stSendFromMemParm.stDestAddr);
    if (AT_OK != ulRet)
    {
        return AT_ERROR;
    }

    stSendFromMemParm.enDomain = pstSmsCtx->stCgsmsSendDomain.enSendDomain;
    /* ?????????????? */
    stSendFromMemParm.enMemStore = pstSmsCtx->stCpmsInfo.enMemSendorWrite;
    stSendFromMemParm.ulIndex = gastAtParaList[0].ulParaValue;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

    /* ???????????? */
    gastAtClientTab[ucIndex].AtSmsData.ucMsgSentSmNum = (TAF_UINT8)gastAtParaList[3].ulParaValue;
    for(ulLoop = 0; ulLoop < gastAtClientTab[ucIndex].AtSmsData.ucMsgSentSmNum; ulLoop++)
    {
        if(AT_SUCCESS != MN_MSG_SendFromMem(gastAtClientTab[ucIndex].usClientId, opId, &stSendFromMemParm))
        {
            return AT_ERROR;
        }
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CMST_SET;
    return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
}

/* Modified by f62575 for AT Project??2011-10-03,  Begin */
/*****************************************************************************
 ?? ?? ??  : At_SetCmStubPara
 ????????  : ????????????????????????????????
             at^cmstub=<stubtype>,<Value>
             <stubtype>
             0: efsms??????????
             1: efsms??????????1
             2: efsmss??????????????????
             3: efsmsp????????????????
             <Value>
             ????<stubtype>??1: efsms??????????1??<Value>????
                 0:     ??????????
                 ???? : EFSMS????????<Value>??????????
             10: AT_SMS_PS_CONCATENATE_FLAG:                   PS??????????????
                 0: ????????PS????????????????
                 1: ????PS????????????????
             11: AT_SMS_STUB_SMS_AUTO_REPLY:
                 0: ????????????????????????????
                 1: ????????????????????????
             ????<stubtype>??????????????<Value>
                 0: ??????????????
                 1: ????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : AT_XXX  --- ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??06??18??
    ??    ??   : Fu Yingjun id:62575
    ????????   : ??????????
  2.??    ??   : 2009??10??28??
     ??    ??   : f62575
     ????????   : PC????????????
  3.??    ??   : 2010??1??26??
    ??    ??   : f62575
    ????????   : ????????AT2D16564
                 PS ??????????????????????????GCF??????????????????AT ??????
                 ??PS??????????????????????????
  4.??    ??   : 2010??01??26??
    ??    ??   : f62575
    ????????   : ????????AT2D16565
                 ????????????????????????????????????????????????????????????
  5.??    ??   : 2011??10??3??
    ??    ??   : f62575
    ????????   : AT Project
    ????C????????????????????C??????????????????????????????????
  6.??    ??   : 2013??3??5??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
VOS_UINT32 At_SetCmStubPara(VOS_UINT8 ucIndex)
{
    MN_MSG_STUB_MSG_STRU                stStubParam;
    VOS_UINT32                          ulRet;

    /* ????????????: <stubtype>????????????????????????????????2?? */
    if ((2 != gucAtParaIndex)
     || (0 == gastAtParaList[0].usParaLen)
     || (0 == gastAtParaList[1].usParaLen))
    {
        AT_LOG1("At_SetCmStubPara: invalid parameter.", gucAtParaIndex);
        AT_LOG1("At_SetCmStubPara: invalid parameter.", gastAtParaList[0].ulParaValue);
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* A??????????????????????????: ??????????????????????C?? */
    if (MN_MSG_STUB_TYPE_SMS_AUTO_REPLY == gastAtParaList[0].ulParaValue)
    {
        /* Modified by l60609 for DSDA Phase III, 2013-3-5, Begin */
        AT_StubTriggerAutoReply(ucIndex, (VOS_UINT8)gastAtParaList[1].ulParaValue);
        /* Modified by l60609 for DSDA Phase III, 2013-3-5, End */
        return AT_OK;
    }


    /* ????C??????????: ??????????C?? */
    stStubParam.enStubType = (MN_MSG_STUB_TYPE_ENUM_U32)gastAtParaList[0].ulParaValue;
    stStubParam.ulValue    = gastAtParaList[1].ulParaValue;

    gastAtClientTab[ucIndex].opId = At_GetOpId();
    ulRet = MN_MSG_ReqStub(gastAtClientTab[ucIndex].usClientId,
                           gastAtClientTab[ucIndex].opId,
                           &stStubParam);
    if (MN_ERR_NO_ERROR != ulRet)
    {
        return ulRet;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CMSTUB_SET;
    return AT_WAIT_ASYNC_RETURN;
}
/* Modified by f62575 for AT Project??2011-10-03,  End */

/*****************************************************************************
 ?? ?? ??  : At_SetCmmsPara
 ????????  : +CMMS=[<n>]
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : AT_XXX  --- ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??07??21??
    ??    ??   : Fu Yingjun id:62575
    ????????   : ??????????
*****************************************************************************/
TAF_UINT32 At_SetCmmsPara(
    TAF_UINT8                           ucIndex
)
{
    MN_MSG_SET_LINK_CTRL_STRU     stSetParam;
    TAF_UINT32                          ulRet;
    MN_OPERATION_ID_T                   opId                = At_GetOpId();

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (0 == gucAtParaIndex)
    {
        stSetParam.enRelayLinkCtrl = MN_MSG_LINK_CTRL_ENABLE;
    }
    else
    {
        stSetParam.enRelayLinkCtrl = (MN_MSG_LINK_CTRL_U8)gastAtParaList[0].ulParaValue;
    }

    ulRet = MN_MSG_SetLinkCtrl(gastAtClientTab[ucIndex].usClientId, opId, &stSetParam);
    if (MN_ERR_NO_ERROR != ulRet)
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].opId = opId;
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CMMS_SET;
    return AT_WAIT_ASYNC_RETURN;
}
/*****************************************************************************
 ?? ?? ??  : AT_ParseCbParm
 ????????  : ????CBS????
 ????????  : pucInPara  :??????????mID??DCS??????????
 ????????  : pstCbRange :????????MID??DCS
 ?? ?? ??  : VOS_UINT32 :VOS_OK:????????
                         VOS_ERR:????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??5??8??
    ??    ??   : zhoujun /z40661
    ????????   : ??????????
  2.??    ??   : 2012??3??30??
    ??    ??   : w00176964
    ????????   : ??????????????:TAF_CBA_CBMI_RANGE_LIST_STRU

*****************************************************************************/
VOS_UINT32 AT_ParseCbParm(
    VOS_UINT8                           *pucInPara,
    TAF_CBA_CBMI_RANGE_LIST_STRU        *pstCbRange
)
{
    VOS_UINT32                          i;
    VOS_UINT32                          iLoop;
    VOS_UINT32                          ulParm_count;
    TAF_UINT8                           aucTemp[TAF_CBA_MAX_CBMID_RANGE_NUM];
    VOS_BOOL                            bRange;
    VOS_UINT32                          ulValue;

    pstCbRange->usCbmirNum      = 0;
    iLoop                       = 0;
    bRange                      = VOS_FALSE;
    ulParm_count                = 0;
    i                           = 0;

    while ( ( pucInPara[iLoop] != '\0' )
         && ( i < TAF_CBA_MAX_CBMID_RANGE_NUM))
    {
        i = 0;
        while ( ( pucInPara[iLoop] != ',' )
             && ( pucInPara[iLoop] != '-' )
             && ( pucInPara[iLoop] != '\0' ) )
        {
            aucTemp[i++] = pucInPara[iLoop++];
            if ( i >= 6 )
            {
                return VOS_ERR;
            }
        }

        aucTemp[i++] = '\0';

        if ( 0 == VOS_StrLen((VOS_CHAR*)aucTemp) )
        {
            return VOS_ERR;
        }

        if ( bRange )
        {
            if(AT_SUCCESS != At_Auc2ul(aucTemp,
                                        (VOS_UINT16)VOS_StrLen((VOS_CHAR*)aucTemp),
                                        &ulValue))
            {
                return VOS_ERR;
            }

            if ( ulValue > 0xFFFF )
            {
                return VOS_ERR;
            }

            if ( ulParm_count >= 1 )
            {
                pstCbRange->astCbmiRangeInfo[ulParm_count - 1].usMsgIdTo = (VOS_UINT16)ulValue;

                bRange = VOS_FALSE;
            }

        }
        else
        {
            if(AT_SUCCESS != At_Auc2ul(aucTemp,
                                       (VOS_UINT16)VOS_StrLen((VOS_CHAR*)aucTemp),
                                       &ulValue))
            {
                return VOS_ERR;
            }

            if ( ulValue > 0xFFFF )
            {
                return VOS_ERR;
            }

            pstCbRange->astCbmiRangeInfo[ulParm_count].usMsgIdFrom = (VOS_UINT16)ulValue;
            pstCbRange->astCbmiRangeInfo[ulParm_count].usMsgIdTo = (VOS_UINT16)ulValue;
            (pstCbRange->usCbmirNum)++;
            ulParm_count++;
        }

        if ( '-' == pucInPara[iLoop])
        {
            bRange = VOS_TRUE;
        }
        else if ( '\0' == pucInPara[iLoop] )
        {
            return VOS_OK;
        }
        else
        {
            bRange = VOS_FALSE;
        }

        iLoop++;

        if ( ulParm_count >= AT_MAX_CBS_MSGID_NUM )
        {
            return VOS_ERR;
        }
    }

    return VOS_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_ProcCscbWithParm
 ????????  : ????+CSCB??????????????????
 ????????  : ucIndex      :AT????????
             pstCbmirList :AT??????????,????????????????TAF??????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??5??8??
    ??    ??   : zhoujun /z40661
    ????????   : ??????????
  2.??    ??   : 2012??3??30??
    ??    ??   : w00176964
    ????????   : ??????????????:TAF_CBA_CBMI_RANGE_LIST_STRU
  3.??    ??   : 2013??2??22??
    ??    ??   : L60609
    ????????   : DSDA PHASE III
*****************************************************************************/
VOS_UINT32 AT_ProcCscbWithParm(
    TAF_UINT8                           ucIndex,
    TAF_CBA_CBMI_RANGE_LIST_STRU       *pstCbmirList
)
{
    VOS_UINT32                          ulRet;
    TAF_CBA_CBMI_RANGE_LIST_STRU       *pstDcssInfo;
    VOS_UINT32                          ulAppRet;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);

    PS_MEM_SET(pstCbmirList, 0x00, sizeof(TAF_CBA_CBMI_RANGE_LIST_STRU));

    ulRet = VOS_ERR;

    /* ???? <mids> ????*/
    if ( gastAtParaList[1].usParaLen > 0 )
    {
        gastAtParaList[1].aucPara[gastAtParaList[1].usParaLen] = '\0';
        ulRet = AT_ParseCbParm(gastAtParaList[1].aucPara,pstCbmirList);
    }

    /* ????????,MID????????,??????????????,???????????? */
    if ( VOS_OK != ulRet )
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ???? <dcss> ????*/
    if ( gastAtParaList[2].usParaLen > 0 )
    {
        pstDcssInfo = (TAF_CBA_CBMI_RANGE_LIST_STRU *)PS_MEM_ALLOC(WUEPS_PID_AT,
                            sizeof(TAF_CBA_CBMI_RANGE_LIST_STRU));

        if ( VOS_NULL == pstDcssInfo )
        {
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }

        gastAtParaList[2].aucPara[gastAtParaList[2].usParaLen] = '\0';
        ulRet = AT_ParseCbParm(gastAtParaList[2].aucPara,pstDcssInfo);
        if ( VOS_OK ==  ulRet)
        {
            PS_MEM_CPY(&(pstSmsCtx->stCbsDcssInfo),pstDcssInfo,sizeof(pstSmsCtx->stCbsDcssInfo));
        }
        else
        {
            PS_MEM_FREE(WUEPS_PID_AT, pstDcssInfo);
            return AT_CMS_OPERATION_NOT_ALLOWED;
        }
        PS_MEM_FREE(WUEPS_PID_AT, pstDcssInfo);
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

    if( MN_MSG_CBMODE_ACCEPT  ==  gastAtParaList[0].ulParaValue)
    {
        ulAppRet = MN_MSG_AddCbMids(gastAtClientTab[ucIndex].usClientId,
                                 gastAtClientTab[ucIndex].opId,
                                 pstCbmirList);
    }
    else
    {
        ulAppRet = MN_MSG_DelCbMids(gastAtClientTab[ucIndex].usClientId,
                                 gastAtClientTab[ucIndex].opId,
                                 pstCbmirList);
    }

    ulRet = VOS_OK;
    /*????API????????*/
    if ( MN_ERR_NO_ERROR != ulAppRet )
    {
        ulRet = VOS_ERR;
    }

    if ( VOS_OK != ulRet )
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetCscbPara
 ????????  : ????????CBS MESSAGE TYPE
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : AT_XXX  --- ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2006??12??18??
    ??    ??   : Fu Yingjun id:62575
    ????????   : ??????????
  2.??    ??   : 2012??3??30??
    ??    ??   : w00176964
    ????????   : ??????????????:TAF_CBA_CBMI_RANGE_LIST_STRU
*****************************************************************************/
TAF_UINT32 At_SetCscbPara(
    TAF_UINT8                           ucIndex
)
{
    VOS_UINT32                          ulRet;
    TAF_CBA_CBMI_RANGE_LIST_STRU       *pstCbmirList;
    VOS_UINT32                          ulApiRet;

    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ????????????????1,???????????????????? */
    if (( gucAtParaIndex > 1 )
      && ( 0 == gastAtParaList[1].usParaLen ))
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    pstCbmirList = (TAF_CBA_CBMI_RANGE_LIST_STRU *)PS_MEM_ALLOC(WUEPS_PID_AT,
                        sizeof(TAF_CBA_CBMI_RANGE_LIST_STRU));

    if ( VOS_NULL_PTR == pstCbmirList )
    {
        AT_WARN_LOG("At_SetCscbPara: Fail to alloc memory.");
        return AT_CMS_ERROR_IN_MS;
    }

    gastAtClientTab[ucIndex].opId = At_GetOpId();

    ulRet = AT_OK;
    if ( ( 0 == gucAtParaIndex )
      || (( 1 == gucAtParaIndex )
      && ( MN_MSG_CBMODE_ACCEPT  ==  gastAtParaList[0].ulParaValue)))
    {
        /* ??????????????????,??????????????CBS???? */
        pstCbmirList->usCbmirNum = 1;
        pstCbmirList->astCbmiRangeInfo[0].usMsgIdFrom = 0;
        pstCbmirList->astCbmiRangeInfo[0].usMsgIdTo = 0xFFFF;
        ulApiRet = MN_MSG_AddCbMids(gastAtClientTab[ucIndex].usClientId,
                                 gastAtClientTab[ucIndex].opId,
                                 pstCbmirList);

        /*????API????????*/
        if ( MN_ERR_NO_ERROR != ulApiRet )
        {
            ulRet = AT_CMS_OPERATION_NOT_ALLOWED;
        }
    }
    else if ( ( 1 == gucAtParaIndex )
      && ( MN_MSG_CBMODE_REJECT  ==  gastAtParaList[0].ulParaValue ))
    {
        /* ??????????????????,????????????????CBS???? */
        ulApiRet = MN_MSG_EmptyCbMids(gastAtClientTab[ucIndex].usClientId,
                                    gastAtClientTab[ucIndex].opId);

        /*????API????????*/
        if ( MN_ERR_NO_ERROR != ulApiRet )
        {
            ulRet = AT_CMS_OPERATION_NOT_ALLOWED;
        }
    }
    else
    {
        /* ?????????????????? */
        ulRet = AT_ProcCscbWithParm(ucIndex,pstCbmirList);
    }

    PS_MEM_FREE(WUEPS_PID_AT, pstCbmirList);

    if (AT_OK != ulRet)
    {
        return ulRet;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CSCB_SET;
    return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
}


/*****************************************************************************
 Prototype      : At_SetClipPara
 Description    : +CLIP=[<n>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2013??2??20??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetClipPara(TAF_UINT8 ucIndex)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, Begin */
    AT_MODEM_SS_CTX_STRU               *pstSsCtx = VOS_NULL_PTR;

    pstSsCtx = AT_GetModemSsCtxAddrFromClientId(ucIndex);

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????? */
    if(0 != gastAtParaList[0].usParaLen)
    {
        pstSsCtx->ucClipType = (AT_CLIP_TYPE)gastAtParaList[0].ulParaValue;
    }
    else
    {
        pstSsCtx->ucClipType = AT_CLIP_DISABLE_TYPE;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, End */

    return AT_OK;
}

/*****************************************************************************
 Prototype      : At_SetClirPara
 Description    : +CLIR=[<n>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2006-11-27
    Author      : ---
    Modification: Created function ??????A32D07303??
  2.Date        : 2007-05-30
    Author      : d49431
    Modification: A32D11328
  3.??    ??   : 2013??2??20??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*************************************************************/
TAF_UINT32 At_SetClirPara(TAF_UINT8 ucIndex)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, Begin */
    AT_MODEM_SS_CTX_STRU               *pstSsCtx = VOS_NULL_PTR;

    pstSsCtx = AT_GetModemSsCtxAddrFromClientId(ucIndex);
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, End */

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* Modified by l60609 for DSDA Phase III, 2013-2-20, Begin */
    /* ?????????? */
    if(0 != gastAtParaList[0].usParaLen)
    {
        switch (gastAtParaList[0].ulParaValue)
        {
            case AT_CLIR_AS_SUBSCRIPT:
                pstSsCtx->ucClirType = AT_CLIR_AS_SUBSCRIPT;
                break;

            case AT_CLIR_INVOKE:
                pstSsCtx->ucClirType = AT_CLIR_INVOKE;
                break;

            case AT_CLIR_SUPPRESS:
                pstSsCtx->ucClirType = AT_CLIR_SUPPRESS;
                break;

            default:
                return AT_CME_INCORRECT_PARAMETERS;
        }
    }
    else
    {
        pstSsCtx->ucClirType = AT_CLIR_AS_SUBSCRIPT;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, End */
    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetColpPara
 ????????  : AT????AT+COLP????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??10??27??
    ??    ??   : o00132663
    ????????   : ??????????
  2.??    ??   : 2013??2??20??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
VOS_UINT32 At_SetColpPara(VOS_UINT8 ucIndex)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, Begin */
    AT_MODEM_SS_CTX_STRU               *pstSsCtx = VOS_NULL_PTR;

    pstSsCtx = AT_GetModemSsCtxAddrFromClientId(ucIndex);

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????? */
    if(0 != gastAtParaList[0].usParaLen)
    {
        pstSsCtx->ucColpType = (AT_COLP_TYPE)gastAtParaList[0].ulParaValue;
    }
    else
    {
        pstSsCtx->ucColpType = AT_COLP_DISABLE_TYPE;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, End */

    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetCscsPara
 Description    : +CSCS=[<chset>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetCscsPara(TAF_UINT8 ucIndex)
{
    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????? */
    if(0 != gastAtParaList[0].usParaLen)
    {
        gucAtCscsType = (AT_CSCS_TYPE)gastAtParaList[0].ulParaValue;
    }
    else
    {
        gucAtCscsType = AT_CSCS_IRA_CODE;
    }
    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetCmeePara
 Description    : +CMEE=[<n>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetCmeePara(TAF_UINT8 ucIndex)
{
    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????? */
    if(0 != gastAtParaList[0].usParaLen)
    {
        gucAtCmeeType = (AT_CMEE_TYPE)gastAtParaList[0].ulParaValue;
    }
    else
    {
        gucAtCmeeType = AT_CMEE_ONLY_ERROR;
    }
    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetCeerPara
 Description    : +CEER
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetCeerPara(TAF_UINT8 ucIndex)
{
    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    gstAtSendData.usBufLen  = (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,(TAF_CHAR *)pgucAtSndCodeAddr,(TAF_CHAR*)pgucAtSndCodeAddr,"%s: %d",g_stParseContext[ucIndex].pstCmdElement->pszCmdName,gastAtClientTab[ucIndex].ulCause);
    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetCregPara
 Description    : +CREG=[<n>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2012??11??21??
    ??    ??   : z00161729
    ????????   : ????cerssi??nmr
  3.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  4.??    ??   : 2013??4??1??
    ??    ??   : s00217060
    ????????   : ????????AT??????????????C??
*****************************************************************************/
TAF_UINT32 At_SetCregPara(TAF_UINT8 ucIndex)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_NET_CTX_STRU                  *pstNetCtx = VOS_NULL_PTR;

    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, begin */
    AT_MTA_UNSOLICITED_RPT_SET_REQ_STRU     stAtCmd;
    VOS_UINT32                              ulResult;

    pstNetCtx = AT_GetModemNetCtxAddrFromClientId(ucIndex);

    PS_MEM_SET(&stAtCmd, 0x00, sizeof(stAtCmd));

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????? */
    if (0 != gastAtParaList[0].usParaLen)
    {
        pstNetCtx->ucCregType   = (AT_CREG_TYPE)gastAtParaList[0].ulParaValue;
        stAtCmd.u.ucCregRptFlg  = (VOS_UINT8)gastAtParaList[0].ulParaValue;

        /* ????????TAF_EVENT_INFO_CELL_SIGN+TAF_EVENT_INFO_CELL_ID + TAF_EVENT_INFO_CELL_BLER
           ????????????????????????????????????????????????????????????????????????????CSQ????*/
    }
    else
    {
        pstNetCtx->ucCregType   = AT_CREG_RESULT_CODE_NOT_REPORT_TYPE;
        stAtCmd.u.ucCregRptFlg  = AT_CREG_RESULT_CODE_NOT_REPORT_TYPE;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

    stAtCmd.enReqType = AT_MTA_SET_CREG_RPT_TYPE;

    /* ??MTA????+creg???????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      0,
                                      ID_AT_MTA_UNSOLICITED_RPT_SET_REQ,
                                      &stAtCmd,
                                      sizeof(AT_MTA_UNSOLICITED_RPT_SET_REQ_STRU),
                                      I0_UEPS_PID_MTA);

    if (TAF_SUCCESS != ulResult)
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_UNSOLICITED_RPT_SET;

    return AT_WAIT_ASYNC_RETURN;
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, end */
}
/*****************************************************************************
 Prototype      : At_SetCgregPara
 Description    : +CGREG=[<n>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2012??11??21??
    ??    ??   : z00161729
    ????????   : ????cerssi??nmr
  3.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  4.??    ??   : 2013??4??1??
    ??    ??   : s00217060
    ????????   : ????????AT??????????????C??
*****************************************************************************/
TAF_UINT32 At_SetCgregPara(TAF_UINT8 ucIndex)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_NET_CTX_STRU                  *pstNetCtx = VOS_NULL_PTR;

    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, begin */
    AT_MTA_UNSOLICITED_RPT_SET_REQ_STRU     stAtCmd;
    VOS_UINT32                              ulResult;

    pstNetCtx = AT_GetModemNetCtxAddrFromClientId(ucIndex);

    PS_MEM_SET(&stAtCmd, 0x00, sizeof(stAtCmd));

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????? */
    if(0 != gastAtParaList[0].usParaLen)
    {
        pstNetCtx->ucCgregType  = (AT_CGREG_TYPE)gastAtParaList[0].ulParaValue;
        stAtCmd.u.ucCgregRptFlg = (VOS_UINT8)gastAtParaList[0].ulParaValue;

        /* ????????TAF_EVENT_INFO_CELL_SIGN+TAF_EVENT_INFO_CELL_ID + TAF_EVENT_INFO_CELL_BLER
           ????????????????????????????????????????????????????????????????????????????CSQ????*/
    }
    else
    {
        pstNetCtx->ucCgregType  = AT_CGREG_RESULT_CODE_NOT_REPORT_TYPE;
        stAtCmd.u.ucCgregRptFlg = AT_CGREG_RESULT_CODE_NOT_REPORT_TYPE;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

    stAtCmd.enReqType       = AT_MTA_SET_CGREG_RPT_TYPE;

    /* ??MTA????+cgreg???????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_UNSOLICITED_RPT_SET_REQ,
                                   &stAtCmd,
                                   sizeof(AT_MTA_UNSOLICITED_RPT_SET_REQ_STRU),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS != ulResult)
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_UNSOLICITED_RPT_SET;

    return AT_WAIT_ASYNC_RETURN;
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, end */
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCeregPara
 ????????  : ????CEREG??????????????
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  --- ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??12??5??
    ??    ??   : z00161729
    ????????   : ??????????
  2.??    ??   : 2012??11??21??
    ??    ??   : z00161729
    ????????  : ????cerssi??nmr
  3.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  4.??    ??   : 2013??4??1??
    ??    ??   : s00217060
    ????????   : ????????AT??????????????C??
*****************************************************************************/
VOS_UINT32 AT_SetCeregPara(VOS_UINT8 ucIndex)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_NET_CTX_STRU                  *pstNetCtx = VOS_NULL_PTR;

    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, begin */
    AT_MTA_UNSOLICITED_RPT_SET_REQ_STRU     stAtCmd;
    VOS_UINT32                              ulResult;

    pstNetCtx = AT_GetModemNetCtxAddrFromClientId(ucIndex);

    PS_MEM_SET(&stAtCmd, 0x00, sizeof(stAtCmd));

    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????? */
    if (0 != gastAtParaList[0].usParaLen)
    {
        pstNetCtx->ucCeregType  = (AT_CEREG_TYPE_ENUM_UINT8)gastAtParaList[0].ulParaValue;
        stAtCmd.u.ucCeregRptFlg = (VOS_UINT8)gastAtParaList[0].ulParaValue;

        /* ????????TAF_EVENT_INFO_CELL_SIGN+TAF_EVENT_INFO_CELL_ID + TAF_EVENT_INFO_CELL_BLER
           ????????????????????????????????????????????????????????????????????????????CSQ????*/
    }
    else
    {
        pstNetCtx->ucCeregType  = AT_CEREG_RESULT_CODE_NOT_REPORT_TYPE;
        stAtCmd.u.ucCeregRptFlg = AT_CEREG_RESULT_CODE_NOT_REPORT_TYPE;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

    stAtCmd.enReqType       = AT_MTA_SET_CEREG_RPT_TYPE;

    /* ??MTA????+cgreg???????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_UNSOLICITED_RPT_SET_REQ,
                                   &stAtCmd,
                                   sizeof(AT_MTA_UNSOLICITED_RPT_SET_REQ_STRU),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS != ulResult)
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_UNSOLICITED_RPT_SET;

    return AT_WAIT_ASYNC_RETURN;
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, end */
}

/*****************************************************************************
 ?? ?? ??  : At_SetClccPara
 ????????  : ??????????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2008??6??25??
    ??    ??   :  l00130025
    ????????   : ?????????? AT2D03937
  3.??    ??   : 2010??3??2??
    ??    ??   : zhoujun /z40661
    ????????   : ????????????
  4.??    ??   : 2011??10??05??
    ??    ??   : f00179208
    ????????   : AT??????????API????????????????
*****************************************************************************/
VOS_UINT32 At_SetClccPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRet;

    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????C?????????????????????? */
    ulRet = MN_CALL_GetCallInfos(gastAtClientTab[ucIndex].usClientId,
                                 gastAtClientTab[ucIndex].opId,
                                 0);
    if (VOS_OK != ulRet)
    {
        AT_WARN_LOG("At_SetClccPara: MN_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CLCC_SET;

    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : At_SetCpasPara
 ????????  : ??????????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2010??11??25??
    ??    ??   : lijun 00171473
    ????????   : DTS2010111300355,????????CPAS????????????4,????????3
  3.??    ??   : 2011??10??17??
    ??    ??   : f00179208
    ????????   : AT??????????API????????????????
*****************************************************************************/
VOS_UINT32 At_SetCpasPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRet;
    AT_CPAS_STATUS_ENUM_U8              enCpas;
    AT_PDP_ENTITY_STRU                 *pstAppPdpEntity;

    pstAppPdpEntity                     = AT_APP_GetPdpEntInfoAddr();

    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ( (AT_PDP_STATE_ACTING == pstAppPdpEntity->enIpv4State)
      || (AT_PDP_STATE_ACTING == pstAppPdpEntity->enIpv6State)
      || (AT_PDP_STATE_ACTING == pstAppPdpEntity->enIpv4v6State) )
    {
        enCpas = AT_CPAS_STATUS_RING;

        gstAtSendData.usBufLen  = (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                                         (VOS_CHAR *)pgucAtSndCodeAddr,
                                                         (VOS_CHAR *)pgucAtSndCodeAddr,
                                                         "%s: %d",
                                                         g_stParseContext[ucIndex].pstCmdElement->pszCmdName,
                                                         enCpas);
        return AT_OK;
    }
    else if ( (AT_PDP_STATE_ACTED    == pstAppPdpEntity->enIpv4State)
           || (AT_PDP_STATE_DEACTING == pstAppPdpEntity->enIpv4State)
           || (AT_PDP_STATE_ACTED    == pstAppPdpEntity->enIpv6State)
           || (AT_PDP_STATE_DEACTING == pstAppPdpEntity->enIpv6State)
           || (AT_PDP_STATE_ACTED    == pstAppPdpEntity->enIpv4v6State)
           || (AT_PDP_STATE_DEACTING == pstAppPdpEntity->enIpv4v6State) )

    {
        enCpas = AT_CPAS_STATUS_CALL_IN_PROGRESS;

        gstAtSendData.usBufLen  = (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                                         (VOS_CHAR *)pgucAtSndCodeAddr,
                                                         (VOS_CHAR *)pgucAtSndCodeAddr,
                                                         "%s: %d",
                                                         g_stParseContext[ucIndex].pstCmdElement->pszCmdName,
                                                         enCpas);
        return AT_OK;
    }
    else
    {
        /* for pclint */
    }

    /* ????????C?????????????????????? */
    ulRet = MN_CALL_GetCallInfos(gastAtClientTab[ucIndex].usClientId,
                                 gastAtClientTab[ucIndex].opId,
                                 0);
    if (TAF_SUCCESS != ulRet)
    {
        AT_WARN_LOG("At_SetCpasPara: MN_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPAS_SET;

    return AT_WAIT_ASYNC_RETURN;


}
/*****************************************************************************
 Prototype      : At_SetCstaPara
 Description    : +CSTA=[<type>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetCstaPara(TAF_UINT8 ucIndex)
{
    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    g_enAtCstaNumType = (AT_CSTA_NUM_TYPE_ENUM_U8)gastAtParaList[0].ulParaValue;

    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetCcugPara
 Description    : +CCUG=[<n>[,<index>[,<info>]]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2013??2??21??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCcugPara(TAF_UINT8 ucIndex)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, Begin */
    AT_MODEM_SS_CTX_STRU               *pstSsCtx = VOS_NULL_PTR;

    pstSsCtx = AT_GetModemSsCtxAddrFromClientId(ucIndex);

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 3)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }


    /* ????<n> */
    if(0 != gastAtParaList[0].usParaLen)
    {
        pstSsCtx->stCcugCfg.bEnable = gastAtParaList[0].ulParaValue;
    }
    else
    {
        pstSsCtx->stCcugCfg.bEnable = 0;
    }

    /* ????<index> */
    if(0 != gastAtParaList[1].usParaLen)
    {
        if (10 == gastAtParaList[1].ulParaValue)
        {
            pstSsCtx->stCcugCfg.bIndexPresent = 0;
            pstSsCtx->stCcugCfg.ulIndex       = 10;
        }
        else
        {
            pstSsCtx->stCcugCfg.bIndexPresent = 1;
            pstSsCtx->stCcugCfg.ulIndex = (TAF_UINT8)gastAtParaList[1].ulParaValue;
        }
    }
    else
    {
        pstSsCtx->stCcugCfg.bIndexPresent = 0;
        pstSsCtx->stCcugCfg.ulIndex       = 0;
    }

    /* ????<info> */
    if(0 != gastAtParaList[2].usParaLen)
    {
        pstSsCtx->stCcugCfg.bSuppressPrefer = (gastAtParaList[2].ulParaValue & 0x02) >> 1;
        pstSsCtx->stCcugCfg.bSuppressOA     = gastAtParaList[2].ulParaValue & 0x01;
    }
    else
    {
        pstSsCtx->stCcugCfg.bSuppressPrefer = 0;
        pstSsCtx->stCcugCfg.bSuppressOA     = 0;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, End */
    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetCssnPara
 Description    : +CSSN=[<n>[,<m>]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2013??2??25??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  3.??    ??   : 2013??4??1??
    ??    ??   : s00217060
    ????????   : ????????AT??????????????C??
*****************************************************************************/
TAF_UINT32 At_SetCssnPara(TAF_UINT8 ucIndex)
{
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-3, begin */
    VOS_UINT32                          ulRst;
    MN_CALL_SET_CSSN_REQ_STRU           stCssnReq;

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 2)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_SET(&stCssnReq, 0, sizeof(stCssnReq));
    stCssnReq.ulActNum      = MN_CALL_MAX_CSSN_MSG_NUM;
    stCssnReq.aenSetType[0] = MN_CALL_SET_CSSN_DEACT;
    stCssnReq.aenSetType[1] = MN_CALL_SET_CSSN_DEACT;

    if(0 != gastAtParaList[0].usParaLen)
    {
        stCssnReq.aenSetType[0] = (MN_CALL_SET_CSSN_TYPE_ENUM_U32)gastAtParaList[0].ulParaValue;
    }

    if(0 != gastAtParaList[1].usParaLen)
    {
        stCssnReq.aenSetType[1] = (MN_CALL_SET_CSSN_TYPE_ENUM_U32)gastAtParaList[1].ulParaValue;
    }

    ulRst = MN_CALL_SendAppRequest(MN_CALL_APP_SET_CSSN_REQ,
                                   gastAtClientTab[ucIndex].usClientId,
                                   gastAtClientTab[ucIndex].opId,
                                   0,
                                   (MN_CALL_APP_REQ_PARM_UNION*)&stCssnReq);
    if (VOS_OK == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CSSN_SET;
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-3, end */
}
/*****************************************************************************
?? ?? ??  : At_ParseSingleChldPara
????????  : ????????AT+CHLD????
????????  : TAF_UINT32                          ulParaValue
MN_CALL_SUPS_PARAM_STRU            *pstCallSupsCmd
????????  : ??
?? ?? ??  : TAF_BOOL
????????  :
????????  :

????????      :
1.??    ??   : 2010??1??20??
??    ??   : ???? \ z40661
????????   : ??????????
2.??    ??   : 2012??03??03??
  ??    ??   : s62952
  ????????   : BalongV300R002 Build????????  :????NAS_FEATURE_CCBS??
3.??    ??   : 2014??11??28??
  ??    ??   : j00174725
  ????????   : ??????????????
*****************************************************************************/
TAF_BOOL At_ParseSingleChldPara(
    TAF_UINT32                          ulParaValue,
    MN_CALL_SUPS_PARAM_STRU            *pstCallSupsCmd
    )
{

    switch ( ulParaValue )
    {
    case 0:
        pstCallSupsCmd->enCallSupsCmd = MN_CALL_SUPS_CMD_REL_HELD_OR_UDUB;
        break;

    case 1:
        pstCallSupsCmd->enCallSupsCmd = MN_CALL_SUPS_CMD_REL_ACT_ACPT_OTH;
        break;

    case 2:
        pstCallSupsCmd->enCallSupsCmd = MN_CALL_SUPS_CMD_HOLD_ACT_ACPT_OTH;
        break;

    case 3:
        pstCallSupsCmd->enCallSupsCmd = MN_CALL_SUPS_CMD_BUILD_MPTY;
        break;

    case 4:
        pstCallSupsCmd->enCallSupsCmd = MN_CALL_SUPS_CMD_ECT;
        break;

    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    case 5:
       pstCallSupsCmd->enCallSupsCmd = MN_CALL_SUPS_CMD_ACT_CCBS;
       return AT_OK;
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, end */

    case 6:
       pstCallSupsCmd->enCallSupsCmd = MN_CALL_SUPS_CMD_ECONF_REL_USER;
       break;

    case 7:
       pstCallSupsCmd->enCallSupsCmd = MN_CALL_SUPS_CMD_ECONF_MERGE_CALL;
       break;

    case 8:
       pstCallSupsCmd->enCallSupsCmd = MN_CALL_SUPS_CMD_ACPT_WAITING_CALL;
       break;

    default:
        return AT_ERROR;
    }
    return AT_OK;
}

/*****************************************************************************
?? ?? ??  : At_ParseChldPara
????????  : ????AT+CHLD????????
????????  : TAF_UINT32                          ulParaValue
MN_CALL_SUPS_PARAM_STRU            *pstCallSupsCmd
????????  : ??
?? ?? ??  : TAF_BOOL
????????  :
????????  :

????????      :
1.??    ??   : 2010??1??20??
??    ??   : ???? \ z40661
????????   : ??????????

*****************************************************************************/
TAF_BOOL At_ParseChldPara(
    TAF_UINT32                          ulParaValue,
    MN_CALL_SUPS_PARAM_STRU            *pstCallSupsCmd
    )
{
    TAF_BOOL                            bRetRst;
    TAF_UINT8                           ucTmp;

    ucTmp = (TAF_UINT8)(ulParaValue / 10);

    if (ulParaValue < 10)
    {
        bRetRst = At_ParseSingleChldPara(ulParaValue,pstCallSupsCmd);
    }
    else
    {
        switch(ucTmp)
        {
        case 1:
            pstCallSupsCmd->enCallSupsCmd = MN_CALL_SUPS_CMD_REL_CALL_X;
            pstCallSupsCmd->callId = (MN_CALL_ID_T)(ulParaValue % 10);
            bRetRst = AT_OK;
            break;

        case 2:
            pstCallSupsCmd->enCallSupsCmd = MN_CALL_SUPS_CMD_HOLD_ALL_EXCPT_X;
            pstCallSupsCmd->callId = (MN_CALL_ID_T)(ulParaValue % 10);
            bRetRst = AT_OK;
            break;

        default:
            bRetRst = AT_ERROR;
            break;
        }
    }
    return bRetRst;
}

/*****************************************************************************
?? ?? ??  : At_SetChldPara
????????  : ????AT+CHLD????????
????????  : TAF_UINT8 ucIndex
????????  : ??
?? ?? ??  : TAF_UINT32
????????  :
????????  :

????????      :
1.??    ??   : 2010??1??20??
??    ??   : ???? \ z40661
????????   : ??????????
2.??    ??   : 2012??03??03??
  ??    ??   : s62952
  ????????   : BalongV300R002 Build????????  :????NAS_FEATURE_CCBS??

*****************************************************************************/
TAF_UINT32 At_SetChldPara(TAF_UINT8 ucIndex)
{
    MN_CALL_SUPS_PARAM_STRU             stCallChldParam;
    VOS_UINT32                          ulRst;


    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_SET(&stCallChldParam,0,sizeof(stCallChldParam));

    ulRst = At_ParseChldPara(gastAtParaList[0].ulParaValue,&stCallChldParam);
    if (AT_ERROR == ulRst)
    {
        return AT_ERROR;
    }

    if(AT_SUCCESS == MN_CALL_Sups(gastAtClientTab[ucIndex].usClientId,0, &stCallChldParam))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CHLD_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
?? ?? ??  : At_SetChldExPara
????????  : AT^CHLD=<n>,<call_type>[,<call_num>]
????????  : TAF_UINT8 ucIndex
????????  : ??
?? ?? ??  : TAF_UINT32
????????  :
????????  :

????????      :
1.??    ??   : 2014??06??16??
  ??    ??   : n00269697
  ????????   : VTLTE??????????
2.??    ??   : 2014??11??28??
  ??    ??   : j00174725
  ????????   : ??????????????
*****************************************************************************/
VOS_UINT32 At_SetChldExPara(VOS_UINT8 ucIndex)
{
    MN_CALL_SUPS_PARAM_STRU             stCallChldParam;
    VOS_UINT32                          ulRst;

    /* ???????? */
    if (gucAtParaIndex > 3)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????????????????????????????????????3??????????chld=6,0,"135xxxxxxxx" */
    if ((3 == gucAtParaIndex)
     && (gastAtParaList[0].ulParaValue != 6))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ((0 == gastAtParaList[0].usParaLen)
     || (0 == gastAtParaList[1].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_SET(&stCallChldParam, 0, sizeof(stCallChldParam));

    stCallChldParam.enCallType = (MN_CALL_TYPE_ENUM_U8)gastAtParaList[1].ulParaValue;

    ulRst = At_ParseChldPara(gastAtParaList[0].ulParaValue, &stCallChldParam);
    if (AT_ERROR == ulRst)
    {
        return AT_ERROR;
    }

    /* ?????????????????????????????????????????????? */
    if (MN_CALL_SUPS_CMD_ECONF_REL_USER == stCallChldParam.enCallSupsCmd)
    {
        /* ???????????? */
        if (0 == gastAtParaList[2].usParaLen)
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        /* ?????????????????? */
        if (VOS_OK !=  AT_FillCalledNumPara((VOS_UINT8 *)gastAtParaList[2].aucPara,
                                            gastAtParaList[2].usParaLen,
                                            &stCallChldParam.stRemoveNum))
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
    }

    if (AT_SUCCESS == MN_CALL_Sups(gastAtClientTab[ucIndex].usClientId, 0, &stCallChldParam))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CHLD_EX_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : At_SetChupPara
 ????????  : ??????????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2005??04??19??
    ??    ??   : ---
    ????????   : ??????????
  2.??    ??   : 2010??07??20??
    ??    ??   : s62952
    ????????   : ????????:A32D11842
  3.??    ??   : 2011??10??06??
    ??    ??   : f00179208
    ????????   : AT????????, ????????????Idle??????Call????C??
  4.??    ??   : 2014??2??14??
    ??    ??   : j00174725
    ????????   : TQE
*****************************************************************************/
VOS_UINT32 At_SetChupPara(VOS_UINT8 ucIndex)
{
    MN_CALL_SUPS_PARAM_STRU             stCallMgmtParam;

    PS_MEM_SET(&stCallMgmtParam, 0x0, sizeof(stCallMgmtParam));

    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    stCallMgmtParam.enCallSupsCmd = MN_CALL_SUPS_CMD_REL_ALL_CALL;
    if(AT_SUCCESS == MN_CALL_Sups(gastAtClientTab[ucIndex].usClientId, 0, &stCallMgmtParam))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CHUP_SET;

        /* ???????????????????? */
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_CheckDtmfKey
 ????????  : ??????????????DTMF????????????key
 ????????  : AT_PARSE_PARA_TYPE_STRU *pstAtPara  -- AT????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??07??11??
    ??    ??   : l00198894
    ????????   : V9R1 STK????????
*****************************************************************************/
VOS_UINT32 AT_CheckDtmfKey(AT_PARSE_PARA_TYPE_STRU *pstAtPara)
{
    VOS_CHAR                            cKey;

    if ( 1 != pstAtPara->usParaLen )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (AT_SUCCESS != At_UpString(pstAtPara->aucPara, pstAtPara->usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    cKey = (VOS_CHAR)pstAtPara->aucPara[0];
    if (!( (('0' <= cKey) && ('9' >= cKey))
         || ('*' == cKey) || ('#' == cKey)
         || ('A' == cKey) || ('B' == cKey)
         || ('C' == cKey) || ('D' == cKey) ))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    return AT_SUCCESS;
}

/*****************************************************************************
 Prototype      : At_SetVtsPara
 Description    : +VTS=<[0-9,#,*,A-D]>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
  3.??    ??   : 2008??06??26??
    ??    ??   : l00130025
    ????????   : ?????????? AT2D03938,
  4.??    ??   : 2012??05??31??
    ??    ??   : Y00213812
    ????????   : DTS2012053005141??????VTS??????????????????????????????
  5.??    ??   : 2013??02??07??
    ??    ??   : l00198894
    ????????   : DTS2013020605774: +VTS??????????
  6.??    ??   : 2013??07??11??
    ??    ??   : l00198894
    ????????   : V9R1 STK????????
  7.??    ??   :2013??10??24??
    ??    ??   :z00161729
    ????????   :DTS2013102403705:dtmf??????off_length??????SBM IOT????????stop dtmf req????????start dtmf req????????70ms????600ms
*****************************************************************************/
TAF_UINT32 At_SetVtsPara(TAF_UINT8 ucIndex)
{
    TAF_CALL_DTMF_PARAM_STRU            stDtmfParam;
    VOS_UINT32                          ulResult;

    /* ???????????????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (gucAtParaIndex != 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????????? */
    ulResult = AT_CheckDtmfKey(&gastAtParaList[0]);

    if (AT_SUCCESS != ulResult)
    {
        return ulResult;
    }

    /* ?????????? */
    PS_MEM_SET(&stDtmfParam, 0, sizeof(stDtmfParam));

    /* ????START DTMF???? */
    stDtmfParam.cKey        = (VOS_CHAR)gastAtParaList[0].aucPara[0];
    stDtmfParam.usOnLength  = AT_VTS_DEFAULT_DTMF_LENGTH;

    stDtmfParam.usOffLength = 0;

    /* Modified by l00198894 for V9R1 STK????, 2013/07/11, begin */
    ulResult = TAF_CALL_SendDtmf(MN_CALL_APP_START_DTMF_REQ,
                                gastAtClientTab[ucIndex].usClientId,
                                gastAtClientTab[ucIndex].opId,
                                &stDtmfParam);

    if (VOS_OK == ulResult)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_VTS_SET;

        /* ???????????????????? */
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;
    /* Modified by l00198894 for V9R1 STK????, 2013/07/11, end */
}

/*****************************************************************************
 ?? ?? ??  : At_CheckDtmfPara
 ????????  : ????^DTMF??????????
 ????????  : ??
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??9??26??
    ??    ??   : ????/00166186
    ????????   : ??????????
  2.??    ??   : 2012??10??22??
    ??    ??   : s00217060
    ????????   : DTS2012101605663,????????DTMF??????????????cKey
  1.??    ??   : 2013??07??11??
    ??    ??   : l00198894
    ????????   : V9R1 STK??????????DTMF????????
*****************************************************************************/
VOS_UINT32 At_CheckDtmfPara(VOS_VOID)
{
    /* Modified by l00198894 for V9R1 STK????, 2013/07/11, begin */
    /* DTS2012101605663??????????DTMF????????????????ckey,????????????ckey????????
       ????????onlength?????????? */
    /*??????????????*/
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ((gucAtParaIndex > 4)
     || (0 == gastAtParaList[2].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????DTMF??,??????????ckey,????????????ckey????????
       ????DTMF??,????????????ckey,??????????????ckey???????? */
    if (AT_DTMF_STOP != gastAtParaList[2].ulParaValue)
    {
        if (AT_SUCCESS != AT_CheckDtmfKey(&gastAtParaList[1]))
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
    }

    return AT_SUCCESS;
    /* Modified by l00198894 for V9R1 STK????, 2013/07/11, end */
}

/* Deleted by l00198894 for V9R1 STK????, 2013/07/11 */

/*****************************************************************************
 ?? ?? ??  : At_SetDtmfPara
 ????????  : DTMF????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??9??20??
    ??    ??   : ????/00166186
    ????????   : ??????????
  2.??    ??   : 2011??10??08??
    ??    ??   : f00179208
    ????????   : AT????????, ????AT????????
  3.??    ??   : 2012??04??07??
    ??    ??   : l65478
    ????????   : DTS2012033002045,??CS CALL??????,????????DTMF????
  4.??    ??   : 2012??12??10??
    ??    ??   : l00198894
    ????????   : DTS2012121007454: ????????????^DTMF????????REJ????
  5.??    ??   : 2013??2??21??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  6.??    ??   : 2012??12??31??
    ??    ??   : l65478
    ????????   : DTS2012122900264:DTMF????????
  7.??    ??   : 2013??01??16??
    ??    ??   : l65478
    ????????   : DTS2013011510416:DTMF????????
  8.??    ??   : 2013??07??11??
    ??    ??   : l00198894
    ????????   : V9R1 STK??????????DTMF????????
  9.??    ??   :2013??10??24??
    ??    ??   :z00161729
    ????????   :DTS2013102403705:dtmf??????off_length??????SBM IOT????????stop dtmf req????????start dtmf req????????70ms????600ms
*****************************************************************************/
VOS_UINT32 At_SetDtmfPara(VOS_UINT8 ucIndex)
{
    /* Modified by l00198894 for V9R1 STK????, 2013/07/11, begin */
    VOS_UINT32                          ulResult;
    TAF_CALL_DTMF_PARAM_STRU            stDtmfParam;

    /*??????????????*/
    ulResult = At_CheckDtmfPara();
    if (AT_SUCCESS != ulResult)
    {
        return ulResult;
    }

    PS_MEM_SET(&stDtmfParam, 0, sizeof(stDtmfParam));

    stDtmfParam.CallId  = (VOS_UINT8)gastAtParaList[0].ulParaValue;
    stDtmfParam.cKey    = (VOS_CHAR)gastAtParaList[1].aucPara[0];

    /* ??????????1????????????DTMF?????? */
    if (AT_DTMF_START == gastAtParaList[2].ulParaValue)
    {
        stDtmfParam.usOnLength = AT_DTMF_DEFAULT_DTMF_LENGTH;
    }
    else
    {
        stDtmfParam.usOnLength = (VOS_UINT16)gastAtParaList[2].ulParaValue;
    }

    if ((0 == gastAtParaList[3].ulParaValue)
     || (gucAtParaIndex < 4))
    {
        stDtmfParam.usOffLength = 0;
    }
    else
    {
        stDtmfParam.usOffLength   = (VOS_UINT16)gastAtParaList[3].ulParaValue;

        if (stDtmfParam.usOffLength < AT_DTMF_MIN_DTMF_OFF_LENGTH)
        {
            /* offlength??????0????10ms-60000ms??????10ms??osa????????????10ms???????????????????? */
            return AT_CME_INCORRECT_PARAMETERS;
        }
    }

    if (AT_DTMF_STOP != stDtmfParam.usOnLength)
    {
        ulResult = TAF_CALL_SendDtmf(MN_CALL_APP_START_DTMF_REQ,
                                    gastAtClientTab[ucIndex].usClientId,
                                    gastAtClientTab[ucIndex].opId,
                                    &stDtmfParam);
    }
    else
    {
        ulResult = TAF_CALL_SendDtmf(MN_CALL_APP_STOP_DTMF_REQ,
                                    gastAtClientTab[ucIndex].usClientId,
                                    gastAtClientTab[ucIndex].opId,
                                    &stDtmfParam);
    }

    if (VOS_OK == ulResult)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_DTMF_SET;

        /* ???????????????????? */
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;
    /* Modified by l00198894 for V9R1 STK????, 2013/07/11, end */
}

/*****************************************************************************
 Prototype      : At_SetCrcPara
 Description    : +CRC=[<mode>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2013??2??25??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCrcPara(TAF_UINT8 ucIndex)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, Begin */
    AT_MODEM_SS_CTX_STRU               *pstSsCtx = VOS_NULL_PTR;

    pstSsCtx = AT_GetModemSsCtxAddrFromClientId(ucIndex);

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????? */
    if(0 != gastAtParaList[0].usParaLen)
    {
        pstSsCtx->ucCrcType = (AT_CRC_TYPE)gastAtParaList[0].ulParaValue;
    }
    else
    {
        pstSsCtx->ucCrcType = AT_CRC_DISABLE_TYPE;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, End */

    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetCbstPara
 Description    : +CBST=[<speed>[,<name>[,<ce>]]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2013??2??21??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCbstPara(TAF_UINT8 ucIndex)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, Begin */
    AT_MODEM_SS_CTX_STRU               *pstSsCtx = VOS_NULL_PTR;

    pstSsCtx = AT_GetModemSsCtxAddrFromClientId(ucIndex);

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 3)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }


    if(0 != gastAtParaList[0].usParaLen)
    {
        pstSsCtx->stCbstDataCfg.enSpeed = (TAF_UINT8)gastAtParaList[0].ulParaValue;
    }
    else
    {
        pstSsCtx->stCbstDataCfg.enSpeed = MN_CALL_CSD_SPD_64K_MULTI;
    }
    if(0 != gastAtParaList[1].usParaLen)
    {
        pstSsCtx->stCbstDataCfg.enName = (TAF_UINT8)gastAtParaList[1].ulParaValue;
    }
    else
    {
        pstSsCtx->stCbstDataCfg.enName = MN_CALL_CSD_NAME_SYNC_UDI;
    }
    if(0 != gastAtParaList[2].usParaLen)
    {
        pstSsCtx->stCbstDataCfg.enConnElem = (TAF_UINT8)gastAtParaList[2].ulParaValue;
    }
    else
    {
        pstSsCtx->stCbstDataCfg.enConnElem = MN_CALL_CSD_CE_T;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, End */

    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetCmodPara
 Description    : +CMOD=[<mode>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2013??2??21??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCmodPara(TAF_UINT8 ucIndex)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, Begin */
    AT_MODEM_SS_CTX_STRU               *pstSsCtx = VOS_NULL_PTR;

    pstSsCtx = AT_GetModemSsCtxAddrFromClientId(ucIndex);

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    pstSsCtx->enCModType = (TAF_UINT8)gastAtParaList[0].ulParaValue;
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, End */

    return AT_OK;

}

/*****************************************************************************
 ?? ?? ??  : At_SetCmmiPara
 ????????  : ^CMMI=<num>
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.Date        : 2006-12-30
    Author      : d49431
    Modification: A32D08138
  3.Date        : 2006-05-18
    Author      : d49431
    Modification: A32D11063
  4.Date        : 2009-06-30
    Author      : l65478
    Modification: AT2D12603,??gastAtParaList[0].aucPara????????????????????????
  5.Date        : 2010-02-01
    Author      : l65478
    Modification: AT2D16566,????????????TAF_MMI_GET_PASSWD????????????????????????????????
  6.??    ??   : 2010??3??2??
    ??    ??   : zhoujun /z40661
    ????????   : ????????????
  7.??    ??   : 2011??10??15??
    ??    ??   : f00179208
    ????????   : AT????????, ????????C????API
  8.??    ??   : 2012??02??23??
    ??    ??   : l65478
    ????????   : DTS2012021604543,GCF??????CMMI????????????????
  9.??    ??   : 2012??03??03??
    ??    ??   : s62952
    ????????   : BalongV300R002 Build????????  :????NAS_FEATURE_CCBS??
 10.??    ??   : 2012??12??11??
    ??    ??   : l00167671
    ????????   : DTS2012121802573, TQE????
 11.??    ??   : 2013??2??20??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
 12.??    ??   : 2013??05??06??
    ??    ??   : f62575
    ????????   : SS FDN&Call Control??????SS??????????SS????
*****************************************************************************/
VOS_UINT32 At_SetCmmiPara(VOS_UINT8 ucIndex)
{
    VOS_BOOL                            inCall;
    MN_MMI_OPERATION_PARAM_STRU        *pMmiOpParam;
    VOS_CHAR                           *pcOutRestMmiStr;
    VOS_UINT32                          ulResult;
    AT_CMD_CURRENT_OPT_ENUM             enCmdCurrentOpt;
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, Begin */
    AT_MODEM_SS_CTX_STRU               *pstSsCtx = VOS_NULL_PTR;
    AT_MODEM_CC_CTX_STRU               *pstCcCtx = VOS_NULL_PTR;

    pstCcCtx = AT_GetModemCcCtxAddrFromClientId(ucIndex);

    pstSsCtx = AT_GetModemSsCtxAddrFromClientId(ucIndex);

    /* ?????????????????? */
    if (VOS_FALSE == pstCcCtx->ulCurIsExistCallFlag)
    {
        inCall = VOS_FALSE;
    }
    else
    {
        inCall = VOS_TRUE;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, End */

    pMmiOpParam = (MN_MMI_OPERATION_PARAM_STRU *)PS_MEM_ALLOC(WUEPS_PID_AT, sizeof(MN_MMI_OPERATION_PARAM_STRU));
    if(TAF_NULL_PTR == pMmiOpParam)
    {
        AT_WARN_LOG("At_SetCmmiPara Mem Alloc FAILURE");
        return AT_ERROR;
    }

    f_enClirOperate = MN_CALL_CLIR_AS_SUBS;

    pcOutRestMmiStr = (VOS_CHAR *)gastAtParaList[0].aucPara;
    pcOutRestMmiStr[gastAtParaList[0].usParaLen] = '\0';
    ulResult = MN_MmiStringParse((VOS_CHAR *)(gastAtParaList[0].aucPara), inCall, pMmiOpParam, &pcOutRestMmiStr);
    pMmiOpParam->ProcessUssdReq.DatacodingScheme = TAF_SS_7bit_LANGUAGE_UNSPECIFIED;

    if(MN_ERR_NO_ERROR == ulResult)
    {
        switch(pMmiOpParam->MmiOperationType)
        {
        case TAF_MMI_SUPPRESS_CLIR:
        case TAF_MMI_INVOKE_CLIR:

            /* Added by f62575 for SS FDN&Call Control, 2013-05-06, begin */
            if(TAF_MMI_SUPPRESS_CLIR == pMmiOpParam->MmiOperationType)
            {
                f_enClirOperate = MN_CALL_CLIR_SUPPRESS;
            }
            else
            {
                f_enClirOperate = MN_CALL_CLIR_INVOKE;
            }
            /* Added by f62575 for SS FDN&Call Control, 2013-05-06, end */

            if((VOS_UINT16)(pcOutRestMmiStr - (VOS_CHAR *)(gastAtParaList[0].aucPara)) < gastAtParaList[0].usParaLen)
            {
                ulResult = MN_MmiStringParse(pcOutRestMmiStr, inCall, pMmiOpParam, &pcOutRestMmiStr);
            }
            else
            {
                PS_MEM_FREE(WUEPS_PID_AT, pMmiOpParam);
                return AT_CME_INCORRECT_PARAMETERS;
            }
            break;
        default :
            break;
        }
        if(MN_ERR_NO_ERROR != ulResult)
        {
            PS_MEM_FREE(WUEPS_PID_AT, pMmiOpParam);
            return AT_CME_INCORRECT_PARAMETERS;
        }

        /* ???????? */
        /* Delete by f62575 for SS FDN&Call Control, 2013-05-06, begin */
        /* Delete by f62575 for SS FDN&Call Control, 2013-05-06, end */

        /* ????TAF????????????????SS???? */
        enCmdCurrentOpt = At_GetMnOptType(pMmiOpParam->MmiOperationType);
        if(AT_CMD_INVALID == enCmdCurrentOpt)
        {
            PS_MEM_FREE(WUEPS_PID_AT, pMmiOpParam);
            return AT_ERROR;
        }
        switch(enCmdCurrentOpt)
        {
            case AT_CMD_D_CS_VOICE_CALL_SET:
                if (VOS_OK != MN_CALL_Orig(gastAtClientTab[ucIndex].usClientId,
                    0,
                    &gastAtClientTab[ucIndex].AtCallInfo.CallId,
                    &(pMmiOpParam->MnCallOrig)))
                {
                    AT_WARN_LOG("At_SetCmmiPara: MN_CALL_Orig failed.");
                }
                break;
            case AT_CMD_CHLD_SET:
                if (VOS_OK != MN_CALL_Sups(gastAtClientTab[ucIndex].usClientId,0, &pMmiOpParam->MnCallSupsReq))
                {
                    AT_WARN_LOG("At_SetCmmiPara: MN_CALL_Sups failed.");
                }
                break;
            case AT_CMD_CPIN_UNBLOCK_SET:
                if (TAF_SUCCESS != Taf_PhonePinHandle(gastAtClientTab[ucIndex].usClientId,0, &pMmiOpParam->PinReq))
                {
                    AT_WARN_LOG("At_SetCmmiPara: Taf_PhonePinHandle failed.");
                }
                break;
            case AT_CMD_CPIN2_UNBLOCK_SET:
                if (TAF_SUCCESS != Taf_PhonePinHandle(gastAtClientTab[ucIndex].usClientId,0, &pMmiOpParam->PinReq))
                {
                    AT_WARN_LOG("At_SetCmmiPara: Taf_PhonePinHandle failed.");
                }
                break;
            case AT_CMD_CPIN_VERIFY_SET:
                if (TAF_SUCCESS != Taf_PhonePinHandle(gastAtClientTab[ucIndex].usClientId,0, &pMmiOpParam->PinReq))
                {
                    AT_WARN_LOG("At_SetCmmiPara: Taf_PhonePinHandle failed.");
                }

                break;
            case AT_CMD_CPIN2_VERIFY_SET:
                if (TAF_SUCCESS != Taf_PhonePinHandle(gastAtClientTab[ucIndex].usClientId,0, &pMmiOpParam->PinReq))
                {
                    AT_WARN_LOG("At_SetCmmiPara: Taf_PhonePinHandle failed.");
                }
                break;
            case AT_CMD_SS_REGISTER:
                if (TAF_SUCCESS != TAF_RegisterSSReq(gastAtClientTab[ucIndex].usClientId,0, &pMmiOpParam->RegisterSsReq))
                {
                    AT_WARN_LOG("At_SetCmmiPara: TAF_RegisterSSReq failed.");
                }
                break;
            case AT_CMD_SS_ERASE:
                if (TAF_SUCCESS != TAF_EraseSSReq(gastAtClientTab[ucIndex].usClientId,0, &pMmiOpParam->EraseSsReq))
                {
                    AT_WARN_LOG("At_SetCmmiPara: TAF_EraseSSReq failed.");
                }
                break;
            case AT_CMD_SS_ACTIVATE:
                if (TAF_SUCCESS != TAF_ActivateSSReq(gastAtClientTab[ucIndex].usClientId,0, &pMmiOpParam->ActivateSsReq))
                {
                    AT_WARN_LOG("At_SetCmmiPara: TAF_ActivateSSReq failed.");
                }
                break;
            case AT_CMD_SS_DEACTIVATE:
                if (TAF_SUCCESS != TAF_DeactivateSSReq(gastAtClientTab[ucIndex].usClientId,0, &pMmiOpParam->DeactivateSsReq))
                {
                    AT_WARN_LOG("At_SetCmmiPara: TAF_DeactivateSSReq failed.");
                }
                break;

             /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
             case AT_CMD_SS_DEACTIVE_CCBS:
                if (TAF_SUCCESS != TAF_EraseCCEntryReq(gastAtClientTab[ucIndex].usClientId,0, &pMmiOpParam->stCcbsEraseReq))
                {
                    AT_WARN_LOG("At_SetCmmiPara: TAF_EraseCCEntryReq failed.");
                }
                break;
            /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, end */

            case AT_CMD_SS_INTERROGATE:
            case AT_CMD_SS_INTERROGATE_CCBS:
                if (TAF_SUCCESS != TAF_InterrogateSSReq(gastAtClientTab[ucIndex].usClientId,0, &pMmiOpParam->InterrogateSsReq))
                {
                    AT_WARN_LOG("At_SetCmmiPara: TAF_DeactivateSSReq failed.");
                }
                break;
            case AT_CMD_SS_REGISTER_PSWD:
                if (TAF_SUCCESS != TAF_RegisterPasswordReq(gastAtClientTab[ucIndex].usClientId,0, &pMmiOpParam->RegPwdReq))
                {
                    AT_WARN_LOG("At_SetCmmiPara: TAF_InterrogateSSReq failed.");
                }
                break;
            /* Delete by f62575 for SS FDN&Call Control, 2013-05-06, begin */
            /* ????AT_CMD_SS_GET_PSWD ???? */
            /* Delete by f62575 for SS FDN&Call Control, 2013-05-06, end */
            case AT_CMD_SS_USSD:
                if (TAF_SUCCESS != TAF_ProcessUnstructuredSSReq(gastAtClientTab[ucIndex].usClientId,0, &pMmiOpParam->ProcessUssdReq))
                {
                    AT_WARN_LOG("At_SetCmmiPara: TAF_ProcessUnstructuredSSReq failed.");
                }
                break;
            case AT_CMD_CLIP_READ:
                /* Modified by l60609 for DSDA Phase III, 2013-2-20, Begin */
                pstSsCtx->ucClipType = (AT_CLIP_TYPE)gastAtParaList[0].ulParaValue;
                /* Modified by l60609 for DSDA Phase III, 2013-2-20, End */
                PS_MEM_FREE(WUEPS_PID_AT, pMmiOpParam);
                return AT_OK;
            default:
                break;
        }
        gastAtClientTab[ucIndex].CmdCurrentOpt = enCmdCurrentOpt;
        PS_MEM_FREE(WUEPS_PID_AT, pMmiOpParam);
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        PS_MEM_FREE(WUEPS_PID_AT, pMmiOpParam);
        return AT_CME_INCORRECT_PARAMETERS;
    }
}


/*****************************************************************************
 ?? ?? ??  : AT_CheckApnFirstAndLastChar
 ????????  : ????APN??????????????????????
 ????????  : ucApnCharacter         - APN????
 ????????  : ??
 ?? ?? ??  : VOS_OK                 - APN??????????????????????????
             VOS_ERR                - APN????????????????????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??7??7??
    ??    ??   : A00165503
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_CheckApnFirstAndLastChar(
    VOS_UINT8                           ucApnCharacter
)
{
    if ( ! ( (('A' <= ucApnCharacter) && ('Z' >= ucApnCharacter))
          || (('0' <= ucApnCharacter) && ('9' >= ucApnCharacter)) ) )
    {
        AT_WARN_LOG("AT_CheckApnFirstAndLastChar: WARNING: Invalid begin/end character in APN.");
        return VOS_ERR;
    }

    return VOS_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_CheckApn
 ????????  : ????APN??????????, ?????????????????? TS 23.003 section 9.1
 ????????  : pucApn                     - APN??????
             usApnLen                   - APN????
 ????????  : ??
 ?? ?? ??  : VOS_OK                     - APN????????????????
             VOS_ERR                    - APN??????????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??7??7??
    ??    ??   : A00165503
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_CheckApnFormat(
    VOS_UINT8                          *pucApn,
    VOS_UINT16                          usApnLen
)
{
    VOS_UINT32                          i;
    VOS_UINT8                           ucApnCharacter;

    for ( i = 0 ; i < usApnLen; i++ )
    {
        /* ????APN?????????? */
        ucApnCharacter = AT_UPCASE(pucApn[i]);

        /* ????APN?????????? */
        if ( ! ( (('A' <= ucApnCharacter) && ('Z' >= ucApnCharacter))
              || (('0' <= ucApnCharacter) && ('9' >= ucApnCharacter))
              || ('-' == ucApnCharacter)
              || ('.' == ucApnCharacter) ) )
        {
            AT_WARN_LOG("AT_CheckApn: WARNING: Invalid character in APN.");
            return VOS_ERR;
        }
    }

    /* ????APN?????????????? */
    ucApnCharacter = AT_UPCASE(pucApn[0]);
    if ( VOS_OK != AT_CheckApnFirstAndLastChar(ucApnCharacter) )
    {
        AT_WARN_LOG("AT_CheckApn: WARNING: Invalid begin/end character in APN.");
        return VOS_ERR;
    }

    /* ????APN?????????????? */
    ucApnCharacter = AT_UPCASE(pucApn[usApnLen - 1]);
    if ( VOS_OK != AT_CheckApnFirstAndLastChar(ucApnCharacter) )
    {
        AT_WARN_LOG("AT_CheckApn: WARNING: Invalid begin/end character in APN.");
        return VOS_ERR;
    }

    return VOS_OK;
}

/*****************************************************************************
 Prototype      : At_SetCgdcontPara
 Description    : +CGDCONT=[<cid>[,<PDP_type>[,<APN>[,<PDP_addr>[,<d_comp>[,<h_comp>]]]]]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2011??10??23??
    ??    ??   : A00165503
    ????????   : ??????????????Primary PDP??????????
  3.??    ??   : 2012??01??06??
    ??    ??   : f00179208
    ????????   : PS Project, ????????????????IP????
  4.??    ??   : 2012??8??10??
    ??    ??   : z60575
    ????????   : DTS2012081006711: ??????IPV6??????????
  5.??    ??   : 2013??07??08??
    ??    ??   : Y00213812
    ????????   : VoLTE_PhaseI ??????????<P-CSCF_discovery>??<IM_CN_Signalling_Flag_Ind>
*****************************************************************************/
VOS_UINT32 AT_SetCgdcontPara(VOS_UINT8 ucIndex)
{
    TAF_PDP_PRIM_CONTEXT_EXT_STRU       stPdpCxtInfo;

    /* ?????? */
    PS_MEM_SET(&stPdpCxtInfo, 0x00, sizeof(TAF_PDP_PRIM_CONTEXT_EXT_STRU));

    /* ???????? */
    if ( 0 == gastAtParaList[0].usParaLen )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( gucAtParaIndex > 10 )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<CID> */
    stPdpCxtInfo.ucCid                  = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ????????????<CID>, ???????????????? */
    if ( 1 == gucAtParaIndex )
    {
        stPdpCxtInfo.ucDefined          = VOS_FALSE;
    }
    else
    {
        stPdpCxtInfo.ucDefined          = VOS_TRUE;

        /* ????<PDP_type> */
        if ( 0 != gastAtParaList[1].usParaLen )
        {
            if ( gastAtParaList[1].ulParaValue < TAF_PDP_PPP )
            {
                stPdpCxtInfo.bitOpPdpType   = VOS_TRUE;

                /* IP:1, IPV6:2, IPV4V6:3, PPP:4 */
                stPdpCxtInfo.enPdpType  = (VOS_UINT8)(gastAtParaList[1].ulParaValue + 1);

                if ( (TAF_PDP_IPV6   == stPdpCxtInfo.enPdpType)
                  || (TAF_PDP_IPV4V6 == stPdpCxtInfo.enPdpType) )
                {
                    if (AT_IPV6_CAPABILITY_IPV4_ONLY == AT_GetIpv6Capability())
                    {
                        return AT_CME_INCORRECT_PARAMETERS;
                    }
                }
            }
        }
        /* ??????????????????<PDP_type>??????""(????????)??,????????????????
           ??g_TafCidTab[ucCid].ucUsed???????????????????????????????????????? */

        /* ????<APN> */
        if ( gastAtParaList[2].usParaLen > TAF_MAX_APN_LEN )
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        if ( 0 != gastAtParaList[2].usParaLen )
        {
            /* ???? */
            if ( VOS_OK != AT_CheckApnFormat(gastAtParaList[2].aucPara,
                                             gastAtParaList[2].usParaLen) )
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }

            stPdpCxtInfo.bitOpApn       = VOS_TRUE;
            PS_MEM_CPY((VOS_CHAR*)stPdpCxtInfo.aucApn,
                       (VOS_CHAR*)gastAtParaList[2].aucPara,
                       gastAtParaList[2].usParaLen);
            stPdpCxtInfo.aucApn[gastAtParaList[2].usParaLen] = 0;
        }

        /* ????<PDP_addr> */
        /* ??????IPV4??IP ADDR??IPV6????????AT??????????IP ADDR */
        if ( 0 != gastAtParaList[3].usParaLen )
        {
            if ( (TAF_PDP_IPV4 != (gastAtParaList[1].ulParaValue + 1))
              || (gastAtParaList[3].usParaLen > (TAF_MAX_IPV4_ADDR_STR_LEN - 1)) )
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }

            stPdpCxtInfo.bitOpPdpAddr        = VOS_TRUE;
            stPdpCxtInfo.stPdpAddr.enPdpType = TAF_PDP_IPV4;

            /* ??IP???????????????????? */
            if ( VOS_OK != AT_Ipv4AddrAtoi((VOS_CHAR*)gastAtParaList[3].aucPara,
                                           (VOS_UINT8*)stPdpCxtInfo.stPdpAddr.aucIpv4Addr) )
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }
        }

        /* ????<d_comp> */
        if ( 0 != gastAtParaList[4].usParaLen )
        {
            stPdpCxtInfo.bitOpPdpDcomp  = VOS_TRUE;
            stPdpCxtInfo.enPdpDcomp     = (VOS_UINT8)gastAtParaList[4].ulParaValue;
        }

        /* ????<h_comp> */
        if ( 0 != gastAtParaList[5].usParaLen )
        {
            stPdpCxtInfo.bitOpPdpHcomp  = VOS_TRUE;
            stPdpCxtInfo.enPdpHcomp     = (VOS_UINT8)gastAtParaList[5].ulParaValue;
        }

        /* ????<IPv4AddrAlloc> */
        if ( 0 != gastAtParaList[6].usParaLen )
        {
            stPdpCxtInfo.bitOpIpv4AddrAlloc = VOS_TRUE;
            stPdpCxtInfo.enIpv4AddrAlloc    = (VOS_UINT8)gastAtParaList[6].ulParaValue;
        }

        /* ????<Emergency Indication> */
        if ( 0 != gastAtParaList[7].usParaLen )
        {
            stPdpCxtInfo.bitOpEmergencyInd = VOS_TRUE;
            stPdpCxtInfo.enEmergencyFlg    = (VOS_UINT8)gastAtParaList[7].ulParaValue;
        }
        /* Added by Y00213812 for VoLTE_PhaseI ????, 2013-07-08, begin */
        /* ????<P-CSCF_discovery> */
        if ( 0 != gastAtParaList[8].usParaLen )
        {
            stPdpCxtInfo.bitOpPcscfDiscovery = VOS_TRUE;
            stPdpCxtInfo.enPcscfDiscovery    = (VOS_UINT8)gastAtParaList[8].ulParaValue;
        }
        /* ????<IM_CN_Signalling_Flag_Ind> */
        if ( 0 != gastAtParaList[9].usParaLen )
        {
            stPdpCxtInfo.bitOpImCnSignalFlg = VOS_TRUE;
            stPdpCxtInfo.enImCnSignalFlg    = (VOS_UINT8)gastAtParaList[9].ulParaValue;
        }
    }

    /* ???????????? */
    if ( VOS_OK != TAF_PS_SetPrimPdpContextInfo(WUEPS_PID_AT,
                                                AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                                0,
                                                &stPdpCxtInfo) )
    {
        return AT_ERROR;
    }
    /* Added by Y00213812 for VoLTE_PhaseI ????, 2013-07-08, end */

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGDCONT_SET;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 Prototype      : At_SetCgdscontPara
 Description    : +CGDSCONT=[<cid> ,<p_cid> [,<d_comp> [,<h_comp>]]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function

  2.??    ??   : 2011??10??23??
    ??    ??   : A00165503
    ????????   : ??????????????Secondary PDP??????????

  3.??    ??   : 2012??4??4??
    ??    ??   : A00165503
    ????????   : DTS2012040101115: ??????????????????????????????

  4.??    ??   : 2013??07??08??
    ??    ??   : Y00213812
    ????????   : VoLTE_PhaseI ??????EVENT??????????????PID
*****************************************************************************/
VOS_UINT32 AT_SetCgdscontPara(VOS_UINT8 ucIndex)
{
    TAF_PDP_SEC_CONTEXT_EXT_STRU        stPdpCxtInfo;

    /* ?????? */
    PS_MEM_SET(&stPdpCxtInfo, 0x00, sizeof(TAF_PDP_SEC_CONTEXT_EXT_STRU));

    /* ???????? */
    if ( 0 == gastAtParaList[0].usParaLen )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( gucAtParaIndex > 4 )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<s_cid> */
    stPdpCxtInfo.ucCid         = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ????????????<CID>, ???????????????? */
    if ( 1 == gucAtParaIndex )
    {
        stPdpCxtInfo.ucDefined          = VOS_FALSE;
    }
    else
    {
        stPdpCxtInfo.ucDefined          = VOS_TRUE;

        /* ????<p_cid> */
        if ( 0 != gastAtParaList[1].usParaLen )
        {
            stPdpCxtInfo.bitOpLinkdCid = VOS_TRUE;
            stPdpCxtInfo.ucLinkdCid    = (VOS_UINT8)gastAtParaList[1].ulParaValue;

            if (stPdpCxtInfo.ucCid == stPdpCxtInfo.ucLinkdCid)
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }
        }
        else
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        /* ????<d_comp> */
        if ( 0 != gastAtParaList[2].usParaLen )
        {
            stPdpCxtInfo.bitOpPdpDcomp  = VOS_TRUE;
            stPdpCxtInfo.enPdpDcomp     = (VOS_UINT8)gastAtParaList[2].ulParaValue;
        }

        /* ????<h_comp> */
        if ( 0 != gastAtParaList[3].usParaLen )
        {
            stPdpCxtInfo.bitOpPdpHcomp  = VOS_TRUE;
            stPdpCxtInfo.enPdpHcomp     = (VOS_UINT8)gastAtParaList[3].ulParaValue;
        }
    }

    /* ???????????? */
    if ( VOS_OK != TAF_PS_SetSecPdpContextInfo(WUEPS_PID_AT,
                                               AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                               0,
                                               &stPdpCxtInfo) )
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGDSCONT_SET;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 Prototype      : AT_SetCgeqreqPara
 Description    : +CGEQREQ=[<cid>                           [1-11]
                           [,<Traffic class>                [0-4]
                           [,<Maximum bitrate UL>           [0-8640]
                           [,<Maximum bitrate DL>           [0-8640]
                           [,<Guaranteed bitrate UL>        [0-8640]
                           [,<Guaranteed bitrate DL>        [0-8640]
                           [,<Delivery order>               [0-2]
                           [,<Maximum SDU size>             [0-1520]
                           [,<SDU error ratio>              [0-7]
                           [,<Residual bit error ratio>     [0-9]
                           [,<Delivery of erroneous SDUs>   [0-3]
                           [,<Transfer delay>               [0-4100]
                           [,<Traffic handling priority>    [0-3]
                           ]]]]]]]]]]]]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function

  2.??    ??   : 2011??10??23??
    ??    ??   : A00165503
    ????????   : ??????????????UMTS QOS????
  3.??    ??   : 2013??07??08??
    ??    ??   : Y00213812
    ????????   : VoLTE_PhaseI ??????EVENT??????????????PID
  4.??    ??   : 2015??4??7??
    ??    ??   : w00316404
    ????????   : M project A characeristic AT part
*****************************************************************************/
TAF_UINT32 AT_SetCgeqreqPara(TAF_UINT8 ucIndex)
{
    TAF_UMTS_QOS_EXT_STRU               stUmtsQosInfo;

    /* ?????? */
    PS_MEM_SET(&stUmtsQosInfo, 0x00, sizeof(TAF_UMTS_QOS_EXT_STRU));

    /* ???????? */
    if ( 0 == gastAtParaList[0].usParaLen )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( gucAtParaIndex > 15 )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<cid> */
    stUmtsQosInfo.ucCid                     = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ????????????<CID>, ???????????????? */
    if ( 1 == gucAtParaIndex )
    {
        stUmtsQosInfo.ucDefined             = VOS_FALSE;
    }
    else
    {
        stUmtsQosInfo.ucDefined             = VOS_TRUE;

        /* ????<Traffic class> */
        if ( 0 != gastAtParaList[1].usParaLen )
        {
            stUmtsQosInfo.bitOpTrafficClass = VOS_TRUE;
            stUmtsQosInfo.ucTrafficClass    = (VOS_UINT8)gastAtParaList[1].ulParaValue;
        }

        /* ????<Maximum bitrate UL> */
        if ( 0 != gastAtParaList[2].usParaLen )
        {
            stUmtsQosInfo.bitOpMaxBitUl     = VOS_TRUE;
            stUmtsQosInfo.ulMaxBitUl        = gastAtParaList[2].ulParaValue;
        }

        /* ????<Maximum bitrate DL> */
        if ( 0 != gastAtParaList[3].usParaLen )
        {
            stUmtsQosInfo.bitOpMaxBitDl     = VOS_TRUE;
            stUmtsQosInfo.ulMaxBitDl        = gastAtParaList[3].ulParaValue;
        }

        /* ????<Guaranteed bitrate UL> */
        if ( 0 != gastAtParaList[4].usParaLen )
        {
            stUmtsQosInfo.bitOpGtdBitUl     = VOS_TRUE;
            stUmtsQosInfo.ulGtdBitUl        = gastAtParaList[4].ulParaValue;
        }

        /* ????<Guaranteed bitrate DL> */
        if ( 0 != gastAtParaList[5].usParaLen )
        {
            stUmtsQosInfo.bitOpGtdBitDl     = VOS_TRUE;
            stUmtsQosInfo.ulGtdBitDl        = gastAtParaList[5].ulParaValue;
        }

        /* ????<Delivery order> */
        if ( 0 != gastAtParaList[6].usParaLen )
        {
            stUmtsQosInfo.bitOpDeliverOrder = VOS_TRUE;
            stUmtsQosInfo.ucDeliverOrder    = (VOS_UINT8)gastAtParaList[6].ulParaValue;
        }

        /* ????<Maximum SDU size> */
        if ( 0 != gastAtParaList[7].usParaLen )
        {
            stUmtsQosInfo.bitOpMaxSduSize   = VOS_TRUE;
            stUmtsQosInfo.usMaxSduSize      = (VOS_UINT16)gastAtParaList[7].ulParaValue;
        }

        /* ????<SDU error ratio> */
        if ( 0 != gastAtParaList[8].usParaLen )
        {
            stUmtsQosInfo.bitOpSduErrRatio  = VOS_TRUE;
            stUmtsQosInfo.ucSduErrRatio     = (VOS_UINT8)gastAtParaList[8].ulParaValue;
        }

        /* ????<Residual bit error ratio> */
        if ( 0 != gastAtParaList[9].usParaLen )
        {
            stUmtsQosInfo.bitOpResidualBer  = VOS_TRUE;
            stUmtsQosInfo.ucResidualBer     = (VOS_UINT8)gastAtParaList[9].ulParaValue;
        }

        /* ????<Delivery of erroneous SDUs> */
        if ( 0 != gastAtParaList[10].usParaLen )
        {
            stUmtsQosInfo.bitOpDeliverErrSdu = VOS_TRUE;
            stUmtsQosInfo.ucDeliverErrSdu    = (VOS_UINT8)gastAtParaList[10].ulParaValue;
        }

        /* ????<Transfer delay> */
        if ( 0 != gastAtParaList[11].usParaLen )
        {
            stUmtsQosInfo.bitOpTransDelay   = VOS_TRUE;
            stUmtsQosInfo.usTransDelay      = (VOS_UINT16)gastAtParaList[11].ulParaValue;
        }

        /* ????<Traffic handling priority> */
        if ( 0 != gastAtParaList[12].usParaLen )
        {
            stUmtsQosInfo.bitOpTraffHandlePrior = VOS_TRUE;
            stUmtsQosInfo.ucTraffHandlePrior    = (VOS_UINT8)gastAtParaList[12].ulParaValue;
        }

        /* ????<Source Statistics Descriptor> */
        if ( 0 != gastAtParaList[13].usParaLen )
        {
            stUmtsQosInfo.bitOpSrcStatisticsDes = VOS_TRUE;
            stUmtsQosInfo.ucSrcStatisticsDes    = (VOS_UINT8)gastAtParaList[13].ulParaValue;
        }

        /* ????<Signalling Indication> */
        if ( 0 != gastAtParaList[14].usParaLen )
        {
            stUmtsQosInfo.bitOpSignalIndication = VOS_TRUE;
            stUmtsQosInfo.ucSignalIndication    = (VOS_UINT8)gastAtParaList[14].ulParaValue;
        }
    }

    /* ???????????? */
    if(AT_CMD_CGEQREQ == g_stParseContext[ucIndex].pstCmdElement->ulCmdIndex)
    {
        if ( VOS_OK != TAF_PS_SetUmtsQosInfo(WUEPS_PID_AT,
                                             AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                             0, &stUmtsQosInfo) )
        {
            return AT_ERROR;
        }

        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt  = AT_CMD_CGEQREQ_SET;
    }
    else
    {
        if ( VOS_OK != TAF_PS_SetUmtsQosMinInfo(WUEPS_PID_AT,
                                                AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                                0, &stUmtsQosInfo) )
        {
            return AT_ERROR;
        }

        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt  = AT_CMD_CGEQMIN_SET;

    }

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 Prototype      : AT_SetCgeqminPara
 Description    : +CGEQMIN=[<cid>
                           [,<Traffic class>
                           [,<Maximum bitrate UL>
                           [,<Maximum bitrate DL>
                           [,<Guaranteed bitrate UL>
                           [,<Guaranteed bitrate DL>
                           [,<Delivery order>
                           [,<Maximum SDU size>
                           [,<SDU error ratio>
                           [,<Residual bit error ratio>
                           [,<Delivery of erroneous SDUs>
                           [,<Transfer delay>
                           [,<Traffic handling priority>]]]]]]]]]]]]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function

  2.??    ??   : 2011??10??23??
    ??    ??   : A00165503
    ????????   : ??????????????UMTS MIN QOS????

*****************************************************************************/
TAF_UINT32 AT_SetCgeqminPara(TAF_UINT8 ucIndex)
{
    return AT_SetCgeqreqPara(ucIndex);
}

/*****************************************************************************
 Prototype      : AT_SetCgpaddrPara
 Description    : +CGPADDR=[<cid>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function

  2.Date        : 2011-06-30
    Author      : f00179208
    Modification: ??????????DTS2011052304121,??AT??????PDP????????????CID??AT+CGPADDR????????IP????

  3.??    ??   : 2011??10??23??
    ??    ??   : A00165503
    ????????   : ??????????????????????PDP IP????????
  4.??    ??   : 2012??01??08??
    ??    ??   : F00179208
    ????????   : PS ?????????? ????????AT+CGPADDR????????????INCORRECT PARAMETERS??????
*****************************************************************************/
TAF_UINT32 AT_SetCgpaddrPara(TAF_UINT8 ucIndex)
{
    VOS_UINT32                          i;
    VOS_UINT32                          ulCidIndex;
    TAF_CID_LIST_STRU                   stCidListInfo;
    VOS_UINT32                          ulIndex;

    /* ?????? */
    ulCidIndex  = 0;
    PS_MEM_SET(&stCidListInfo, 0x00, sizeof(TAF_CID_LIST_STRU));

    /* ???????? */
    if ( gucAtParaIndex > TAF_MAX_CID )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ulIndex = AT_MAX_PARA_NUMBER;

    /* ???????? */
    if ( 0 != gucAtParaIndex )
    {
        for ( i = 0; i < ulIndex; i++ )
        {
            if ( 0 == gastAtParaList[i].usParaLen )
            {
                break;
            }
            else
            {
                ulCidIndex = gastAtParaList[i].ulParaValue;
            }

            /* ??CID????????, ??????????CID */
            stCidListInfo.aucCid[ulCidIndex] = 1;
        }
    }
    else
    {
        for ( i = 1; i <= TAF_MAX_CID; i++ )
        {
            stCidListInfo.aucCid[i] = 1;
        }
    }

    /* ???????????? */
    if ( VOS_OK != TAF_PS_GetPdpIpAddrInfo(WUEPS_PID_AT,
                                           AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                           0, &stCidListInfo) )
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGPADDR_SET;

    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 Prototype      : AT_SetCgeqnegPara
 Description    : +CGEQNEG=[<cid>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2006-12-07
    Author      : H41410
    Modification: Created function
  2.??    ??   : 2011??10??23??
    ??    ??   : A00165503
    ????????   : ??????????????????????PDP UMTS QOS????
  3.??    ??   : 2012??06??26??
    ??    ??   : f00179208
    ????????   : ??????:DTS2012062201678, ????????CID??????????
*****************************************************************************/
TAF_UINT32 AT_SetCgeqnegPara(TAF_UINT8 ucIndex)
{
    VOS_UINT32                          i;
    VOS_UINT32                          ulCidIndex;
    TAF_CID_LIST_STRU                   stCidListInfo;
    VOS_UINT32                          ulIndex;

    /* ?????? */
    ulCidIndex  = 0;
    PS_MEM_SET(&stCidListInfo, 0x00, sizeof(TAF_CID_LIST_STRU));

    /* ???????? */
    if ( gucAtParaIndex > TAF_MAX_CID )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ulIndex = AT_MAX_PARA_NUMBER;

    /* ???????? */
    /* +CGEQNEG[=<cid>[,<cid>[,...]]] */
    if ( 0 != gucAtParaIndex )
    {
        for ( i = 0; i < ulIndex; i++ )
        {
            if ( 0 == gastAtParaList[i].usParaLen )
            {
                break;
            }
            else
            {
                ulCidIndex = gastAtParaList[i].ulParaValue;
            }

            /* ??CID????????, ??????????CID */
            stCidListInfo.aucCid[ulCidIndex] = 1;
        }
    }
    else
    {
        for ( i = 1; i <= TAF_MAX_CID; i++ )
        {
            stCidListInfo.aucCid[i] = 1;
        }
    }

    /* ???????????? */
    if ( VOS_OK != TAF_PS_GetDynamicUmtsQosInfo(WUEPS_PID_AT,
                                                AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                                0,
                                                &stCidListInfo) )
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGEQNEG_SET;

    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 Prototype      : AT_SetCgcmodPara
 Description    : +CGCMOD=[<cid>[,<cid>[,...]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function

  2.??    ??   : 2011??10??23??
    ??    ??   : A00165503
    ????????   : ??????????????PDP????????(??????????)
  3.??    ??   : 2012??04??09??
    ??    ??   : f00179208
    ????????   : DTS2012032402423, ??????????????
*****************************************************************************/
TAF_UINT32 AT_SetCgcmodPara(TAF_UINT8 ucIndex)
{
    VOS_UINT32                          i;
    VOS_UINT32                          ulCidIndex;
    TAF_CID_LIST_STRU                   stCidListInfo;

    /* ?????? */
    ulCidIndex  = 0;
    PS_MEM_SET(&stCidListInfo, 0x00, sizeof(TAF_CID_LIST_STRU));

    /* ???????? */
    if ( AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (1 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( 0 != gucAtParaIndex )
    {
        for ( i = 0; i < AT_MAX_PARA_NUMBER; i++ )
        {
            if ( 0 == gastAtParaList[i].usParaLen )
            {
                break;
            }
            else
            {
                ulCidIndex = gastAtParaList[i].ulParaValue;
            }

            /* ??CID????????, ??????????CID */
            stCidListInfo.aucCid[ulCidIndex] = VOS_TRUE;
        }
    }

    /* ???????????? */
    if ( VOS_OK != TAF_PS_CallModify(WUEPS_PID_AT,
                                     AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                     0,
                                     &stCidListInfo) )
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGCMOD_SET;

    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 Prototype      : AT_SetCgactPara
 Description    : +CGACT=[<state> [,<cid>[,<cid>[,...]]]]

                  ??????????0xFF

                  +CGACT=1,<cid>...
                  ??cid????cid[1-11]????1

                  +CGACT=0,<cid>...
                  ??cid????cid[0-11]????1

                  D*98*<cid>...#
                  ??cid????cid[0]??1

                  +CGCMOD=<cid>...
                  ??cid????cid[1-11]????1

 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function

  2.??    ??   : 2011??10??23??
    ??    ??   : A00165503
    ????????   : ??????????????PDP??????????(??????????)
  3.??    ??   : 2012??2??24??
    ??    ??   : L47619
    ????????   : V7R1C50 IPC????:??HSIC AT????????????????????AT^CHDATA????????????
  4.??    ??   : 2012??03??24??
    ??    ??   : f00179208
    ????????   : ????????:DTS2012031904349,??????AT??????????
  5.??    ??   : 2012??06??25??
    ??    ??   : f00179208
    ????????   : ??????:DTS2012062201590, AT+CGACT=,1??????????????????????????
  6.??    ??   : 2012??06??30??
    ??    ??   : L47619
    ????????   : V7R1C50 A-GPS????,????HSIC AT??????????????CID????????????????

*****************************************************************************/
TAF_UINT32 AT_SetCgactPara(TAF_UINT8 ucIndex)
{
    VOS_UINT32                          i;
    VOS_UINT32                          ulCidIndex;
    TAF_CID_LIST_STATE_STRU             stCidListStateInfo;
    AT_MODEM_PS_CTX_STRU               *pstPsModemCtx = VOS_NULL_PTR;

    /* ?????? */
    ulCidIndex  = 0;
    PS_MEM_SET(&stCidListStateInfo, 0x00, sizeof(TAF_CID_LIST_STATE_STRU));

    /* ???????? */
    if ( AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( gucAtParaIndex != 2)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    pstPsModemCtx = AT_GetModemPsCtxAddrFromClientId(ucIndex);

    /* ???????? */
    stCidListStateInfo.ucState  = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    for ( i = 0; i < (AT_MAX_PARA_NUMBER - 1); i++ )
    {
        if ( 0 == gastAtParaList[i + 1UL].usParaLen )
        {
            break;
        }
        else
        {
            ulCidIndex = gastAtParaList[i + 1UL].ulParaValue;

            /* ????AP-Modem????????????????????HSIC AT??????????CGACT??????
                ????????????CID??????????????????????????????????ERROR */
            if (VOS_TRUE == AT_CheckHsicUser(ucIndex))
               /* Modified by L47619 for V7R1C50 A-GPS Project, 2012/06/28, end */
            {
                if ((VOS_FALSE == pstPsModemCtx->astChannelCfg[ulCidIndex].ulUsed)
                  ||(UDI_INVAL_DEV_ID == (UDI_DEVICE_ID_E)pstPsModemCtx->astChannelCfg[ulCidIndex].ulRmNetId))
                {
                    return AT_ERROR;
                }
            }
        }

        /* ??CID????????, ??????????CID */
        stCidListStateInfo.aucCid[ulCidIndex] = 1;
    }

    /* ???????????? */
    if ( VOS_OK != TAF_PS_SetPdpContextState(WUEPS_PID_AT,
                                             AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                             0,
                                             &stCidListStateInfo) )
    {
        return AT_ERROR;
    }

    if ( 1 == stCidListStateInfo.ucState )
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGACT_ORG_SET;
    }
    else
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGACT_END_SET;
    }

    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 Prototype      : AT_SetCgansPara
 Description    : +CGANS=[<response>, [<L2P> ,[<cid>]]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function

  2.??    ??   : 2011??10??23??
    ??    ??   : A00165503
    ????????   : ????????????????????PS??MT CALL
  3.??    ??   : 2013??05??22??
    ??    ??   : f00179208
    ????????   : V3R3 PPP PROJECT
*****************************************************************************/
TAF_UINT32 AT_SetCgansPara(TAF_UINT8 ucIndex)
{
    VOS_UINT8                           ucRspType;
    TAF_PS_ANSWER_STRU                  stAnsInfo;

    /* ?????? */
    PS_MEM_SET(&stAnsInfo, 0x00, sizeof(TAF_PS_ANSWER_STRU));

    /* ???????? */
    if ( 0 == gastAtParaList[0].usParaLen )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( gucAtParaIndex > 3 )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    ucRspType           = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ????<CID> */
    if ( 0 != gastAtParaList[2].usParaLen )
    {
        stAnsInfo.ucCid = (VOS_UINT8)gastAtParaList[2].ulParaValue;
    }

    /* Added by l60609 for V3R3 PPP RPOJECT 2013-06-07, Begin */
    /* ????ans???????? */
    if (AT_CMD_CGANS_EXT == g_stParseContext[ucIndex].pstCmdElement->ulCmdIndex)
    {
        stAnsInfo.ucAnsExtFlg = VOS_TRUE;
    }
    else
    {
        stAnsInfo.ucAnsExtFlg = VOS_FALSE;
    }
    /* Added by l60609 for V3R3 PPP RPOJECT 2013-06-07, End */

    /* ???????????? */
    if ( 1 == ucRspType )
    {
        if ( VOS_OK == TAF_PS_CallAnswer(WUEPS_PID_AT,
                                         AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                         0,
                                         &stAnsInfo) )
        {
            /* ???????????????? */
            if (AT_CMD_CGANS_EXT == g_stParseContext[ucIndex].pstCmdElement->ulCmdIndex)
            {
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGANS_ANS_EXT_SET;
            }
            else
            {
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGANS_ANS_SET;
            }

            /* ???????????????????? */
            return AT_WAIT_ASYNC_RETURN;
        }
        else
        {
            return AT_ERROR;
        }
    }
    else
    {
        /* 0 --  ?????????????????????? */
        if ( VOS_OK == TAF_PS_CallHangup(WUEPS_PID_AT,
                                         AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                         0) )
        {
            /* ???????????????? */
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGANS_ANS_SET;

            /* ???????????????????? */
            return AT_WAIT_ASYNC_RETURN;
        }
        else
        {
            return AT_ERROR;
        }
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_CountSpecCharInString
 ????????  : ??????????????????????????????
 ????????  : VOS_UINT8               *pucData
             VOS_UINT16               usLen
             VOS_UINT8                ucChar
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??01??12??
    ??    ??   : f00179208
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_CountSpecCharInString(
    VOS_UINT8                          *pucData,
    VOS_UINT16                          usLen,
    VOS_UINT8                           ucChar
)
{
    VOS_UINT8                          *pucRead;
    VOS_UINT32                          ulChkLen;
    VOS_UINT32                          ulCount;

    if(VOS_NULL_PTR == pucData)
    {
        return 0;
    }

    pucRead                             = pucData;
    ulChkLen                            = 0;
    ulCount                             = 0;

    /* ???? */
    while( ulChkLen++ < usLen )
    {
        if(ucChar == *pucRead)
        {
            ulCount++;
        }
        pucRead++;
    }

    return ulCount;

}

/*****************************************************************************
 ?? ?? ??  : AT_FillTftIpv4Addr
 ????????  : ????AT????????TFT??IPV4????
 ????????  : VOS_UINT8                   *pData
             VOS_UINT32                   ulLen
 ????????  : TAF_TFT_EXT_STRU            *pstTftInfo
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??01??12??
    ??    ??   : f00179208
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_FillTftIpv4Addr(
    VOS_UINT8                          *pucData,
    VOS_UINT16                          usLen,
    TAF_TFT_EXT_STRU                   *pstTftInfo
)
{
    VOS_UINT32                          ulCount;
    VOS_UINT32                          ulRet;
    VOS_CHAR                           *ptrTmp;

    ulCount = 0;
    ptrTmp  = VOS_NULL_PTR;

    ulCount = AT_CountDigit(pucData, usLen, '.', 7);
    if ((0 == ulCount) || (0 == pucData[ulCount]))
    {
        return AT_FAILURE;
    }

    ulCount = AT_CountDigit(pucData, usLen, '.', 4);

    pstTftInfo->bitOpSrcIp = VOS_TRUE;
    pstTftInfo->stSourceIpaddr.enPdpType = TAF_PDP_IPV4;
    pstTftInfo->stSourceIpMask.enPdpType = TAF_PDP_IPV4;

    if ((usLen - ulCount) > TAF_MAX_IPV4_ADDR_STR_LEN)
    {
        return AT_FAILURE;
    }

    ptrTmp = (VOS_CHAR *)&(pucData[ulCount]);

    ulRet = AT_Ipv4AddrAtoi(ptrTmp, pstTftInfo->stSourceIpMask.aucIpv4Addr);
    if(VOS_OK != ulRet)
    {
        return AT_FAILURE;
    }

    if ((ulCount - 1) > TAF_MAX_IPV4_ADDR_STR_LEN)
    {
        return AT_FAILURE;
    }

    ptrTmp = (VOS_CHAR *)(pucData);
    ptrTmp[ulCount - 1] = '\0';

    ulRet = AT_Ipv4AddrAtoi(ptrTmp, pstTftInfo->stSourceIpaddr.aucIpv4Addr);
    if (VOS_OK != ulRet)
    {
        return AT_FAILURE;
    }

    return AT_SUCCESS;

}

/*****************************************************************************
 ?? ?? ??  : AT_FillTftLocalIpv4Addr
 ????????  : ????AT????????TFT??Local IPV4????
 ????????  : VOS_UINT8                   *pData
             VOS_UINT32                   ulLen
 ????????  : TAF_TFT_EXT_STRU            *pstTftInfo
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??09??28??
    ??    ??   : w00316404
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_FillTftLocalIpv4Addr(
    VOS_UINT8                          *pucData,
    VOS_UINT16                          usLen,
    TAF_TFT_EXT_STRU                   *pstTftInfo
)
{
    VOS_UINT32                          ulCount;
    VOS_UINT32                          ulRet;
    VOS_CHAR                           *ptrTmp;

    ulCount = 0;
    ptrTmp  = VOS_NULL_PTR;

    ulCount = AT_CountDigit(pucData, usLen, '.', 7);
    if ((0 == ulCount) || (0 == pucData[ulCount]))
    {
        return AT_FAILURE;
    }

    ulCount = AT_CountDigit(pucData, usLen, '.', 4);

    pstTftInfo->bitOpLocalIpv4AddrAndMask= VOS_TRUE;

    if ((usLen - ulCount) > TAF_MAX_IPV4_ADDR_STR_LEN)
    {
        return AT_FAILURE;
    }

    ptrTmp = (VOS_CHAR *)&(pucData[ulCount]);

    ulRet = AT_Ipv4AddrAtoi(ptrTmp, pstTftInfo->aucLocalIpv4Mask);
    if(VOS_OK != ulRet)
    {
        return AT_FAILURE;
    }

    if ((ulCount - 1) > TAF_MAX_IPV4_ADDR_STR_LEN)
    {
        return AT_FAILURE;
    }

    ptrTmp = (VOS_CHAR *)(pucData);
    ptrTmp[ulCount - 1] = '\0';

    ulRet = AT_Ipv4AddrAtoi(ptrTmp, pstTftInfo->aucLocalIpv4Addr);
    if (VOS_OK != ulRet)
    {
        return AT_FAILURE;
    }

    return AT_SUCCESS;

}

/*****************************************************************************
 ?? ?? ??  : AT_FillTftIpv6Addr
 ????????  : ????AT????????TFT??IPV6????
 ????????  : VOS_UINT8                   *pData
             VOS_UINT32                   ulLen
 ????????  : TAF_TFT_EXT_STRU            *pstTftInfo
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??01??12??
    ??    ??   : f00179208
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_FillTftIpv6Addr(
    VOS_UINT8                          *pucData,
    VOS_UINT16                          usLen,
    TAF_TFT_EXT_STRU                   *pstTftInfo
)
{
    VOS_UINT32                          ulCount;
    VOS_UINT32                          ulRet;
    VOS_CHAR                           *ptrTmp;

    ulCount = 0;
    ptrTmp  = VOS_NULL_PTR;

    ulCount = AT_CountDigit(pucData, usLen, '.', 31);
    if ((0 == ulCount) || (0 == pucData[ulCount]))
    {
        return AT_FAILURE;
    }

    ulCount = AT_CountDigit(pucData, usLen, '.', 16);

    pstTftInfo->bitOpSrcIp = VOS_TRUE;
    pstTftInfo->stSourceIpaddr.enPdpType = TAF_PDP_IPV6;
    pstTftInfo->stSourceIpMask.enPdpType = TAF_PDP_IPV6;

    if ((usLen - ulCount) > TAF_MAX_IPV6_ADDR_DOT_STR_LEN)
    {
        return AT_FAILURE;
    }

    ptrTmp = (VOS_CHAR *)&(pucData[ulCount]);

    ulRet = AT_Ipv6AddrAtoi(ptrTmp, pstTftInfo->stSourceIpMask.aucIpv6Addr);
    if(VOS_OK != ulRet)
    {
        return AT_FAILURE;
    }

    if ((ulCount - 1) > TAF_MAX_IPV6_ADDR_DOT_STR_LEN)
    {
        return AT_FAILURE;
    }

    ptrTmp = (VOS_CHAR *)(pucData);
    ptrTmp[ulCount - 1] = '\0';

    ulRet = AT_Ipv6AddrAtoi(ptrTmp, pstTftInfo->stSourceIpaddr.aucIpv6Addr);
    if (VOS_OK != ulRet)
    {
        return AT_FAILURE;
    }

    return AT_SUCCESS;
}

/*****************************************************************************
 ?? ?? ??  : AT_FillTftLocalIpv6Addr
 ????????  : ????AT????????TFT??Local IPV6????
 ????????  : VOS_UINT8                   *pData
             VOS_UINT32                   ulLen
 ????????  : TAF_TFT_EXT_STRU            *pstTftInfo
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??09??28??
    ??    ??   : w00316404
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_FillTftLocalIpv6Addr(
    VOS_UINT8                          *pucData,
    VOS_UINT16                          usLen,
    TAF_TFT_EXT_STRU                   *pstTftInfo
)
{
    VOS_UINT32                          ulCount;
    VOS_UINT32                          ulRet;
    VOS_CHAR                           *ptrTmp;
    VOS_UINT8                           aucLocalIpv6Mask[APP_MAX_IPV6_ADDR_LEN];

    ulCount = 0;
    ptrTmp  = VOS_NULL_PTR;
    PS_MEM_SET(aucLocalIpv6Mask, 0x00, sizeof(aucLocalIpv6Mask));

    ulCount = AT_CountDigit(pucData, usLen, '.', 31);
    if ((0 == ulCount) || (0 == pucData[ulCount]))
    {
        return AT_FAILURE;
    }

    ulCount = AT_CountDigit(pucData, usLen, '.', 16);

    pstTftInfo->bitOpLocalIpv6AddrAndMask = VOS_TRUE;

    if ((usLen - ulCount) > TAF_MAX_IPV6_ADDR_DOT_STR_LEN)
    {
        return AT_FAILURE;
    }

    ptrTmp = (VOS_CHAR *)&(pucData[ulCount]);

    ulRet = AT_Ipv6AddrAtoi(ptrTmp, aucLocalIpv6Mask);

    if(VOS_OK != ulRet)
    {
        return AT_FAILURE;
    }

    pstTftInfo->ucLocalIpv6Prefix = AT_CalcIpv6PrefixLength(aucLocalIpv6Mask);

    if ((ulCount - 1) > TAF_MAX_IPV6_ADDR_DOT_STR_LEN)
    {
        return AT_FAILURE;
    }

    ptrTmp = (VOS_CHAR *)(pucData);
    ptrTmp[ulCount - 1] = '\0';

    ulRet = AT_Ipv6AddrAtoi(ptrTmp, pstTftInfo->aucLocalIpv6Addr);
    if (VOS_OK != ulRet)
    {
        return AT_FAILURE;
    }

    return AT_SUCCESS;
}

/*****************************************************************************
 ?? ?? ??  : AT_FillTftIpAddr
 ????????  : ????AT????????TFT??IP????
 ????????  : VOS_UINT8                   *pData
             VOS_UINT32                   ulLen
 ????????  : TAF_TFT_EXT_STRU            *pstTftInfo
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??01??12??
    ??    ??   : f00179208
    ????????   : ??????????
  2.??    ??   : 2012??8??10??
    ??    ??   : z60575
    ????????   : DTS2012081006711: ??????IPV6??????????
  3.??    ??   : 2015??9??28??
    ??    ??   : W00316404
    ????????   : R11 TFT ????????
*****************************************************************************/
VOS_UINT32 AT_FillTftIpAddr(
    VOS_UINT8                          *pData,
    VOS_UINT16                          usLen,
    TAF_TFT_EXT_STRU                   *pstTftInfo,
    VOS_UINT8                           ucIpAddrType
)
{
    VOS_UINT32                          ulCount;

    /* ??????????IP????????????'.'?????? */
    ulCount = AT_CountSpecCharInString(pData, usLen, '.');

    /* ??????????IPV4????????????????????7??'.' */
    /* ????"10.140.23.144.255.255.255.0"????4????IPV4????????4???????? */
    if ((TAF_IPV4_ADDR_LEN * 2 - 1) == ulCount)
    {
        if (AT_IP_ADDR_TYPE_SOURCE == ucIpAddrType)
        {
            return (AT_FillTftIpv4Addr(pData, usLen, pstTftInfo));
        }

        if (AT_IP_ADDR_TYPE_LOCAL == ucIpAddrType)
        {
            return (AT_FillTftLocalIpv4Addr(pData, usLen, pstTftInfo));
        }
    }
    /* ??????????IPV6????????????????????31??'.' */
    /* ????"32.8.0.2.0.2.0.1.0.2.0.1.0.3.21.111.255.255.255.255.255.255.255.255.255.255.255.255.255.255.255.255" */
    /* ??16????IPV6????????16???????? */
    else if ((AT_IPV6_CAPABILITY_IPV4_ONLY != AT_GetIpv6Capability())
           && ((TAF_IPV6_ADDR_LEN * 2 - 1) == ulCount))
    {
        if (AT_IP_ADDR_TYPE_SOURCE == ucIpAddrType)
        {
            return (AT_FillTftIpv6Addr(pData, usLen, pstTftInfo));
        }

        if (AT_IP_ADDR_TYPE_LOCAL == ucIpAddrType)
        {
            return (AT_FillTftLocalIpv6Addr(pData, usLen, pstTftInfo));
        }
    }
    else
    {
        return AT_FAILURE;
    }

    return AT_FAILURE;
}

/*****************************************************************************
 Prototype      : AT_SetCgtftPara
                  ????????????????????MAPS1000????
 Description    : +CGTFT=[<cid>,    [1-11]
                         [<packet filter identifier>,           [1-8]
                         <evaluation precedence index>          [0-255]
                         [,<source address and subnet mask>     [1-8]
                         [,<protocol number (ipv4) / next header (ipv6)>
                         [,<destination port range>
                         [,<source port range>
                         [,<ipsec security parameter index (spi)>
                         [,<type of service (tos) (ipv4) and mask / traffic class (ipv6) and mask>
                         [,<flow label (ipv6)> ]]]]]]]]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
  3.??    ?? : 2007-11-09
    ??    ?? : L47619
    ???????? : ????????:A32D13432
  4.??    ??   : 2011??10??23??
    ??    ??   : A00165503
    ????????   : ????LTE??????, ??????????????TFT????
  5.??    ??   : 2012??01??12??
    ??    ??   : f00179208
    ????????   : PS?????????? ????????IPV6??????????
  6.??    ??   : 2015??9??28??
    ??    ??   : W00316404
    ????????   : R11 TFT ????????
*****************************************************************************/
TAF_UINT32 AT_SetCgtftPara(TAF_UINT8 ucIndex)
{
    TAF_TFT_EXT_STRU                    stTftInfo;
    VOS_UINT32                          ulLow  = 0;
    VOS_UINT32                          ulHigh = 0;
    VOS_UINT32                          ulCount = 0;
    VOS_UINT32                          ulRet;

    /* ?????? */
    PS_MEM_SET(&stTftInfo, 0x00, sizeof(TAF_TFT_EXT_STRU));

    /* ????????cid???????????? */
    if ( 0 == gastAtParaList[0].usParaLen )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????,<flow label (ipv6)>????????<direction>?????????? */
    if (AT_IsSupportReleaseRst(AT_RELEASE_R11))
    {
        if ( gucAtParaIndex > 12 )
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
    }
    else
    {
        if ( gucAtParaIndex > 11 )
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
    }

    /* ????<cid> */
    stTftInfo.ucCid = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ????????????<CID>, ???????????????? */
    if ( 1 == gucAtParaIndex )
    {
        stTftInfo.ucDefined             = VOS_FALSE;
    }
    else
    {
        stTftInfo.ucDefined             = VOS_TRUE;

        /* ????<packet filter identifier> */
        if ( 0 != gastAtParaList[1].usParaLen )
        {
            stTftInfo.bitOpPktFilterId  = 1;
            stTftInfo.ucPacketFilterId  = (VOS_UINT8)gastAtParaList[1].ulParaValue;
        }

        /* ????<evaluation precedence index> */
        if ( 0 != gastAtParaList[2].usParaLen )
        {
            stTftInfo.bitOpPrecedence   = 1;
            stTftInfo.ucPrecedence      = (VOS_UINT8)gastAtParaList[2].ulParaValue;
        }

        /* ????<source address and subnet mask> */
        if ( 0 != gastAtParaList[3].usParaLen )
        {
            ulRet = AT_FillTftIpAddr(gastAtParaList[3].aucPara,
                                     gastAtParaList[3].usParaLen,
                                     &stTftInfo, AT_IP_ADDR_TYPE_SOURCE);
            if (AT_FAILURE == ulRet)
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }
        }

        /* ????<protocol number (ipv4) / next header (ipv6)> */
        if(0 != gastAtParaList[4].usParaLen)
        {
            stTftInfo.bitOpProtocolId   = 1;
            stTftInfo.ucProtocolId      = (VOS_UINT8)gastAtParaList[4].ulParaValue;
        }

        /* ????<destination port range> */
        if(0 != gastAtParaList[5].usParaLen)
        {
            ulCount = AT_CountDigit(gastAtParaList[5].aucPara,gastAtParaList[5].usParaLen,'.',1);
            if((0 == ulCount) || (0 == gastAtParaList[5].aucPara[ulCount]))
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }

            stTftInfo.bitOpDestPortRange= 1;

            if(AT_FAILURE == atAuc2ul(gastAtParaList[5].aucPara,(VOS_UINT16)(ulCount-1),&ulLow))
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }
            if(AT_FAILURE == atAuc2ul(&gastAtParaList[5].aucPara[ulCount],(VOS_UINT16)(gastAtParaList[5].usParaLen - ulCount),&ulHigh))
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }

            if((ulLow > 65535) || (ulHigh > 65535) || (ulLow > ulHigh))
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }
            else
            {
                stTftInfo.usHighDestPort = (VOS_UINT16)ulHigh;
                stTftInfo.usLowDestPort = (VOS_UINT16)ulLow;
            }
        }

        /* ????<source port range> */
        if(0 != gastAtParaList[6].usParaLen)
        {
            ulCount = AT_CountDigit(gastAtParaList[6].aucPara,gastAtParaList[6].usParaLen,'.',1);
            if((0 == ulCount) || (0 == gastAtParaList[6].aucPara[ulCount]))
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }

            stTftInfo.bitOpSrcPortRange = 1;

            if(AT_FAILURE == atAuc2ul(gastAtParaList[6].aucPara,(VOS_UINT16)(ulCount-1),&ulLow))
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }
            if(AT_FAILURE == atAuc2ul(&gastAtParaList[6].aucPara[ulCount],(VOS_UINT16)(gastAtParaList[6].usParaLen - ulCount),&ulHigh))
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }
            if((ulLow > 65535) || (ulHigh > 65535) || (ulLow > ulHigh))
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }
            else
            {
                stTftInfo.usHighSourcePort = (VOS_UINT16)ulHigh;
                stTftInfo.usLowSourcePort = (VOS_UINT16)ulLow;
            }
        }

        /* ????<ipsec security parameter index (spi)> */
        if(0 != gastAtParaList[7].usParaLen)
        {
            stTftInfo.bitOpSpi = 1;
            /* ???????????????? */
            if(gastAtParaList[7].usParaLen > 8) /*????FFFFFFFF */
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }

            if(AT_FAILURE == At_String2Hex(gastAtParaList[7].aucPara,gastAtParaList[7].usParaLen,&gastAtParaList[7].ulParaValue))
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }
            stTftInfo.ulSecuParaIndex = gastAtParaList[7].ulParaValue;
        }

        /* ????<type of service (tos) (ipv4) and mask / traffic class (ipv6) and mask> */
        if(0 != gastAtParaList[8].usParaLen)
        {
            ulCount = AT_CountDigit(gastAtParaList[8].aucPara,gastAtParaList[8].usParaLen,'.',1);
            if((0 == ulCount) || (0 == gastAtParaList[8].aucPara[ulCount]))
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }

            stTftInfo.bitOpTosMask = 1;

            if(AT_FAILURE == atAuc2ul(gastAtParaList[8].aucPara,(VOS_UINT16)(ulCount-1),&ulLow))
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }
            if(AT_FAILURE == atAuc2ul(&gastAtParaList[8].aucPara[ulCount],(VOS_UINT16)(gastAtParaList[8].usParaLen - ulCount),&ulHigh))
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }

            if((ulLow > 255) || (ulHigh > 255))
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }
            else
            {
                stTftInfo.ucTypeOfServiceMask = (VOS_UINT8)ulHigh;
                stTftInfo.ucTypeOfService = (VOS_UINT8)ulLow;
            }
        }

        /* <flow label (ipv6)> */
        if(0 != gastAtParaList[9].usParaLen)
        {
            stTftInfo.bitOpFlowLable = 1;
            stTftInfo.ulFlowLable = gastAtParaList[9].ulParaValue;
        }

        /* <direction> */
        if(0 != gastAtParaList[10].usParaLen)
        {
            stTftInfo.bitOpDirection = 1;
            stTftInfo.ucDirection = (VOS_UINT8)gastAtParaList[10].ulParaValue;
        }

        if (AT_IsSupportReleaseRst(AT_RELEASE_R11))
        {
            /* ????<local address and subnet mask> */
            if ( 0 != gastAtParaList[11].usParaLen )
            {
                ulRet = AT_FillTftIpAddr(gastAtParaList[11].aucPara,
                                         gastAtParaList[11].usParaLen,
                                         &stTftInfo, AT_IP_ADDR_TYPE_LOCAL);
                if (AT_FAILURE == ulRet)
                {
                    return AT_CME_INCORRECT_PARAMETERS;
                }
            }
        }
    }

    if ( VOS_OK != TAF_PS_SetTftInfo(WUEPS_PID_AT,
                                     AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                     0,
                                     &stTftInfo) )
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGTFT_SET;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 Prototype      : AT_SetCgdnsPara
 Description    : +CGDNS=<cid>,[<PriDns>,[<SecDns>]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function

  2.??    ??   : 2011??10??23??
    ??    ??   : A00165503
    ????????   : ??????????????PDP DNS????
  3.??    ??   : 2012??03??26??
    ??    ??   : w00199382
    ????????   : DTS2012032207736,????????
  4.??    ??   : 2013??07??08??
    ??    ??   : Y00213812
    ????????   : VoLTE_PhaseI ??????EVENT??????????????PID
*****************************************************************************/
TAF_UINT32 AT_SetCgdnsPara(TAF_UINT8 ucIndex)
{
    TAF_PDP_DNS_EXT_STRU                stPdpDnsInfo;

    VOS_UINT8                           aucTempIpv4Addr[TAF_IPV4_ADDR_LEN];
    VOS_UINT32                          ulRslt;

    /* ?????? */
    PS_MEM_SET(&stPdpDnsInfo, 0x00, sizeof(TAF_PDP_DNS_EXT_STRU));

    /* ???????? */
    if ( 0 == gastAtParaList[0].usParaLen )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( gucAtParaIndex > 3 )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<cid> */
    stPdpDnsInfo.ucCid                  = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ????????????<CID>, ???????????????? */
    if ( 1 == gucAtParaIndex )
    {
        stPdpDnsInfo.ucDefined          = VOS_FALSE;
    }
    else
    {
        stPdpDnsInfo.ucDefined          = VOS_TRUE;

        /* ????<PriDns> */
        if ( 0 != gastAtParaList[1].usParaLen )
        {
            /* ????<PriDns>?????????????????? */
            if ( gastAtParaList[1].usParaLen > (TAF_MAX_IPV4_ADDR_STR_LEN - 1) )
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }


            ulRslt = AT_Ipv4AddrAtoi((VOS_CHAR*)gastAtParaList[1].aucPara, &aucTempIpv4Addr[0]);

            if ( VOS_OK != ulRslt )
            {
               return AT_CME_INCORRECT_PARAMETERS;
            }


            stPdpDnsInfo.bitOpPrimDnsAddr = VOS_TRUE;
            PS_MEM_CPY(stPdpDnsInfo.aucPrimDnsAddr,
                       aucTempIpv4Addr,
                       TAF_IPV4_ADDR_LEN);
        }

        /* ????<SecDns> */
        if ( 0 != gastAtParaList[2].usParaLen )
        {
            /* ????<SecDns>?????????????????? */
            if ( gastAtParaList[2].usParaLen > (TAF_MAX_IPV4_ADDR_STR_LEN - 1) )
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }


            /*????????????????????????DNS??????????????????????*/
            ulRslt = AT_Ipv4AddrAtoi((VOS_CHAR*)gastAtParaList[2].aucPara, &aucTempIpv4Addr[0]);

            if ( VOS_OK != ulRslt )
            {
               return AT_CME_INCORRECT_PARAMETERS;
            }


            stPdpDnsInfo.bitOpSecDnsAddr = VOS_TRUE;
            PS_MEM_CPY(stPdpDnsInfo.aucSecDnsAddr,
                       aucTempIpv4Addr,
                       TAF_IPV4_ADDR_LEN);
        }
    }

    /* ???????????? */
    if ( VOS_OK != TAF_PS_SetPdpDnsInfo(WUEPS_PID_AT,
                                        AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                        0, &stPdpDnsInfo) )
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGDNS_SET;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 Prototype      : AT_SetCgautoPara
 Description    : +CGAUTO=[<n>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function

  2.??    ??   : 2011??10??23??
    ??    ??   : A00165503
    ????????   : ??????????????????????????

*****************************************************************************/
TAF_UINT32 AT_SetCgautoPara(TAF_UINT8 ucIndex)
{
    VOS_UINT32                          ulAnsMode;

    /* ???????? */
    if ( AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( gucAtParaIndex > 1 )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( 0 == gastAtParaList[0].usParaLen )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<n> */
    ulAnsMode = gastAtParaList[0].ulParaValue;

    /* ???????????? */
    if ( VOS_OK != TAF_PS_SetAnsModeInfo(WUEPS_PID_AT,
                                         AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                         0,
                                         ulAnsMode) )
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGAUTO_SET;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;
}

/******************************************************************************
 ????????: atSetCgeqosPara
 ????????: +CGEQOS=[<cid> [,<QCI> [,<DL_GBR>, <UL_GBR> [,<DL_MBR>,<UL_MBR]]]]

 ????????:
   ulIndex [in] ...
                ...

 ?? ?? ??:
    TODO: ...

 ????????: TODO: ...
 ????????: TODO: ...
 ??    ??: ??????/00064416 [2009-09-11]
******************************************************************************/
VOS_UINT32 atSetCgeqosPara(VOS_UINT8 ucIndex)
{
    TAF_EPS_QOS_EXT_STRU                stEpsQosInfo;

    PS_MEM_SET(&stEpsQosInfo, 0x00, sizeof(TAF_EPS_QOS_EXT_STRU));

    if ( 0 == gastAtParaList[0].usParaLen )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ( gucAtParaIndex > 6 )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    stEpsQosInfo.ucCid = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    if ( 0 != gastAtParaList[1].usParaLen )
    {
        stEpsQosInfo.bitOpQCI   = 1;
        stEpsQosInfo.ucQCI      = (VOS_UINT8)gastAtParaList[1].ulParaValue;
    }

    if ( 0 != gastAtParaList[2].usParaLen )
    {
        stEpsQosInfo.bitOpDLGBR = 1;
        stEpsQosInfo.ulDLGBR    = gastAtParaList[2].ulParaValue;
    }

    if (0 != gastAtParaList[3].usParaLen )
    {
        stEpsQosInfo.bitOpULGBR = 1;
        stEpsQosInfo.ulULGBR    = gastAtParaList[3].ulParaValue;
    }

    if (0 != gastAtParaList[4].usParaLen )
    {
        stEpsQosInfo.bitOpDLMBR = 1;
        stEpsQosInfo.ulDLMBR= gastAtParaList[4].ulParaValue;
    }

    if (0 != gastAtParaList[5].usParaLen )
    {
        stEpsQosInfo.bitOpULMBR = 1;
        stEpsQosInfo.ulULMBR    = gastAtParaList[5].ulParaValue;
    }

    if ( VOS_OK != TAF_PS_SetEpsQosInfo(WUEPS_PID_AT,
                                        AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                        0,
                                        &stEpsQosInfo) )
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGEQOS_SET;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;
}

/******************************************************************************
 ????????: atQryCgeqosPara
 ????????: +CGEQOS

 ????????:
   ulIndex [in] ...
                ...

 ?? ?? ??:
    TODO: ...

 ????????: TODO: ...
 ????????: TODO: ...
 ??    ??: ??????/00064416 [2009-09-11]
******************************************************************************/
VOS_UINT32 atQryCgeqosPara(VOS_UINT8 ucIndex)
{
    if( VOS_OK != TAF_PS_GetEpsQosInfo(WUEPS_PID_AT,
                                       AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                       0))
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGEQOS_READ;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;
}


/******************************************************************************
 ????????: atSetCgeqosrdpPara
 ????????: +CGEQOSRDP=[<cid>]

 ????????:
   ulIndex [in] ...
                ...

 ?? ?? ??:
    TODO: ...

 ????????: TODO: ...
 ????????: TODO: ...
 ??    ??: ??????/00064416 [2009-09-11]
******************************************************************************/
VOS_UINT32 atSetCgeqosrdpPara(VOS_UINT8 ucIndex)
{
    VOS_UINT8                           ucCid;

    ucCid     = 0;

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(0 != gastAtParaList[0].usParaLen)
    {
        ucCid = (VOS_UINT8)gastAtParaList[0].ulParaValue;
    }
    else
    {
        ucCid = 0xff;
    }

    if ( VOS_OK != TAF_PS_GetDynamicEpsQosInfo(WUEPS_PID_AT,
                                               AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                               0,
                                               ucCid) )
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGEQOSRDP_SET;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;
}

/******************************************************************************
 ????????: atSetCgcontrdpPara
 ????????: +CGCONTRDP=[<p_cid>]

 ????????:
   ulIndex [in] ...
                ...

 ?? ?? ??:
    TODO: ...

 ????????: TODO: ...
 ????????: TODO: ...
 ??    ??: ??????/00064416 [2009-09-11]
******************************************************************************/
VOS_UINT32 atSetCgcontrdpPara(VOS_UINT8 ucIndex)
{
    VOS_UINT8                           ucCid;

    ucCid     = 0;

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(0 != gastAtParaList[0].usParaLen)
    {
        ucCid = (VOS_UINT8)gastAtParaList[0].ulParaValue;
    }
    else
    {
        ucCid = 0xff;
    }

    if( VOS_OK != TAF_PS_GetDynamicPrimPdpContextInfo(WUEPS_PID_AT,
                                                      AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                                      0, ucCid) )
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGCONTRDP_SET;

    return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */

}

/******************************************************************************
 ????????: atSetCgscontrdpPara
 ????????: +CGSCONTRDP=[<p_cid>]

 ????????:
   ulIndex [in] ...
                ...

 ?? ?? ??:
    TODO: ...

 ????????: TODO: ...
 ????????: TODO: ...
 ??    ??: ??????/00064416 [2009-09-11]
******************************************************************************/
VOS_UINT32 atSetCgscontrdpPara(VOS_UINT8 ucIndex)
{
    VOS_UINT8                           ucCid;

    ucCid     = 0;

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(0 != gastAtParaList[0].usParaLen)
    {
        ucCid = (VOS_UINT8)gastAtParaList[0].ulParaValue;
    }
    else
    {
        ucCid = 0xff;
    }

    if( VOS_OK != TAF_PS_GetDynamicSecPdpContextInfo(WUEPS_PID_AT,
                                                     AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                                     0,
                                                     ucCid) )
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGSCONTRDP_SET;

    return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */

}

/******************************************************************************
 ????????: atSetCgtftrdpPara
 ????????: +CGTFTRDP=[<cid>]

 ????????:
   ulIndex [in] ...
                ...

 ?? ?? ??:
    TODO: ...

 ????????: TODO: ...
 ????????: TODO: ...
 ??    ??: ??????/00064416 [2009-09-11]
******************************************************************************/
VOS_UINT32 atSetCgtftrdpPara(VOS_UINT8 ucIndex)
{
    VOS_UINT8                           ucCid;

    ucCid       = 0;

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(0 != gastAtParaList[0].usParaLen)
    {
        ucCid = (VOS_UINT8)(gastAtParaList[0].ulParaValue);
    }
    else
    {
        ucCid = 0xff;
    }

    if( VOS_OK != TAF_PS_GetDynamicTftInfo(WUEPS_PID_AT,
                                           AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                           0,
                                           ucCid) )
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGTFTRDP_SET;

    return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
}

/*****************************************************************************
 ?? ?? ??  : At_SetCsndPara
 ????????  : ^CSND=<rabid>,<len>
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  --- ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2005??04??19??
    ??    ??   : ---
    ????????   : ??????????

  2.??    ??   : 2012??6??12??
    ??    ??   : S62952
    ????????   : DTS2012032802023: ^CSND????????????????

  3.??    ??   : 2013??11??11??
    ??    ??   : A00165503
    ????????   : DTS2013110900839: ^CSND????????????
*****************************************************************************/
VOS_UINT32 At_SetCsndPara(VOS_UINT8 ucIndex)
{
    IMM_ZC_STRU                        *pstImmZc = VOS_NULL_PTR;
    VOS_UINT8                          *pucData = VOS_NULL_PTR;
    VOS_UINT8                           ucRabId;
    VOS_UINT16                          usLength;
    VOS_UINT32                          ulSrcAddr;
    VOS_UINT32                          ulDestAddr;
    VOS_UINT16                          usDestPort;
    VOS_UINT16                          usSrcPort;
    VOS_UINT16                          usTotalLen;
    MODEM_ID_ENUM_UINT16                enModemId;
    VOS_UINT32                          ulIpAddr;

    /* ???????? */
    if ((0 == gastAtParaList[0].usParaLen) || (0 == gastAtParaList[1].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (gucAtParaIndex > 2)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* RABID??????????[5,15] */
    ucRabId     = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    if (!AT_PS_IS_RABID_VALID(ucRabId))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????UDP???????? */
    usLength    = (VOS_UINT16)gastAtParaList[1].ulParaValue;
    usLength    = (usLength > 1400) ? (1400) : usLength;
    usTotalLen  = usLength + AT_IP_HDR_LEN + AT_UDP_HDR_LEN;

    /* ?????????????????? */
    pstImmZc    = IMM_ZcStaticAlloc(usTotalLen);
    if (VOS_NULL_PTR == pstImmZc)
    {
        AT_ERR_LOG("At_SetCsndPara: IMM_ZcStaticAlloc fail!");
        return AT_ERROR;
    }

    ulIpAddr    = AT_PS_GetIpAddrByRabId(ucIndex, ucRabId);
    ulSrcAddr   = ulIpAddr;
    ulDestAddr  = ulIpAddr + 1;
    usDestPort  = 9600;
    usSrcPort   = 9700;

    pucData     = (VOS_UINT8 *)IMM_ZcPut(pstImmZc, usTotalLen);
    if (VOS_NULL_PTR == pucData)
    {
        IMM_ZcFree(pstImmZc);

        AT_ERR_LOG("At_SetCsndPara: IMM_ZcPut fail!");

        return AT_ERROR;
    }

    /* ????UDP?? */
    if (VOS_OK != AT_BuildUdpHdr((AT_UDP_PACKET_FORMAT_STRU *)pucData,
                                 usLength,
                                 ulSrcAddr,
                                 ulDestAddr,
                                 usSrcPort,
                                 usDestPort))
    {
        IMM_ZcFree(pstImmZc);

        AT_ERR_LOG("At_SetCsndPara: IMM_ZcPut fail!");

        return AT_ERROR;
    }

    enModemId       = MODEM_ID_0;
    if (VOS_OK != AT_GetModemIdFromClient(ucIndex, &enModemId))
    {
        IMM_ZcFree(pstImmZc);
        AT_ERR_LOG("At_SetCsndPara: Get modem id fail.");
        return AT_ERROR;
    }

    if (MODEM_ID_0 != enModemId)
    {
        ucRabId    |= AT_PS_RABID_MODEM_1_MASK;
    }

    /* ?????????????? */
    if (VOS_OK != ADS_UL_SendPacket(pstImmZc, ucRabId))
    {
        IMM_ZcFree(pstImmZc);

        return AT_ERROR;
    }

    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetCgdataPara
 Description    : +CGDATA=[<L2P>,[<cid>[,<cid> [,...]]]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function

  2.??    ??   : 2012??5??5??
    ??    ??   : A00165503
    ????????   : DTS2012050405948: +CGDATA????????V3R1????
*****************************************************************************/
TAF_UINT32 At_SetCgdataPara(TAF_UINT8 ucIndex)
{
    VOS_UINT32                          ulCidIndex;
    TAF_CID_LIST_STATE_STRU             stCidListStateInfo;

    /* ?????? */
    ulCidIndex  = 0;
    PS_MEM_SET(&stCidListStateInfo, 0x00, sizeof(TAF_CID_LIST_STATE_STRU));

    /* ???????? */
    if ( AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????, ????????????????CID */
    if (gucAtParaIndex > 2)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* <L2P>?????? */

    /* ???????? */
    stCidListStateInfo.ucState  = 1;

    if (0 == gastAtParaList[1].usParaLen)
    {
        ulCidIndex = 1;
    }
    else
    {
        ulCidIndex = gastAtParaList[1].ulParaValue;
    }

    /* ??CID????????, ??????????CID */
    stCidListStateInfo.aucCid[ulCidIndex] = 1;


    /* ???????????? */
    if (VOS_OK != TAF_PS_SetPdpContextState(WUEPS_PID_AT,
                                            AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                            0,
                                            &stCidListStateInfo))
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGDATA_SET;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;

}

/*****************************************************************************
 Prototype      : At_SetCgattPara
 Description    : +CGATT=[<state>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2014??1??27??
    ??    ??   : S00261364
    ????????   : L-C??????????
  3.??    ??   : 2015??4??9??
    ??    ??   : h00313353
    ????????   : SysCfg???? Attach????????
*****************************************************************************/
TAF_UINT32 At_SetCgattPara(TAF_UINT8 ucIndex)
{
    /* Added by s00261364 for L-C??????????, 2014-1-27, begin */
    TAF_MMA_DETACH_PARA_STRU           stDetachPara;
    /* Added by s00261364 for L-C??????????, 2014-1-27, end */

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if(0 == gastAtParaList[0].ulParaValue)
    {
        /* Added by s00261364 for L-C??????????, 2014-1-27, begin */
        /* ????Detach???? */
        PS_MEM_SET(&stDetachPara, 0, sizeof(TAF_MMA_DETACH_PARA_STRU));
        stDetachPara.enDetachCause  = TAF_MMA_DETACH_CAUSE_USER_DETACH;
        stDetachPara.enDetachDomain = TAF_MMA_SERVICE_DOMAIN_PS;

        if (VOS_TRUE == TAF_MMA_DetachReq(WUEPS_PID_AT, gastAtClientTab[ucIndex].usClientId, 0, &stDetachPara))
        {
            /* ???????????????? */
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGATT_DETAACH_SET;
            return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
        }
        else
        {
            return AT_ERROR;
        }
        /* Added by s00261364 for L-C??????????, 2014-1-27, end */
    }
    else
    {
        /* ????Attach???? */
        if(VOS_TRUE == TAF_MMA_AttachReq(WUEPS_PID_AT, gastAtClientTab[ucIndex].usClientId, 0, TAF_MMA_ATTACH_TYPE_GPRS))
        {
            /* ???????????????? */
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGATT_ATTACH_SET;
            return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
        }
        else
        {
            return AT_ERROR;
        }
    }
}

/*****************************************************************************
 Prototype      : At_SetCgcattPara
 Description    : +CGCATT=<state>,<mode>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
  3.??    ?? : 2014??1??27??
    ??    ?? : S00261364
    ???????? : L-C??????????
  4.??    ??   : 2015??4??9??
    ??    ??   : h00313353
    ????????   : SysCfg???? Attach????????????
*****************************************************************************/
TAF_UINT32 At_SetCgcattPara(TAF_UINT8 ucIndex)
{
    /* Added by s00261364 for L-C??????????, 2014-1-27, begin */
    TAF_MMA_DETACH_PARA_STRU           stDetachPara;
    /* Added by s00261364 for L-C??????????, 2014-1-27, end */

    TAF_MMA_ATTACH_TYPE_ENUM_UINT8     enAttachType;

    enAttachType                       = TAF_MMA_ATTACH_TYPE_BUTT;

    /* ???????? */
    if((0 == gastAtParaList[0].usParaLen) || (0 == gastAtParaList[1].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 2)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if(0 == gastAtParaList[0].ulParaValue)
    {
        /* ????Detach???? */
        /* Added by s00261364 for L-C??????????, 2014-1-27, begin */
        PS_MEM_SET(&stDetachPara, 0, sizeof(TAF_MMA_DETACH_PARA_STRU));
        stDetachPara.enDetachCause  = TAF_MMA_DETACH_CAUSE_USER_DETACH;

        /* ??????????DETACH???? */
        stDetachPara.enDetachDomain = At_ConvertDetachTypeToServiceDomain(gastAtParaList[1].ulParaValue);

        if(VOS_TRUE == TAF_MMA_DetachReq(WUEPS_PID_AT, gastAtClientTab[ucIndex].usClientId, 0, &stDetachPara))
        {
            /* ???????????????? */
            switch(gastAtParaList[1].ulParaValue)
            {
                case AT_CGCATT_MODE_PS:
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGCATT_PS_DETAACH_SET;
                break;

                case AT_CGCATT_MODE_CS:
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGCATT_CS_DETAACH_SET;
                break;

            default:
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGCATT_PS_CS_DETAACH_SET;
                break;
            }
            return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
        }
        else
        {
            return AT_ERROR;
        }
        /* Added by s00261364 for L-C??????????, 2014-1-27, end */
    }
    else
    {
        /* ??????????ATTACH???? */
        enAttachType    = At_ConvertCgcattModeToAttachType(gastAtParaList[1].ulParaValue);

        /* ????Attach???? */
        if(VOS_TRUE == TAF_MMA_AttachReq(WUEPS_PID_AT, gastAtClientTab[ucIndex].usClientId, 0, enAttachType))
        {
            /* ???????????????? */
            switch(gastAtParaList[1].ulParaValue)
            {
                case AT_CGCATT_MODE_PS:
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGCATT_PS_ATTACH_SET;
                break;

                case AT_CGCATT_MODE_CS:
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGCATT_CS_ATTACH_SET;
                break;

            default:
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGCATT_PS_CS_ATTACH_SET;
                break;
            }
            return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
        }
        else
        {
            return AT_ERROR;
        }
    }
}
/* Added by s46746 for V7R1 phase II , 2011-10-18, begin */
/*****************************************************************************
 ?? ?? ??  : At_SetCopsActPara
 ????????  : ????COPS??????????????????
 ????????  : usParaLen:????????
             ulParaValue:??????
 ????????  : penPhRat:????????
 ?? ?? ??  : ??
 ????????  :
 ????????  :

 ????????     :
 1.??    ??   : 2011??10??18??
   ??    ??   : s46746
   ????????   : ??????????
  2.??    ??   : 2015??4??10??
    ??    ??   : h00313353
    ????????   : SysCfg????
*****************************************************************************/
VOS_VOID At_SetCopsActPara(
    TAF_MMA_RAT_TYPE_ENUM_UINT8        *penPhRat,
    VOS_UINT16                          usParaLen,
    VOS_UINT32                          ulParaValue
)
{
    /* ??????????????0???????????? */
    if (0 == usParaLen)
    {
        *penPhRat = TAF_MMA_RAT_BUTT;

        return;
    }

    /* ????????????????????,??????AT??MMA???????????????????????? */
    if (AT_COPS_RAT_GSM == ulParaValue)
    {
        *penPhRat = TAF_MMA_RAT_GSM;
    }
    else if (AT_COPS_RAT_WCDMA == ulParaValue)
    {
        *penPhRat = TAF_MMA_RAT_WCDMA;
    }
    else if (AT_COPS_RAT_LTE == ulParaValue)
    {
        *penPhRat = TAF_MMA_RAT_LTE;
    }
    else
    {
        *penPhRat = TAF_MMA_RAT_BUTT;
    }

    return;
}
/* Added by s46746 for V7R1 phase II , 2011-10-18, end */

/*****************************************************************************
 ?? ?? ??  : AT_DigitString2Hex
 ????????  : ??????????????????16??????????
 ????????  : ucIndex - ????
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??11??23??
    ??    ??   : s00193151
    ????????   : ????????????

*****************************************************************************/
VOS_UINT32 AT_DigitString2Hex(
    VOS_UINT8                          *pucDigitStr,
    VOS_UINT16                          usLen,
    VOS_UINT32                         *pulDestHex
)
{
    VOS_UINT32                          ulCurrValue;
    VOS_UINT32                          ulTotalVaue;
    VOS_UINT8                           ucLength;

    /*lint -e961*/
    ulCurrValue     = 0;
    ulTotalVaue     = 0;
    ucLength        = 0;
    ulCurrValue = (VOS_UINT32)*pucDigitStr++;

    while (ucLength++ < usLen)
    {
        if((ulCurrValue  >= '0')
        && (ulCurrValue  <= '9'))
        {
            ulCurrValue  = ulCurrValue  - '0';
        }
        else
        {
            return VOS_FALSE;
        }

        if (ulTotalVaue > 0x0FFFFFFF)              /* ???????? */
        {
            return VOS_FALSE;
        }
        else
        {
            ulTotalVaue = (ulTotalVaue << AT_OCTET_MOVE_FOUR_BITS) + ulCurrValue;              /* accumulate digit */
            ulCurrValue = (VOS_UINT32)(VOS_UINT8)*pucDigitStr++;    /* get next Char */
        }
    }
    /*lint +e961*/

    *pulDestHex = ulTotalVaue;
    return VOS_TRUE;
}

/**********************************************************
 ?? ?? ??  : AT_FormatNumericPlmnStr2PlmnId
 ????????  : ??????????????????????PLMN??????PLMN ID
 ????????  : usOprNameLen        PLMN????
             pucOprName          PLMN????
 ????????  : *pPlmn               ????????PLMN????
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??11??23??
    ??    ??   : s00193151
    ????????   : ????LTE CSG??????????????MMA_FormatPlmnStr2PlmnId
*************************************************************/
VOS_UINT32 AT_FormatNumericPlmnStr2PlmnId(
    TAF_PLMN_ID_STRU                   *pPlmn,
    VOS_UINT16                          usOprNameLen,
    VOS_CHAR                           *pucOprName
)
{
    if(VOS_FALSE == AT_DigitString2Hex((VOS_UINT8*)pucOprName,AT_MBMS_MCC_LENGTH,&pPlmn->Mcc))
    {
        return VOS_FALSE;
    }

    if(VOS_FALSE == AT_DigitString2Hex((VOS_UINT8*)&pucOprName[AT_MBMS_MCC_LENGTH],usOprNameLen-AT_MBMS_MNC_MAX_LENGTH,&pPlmn->Mnc))
    {
        return VOS_FALSE;
    }

    pPlmn->Mcc |= 0xFFFFF000;
    pPlmn->Mnc |= (0xFFFFFFFF << ((usOprNameLen-AT_MBMS_MNC_MAX_LENGTH)*4));

    return VOS_TRUE;
}


/*****************************************************************************
 ?? ?? ??  : AT_SetCsgIdSearchPara
 ????????  : ????CSG????????????
 ????????  : ucIndex - ????
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??9??6??
    ??    ??   : z00161729
    ????????   : ????LTE CSG????????
  2.??    ??   : 2015??11??23??
    ??    ??   : s00193151
    ????????   : ????????????

*****************************************************************************/
VOS_UINT32 AT_SetCsgIdSearchPara(VOS_UINT8 ucIndex)
{
    /* ????????at??????????????????????????mma */
    TAF_MMA_CSG_SPEC_SEARCH_INFO_STRU   stCsgIdUserSel;
    VOS_UINT32                          ulRatType;

    stCsgIdUserSel.stPlmnId.Mcc = TAF_MMA_INVALID_MCC;
    stCsgIdUserSel.stPlmnId.Mnc = TAF_MMA_INVALID_MNC;
    stCsgIdUserSel.ulCsgId      = TAF_MMA_INVALID_CSG_ID_VALUE;
    stCsgIdUserSel.enRatType    = TAF_MMA_RAT_BUTT;
    ulRatType                   = TAF_MMA_RAT_BUTT;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????3?? */
    if (gucAtParaIndex != 3)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* @oper???????? */
    if ((5 != gastAtParaList[0].usParaLen)
      &&(6 != gastAtParaList[0].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* CSG ID???????? */
    if ((0 == gastAtParaList[1].usParaLen)
      ||(8 < gastAtParaList[1].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }


    if (AT_SUCCESS != AT_String2Hex(gastAtParaList[2].aucPara, gastAtParaList[2].usParaLen, &ulRatType))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????????????????LTE????????????????????????LTE??CSG ID?????????????????????????????????????????? */
    if((AT_COPS_RAT_LTE != ulRatType))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<AcT> */
    At_SetCopsActPara(&stCsgIdUserSel.enRatType, gastAtParaList[2].usParaLen, ulRatType);

    /* ????PLMN ID */
    if (VOS_TRUE != AT_FormatNumericPlmnStr2PlmnId(&stCsgIdUserSel.stPlmnId,
                                        gastAtParaList[0].usParaLen, (VOS_CHAR*)gastAtParaList[0].aucPara))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????CSG ID */
    if (AT_SUCCESS != AT_String2Hex(gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen, &stCsgIdUserSel.ulCsgId))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }


    if (VOS_TRUE == TAF_MMA_SetCsgIdSearch(WUEPS_PID_AT,
                                    gastAtClientTab[ucIndex].usClientId,
                                    gastAtClientTab[ucIndex].opId,
                                    &stCsgIdUserSel))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CSG_SPEC_SEARCH;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }

    return AT_ERROR;

}

/*****************************************************************************
 ?? ?? ??  : At_SetCopsPara
 ????????  : +COPS=[<mode>[,<format>[,<oper>[,<AcT>]]]]
             ????: ????????????????????????????????????????????????????????????????????????
             <oper>??????????????????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??06??03??
    ??    ??   : s46746
    ????????   : ??????????
  2.??    ??   : 2008-11-19
    ??    ??   : l00130025
    ????????   : ????????:AT2D06741????????????AccessMode??????????????????????default
  3.??    ??   : 2010-03-28
    ??    ??   : l65478
    ????????   : ????????:AT2D17790????????????????PLMN????????????
                   ??????????????????????????????????
  4.??    ??   : 2011??10??05??
    ??    ??   : c00173809
    ????????   : AT??????????
  5.??    ??   : 2012??1??2??
    ??    ??   : ??????/00130025
    ????????   : ??????DTS2011122605064??AT????????????????????????
  6.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  7.??    ??   : 2015??2??25??
    ??    ??   : z00161729
    ????????   : AT&T ????EONS????????
  8.??    ??   : 2015??4??10??
    ??    ??   : h00313353
    ????????   : SysCfg????
  9.??    ??   : 2016??1??22??
    ??    ??   : h00313353
    ????????   : DTS2016012202418
*****************************************************************************/
VOS_UINT32 At_SetCopsPara(TAF_UINT8 ucIndex)
{
    TAF_MMA_RAT_TYPE_ENUM_UINT8         enPhRat;
    VOS_UINT32                          ulRslt;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_NET_CTX_STRU              *pstNetCtx = VOS_NULL_PTR;

    /* Modified by w00167002 for L-C??????????, 2014-2-14, begin */

    TAF_PLMN_USER_SEL_STRU          stPlmnUserSel;
    VOS_UINT32                      ulGetOperNameRst;

    TAF_MMA_COPS_FORMAT_TYPE_SET_REQ_STRU                   stCopsFormatSetReq;

    PS_MEM_SET(&stCopsFormatSetReq, 0, sizeof(stCopsFormatSetReq));

    pstNetCtx = AT_GetModemNetCtxAddrFromClientId(ucIndex);

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 4)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(0 == gastAtParaList[0].usParaLen)
    {
        gastAtParaList[0].ulParaValue = 0;
    }

    /* ????<mode> A32D07158
     * only in case of mode = 3(change the format), should the new format be saved.
     */
    /* ????<format> */
    if(0 != gastAtParaList[1].usParaLen)
    {
        /* ??????????????????????????????????????PLMN?????????????????????????????????????????? */
        pstNetCtx->ucCopsFormatType = (VOS_UINT8)gastAtParaList[1].ulParaValue;
    }

    /* Modified by s46746 for V7R1 phase II , 2011-10-18, begin */
    /* ????<AcT> */
    At_SetCopsActPara(&enPhRat, gastAtParaList[3].usParaLen, gastAtParaList[3].ulParaValue);
    /* Modified by s46746 for V7R1 phase II , 2011-10-18, end */


    /* ??????????????????????????????????????????PLMN?????????????????????????????????????????? */
    switch(gastAtParaList[0].ulParaValue)
    {
    case 0: /* automatic */

        if(VOS_TRUE == TAF_MMA_PlmnAutoReselReq(WUEPS_PID_AT,
                                                gastAtClientTab[ucIndex].usClientId,
                                                0))
        {
            /* ???????????????? */
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_COPS_SET_AUTOMATIC;
            return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
        }
        else
        {
            return AT_ERROR;
        }

    case 1: /* manual */


        /* ???????? */
        if (0 == gastAtParaList[2].usParaLen)
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        stPlmnUserSel.ucFormatType = pstNetCtx->ucCopsFormatType;
        stPlmnUserSel.enAccessMode = enPhRat;

        /* ????????PLMN??????????????TAF_PLMN_USER_SEL_STRU??????????????MMA????????MMA?????????????????????? */
        ulGetOperNameRst = AT_GetOperatorNameFromParam(&stPlmnUserSel.usOperNameLen,
                                                        stPlmnUserSel.ucOperName,
                                                        sizeof(stPlmnUserSel.ucOperName),
                                                        stPlmnUserSel.ucFormatType);

        if (AT_OK != ulGetOperNameRst )
        {
            return ulGetOperNameRst;
        }

        ulRslt = TAF_MMA_PlmnSpecialSelReq(WUEPS_PID_AT,
                                           gastAtClientTab[ucIndex].usClientId,
                                           gastAtClientTab[ucIndex].opId,
                                          &stPlmnUserSel);
        if (VOS_TRUE == ulRslt)
        {
            /* ???????????????? */
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_COPS_SET_MANUAL;
            return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
        }
        else
        {
            return AT_ERROR;
        }
        /* Modified by w00167002 for L-C??????????, 2014-2-14, end */

    case 3: /* set only <format> */
        stCopsFormatSetReq.ucCopsFormatType = (VOS_UINT8)gastAtParaList[1].ulParaValue;

        Taf_SetCopsFormatTypeReq(gastAtClientTab[ucIndex].usClientId,
                                 gastAtClientTab[ucIndex].opId,
                                 &stCopsFormatSetReq);
        return AT_OK;
    default: /* manual/automatic */
        return AT_ERROR;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */
}

/*****************************************************************************
 Prototype      : At_SetCgclassPara
 Description    : +CGCLASS=[<class>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2012??03??03??
   ??    ??   : s62952
   ????????   : BalongV300R002 Build????????:????NAS_FEATURE_AT_COMMAND_CGCLASS??
*****************************************************************************/
TAF_UINT32 At_SetCgclassPara(TAF_UINT8 ucIndex)
{
    TAF_PH_MS_CLASS_TYPE MsClass;

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<class> */
    switch(gastAtParaList[0].ulParaValue)
    {
    case 0:
        MsClass = TAF_PH_MS_CLASS_A;
        break;

    case 1:
        MsClass = TAF_PH_MS_CLASS_B;
        break;

    case 2:
        MsClass = TAF_PH_MS_CLASS_CG;
        break;

    default:
        MsClass = TAF_PH_MS_CLASS_CC;
        break;
    }

    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    if (TAF_PH_MS_CLASS_A == MsClass)
    {
        return AT_OK;
    }
    else
    {
        return AT_ERROR;
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, end */

}

/*****************************************************************************
 ?? ?? ??  : AT_CheckUserRebootSupportFlg
 ????????  : ????????????????????????
 ????????  : ??
 ????????  : ??
 ?? ?? ??  : VOS_TRUE:????,VOS_FALSE:??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2016??05??30??
    ??    ??   : h00360002
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32  AT_CheckUserRebootSupportFlg(VOS_VOID)
{
    TAF_NVIM_USER_REBOOT_SUPPORT_STRU       stUserRebootSupport;
    VOS_UINT32                              ulResult;
    VOS_UINT32                              ulLen;

    ulLen = sizeof(TAF_NVIM_USER_REBOOT_SUPPORT_STRU);

    PS_MEM_SET(&stUserRebootSupport, 0x00, ulLen);

    ulResult = NV_ReadEx(MODEM_ID_0, en_NV_Item_User_Reboot_Support_Flg, &stUserRebootSupport, ulLen);

    if (NV_OK != ulResult)
    {
        AT_WARN_LOG("TAF_MMA_IsUserRebootSupport:Read Nvim Failed");
        return VOS_FALSE;
    }

    if (0xEF == stUserRebootSupport.ucUserRebootConfig)
    {
        return VOS_TRUE;
    }

    return VOS_FALSE;
}

/*****************************************************************************
 ?? ?? ??  : At_SetCfunPara
 ????????  : +CFUN????????????????????????+CFUN=[<fun>[,<rst>]]
 ????????  : TAF_UINT8 ucIndex  ????????
 ????????  : ??
 ?? ?? ??  : TAF_UINT32         ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2005-04-19
    ??    ??   :
    ????????   : ??????????
  2.??    ??   : 2012??1??3??
    ??    ??   : f62575
    ????????   : SMALL IMAGE????????: ??????????????MSG????????????
  3.??    ??   : 2012??5??10??
    ??    ??   : l60609
    ????????   : DTS2012050805070:AT+CFUN????????AT_AppPsRecoverState
  4.??    ??   : 2012??12??13??
    ??    ??   : L00171473
    ????????   : DTS2012121802573, TQE????
  5.??    ??   : 2013??6??20??
    ??    ??   : m00217266
    ????????   : DTS2013052700872 at+cfun=,1 ????????
  6.??    ??   : 2014??1??27??
    ??    ??   : S00261364
    ????????   : L-C??????????
*****************************************************************************/
TAF_UINT32 At_SetCfunPara(TAF_UINT8 ucIndex)
{
    /* Modified by s00261364 for L-C??????????, 2014-1-27, begin */
    TAF_MMA_PHONE_MODE_PARA_STRU       stPhoneModePara;
    /* Modified by s00261364 for L-C??????????, 2014-1-27, end */

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (gucAtParaIndex > 2)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (((0 == gastAtParaList[0].usParaLen) || (0 == gastAtParaList[1].usParaLen))
      && (2 == gucAtParaIndex))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<fun> */
    if ( TAF_PH_MODE_NUM_MAX <= gastAtParaList[0].ulParaValue )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }
    /* Deleted by s00261364 for L-C??????????, 2014-1-27, begin */
    /* Deleted by s00261364 for L-C??????????, 2014-1-27, end */

/* ????TAF?????????? */
/* ????TAF?????????? */

    /* Modified by s00261364 for L-C??????????, 2014-1-27, begin */
    PS_MEM_SET(&stPhoneModePara, 0x00, sizeof(TAF_MMA_PHONE_MODE_PARA_STRU));
    stPhoneModePara.PhMode  = (VOS_UINT8)gastAtParaList[0].ulParaValue;;

    if (2 == gucAtParaIndex)
    {
        stPhoneModePara.PhReset = (VOS_UINT8)gastAtParaList[1].ulParaValue;

        /* NV????????AT+CFUN=1,1??????A?????????????? */
        if ( (VOS_TRUE == AT_CheckUserRebootSupportFlg())
          && (TAF_PH_MODE_FULL == stPhoneModePara.PhMode)
          && (TAF_PH_OP_MODE_RESET == stPhoneModePara.PhReset) )
        {
            gstAtSendData.usBufLen = 0;
            At_FormatResultData(ucIndex, AT_OK);
            VOS_TaskDelay(300); /*wait 300 tick*/

            mdrv_om_system_error(NAS_REBOOT_MOD_ID_USER, 0, 0, VOS_NULL_PTR, 0);
            return AT_SUCCESS;
        }
    }

    if (VOS_TRUE == TAF_MMA_PhoneModeSetReq(WUEPS_PID_AT, gastAtClientTab[ucIndex].usClientId, 0, &stPhoneModePara))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CFUN_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
    /* Modified by s00261364 for L-C??????????, 2014-1-27, end */
}
/*****************************************************************************
 Prototype      : At_SetCgmiPara
 Description    : +CGMI
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function

  2.??    ??   : 2015??03??27??
    ??    ??   : K00902809
    ????????   : Added seperate function TAF_MMA_QryCgmiReq to send message to mma
*****************************************************************************/
TAF_UINT32 At_SetCgmiPara(TAF_UINT8 ucIndex)
{
    VOS_UINT8                           aucMfrId[TAF_MAX_MFR_ID_STR_LEN];

    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (NV_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_FMRID, aucMfrId, TAF_MAX_MFR_ID_STR_LEN))
    {
        return AT_ERROR;
    }
    else
    {
        gstAtSendData.usBufLen = (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                                       (TAF_CHAR *)pgucAtSndCodeAddr,
                                                       (TAF_CHAR *)pgucAtSndCodeAddr,
                                                       "%s",
                                                        aucMfrId);

        return AT_OK;
    }
}
/*****************************************************************************
 Prototype      : At_SetCgmmPara
 Description    : +CGMM/+GMM
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function

  2.Date        : 2015-03-27
    Author      : K00902809
    Modification: Added seperate function TAF_MMA_QryCgmmReq to send message to mma
*****************************************************************************/
TAF_UINT32 At_SetCgmmPara(TAF_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;

    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   DRV_AGENT_MSID_QRY_REQ,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_WUEPS_PID_DRV_AGENT);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGMM_READ;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}
/*****************************************************************************
 Prototype      : At_SetCgmrPara
 Description    : +CGMR
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.Date        : 2015-03-27
    Author      : K00902809
    Modification: Added seperate function TAF_MMA_QryCgmrReq to send message to mma
*****************************************************************************/
TAF_UINT32 At_SetCgmrPara(TAF_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;

    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   DRV_AGENT_MSID_QRY_REQ,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_WUEPS_PID_DRV_AGENT);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGMR_READ;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}
/*****************************************************************************
 ?? ?? ??  : At_SetCgsnPara
 ????????  : CGSN????UE??IMEI
 ????????  : TAF_UINT8 ucIndex ????????
 ????????  : ??
 ?? ?? ??  : TAF_UINT32        ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??5??25??
    ??    ??   : Y00213812
    ????????   : ??????????

*****************************************************************************/
TAF_UINT32 At_SetCgsnPara(TAF_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;

    /* AT???????????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? ID_AT_MTA_CGSN_QRY_REQ ?? MTA ?????? */
    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   gastAtClientTab[ucIndex].opId,
                                   ID_AT_MTA_CGSN_QRY_REQ,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_UEPS_PID_MTA);

    if(AT_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGSN_READ;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : At_SetCimiPara
 ????????  : +CIMI
 ????????  : TAF_UINT8 ucIndex ????????
 ????????  : ??
 ?? ?? ??  : TAF_UINT32        ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2005??4??19??
    ??    ??   :
    ????????   : ??????????
  2.??    ??   : 2012??12??26??
    ??    ??   : l00198894
    ????????   : DTS2012122505294: DCM??????+CIMI????NV????????????IMSI??AT????
  3.??    ??   : 2013??5??17??
    ??    ??   : l00167671
    ????????   : NV??????????, ??NV??????????????????
*****************************************************************************/
TAF_UINT32 At_SetCimiPara(TAF_UINT8 ucIndex)
{
    TAF_AT_NVIM_CIMI_PORT_CFG_STRU      stCimiPortCfg;

    stCimiPortCfg.ulCimiPortCfg = 0;

    /* ????NV???????????????????????????????????? */
    if (NV_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_CIMI_PORT_CFG,
                         &stCimiPortCfg,
                         sizeof(stCimiPortCfg)))
    {
        stCimiPortCfg.ulCimiPortCfg  = 0;
    }

    /* ????????????Bit??????0????????????AT_ERROR */
    if (0 != (stCimiPortCfg.ulCimiPortCfg & ((VOS_UINT32)1 << ucIndex)))
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if (AT_SUCCESS == SI_PIH_CimiSetReq(gastAtClientTab[ucIndex].usClientId,0))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CIMI_READ;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 Prototype      : At_SetClipPara
 Description    : +CSQ
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function

  2.??    ??   : 2015??3??28??
    ??    ??   : y00322978
    ????????   : ????CSQ????????????????????
*****************************************************************************/
TAF_UINT32 At_SetCsqPara(TAF_UINT8 ucIndex)
{
    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

     /* ???????????? */
    if(VOS_TRUE == TAF_MMA_QryCsqReq(WUEPS_PID_AT,
                                     gastAtClientTab[ucIndex].usClientId,
                                     0))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CSQ_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}
/*****************************************************************************
 Prototype      : At_SetCbcPara
 Description    : +CBC
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2010??11??23??
    ??    ??   : lijun 00171473
    ????????   : DTS2010111900327,CBC????????0,0 ??????
  3.??    ??   : 2012??03??13??
    ??    ??   : w00199382
    ????????   : DTS2012030804030,CBC????
  3.??    ??   : 2012??03??03??
    ??    ??   : s62952
    ????????   : BalongV300R002 Build????????
  4.??    ??   : 2015??03??27??
    ??    ??   : m00270891
    ????????   : CBC request to MMA
*****************************************************************************/
VOS_UINT32 At_SetCbcPara(VOS_UINT8 ucIndex)
{
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    if (BSP_MODULE_SUPPORT == mdrv_misc_support_check(BSP_MODULE_TYPE_CHARGE) )
    {

        /* E5 ?????????????????????? */
        VOS_UINT8                           ucBcs;
        VOS_UINT8                           ucBcl;

        /* ???????? */
        if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        if (VOS_OK != mdrv_misc_get_cbc_state(&ucBcs, &ucBcl))
        {
            return AT_ERROR;
        }

        gstAtSendData.usBufLen = (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                                        (TAF_CHAR *)pgucAtSndCodeAddr,
                                                        (TAF_CHAR*)pgucAtSndCodeAddr,
                                                        "%s: %d,%d",
                                                        g_stParseContext[ucIndex].pstCmdElement->pszCmdName,
                                                        ucBcs, ucBcl);
        return AT_OK;

    }
    else
    {
        /* ???????? */
        if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        /* ???????????? */
        if(VOS_TRUE == TAF_MMA_QryBatteryCapacityReq(WUEPS_PID_AT,
                                         gastAtClientTab[ucIndex].usClientId,
                                         0))
        {
            /* ???????????????? */
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CBC_SET;
            return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
        }
        else
        {
            return AT_ERROR;
        }

    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, end */

}

/*****************************************************************************
 ?? ?? ??  : At_SetCpdwPara
 ????????  : ^CPDW??????????????
 ????????  : ??
 ????????  : ??
 ?? ?? ??  : ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??9??30??
    ??    ??   : C00173809
    ????????   : ??????????
  2.??    ??   : 2011??10??4??
    ??    ??   : C00173809
    ????????   : AT??????????????????????????????
*****************************************************************************/
VOS_UINT32 At_SetCpdwPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                           ulRst;

    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????C CPU??ID_TAF_MMA_CPLS_SET_REQ????????MT???? */
    ulRst = TAF_MMA_MtPowerDownReq(WUEPS_PID_AT,
                                   gastAtClientTab[ucIndex].usClientId,
                                   0);

    if(VOS_TRUE == ulRst)

    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_MMA_MT_POWER_DOWN;
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;

}
/*****************************************************************************
 Prototype      : At_SetSnPara
 Description    : ^SN
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2008-08-28
    Author      : l00130025
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetSnPara(TAF_UINT8 ucIndex)
{
    TAF_PH_SERIAL_NUM_STRU stSerialNum;
    TAF_UINT16            usLength = 0;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD == g_stATParseCmd.ucCmdOptType)
    {
        return At_WriteSnPara(ucIndex);
    }
    /* ??NV?????? Serial Num,?????????????? */

    PS_MEM_SET(&stSerialNum, 0, sizeof(TAF_PH_SERIAL_NUM_STRU));

    usLength = TAF_SERIAL_NUM_NV_LEN;
    if (NV_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_Serial_Num, stSerialNum.aucSerialNum, usLength))
    {
        AT_WARN_LOG("At_SetSnPara:WARNING:NVIM Read en_NV_Item_Serial_Num falied!");
        return AT_ERROR;
    }
    else
    {
        PS_MEM_SET((stSerialNum.aucSerialNum+TAF_SERIAL_NUM_LEN), 0, (VOS_SIZE_T)(4*sizeof(stSerialNum.aucSerialNum[0])));
        usLength = 0;
        usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,(TAF_CHAR *)pgucAtSndCodeAddr,(TAF_CHAR *)pgucAtSndCodeAddr + usLength,"%s:",g_stParseContext[ucIndex].pstCmdElement->pszCmdName);
        usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,(TAF_CHAR *)pgucAtSndCodeAddr,(TAF_CHAR *)pgucAtSndCodeAddr + usLength,"%s",stSerialNum.aucSerialNum);
    }
    gstAtSendData.usBufLen = usLength;

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_WriteSnPara
 ????????  : ??????????SN??,en_NV_Item_Serial_Num????SN????????20byte??????
             ??SN??????20byte??????????????????0xFF
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32:
             ????SN??????????AT_OK;
             ????????????16??,????AT_SN_LENGTH_ERROR
             ????????????:AT_DEVICE_OTHER_ERROR
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??9??
    ??    ??   : w00167002
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 At_WriteSnPara(VOS_UINT8 ucIndex)
{
    TAF_PH_SERIAL_NUM_STRU              stSerialNum;

    /* ????????????1 */
    if (gucAtParaIndex != 1)
    {
        return AT_DEVICE_OTHER_ERROR;
    }

    /* ??????????????????16?????????????? */
    if (TAF_SERIAL_NUM_LEN != gastAtParaList[0].usParaLen)
    {
        return AT_SN_LENGTH_ERROR;
    }

    /* ????????????????????????????????,?????????????????? */
    if (AT_FAILURE == At_CheckNumCharString(gastAtParaList[0].aucPara,
                                            gastAtParaList[0].usParaLen))
    {
        return AT_DEVICE_OTHER_ERROR;
    }

    /* ??????????16??SN????????????????stSerialNum.aucSerialNum?? */
    PS_MEM_CPY(stSerialNum.aucSerialNum, gastAtParaList[0].aucPara, TAF_SERIAL_NUM_LEN);

    /* ??stSerialNum.aucSerialNum????????????0xFF */
    PS_MEM_SET((stSerialNum.aucSerialNum + TAF_SERIAL_NUM_LEN), 0xFF, (TAF_SERIAL_NUM_NV_LEN - TAF_SERIAL_NUM_LEN));

    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_Serial_Num,
                          stSerialNum.aucSerialNum,
                          TAF_SERIAL_NUM_NV_LEN))
    {
        AT_WARN_LOG("At_WriteSnPara:WARNING:NVIM Write en_NV_Item_Serial_Num failed!");
        return AT_DEVICE_OTHER_ERROR;
    }

    return AT_OK;
}
/*****************************************************************************
 ?? ?? ??  : At_SetHwVerPara
 ????????  : ^HWVER??????????????
 ????????  : ??
 ????????  : ??
 ?? ?? ??  : ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??10??5??
    ??    ??   : C00173809
    ????????   : ??????????
  2.??    ??   : 2010??01??28??
    ??    ??   : x00115505
    ????????   : AT2D16517,????????????????????????????
  3.??    ??   : 2011??10??5??
    ??    ??   : c00173809
    ????????   : AT??????????^HWVER ?????????????????? C CPU??????
*****************************************************************************/
VOS_UINT32 At_SetHwVerPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;

    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????DRV_AGENT_HARDWARE_QRY??AT AGENT?????????????????????? */
    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   gastAtClientTab[ucIndex].opId,
                                   DRV_AGENT_HARDWARE_QRY,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_WUEPS_PID_DRV_AGENT);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_DRV_AGENT_HARDWARE_QRY;
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;
}
/*****************************************************************************
 ?? ?? ??  : At_SetHwVerPara
 ????????  : ^FHVER,????????????????????
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??10??5??
    ??    ??   : C00173809
    ????????   : ??????????
  2.??    ??   : 2011??10??5??
    ??    ??   : c00173809
    ????????   : AT??????????^FHVER ?????????????????? C CPU??????
*****************************************************************************/
VOS_UINT32 At_SetFHVerPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;

    /* ???????? */
    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????DRV_AGENT_FULL_HARDWARE_QRY??AT AGENT?????????????????????? */
    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   At_GetOpId(),
                                   DRV_AGENT_FULL_HARDWARE_QRY,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_WUEPS_PID_DRV_AGENT);

    if(AT_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_DRV_AGENT_FULL_HARDWARE_QRY;
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;


}

/*****************************************************************************
 ?? ?? ??  : At_SetPfverPara
 ????????  : ^PFVER,????????????????????
 ????????  : VOS_UINT8 ucIndex  ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32         ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??10??18??
    ??    ??   : ??????/f62575
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 At_SetPfverPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRet;

    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ????????C???????????????????????? */
    ulRet = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   gastAtClientTab[ucIndex].opId,
                                   DRV_AGENT_PFVER_QRY_REQ,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_WUEPS_PID_DRV_AGENT);
    if (TAF_SUCCESS != ulRet)
    {
        AT_WARN_LOG("At_SetPfverPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_PFVER_READ;
    return AT_WAIT_ASYNC_RETURN;

}

/*****************************************************************************
 ?? ?? ??  : At_SetCLACPara
 ????????  : +CLAC??????????????
 ????????  : ??
 ????????  : ??
 ?? ?? ??  : ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??11??26??
    ??    ??   : ouyang fei 00132663
    ????????   : ????????????????AT2D06578?????? AT^PORTSEL??AT^HVER??AT+CLAC ????????
  2.??    ??   : 2010??12??22??
    ??    ??   : lijun 00171473
    ????????   : DTS2010121101639 ????CLAC??????????????
  3.??    ??   : 2010??12??25??
    ??    ??   : lijun 00171473
    ????????   : DTS201012220636 APPROFRD??????CLAC????????????????
  4.??    ??   : 2011??01??11??
    ??    ??   : lijun 00171473
    ????????   : DTS2011010801617 ??????????????????????????CLAC??????
  5.??    ??   : 2011??10??5??
    ??    ??   : c00173809
    ????????   : AT??????????+CLAC ?????????????????? C CPU??????
*****************************************************************************/
VOS_UINT32 At_SetCLACPara(VOS_UINT8 ucIndex)
{
    /* ???????? */
    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    gstAtSendData.usBufLen = 0;

    /* ??????????????????????AT???? */
    AT_ClacCmdProc();

    return AT_OK;
}

/*****************************************************************************
 Prototype      : At_SetCpbsPara
 Description    : +CPBS=<storage>[,<password>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2007??8??22??
     ??    ??   : H44270
     ????????   : ??????A32D11418
3.??    ??   : 2007??10??24??
  ??    ??   : zhuli 00100318
  ????????   : ??????????A32D13155

*****************************************************************************/
TAF_UINT32 At_SetCpbsPara(TAF_UINT8 ucIndex)
{
    SI_PB_STORATE_TYPE  Storage = SI_PB_STORAGE_UNSPECIFIED;
    TAF_UINT32          i;

    /* ???????? */
    if(0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* VOS_StrCmp????????????????????????! */
    if(TAF_NULL_PTR == (TAF_CHAR*)gastAtStringTab[AT_STRING_SM].pucText)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(TAF_NULL_PTR == (TAF_CHAR*)gastAtStringTab[AT_STRING_ON].pucText)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(TAF_NULL_PTR == (TAF_CHAR*)gastAtStringTab[AT_STRING_EN].pucText)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(TAF_NULL_PTR == (TAF_CHAR*)gastAtStringTab[AT_STRING_FD].pucText)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(TAF_NULL_PTR == (TAF_CHAR*)gastAtStringTab[AT_STRING_BD].pucText)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    for(i = 0; i < gastAtParaList[0].usParaLen ; i++)
    {
        gastAtParaList[0].aucPara[i] = At_UpChar(gastAtParaList[0].aucPara[i]);
    }

    if(0 == VOS_StrCmp((TAF_CHAR*)gastAtStringTab[AT_STRING_ON].pucText,(TAF_CHAR*)gastAtParaList[0].aucPara))
    {
        Storage = SI_PB_STORAGE_ON;
    }
    else if(0 == VOS_StrCmp((TAF_CHAR*)gastAtStringTab[AT_STRING_SM].pucText,(TAF_CHAR*)gastAtParaList[0].aucPara))
    {
        Storage = SI_PB_STORAGE_SM;
    }
    else if(0 == VOS_StrCmp((TAF_CHAR*)gastAtStringTab[AT_STRING_FD].pucText,(TAF_CHAR*)gastAtParaList[0].aucPara))
    {
        Storage = SI_PB_STORAGE_FD;
    }
    else if(0 == VOS_StrCmp((TAF_CHAR*)gastAtStringTab[AT_STRING_EN].pucText,(TAF_CHAR*)gastAtParaList[0].aucPara))
    {
        Storage = SI_PB_STORAGE_EC;
    }
    else if(0 == VOS_StrCmp((TAF_CHAR*)gastAtStringTab[AT_STRING_BD].pucText,(TAF_CHAR*)gastAtParaList[0].aucPara))
    {
        Storage = SI_PB_STORAGE_BD;
    }
    else
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }


    /* ???????????? */
    if(AT_SUCCESS == SI_PB_Set(gastAtClientTab[ucIndex].usClientId, 0, Storage))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPBS_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 Prototype      : At_SetCpbr2Para
 Description    : +CPBR=<index1>[,<index2>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function

  2.??    ??   : 2015??3??12??
    ??    ??   : A00165503
    ????????   : DTS2015032409785: ????????????????
*****************************************************************************/
TAF_UINT32 At_SetCpbr2Para(TAF_UINT8 ucIndex)
{
    AT_COMM_PB_CTX_STRU                *pstCommPbCntxt = VOS_NULL_PTR;
    VOS_UINT32                          ulResult;
    VOS_UINT16                          usIndex1;
    VOS_UINT16                          usIndex2;

    pstCommPbCntxt = AT_GetCommPbCtxAddr();

    /* ???????????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????????? */
    if ((gucAtParaIndex < 1) || (gucAtParaIndex > 2))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* AT+CPBR=, */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<index1> */
    usIndex1 = (VOS_UINT16)gastAtParaList[0].ulParaValue;

    if (gucAtParaIndex > 1)
    {
        if (0 == gastAtParaList[1].usParaLen)
        {
            /* AT+CPBR=<index1>, */
            return AT_CME_INCORRECT_PARAMETERS;
        }
        else
        {
            /* AT+CPBR=<index1>,<index2> */
            usIndex2 = (VOS_UINT8)gastAtParaList[1].ulParaValue;
        }
    }
    else
    {
        /* AT+CPBR=<index1> */
        usIndex2 = usIndex1;
    }

    /* HSUART????????????????, ???????????? */
    if (VOS_TRUE == AT_CheckHsUartUser(ucIndex))
    {
        pstCommPbCntxt->usCurrIdx       = usIndex1;
        pstCommPbCntxt->usLastIdx       = usIndex2;
        pstCommPbCntxt->ulSingleReadFlg = (usIndex1 == usIndex2) ? VOS_TRUE : VOS_FALSE;

        ulResult = SI_PB_Read(gastAtClientTab[ucIndex].usClientId,
                              0, SI_PB_STORAGE_UNSPECIFIED,
                              pstCommPbCntxt->usCurrIdx,
                              pstCommPbCntxt->usCurrIdx);
    }
    else
    {
        ulResult = SI_PB_Read(gastAtClientTab[ucIndex].usClientId,
                              0, SI_PB_STORAGE_UNSPECIFIED,
                              usIndex1,
                              usIndex2);
    }

    if (TAF_SUCCESS == ulResult)
    {
        gulPBPrintTag = TAF_FALSE;
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPBR2_SET;
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;
}

/*****************************************************************************
 Prototype      : At_SetCpbrPara
 Description    : +CPBR=<index1>[,<index2>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2007??8??22??
    ??    ??   : H44270
    ????????   : ??????A32D11418
  3.??    ??   : 2008??11??03??
    ??    ??   : H59254
    ????????   : PB????????
*****************************************************************************/
TAF_UINT32 At_SetCpbrPara(TAF_UINT8 ucIndex)
{
    /* ???????? */
    if(0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 2)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(0 == gastAtParaList[1].usParaLen)
    {
        gastAtParaList[1].ulParaValue = gastAtParaList[0].ulParaValue;
    }

    if (AT_SUCCESS == SI_PB_Read(gastAtClientTab[ucIndex].usClientId,
                                0, SI_PB_STORAGE_UNSPECIFIED,
                                (TAF_UINT16)gastAtParaList[0].ulParaValue,
                                (TAF_UINT16)gastAtParaList[1].ulParaValue))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPBR_SET;

        gulPBPrintTag = TAF_FALSE;

        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 Prototype      : At_PbDeleteProc
 Description    :
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????

 History        : ---
  1.Date        : 2011-04-20
    Author      : j00168360
    Modification: Created function[DTS2011042105653]??at+cpbf????????????
 *****************************************************************************/
TAF_UINT32 At_PbDeleteProc(TAF_UINT8 ucIndex)
{
    /* ????AT+CPBW=,??AT+CPBW=0?????? */
    if(0 == gastAtParaList[0].usParaLen || 0 == gastAtParaList[0].ulParaValue)
    {
        return AT_CME_INVALID_INDEX;
    }

    if(AT_SUCCESS == SI_PB_Delete(gastAtClientTab[ucIndex].usClientId,
                                  0, SI_PB_STORAGE_UNSPECIFIED,
                                  (TAF_UINT16)gastAtParaList[0].ulParaValue))

    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPBW_SET;/* ???????????????? */

        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }

    AT_ERR_LOG("At_PbDeleteProc error: delete pb record failed");

    return AT_ERROR;
}


/*****************************************************************************
 Prototype      : At_SetCpbwPara
 Description    : ^CPBW=[<index>][,<number>[,<type>[,<text>,<coding>]]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2008-06-21
    Author      : H59254
    Modification: Created function
  2.Date        : 2008-10-28
    Author      : H59254
    Modification: For V2R1 PB
  3.??    ??  : 2011??6??21??
    ??    ??  : j00168360
    ????????  : [DTS2011042105653]??at+cpbf????????????
*****************************************************************************/
TAF_UINT32 At_SetCpbwPara(TAF_UINT8 ucIndex)
{
    SI_PB_RECORD_STRU   stRecords;
    TAF_UINT8           *pucNumber;
    TAF_UINT16          usLen;
    TAF_UINT16          usAlphaTagLength;
    TAF_UINT32          ulResult;
    TAF_UINT32          ulResultTemp;

    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)    /* ???????? */
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(gucAtParaIndex > 5)/* ???????? */
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????????????????? */
    if (1 == gucAtParaIndex)
    {
        ulResult = At_PbDeleteProc(ucIndex);

        return ulResult;
    }

    if((0 == gastAtParaList[1].usParaLen)&&(0 == gastAtParaList[3].usParaLen))
    {
        return AT_ERROR;
    }

    /* ??????????????UNICODE????ASCII?? */
    PS_MEM_SET(&stRecords, 0x00, sizeof(stRecords));/* ?????? */

    if((AT_CSCS_UCS2_CODE == gastAtParaList[4].ulParaValue) && (5 == gucAtParaIndex))
    {
        stRecords.AlphaTagType = AT_CSCS_UCS2_CODE;
    }
    else if((AT_CSCS_IRA_CODE == gastAtParaList[4].ulParaValue) && (5 == gucAtParaIndex))
    {
        stRecords.AlphaTagType = AT_CSCS_IRA_CODE;
    }
    else if(4 == gucAtParaIndex)
    {
        stRecords.AlphaTagType = AT_CSCS_IRA_CODE;
    }
    else
    {
        stRecords.AlphaTagType = AT_CSCS_IRA_CODE;
    }

    if(0 != gastAtParaList[0].usParaLen)/* ????<index> */
    {
        stRecords.Index = (TAF_UINT16)gastAtParaList[0].ulParaValue;
    }

    if(0 != gastAtParaList[1].usParaLen)/* ????<number> */
    {
        if('+' == gastAtParaList[1].aucPara[0])
        {
            pucNumber = gastAtParaList[1].aucPara   + 1;
            usLen     = gastAtParaList[1].usParaLen - 1;
        }
        else
        {
            pucNumber = gastAtParaList[1].aucPara;
            usLen     = gastAtParaList[1].usParaLen;
        }

        if(AT_FAILURE == At_CheckPBString(pucNumber,&usLen))
        {
            return AT_CME_INVALID_CHARACTERS_IN_DIAL_STRING;
        }

        if(SI_PB_PHONENUM_MAX_LEN < usLen)
        {
            return AT_CME_TEXT_STRING_TOO_LONG;
        }

        PS_MEM_CPY(stRecords.Number, pucNumber, usLen);

        stRecords.NumberLength = (TAF_UINT8)usLen;
    }

    if(0 != gastAtParaList[2].usParaLen)/* ????<type> */
    {
        /* ?????????????? */
        stRecords.NumberType = (PB_NUMBER_TYPE_INTERNATIONAL == At_GetCodeType(gastAtParaList[1].aucPara[0]))
                              ? PB_NUMBER_TYPE_INTERNATIONAL : (TAF_UINT8)gastAtParaList[2].ulParaValue;
    }
    else
    {
        stRecords.NumberType = (TAF_UINT8)At_GetCodeType(gastAtParaList[1].aucPara[0]);
    }

    if(stRecords.NumberType < 128)
    {
        return AT_CME_INVALID_INDEX;
    }

    if(0 != gastAtParaList[3].usParaLen) /* ????<text> */
    {
        /* ??????????AT??????????????UNICODE????????????????????ASCII?? */
        usAlphaTagLength = gastAtParaList[3].usParaLen;


        if(AT_CSCS_UCS2_CODE == stRecords.AlphaTagType)
        {
            /* ??ASCII??????????UNICODE???????? */
            if ((usAlphaTagLength % 2) != 0)
            {
                return AT_ERROR;
            }

            if(AT_FAILURE == At_UnicodePrint2Unicode(gastAtParaList[3].aucPara,&usAlphaTagLength))
            {
                return AT_ERROR;
            }

            if (AT_FAILURE == At_CheckNameUCS2Code(gastAtParaList[3].aucPara, &usAlphaTagLength))
            {
                return AT_ERROR;
            }

            stRecords.AlphaTagType = gastAtParaList[3].aucPara[0];
        }

        /* ????????????????????????????????TAF_PB_RECORD_STRU
           ???????????????????????????????????? */
        if(usAlphaTagLength > SI_PB_ALPHATAG_MAX_LEN)
        {
            usAlphaTagLength = SI_PB_ALPHATAG_MAX_LEN;
        }


        PS_MEM_CPY(stRecords.AlphaTag, gastAtParaList[3].aucPara, usAlphaTagLength);

        stRecords.ucAlphaTagLength = (TAF_UINT8)usAlphaTagLength;
    }

    if(0 == gastAtParaList[0].usParaLen) /* ???? */
    {
        if( AT_SUCCESS == SI_PB_Add(gastAtClientTab[ucIndex].usClientId,
                                                0, SI_PB_STORAGE_UNSPECIFIED, &stRecords))
        {
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPBW_SET;/* ???????????????? */

            return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
        }

        return AT_ERROR;
    }

    ulResult      = SI_PB_GetSPBFlag();
    ulResultTemp  = SI_PB_GetStorateType();

    if((1 == ulResult)&&(SI_PB_STORAGE_SM == ulResultTemp))
    {
        if ( AT_SUCCESS == SI_PB_SModify(gastAtClientTab[ucIndex].usClientId,
                                            0, SI_PB_STORAGE_UNSPECIFIED, &stRecords))
        {
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPBW_SET;/* ???????????????? */

            return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
        }
    }


    if (AT_SUCCESS == SI_PB_Modify(gastAtClientTab[ucIndex].usClientId,
                                   0, SI_PB_STORAGE_UNSPECIFIED, &stRecords))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPBW_SET;/* ???????????????? */

        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }

    return AT_CME_INCORRECT_PARAMETERS;

}

/*****************************************************************************
 Prototype      : At_PbIraToUnicode
 Description    : ????IRA??????????????????????????????????UCS2????????????????????
 Input          : pucSrc -- ??????IRA????
                : ulSrcLen -- ??????IRA????????
 Output         : pucDst -- ????????UCS????
                : pulDstLen -- ????????UCS????????
 Return Value   : ??

 History        : ---
  1.Date        : 2011-01-19
    Author      : j00168360
    Modification: Created function
*****************************************************************************/
TAF_VOID At_PbIraToUnicode(TAF_UINT8  *pucSrc,
                           TAF_UINT16 usSrcLen,
                           TAF_UINT8  *pucDst,
                           TAF_UINT16 *pusDstLen)
{
    TAF_UINT16      usIndex;
    TAF_UINT16      usUCS2;

    for (usIndex = 0; usIndex < usSrcLen; usIndex++)
    {
        /* ??IRA??UNICODE???????? ??IRA??????????unicode???? */
        usUCS2 = g_astIraToUnicode[pucSrc[usIndex]].usUnicode;
        *pucDst = (TAF_UINT8)(usUCS2 >> 8);
        pucDst++;
        *pucDst = (TAF_UINT8)usUCS2;
        pucDst++;
    }

    /* ??????????????????2?? */
    *pusDstLen = (TAF_UINT16)(usSrcLen << 1);

    return;
}

/*****************************************************************************
 Prototype      :At_OneUnicodeToGsm
 Description    :????????Unicude??GSM??????????????????UCS2??????????GSM7BIT????
 Input          : usSrc -- ??????????????
 Output         : pucDst -- ????GSM????????
                : pusDstLen -- ????GSM????????????
 Return Value   : AT_SUCCESS??AT_FAILURE

 History        :
  1.Date        : 2011-01-19
    Author      : j00168360
    Modification: [??????????????]Created function
*****************************************************************************/
TAF_UINT32 At_OneUnicodeToGsm(TAF_UINT16 usSrc, TAF_UINT8 *pucDst, TAF_UINT16 *pusDstLen)
{
    TAF_UINT16      usIndex;

    /* ??????????????A0A1??????SIM????????1B40????????????007C*/
    if (0x00A0 == usSrc)
    {
        AT_LOG1("At_OneUnicodeToGsm no found one unicode[0x%x] to gsm",usSrc);

        return AT_FAILURE;
    }

    /* ????GSM ?? UNICODE?????? */
    for(usIndex = 0; usIndex < AT_PB_GSM_MAX_NUM; usIndex++)
    {
        if(usSrc == g_astGsmToUnicode[usIndex].usUnicode)
        {
            *pucDst = g_astGsmToUnicode[usIndex].ucOctet;

            *pusDstLen = 1;

            return AT_SUCCESS;
        }
    }

    /* ????GSM ?? UNICODE?????? */
    for(usIndex = 0; usIndex < AT_PB_GSM7EXT_MAX_NUM; usIndex++)
    {
        if(usSrc == g_astGsm7extToUnicode[usIndex].usUnicode)
        {
            *pucDst++ = AT_PB_GSM7EXT_SYMBOL;
            *pucDst = g_astGsm7extToUnicode[usIndex].ucOctet;

            *pusDstLen = 2;

            return AT_SUCCESS;
        }
    }

    /* ?????????????????? */
    *pusDstLen = 0;

    AT_LOG1("At_OneUnicodeToGsm no found one unicode[0x%x] to gsm",usSrc);

    return AT_FAILURE;
}

/*****************************************************************************
 Prototype      : At_UnicodeTransferToGsmCalcLength
 Description    : ????unicode??????????????GSM7bit????,????????????????
 Input          : pucSrc -- ??????UCS????
                : usSrcLen -- ??????UCS????????
 Output         : pusDstLen -- ??????GSM????????
 Return Value   : AT_FAILURE -- ????????
                  AT_SUCCESS -- ????????

 History        :
  1.Date        : 2011-01-19
    Author      : j00168360
    Modification: [??????????????]Created function
*****************************************************************************/
TAF_UINT32 At_UnicodeTransferToGsmCalcLength(TAF_UINT8  *pucSrc,
                                             TAF_UINT16 usSrcLen,
                                             TAF_UINT16 *pusDstLen)
{
     TAF_UINT16     usIndex;
     TAF_UINT16     usUnicodeChar;
     TAF_UINT8      aucGsmData[2];
     TAF_UINT16     usGsmDataLen;

     for (usIndex = 0; usIndex < (usSrcLen >> 1); usIndex++)
     {
        usUnicodeChar = (*pucSrc << 8) | (*(pucSrc + 1));

        /* ????UNICODE??????????????GSM7BIT */
        if (AT_SUCCESS != At_OneUnicodeToGsm(usUnicodeChar, aucGsmData, &usGsmDataLen))
        {
            AT_ERR_LOG("At_UnicodeTransferToGsmCalcLength error");

            return AT_FAILURE;
        }

        pucSrc     += 2;

        *pusDstLen += usGsmDataLen;
     }

     return AT_SUCCESS;
}

/*****************************************************************************
 Prototype      : At_PbUnicodeParse
 Description    : ??UCS2????????????????
 Input          : pucSrc -- ??????UCS/IRA????
                  usSrcLen -- ??????UCS/IRA????????
 Output         : pulAlphaTagType -- ??????????????????
                  pusDstLen -- ????????????????????????80/81/82??????????????????
 Return Value   : AT_SUCCESS -- ????

 History        :
  1.Date        : 2011-01-19
    Author      : j00168360
    Modification: [??????????????]Created function
*****************************************************************************/
TAF_VOID At_PbUnicodeParse(TAF_UINT8  *pucSrc,
                           TAF_UINT16 usSrcLen,
                           TAF_UINT32 *pulAlphaTagType,
                           TAF_UINT16 *pusDstLen,
                           TAF_UINT16 *pusCodeBase)
{
    TAF_UINT16      usGsmCodeLen = 0;
    TAF_UINT16      us81CodeLen = 0;
    TAF_UINT16      us82CodeLen = 0;
    TAF_UINT16      us81Base;
    TAF_UINT16      us82Base;
    TAF_UINT16      usMinCodeLen;
    TAF_UINT32      ulAlphaTagType;
    TAF_UINT16      usCodeBase;

    /* ??????????GSM????,?????????????????????? */
    if (AT_SUCCESS == At_UnicodeTransferToGsmCalcLength(pucSrc, usSrcLen, &usGsmCodeLen))
    {
        *pulAlphaTagType = SI_PB_ALPHATAG_TYPE_GSM;
        *pusDstLen       = usGsmCodeLen;
        *pusCodeBase     = 0;

        return;
    }

    /***************************************************************************
                            ????????80????
    ***************************************************************************/
    usMinCodeLen   = usSrcLen + 1;
    ulAlphaTagType = SI_PB_ALPHATAG_TYPE_UCS2_80;
    usCodeBase     = 0;

    /* ????81????????,???????????????????????????????? */
    if (AT_SUCCESS == At_UnicodeTransferTo81CalcLength(pucSrc, usSrcLen, &us81Base, &us81CodeLen))
    {
        if (us81CodeLen <= usMinCodeLen)
        {
            usMinCodeLen   = us81CodeLen;
            ulAlphaTagType = SI_PB_ALPHATAG_TYPE_UCS2_81;
            usCodeBase     = us81Base;
        }
    }

    /* ????82????????,???????????????????????????????? */
    if (AT_SUCCESS == At_UnicodeTransferTo82CalcLength(pucSrc, usSrcLen, &us82Base, &us82CodeLen))
    {
        if (us82CodeLen <= usMinCodeLen)
        {
            usMinCodeLen   = us82CodeLen;
            ulAlphaTagType = SI_PB_ALPHATAG_TYPE_UCS2_82;
            usCodeBase     = us82Base;
        }
    }

    *pusDstLen          = usMinCodeLen;
    *pusCodeBase        = usCodeBase;
    *pulAlphaTagType    = ulAlphaTagType;

    return;
}

/*****************************************************************************
 Prototype      : At_UnicodeTransferToGsm
 Description    : ??UCS2??????????GSM7bit????
 Input          : pucSrc -- ??????UCS????
                : usSrcLen -- ??????UCS????????
 Output         : pucDst -- ????????GSM????
 Return Value   : AT_SUCCESS, AT_FAILURE

 History        :
  1.Date        : 2011-01-19
    Author      : j00168360
    Modification: [??????????????]Created function
*****************************************************************************/
TAF_UINT32 At_UnicodeTransferToGsm(TAF_UINT8 *pucSrc, TAF_UINT16 usSrcLen, TAF_UINT8 *pucDst)
{
    TAF_UINT16      usIndex;
    TAF_UINT16      usUnicodeChar;
    TAF_UINT16      usGsmDataLen = 0;

    for (usIndex = 0; usIndex < (usSrcLen >> 1); usIndex++)
    {
        usUnicodeChar = (*pucSrc << 8)|(*(pucSrc + 1));

        /* ???????????????? */
        if (AT_SUCCESS != At_OneUnicodeToGsm(usUnicodeChar, pucDst, &usGsmDataLen))
        {
            AT_ERR_LOG("At_UnicodeTransferToGsm error");

            return AT_FAILURE;
        }

        pucDst += usGsmDataLen;
        pucSrc += 2;
    }

    return AT_SUCCESS;
}

/*****************************************************************************
 Prototype      : At_UnicodeTransferTo80
 Description    : ??UCS2??????????80????
 Input          : pucSrc -- ??????UCS????
                : usSrcLen -- ??????UCS????????
 Output         : pucDst -- ????????????
 Return Value   : ??

 History        :
  1.Date        : 2011-01-19
    Author      : j00168360
    Modification: [??????????????]Created function
*****************************************************************************/
TAF_VOID At_UnicodeTransferTo80(TAF_UINT8 *pucSrc, TAF_UINT16 usSrcLen, TAF_UINT8 *pucDst)
{
    pucDst[0] = SI_PB_ALPHATAG_TYPE_UCS2_80;

    VOS_MemCpy(&pucDst[1], pucSrc, usSrcLen);

    return;
}

/*****************************************************************************
 Prototype      : At_PbUnicodeTransfer
 Description    : ??????????????UCS2??????????????????
 Input          : pucSrc -- ??????UCS????
                : usSrcLen -- ??????UCS????????
 Output         : pstRecord -- ??????????
                : usCodeBase -- UCS??CodeBase
 Return Value   : AT_SUCCESS, AT_FAILURE

 History        :
  1.Date        : 2011-01-19
    Author      : j00168360
    Modification: [??????????????]Created function
*****************************************************************************/
TAF_UINT32 At_PbUnicodeTransfer(TAF_UINT8           *pucSrc,
                                TAF_UINT16          usSrcLen,
                                SI_PB_RECORD_STRU   *pstRecord,
                                TAF_UINT16          usCodeBase)
{
    TAF_UINT32      ulResult = AT_FAILURE;

    switch (pstRecord->AlphaTagType)
    {
        case SI_PB_ALPHATAG_TYPE_GSM:
            ulResult = At_UnicodeTransferToGsm(pucSrc, usSrcLen, pstRecord->AlphaTag);

            break;

        case SI_PB_ALPHATAG_TYPE_UCS2_81:
            ulResult = At_UnicodeTransferTo81(pucSrc, usSrcLen, usCodeBase, pstRecord->AlphaTag);

            break;

        case SI_PB_ALPHATAG_TYPE_UCS2_82:
            ulResult = At_UnicodeTransferTo82(pucSrc, usSrcLen, usCodeBase, pstRecord->AlphaTag);

            break;

        case SI_PB_ALPHATAG_TYPE_UCS2_80:
            At_UnicodeTransferTo80(pucSrc, usSrcLen, pstRecord->AlphaTag);
            ulResult = AT_SUCCESS;

            break;

        default:

            break;
    }

    if (AT_SUCCESS != ulResult)
    {
        AT_ERR_LOG("At_PbUnicodeTransfer: UCS2 transfer to gsm, 80, 81 or 82 error");
    }

    return ulResult;
}

/*****************************************************************************
 Prototype      : At_PbAlphaTagProc
 Description    : ????????????????????????????????GSM7BIT??UCS2??????80/81/82????????
 Input          : pstRecord -- ??????????
 Output         : ??
 Return Value   : AT_SUCCESS -- ????
                  AT_FAILURE -- ????
                  AT_CME_TEXT_STRING_TOO_LONG -- ??????????
                  AT_CME_INVALID_CHARACTERS_IN_TEXT_STRING -- ??????????????????????
 History        :
  1.Date        : 2011-01-19
    Author      : j00168360
    Modification: [??????????????]Created function
  2.??    ??  : 2011??6??21??
    ??    ??  : j00168360
    ????????  : [DTS2011042105653]??at+cpbf????????????
  3.??    ??   : 2012??8??10??
    ??    ??   : y00213812
    ????????   : DTS2012082204471, TQE????????????????????????????????????
*****************************************************************************/
TAF_UINT32 At_PbAlphaTagProc(SI_PB_RECORD_STRU *pstRecord, AT_PARSE_PARA_TYPE_STRU *pstAtParaList)
{
    TAF_UINT8       *pucAlphaTag;
    TAF_UINT16      usAlphaTagLen;
    TAF_UINT16      usAlphaCodeLen;
    TAF_UINT16      usCodeBase;

    /* ?????????????????????????????????????????????????????????????????? */
    if (0 == pstAtParaList->usParaLen)
    {
        return AT_SUCCESS;
    }

    if (AT_CSCS_GSM_7Bit_CODE == gucAtCscsType)
    {
        if (pstAtParaList->usParaLen > gstPBATInfo.usNameMaxLen)
        {
            AT_ERR_LOG("At_PbAlphaTagProc error: text string to long in gsm7");

            return AT_CME_TEXT_STRING_TOO_LONG;
        }

        pstRecord->AlphaTagType = SI_PB_ALPHATAG_TYPE_GSM;

        /* GSM??????????????????????????????0x7f????????0x7f???????????????????????????? */
        if (AT_SUCCESS != At_Gsm7BitFormat(pstAtParaList->aucPara,
                                           pstAtParaList->usParaLen,
                                           pstRecord->AlphaTag,
                                           &pstRecord->ucAlphaTagLength))
        {
            AT_ERR_LOG("At_PbAlphaTagProc: error:the eighth bit is 1 in gsm7");

            return AT_CME_INVALID_CHARACTERS_IN_TEXT_STRING;
        }

        return AT_SUCCESS;
    }

    /* ??????????????????????????????????????????????80????????????????????????????2?? */
    usAlphaTagLen = (TAF_UINT16)(pstAtParaList->usParaLen << 1);

    pucAlphaTag = (TAF_UINT8*)VOS_MemAlloc(WUEPS_PID_AT, DYNAMIC_MEM_PT, usAlphaTagLen);

    if (VOS_NULL_PTR == pucAlphaTag)
    {
        AT_ERR_LOG("At_PbAlphaTagProc error:malloc failed");

        return AT_FAILURE;
    }

    /* IRA??????????????????????UCS2???????? */
    if (AT_CSCS_IRA_CODE == gucAtCscsType)
    {
        At_PbIraToUnicode(pstAtParaList->aucPara,
                          pstAtParaList->usParaLen,
                          pucAlphaTag,
                          &usAlphaTagLen);
    }
    else
    {
        /* UCS2???????????????????????????????????????????????? */
        if (0 != (pstAtParaList->usParaLen % 4))
        {
            VOS_MemFree(WUEPS_PID_AT, pucAlphaTag);

            AT_LOG1("At_PbAlphaTagProc error: ucs2 codes length [%d] is nor 4 multiple",
                    pstAtParaList->usParaLen);

            return AT_ERROR;
        }

        if(AT_FAILURE == At_UnicodePrint2Unicode(pstAtParaList->aucPara, &(pstAtParaList->usParaLen)))
        {
            VOS_MemFree(WUEPS_PID_AT, pucAlphaTag);

            AT_ERR_LOG("At_PbAlphaTagProc error: Printunicode to unicode failed");

            return AT_ERROR;
        }

        usAlphaTagLen = pstAtParaList->usParaLen;

        VOS_MemCpy(pucAlphaTag, pstAtParaList->aucPara, usAlphaTagLen);
    }

    /* ??UCS2??IRA????????????UCS2???????????????? */
    At_PbUnicodeParse(pucAlphaTag, usAlphaTagLen, &pstRecord->AlphaTagType, &usAlphaCodeLen, &usCodeBase);

    /* ???????????????????????????????????????????????????????????????????? */
    if (usAlphaCodeLen > gstPBATInfo.usNameMaxLen)
    {
        VOS_MemFree(WUEPS_PID_AT, pucAlphaTag);

        AT_LOG1("At_PbAlphaTagProc error: name length [%d] too long", usAlphaCodeLen);

        return AT_CME_TEXT_STRING_TOO_LONG;
    }

    pstRecord->ucAlphaTagLength = (TAF_UINT8)usAlphaCodeLen;

    if (AT_SUCCESS != At_PbUnicodeTransfer(pucAlphaTag, usAlphaTagLen, pstRecord, usCodeBase))
    {
        VOS_MemFree(WUEPS_PID_AT, pucAlphaTag);

        AT_ERR_LOG("At_PbAlphaTagProc: fail to convert UCS2");

        return AT_ERROR;
    }

    VOS_MemFree(WUEPS_PID_AT, pucAlphaTag);

    return AT_SUCCESS;
}

/*****************************************************************************
 Prototype      : At_PbEmailTransferToGsm
 Description    : ??????Email??????????GSM7bit??????????????????????????????????
 Input          : pucSrc -- ??????IRA????
                : ulSrcLen -- ??????IRA????????
 Output         : pucDst -- ????????GSM????
                : pulDstLen -- ????????GSM????????
 Return Value   : AT_SUCCESS --- ????
                  AT_FAILURE --- ????

 History        :
  1.Date        : 2011-1-27
    Author      : J00168360
    Modification: [??????????????]Created function
  2.??    ??   : 2014??5??30??
    ??    ??   : j00174725
    ????????   : TQE ???????? pusDstLen -> pulDstLen
*****************************************************************************/
TAF_UINT32 At_PbEmailTransferToGsm(TAF_UINT8  *pucSrc,
                                   TAF_UINT16 usSrcLen,
                                   TAF_UINT8  *pucDst,
                                   VOS_UINT32 *pulDstLen)
{
    TAF_UINT16      usGsmCodeLen = 0;
    TAF_UINT8       aucEmailUCS2[2 * SI_PB_EMAIL_MAX_LEN];
    TAF_UINT16      usUCS2Len;

    PS_MEM_SET(aucEmailUCS2, 0x0, sizeof(aucEmailUCS2));

    /* ??????????????????UCS2???????? */
    At_PbIraToUnicode(pucSrc, usSrcLen, aucEmailUCS2, &usUCS2Len);

    /* ????UCS2??????????GSM7bit???? */
    if (AT_SUCCESS != At_UnicodeTransferToGsmCalcLength(aucEmailUCS2, usUCS2Len, &usGsmCodeLen))
    {
        AT_ERR_LOG("At_PbEmailTransferToGsm error: failed to transfer to Gsm");

        return AT_CME_INVALID_CHARACTERS_IN_TEXT_STRING;
    }

    /* EMAIL????????????????EMAIL???????????????????????????????????? */
    if (usGsmCodeLen > gstPBATInfo.usEmailLen)
    {
        AT_LOG1("At_PbEmailTransferToGsm error: mail length [%d] too long", usGsmCodeLen);

        return AT_CME_TEXT_STRING_TOO_LONG;
    }

    *pulDstLen = usGsmCodeLen;

    /* ??????????GSM7bit?????????? */
    At_UnicodeTransferToGsm(aucEmailUCS2, usUCS2Len, pucDst);

    return AT_SUCCESS;
}

/*****************************************************************************
 Prototype      : At_SetCpbfPara
 Description    : +CPBF=<findtext>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??  : 2011??6??21??
    ??    ??  : j00168360
    ????????  : [DTS2011042105653]??at+cpbf????????????
  3.??    ??   : 2012??8??10??
    ??    ??   : y00213812
    ????????   : DTS2012082204471, TQE??????At_PbAlphaTagProc????????????????
                 ????????????????????
*****************************************************************************/
TAF_UINT32 At_SetCpbfPara(TAF_UINT8 ucIndex)
{
    SI_PB_STORATE_TYPE                  Storage = SI_PB_STORAGE_UNSPECIFIED;
    SI_PB_RECORD_STRU                   stRecords;
    TAF_UINT32                          ulResult;

    /* ???????? */
    if(0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????????????????????????????????????GSM7BIT??UCS2 80/81/82 */
    /*modified by Y00213812 for DTS2012082204471 TQE????, 2012-08-10, begin*/
    ulResult = At_PbAlphaTagProc(&stRecords, &gastAtParaList[0]);
    /*modified by Y00213812 for DTS2012082204471 TQE????, 2012-08-10, end*/

    if (AT_SUCCESS != ulResult)
    {
        AT_ERR_LOG("At_SetCpbfPara:something wrong in At_PbAlphaTagProc");
        return ulResult;
    }

    /* ???????????? */
    if( AT_SUCCESS == SI_PB_Search ( gastAtClientTab[ucIndex].usClientId, 0,
                                      Storage, stRecords.ucAlphaTagLength,
                                      stRecords.AlphaTag)
        )
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPBF_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}


/*****************************************************************************
 ?? ?? ??  : AT_SetModemStatusPara
 ????????  : Modem????????????????????
             <CR><LF>OK<CR><LF>
             ??MT????????????
             <CR><LF>+CME ERROR: <err><CR><LF>

 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_ERR??VOS_OK
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??12??20??
    ??    ??   : d00212987
    ????????   : V9R1 L_plus_C????????

*****************************************************************************/
VOS_UINT32 AT_SetModemStatusPara( VOS_UINT8 ucIndex )
{
    VOS_UINT32                          ulRst;

    /* ?????????? */
    if (2 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????????? */
    if((1 != gastAtParaList[0].usParaLen) || (1 != gastAtParaList[1].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????balong modem?????????????????????? */
    if(0 == gastAtParaList[0].ulParaValue)
    {
        return AT_OK;
    }

    ulRst = AT_FillAndSndCSIMAMsg(gastAtClientTab[ucIndex].usClientId, gastAtParaList[1].ulParaValue);

    if (VOS_OK == ulRst)
    {
        return AT_OK;
    }
    else
    {
        return AT_ERROR;
    }

}

/*****************************************************************************
 Prototype      : At_SetCpbwPara2
 Description    : +CPBW=[<index>][,<number>[,<type>[,<text>]]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2009-01-17
    Author      : m00128685
    Modification: Created function
  2.Date        : 2011-01-19
    Author      : j00168360
    Modification: [??????????????]????????????????????????
  3.??    ??  : 2011??6??21??
    ??    ??  : j00168360
    ????????  : [DTS2011042105653]??at+cpbf????????????
  4.??    ??   : 2012??8??10??
    ??    ??   : y00213812
    ????????   : DTS2012082204471, TQE??????At_PbAlphaTagProc????????????????
                 ????????????????????
*****************************************************************************/
TAF_UINT32 At_SetCpbwPara2(TAF_UINT8 ucIndex)
{
    SI_PB_RECORD_STRU   stRecords;
    TAF_UINT8           *pucNumber;
    TAF_UINT16          usLen;
    TAF_UINT32          ulResult;
    TAF_UINT32          ulResultTemp;

    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType) /* ???????? */
    {
        AT_ERR_LOG("At_SetCpbwPara2 error:incorect parameters");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(gucAtParaIndex > 4) /* ???????? */
    {
        AT_ERR_LOG("At_SetCpbwPara2 error: too many parameters");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????????????????? */
    if (1 == gucAtParaIndex)
    {
        ulResult = At_PbDeleteProc(ucIndex);

        return ulResult;
    }

    if((0 == gastAtParaList[1].usParaLen)&&(0 == gastAtParaList[3].usParaLen))
    {
        return AT_ERROR;
    }

    PS_MEM_SET(&stRecords, 0x00, sizeof(stRecords));/* ?????? */

    if(0 != gastAtParaList[0].usParaLen)/* ????<index> */
    {
        stRecords.Index = (TAF_UINT16)gastAtParaList[0].ulParaValue;
    }

    if(0 != gastAtParaList[1].usParaLen)/* ????<number> */
    {
        if('+' == gastAtParaList[1].aucPara[0])
        {
            pucNumber = gastAtParaList[1].aucPara   + 1;
            usLen     = gastAtParaList[1].usParaLen - 1;
        }
        else
        {
            pucNumber = gastAtParaList[1].aucPara;
            usLen     = gastAtParaList[1].usParaLen;
        }

        if(AT_FAILURE == At_CheckPBString(pucNumber,&usLen))
        {
            AT_ERR_LOG("At_SetCpbwPara2 error: invalid characters in dial string");

            return AT_CME_INVALID_CHARACTERS_IN_DIAL_STRING;
        }

        PS_MEM_CPY(stRecords.Number, pucNumber, usLen);

        stRecords.NumberLength = (TAF_UINT8)usLen;
    }

    /* ????????????????????????????????????????????GSM7BIT??UCS2 80/81/82 */
    /*modified by Y00213812 for DTS2012082204471 TQE????, 2012-08-10, begin*/
    ulResult = At_PbAlphaTagProc(&stRecords, &gastAtParaList[3]);
    /*modified by Y00213812 for DTS2012082204471 TQE????, 2012-08-10, end*/

    if (AT_SUCCESS != ulResult)
    {
        AT_ERR_LOG("At_SetCpbwPara2:something wrong in At_PbAlphaTagProc");
        return ulResult;
    }

    if (0 != gastAtParaList[2].usParaLen)/* ????<type> */
    {
        /* ?????????????? */
        stRecords.NumberType = (PB_NUMBER_TYPE_INTERNATIONAL == At_GetCodeType(gastAtParaList[1].aucPara[0]))
                              ? PB_NUMBER_TYPE_INTERNATIONAL : (TAF_UINT8)gastAtParaList[2].ulParaValue;
    }
    else
    {
        stRecords.NumberType = (TAF_UINT8)At_GetCodeType(gastAtParaList[1].aucPara[0]);
    }

    if (stRecords.NumberType < 128)
    {
        AT_ERR_LOG("At_SetCpbwPara2 error: invalid index");

        return AT_CME_INVALID_INDEX;
    }

    if (0 == gastAtParaList[0].usParaLen)
    {
        /* ???????? */
        if (AT_SUCCESS == SI_PB_Add(gastAtClientTab[ucIndex].usClientId,
                                    0, SI_PB_STORAGE_UNSPECIFIED, &stRecords))
        {
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPBW_SET;/* ???????????????? */

            return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
        }

        AT_ERR_LOG("At_SetCpbwPara2 error: add pb record failed");

        return AT_ERROR;
    }

    /* ???????? */
    ulResult      = SI_PB_GetSPBFlag();
    ulResultTemp  = SI_PB_GetStorateType();

    if((1 == ulResult)&&(SI_PB_STORAGE_SM == ulResultTemp))
    {
        if ( AT_SUCCESS == SI_PB_SModify(gastAtClientTab[ucIndex].usClientId,
                                            0, SI_PB_STORAGE_UNSPECIFIED, &stRecords))
        {
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPBW_SET;/* ???????????????? */

            return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
        }
    }

    if (AT_SUCCESS == SI_PB_Modify(gastAtClientTab[ucIndex].usClientId,
                                   0, SI_PB_STORAGE_UNSPECIFIED, &stRecords))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPBW_SET;/* ???????????????? */

        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }

    AT_ERR_LOG("At_SetCpbwPara2 error: modify pb record failed");

    return AT_ERROR;
}

/*****************************************************************************
 Prototype      : At_SetScpbwPara
 Description    : ^SCPBW
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2009-05-23
    Author      : h59254
    Modification: Created
  2.Date        : 2011-01-27
    Author      : j00168360
    Modification: [??????????????]????EMAIL????
  3.Date        : 2011-04-21
    Author      : j00168360
    Modification: [DTS2011041403381],??????????????????????????????????????????????????255??
                  ????????????129
  4.??    ??  : 2011??6??21??
    ??    ??  : j00168360
    ????????  : [DTS2011042105653]??at+cpbf????????????
  5.??    ??   : 2014??5??30??
    ??    ??   : j00174725
    ????????   : TQE
*****************************************************************************/
TAF_UINT32 At_SetScpbwPara(TAF_UINT8 ucIndex)
{
    SI_PB_RECORD_STRU   stRecords;
    TAF_UINT8           *pucNumber;
    TAF_UINT16          usLen;
    TAF_UINT16          usAlphaTagLength;
    TAF_UINT32          ulResult;

    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)    /* ???????? */
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(gucAtParaIndex > 12)/* ???????? */
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????????????????? */
    if (1 == gucAtParaIndex)
    {
        ulResult = At_PbDeleteProc(ucIndex);

        return ulResult;
    }

    if ((0 == gastAtParaList[1].usParaLen) && (0 == gastAtParaList[3].usParaLen)
     && (0 == gastAtParaList[5].usParaLen) && (0 == gastAtParaList[7].usParaLen)
     && (0 == gastAtParaList[9].usParaLen) && (0 == gastAtParaList[11].usParaLen))
    {
        return AT_ERROR;
    }

    /* ??????????????UNICODE????ASCII?? */
    PS_MEM_SET(&stRecords, 0x00, sizeof(stRecords));/* ?????? */

    if (0 != gastAtParaList[0].usParaLen)/* ????<index> */
    {
        stRecords.Index = (TAF_UINT16)gastAtParaList[0].ulParaValue;
    }

    if (0 != gastAtParaList[1].usParaLen)    /* ????<num1> */
    {
        if ('+' == gastAtParaList[1].aucPara[0])
        {
            pucNumber = gastAtParaList[1].aucPara   + 1;
            usLen     = gastAtParaList[1].usParaLen - 1;
        }
        else
        {
            pucNumber = gastAtParaList[1].aucPara;
            usLen     = gastAtParaList[1].usParaLen;
        }

        if (AT_FAILURE == At_CheckPBString(pucNumber,&usLen))
        {
            return AT_CME_INVALID_CHARACTERS_IN_DIAL_STRING;
        }

        PS_MEM_CPY(stRecords.Number, pucNumber, usLen);

        stRecords.NumberLength = (TAF_UINT8)usLen;
    }

    /* ????????????????????????????????0xFF */
    if(0 == gastAtParaList[1].usParaLen)
    {
        stRecords.NumberType = 0xFF;
        stRecords.NumberLength = 0;
    }
    else
    {
        if (0 != gastAtParaList[2].usParaLen)/* ????<type1> */
        {
            /* ?????????????? */
            stRecords.NumberType = (PB_NUMBER_TYPE_INTERNATIONAL == At_GetCodeType(gastAtParaList[1].aucPara[0]))
                                  ? PB_NUMBER_TYPE_INTERNATIONAL : (TAF_UINT8)gastAtParaList[2].ulParaValue;
        }
        else
        {
            stRecords.NumberType = (TAF_UINT8)At_GetCodeType(gastAtParaList[1].aucPara[0]);
        }
    }

    if (0 != gastAtParaList[3].usParaLen)    /* ????<num2> */
    {
        if ('+' == gastAtParaList[3].aucPara[0])
        {
            pucNumber = gastAtParaList[3].aucPara   + 1;
            usLen     = gastAtParaList[3].usParaLen - 1;
        }
        else
        {
            pucNumber = gastAtParaList[3].aucPara;
            usLen     = gastAtParaList[3].usParaLen;
        }

        if (AT_FAILURE == At_CheckPBString(pucNumber,&usLen))
        {
            return AT_CME_INVALID_CHARACTERS_IN_DIAL_STRING;
        }

        PS_MEM_CPY(stRecords.AdditionNumber[0].Number, pucNumber, usLen);

        stRecords.AdditionNumber[0].NumberLength = (TAF_UINT8)usLen;
    }

    if(0 == gastAtParaList[3].usParaLen)
    {
        stRecords.AdditionNumber[0].NumberType = 0xFF;
        stRecords.AdditionNumber[0].NumberLength = 0;
    }
    else
    {
        if (0 != gastAtParaList[4].usParaLen)/* ????<type2> */
        {
            /* ?????????????? */
            stRecords.AdditionNumber[0].NumberType = (PB_NUMBER_TYPE_INTERNATIONAL == At_GetCodeType(gastAtParaList[3].aucPara[0]))
                                                    ? PB_NUMBER_TYPE_INTERNATIONAL : (TAF_UINT8)gastAtParaList[4].ulParaValue;
        }
        else
        {
            stRecords.AdditionNumber[0].NumberType = (TAF_UINT8)At_GetCodeType(gastAtParaList[3].aucPara[0]);
        }
    }

    if (0 != gastAtParaList[5].usParaLen)    /* ????<num3> */
    {
        if ('+' == gastAtParaList[5].aucPara[0])
        {
            pucNumber = gastAtParaList[5].aucPara   + 1;
            usLen     = gastAtParaList[5].usParaLen - 1;
        }
        else
        {
            pucNumber = gastAtParaList[5].aucPara;
            usLen     = gastAtParaList[5].usParaLen;
        }

        if (AT_FAILURE == At_CheckPBString(pucNumber,&usLen))
        {
            return AT_CME_INVALID_CHARACTERS_IN_DIAL_STRING;
        }

        PS_MEM_CPY(stRecords.AdditionNumber[1].Number, pucNumber, usLen);

        stRecords.AdditionNumber[1].NumberLength = (TAF_UINT8)usLen;
    }

    if(0 == gastAtParaList[5].usParaLen)
    {
        stRecords.AdditionNumber[1].NumberType = 0xFF;
        stRecords.AdditionNumber[1].NumberLength = 0;
    }
    else
    {
        if (0 != gastAtParaList[6].usParaLen)/* ????<type3> */
        {
            /* ?????????????? */
            stRecords.AdditionNumber[1].NumberType = (PB_NUMBER_TYPE_INTERNATIONAL == At_GetCodeType(gastAtParaList[5].aucPara[0]))
                                                    ? PB_NUMBER_TYPE_INTERNATIONAL : (TAF_UINT8)gastAtParaList[6].ulParaValue;
        }
        else
        {
            stRecords.AdditionNumber[1].NumberType = (TAF_UINT8)At_GetCodeType(gastAtParaList[5].aucPara[0]);
        }
    }

    if (0 != gastAtParaList[7].usParaLen)    /* ????<num4> */
    {
        if ('+' == gastAtParaList[7].aucPara[0])
        {
            pucNumber = gastAtParaList[7].aucPara   + 1;
            usLen     = gastAtParaList[7].usParaLen - 1;
        }
        else
        {
            pucNumber = gastAtParaList[7].aucPara;
            usLen     = gastAtParaList[7].usParaLen;
        }

        if (AT_FAILURE == At_CheckPBString(pucNumber,&usLen))
        {
            return AT_CME_INVALID_CHARACTERS_IN_DIAL_STRING;
        }

        PS_MEM_CPY(stRecords.AdditionNumber[2].Number, pucNumber, usLen);

        stRecords.AdditionNumber[2].NumberLength = (TAF_UINT8)usLen;
    }

    if(0 == gastAtParaList[7].usParaLen)
    {
        stRecords.AdditionNumber[2].NumberType = 0xFF;
        stRecords.AdditionNumber[2].NumberLength = 0;
    }
    else
    {
        if (0 != gastAtParaList[8].usParaLen)/* ????<type4> */
        {
            /* ?????????????? */
            stRecords.AdditionNumber[2].NumberType = (PB_NUMBER_TYPE_INTERNATIONAL == At_GetCodeType(gastAtParaList[7].aucPara[0]))
                                                    ? PB_NUMBER_TYPE_INTERNATIONAL : (TAF_UINT8)gastAtParaList[8].ulParaValue;
        }
        else
        {
            stRecords.AdditionNumber[2].NumberType = (TAF_UINT8)At_GetCodeType(gastAtParaList[7].aucPara[0]);
        }
    }

    /* ????ucAlphaTagType */
    if (AT_CSCS_UCS2_CODE == gastAtParaList[10].ulParaValue)
    {
        stRecords.AlphaTagType = AT_CSCS_UCS2_CODE;
    }
    else if (AT_CSCS_IRA_CODE == gastAtParaList[10].ulParaValue)
    {
        stRecords.AlphaTagType = AT_CSCS_IRA_CODE;
    }
    else
    {
        stRecords.AlphaTagType = AT_CSCS_IRA_CODE;
    }

    if (0 != gastAtParaList[9].usParaLen) /* ????<text> */
    {
        /* ??????????AT??????????????UNICODE????????????????????ASCII?? */
        usAlphaTagLength = gastAtParaList[9].usParaLen;

        if (AT_CSCS_UCS2_CODE == stRecords.AlphaTagType)
        {
            /* ??ASCII??????????UNICODE???????? */
            if ((usAlphaTagLength % 2) != 0)
            {
                return AT_ERROR;
            }

            if (AT_FAILURE == At_UnicodePrint2Unicode(gastAtParaList[9].aucPara,&usAlphaTagLength))
            {
                return AT_ERROR;
            }

            if (AT_FAILURE == At_CheckNameUCS2Code(gastAtParaList[9].aucPara, &usAlphaTagLength))
            {
                return AT_ERROR;
            }

            stRecords.AlphaTagType = gastAtParaList[9].aucPara[0];
        }

        /* ????????????????????????????????TAF_PB_RECORD_STRU
        ???????????????????????????????????? */
        if (usAlphaTagLength > SI_PB_ALPHATAG_MAX_LEN)
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        PS_MEM_CPY(stRecords.AlphaTag, gastAtParaList[9].aucPara, usAlphaTagLength);
        stRecords.ucAlphaTagLength = (TAF_UINT8)usAlphaTagLength;
    }

    if (0 != gastAtParaList[11].usParaLen)  /* ????<email> */
    {
        if (gastAtParaList[11].usParaLen > SI_PB_EMAIL_MAX_LEN)
        {
            return AT_CME_TEXT_STRING_TOO_LONG;
        }

        ulResult = At_PbEmailTransferToGsm(gastAtParaList[11].aucPara,
                                           gastAtParaList[11].usParaLen,
                                           stRecords.Email.Email,
                                           &stRecords.Email.EmailLen);

        if (AT_SUCCESS != ulResult)
        {
            return ulResult;
        }
    }

    if (0 == gastAtParaList[0].usParaLen) /* ???? */
    {
        if ( AT_SUCCESS == SI_PB_SAdd(gastAtClientTab[ucIndex].usClientId,
                                        0, SI_PB_STORAGE_UNSPECIFIED, &stRecords))
        {
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPBW_SET;/* ???????????????? */

            return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
        }

        return AT_ERROR;

    }

    /* ???? */
    if ( AT_SUCCESS == SI_PB_SModify(gastAtClientTab[ucIndex].usClientId,
                                        0, SI_PB_STORAGE_UNSPECIFIED, &stRecords))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPBW_SET;/* ???????????????? */

        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }

    return AT_ERROR;

}


/*****************************************************************************
 Prototype      : At_SetScpbrPara
 Description    : ^SCPBR
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2009-05-23
    Author      : h59254
    Modification: Created
*****************************************************************************/
TAF_UINT32 At_SetScpbrPara(TAF_UINT8 ucIndex)
{
    /* ???????? */
    if(0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 2)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(0 == gastAtParaList[1].usParaLen)
    {
        gastAtParaList[1].ulParaValue = gastAtParaList[0].ulParaValue;
    }

    if (AT_SUCCESS == SI_PB_SRead(gastAtClientTab[ucIndex].usClientId,
                                0, SI_PB_STORAGE_UNSPECIFIED,
                                (TAF_UINT16)gastAtParaList[0].ulParaValue,
                                (TAF_UINT16)gastAtParaList[1].ulParaValue))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SCPBR_SET;

        gulPBPrintTag = TAF_FALSE;

        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}


/*****************************************************************************
 Prototype      : At_SetCnumPara
 Description    : +CNUM
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2007-06-11
    Author      : h44270
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetCnumPara(TAF_UINT8 ucIndex)
{
    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if(AT_SUCCESS == SI_PB_Read(gastAtClientTab[ucIndex].usClientId,0, SI_PB_STORAGE_ON, 0, 0))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CNUM_READ;

        gulPBPrintTag = TAF_FALSE;

        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}


/*****************************************************************************
 Prototype      : At_SetCsimPara
 Description    : +CSIM=<length>,<command>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  1.Date        : 2006-10-23
    Author      : ---
    Modification: w42656
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
*****************************************************************************/
TAF_UINT32 At_SetCsimPara(TAF_UINT8 ucIndex)
{
    SI_PIH_CSIM_COMMAND_STRU Command;

    /* ???????? */
    if((0 == gastAtParaList[0].usParaLen) || (0 == gastAtParaList[1].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 2)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????? */
    PS_MEM_SET(&Command,0x00,sizeof(Command));

    if(0 != (gastAtParaList[0].ulParaValue % 2))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(0 != (gastAtParaList[1].usParaLen % 2))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(AT_FAILURE == At_AsciiNum2HexString(gastAtParaList[1].aucPara,&gastAtParaList[1].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(gastAtParaList[0].ulParaValue != (TAF_UINT32)(gastAtParaList[1].usParaLen * 2))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<length> */
    Command.ulLen = gastAtParaList[1].usParaLen;

    /* ????<command> */
    PS_MEM_CPY((TAF_VOID*)Command.aucCommand,(TAF_VOID*)gastAtParaList[1].aucPara,(VOS_UINT16)Command.ulLen);

    /* ???????????? */
    if(AT_SUCCESS == SI_PIH_GenericAccessReq(gastAtClientTab[ucIndex].usClientId, 0, &Command))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CSIM_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 Prototype      : At_SetCchoPara
 Description    : +CCHO=<dfname>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2013-05-15
    Author      : g47350
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetCchoPara(TAF_UINT8 ucIndex)
{
    SI_PIH_CCHO_COMMAND_STRU    stCchoCmd;

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(1 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????????????2???????? */
    if(0 != (gastAtParaList[0].usParaLen % 2))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????????????16???????? */
    if(AT_FAILURE == At_AsciiNum2HexString(gastAtParaList[0].aucPara, &gastAtParaList[0].usParaLen))
    {
        AT_ERR_LOG("At_SetCchoPara: At_AsciiNum2HexString fail.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    stCchoCmd.ulAIDLen   = gastAtParaList[0].usParaLen;
    stCchoCmd.pucADFName = gastAtParaList[0].aucPara;

    /* ???????????? */
    if(AT_SUCCESS == SI_PIH_CchoSetReq(gastAtClientTab[ucIndex].usClientId, 0, &stCchoCmd))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CCHO_SET;

        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }

    return AT_ERROR;
}

/*****************************************************************************
 Prototype      : At_SetCchcPara
 Description    : +CCHC=<sessionid>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2013-05-15
    Author      : g47350
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetCchcPara(TAF_UINT8 ucIndex)
{
    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(1 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if(AT_SUCCESS == SI_PIH_CchcSetReq(gastAtClientTab[ucIndex].usClientId,
                                    0,
                                    gastAtParaList[0].ulParaValue))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CCHC_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }

    return AT_ERROR;
}

/*****************************************************************************
 Prototype      : At_SetCglaPara
 Description    : +CGLA=<sessionid>,<length>,<command>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2013-05-15
    Author      : g47350
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetCglaPara(TAF_UINT8 ucIndex)
{
    SI_PIH_CGLA_COMMAND_STRU    stCglaCmd;

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(3 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* <length>??????2???????? */
    if(0 != (gastAtParaList[1].ulParaValue % 2))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????????????2???????? */
    if(0 != (gastAtParaList[2].usParaLen % 2))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????????????16???????? */
    if(AT_FAILURE == At_AsciiNum2HexString(gastAtParaList[2].aucPara, &gastAtParaList[2].usParaLen))
    {
        AT_ERR_LOG("At_SetCglaPara: At_AsciiNum2HexString fail.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* length????????????????????2?? */
    if(gastAtParaList[1].ulParaValue != (TAF_UINT32)(gastAtParaList[2].usParaLen * 2))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    stCglaCmd.ulSessionID   = gastAtParaList[0].ulParaValue;
    stCglaCmd.ulLen         = gastAtParaList[2].usParaLen;
    stCglaCmd.pucCommand    = gastAtParaList[2].aucPara;

    /* ???????????? */
    if(AT_SUCCESS == SI_PIH_CglaSetReq(gastAtClientTab[ucIndex].usClientId, 0, &stCglaCmd))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGLA_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }

    return AT_ERROR;
}

/*****************************************************************************
 Prototype      : At_SetCardATRPara
 Description    :
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2013-08-22
    Author      : g47350
    Modification: Created function by g47350
*****************************************************************************/
TAF_UINT32 At_SetCardATRPara(TAF_UINT8 ucIndex)
{
    if (AT_SUCCESS == SI_PIH_GetCardATRReq(gastAtClientTab[ucIndex].usClientId, 0))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CARD_ATR_READ;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : At_SetUsimStub
 ????????  : ????usim??????????rsp??????mma
             ??1??????????????id??
             ??2??????????????0??sim??1??usim??
             ??3????????total num??????????????1
             ??4????????ef len
             ??5????????????????

 ????????  : VOS_VOID
 ?? ?? ??  : VOS_VOID
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??3??31??
    ??    ??   : z00161729
    ????????   : ????????
*****************************************************************************/
VOS_UINT32 At_SetUsimStub(VOS_UINT8 ucIndex)
{
    TAF_MMA_USIM_STUB_SET_REQ_STRU                          stUsimStub;
    TAF_NVIM_ENHANCED_OPER_NAME_SERVICE_CFG_STRU            stOperNameServiceCfg;
    VOS_UINT8                                               i;
    VOS_UINT8                                               ucNum;
    VOS_UINT32                                              ulEf;
    VOS_UINT32                                              ulTotalNum;
    VOS_UINT32                                              ulEfId;
    VOS_UINT32                                              ulEfLen;
    VOS_UINT32                                              ulApptype;
    MODEM_ID_ENUM_UINT16                                    enModemID;
    VOS_UINT32                                              ulRet;

    ucNum      = 0;
    ulEf       = 0;
    ulTotalNum = 0;
    ulApptype  = 0;
    ulEfId     = 0;
    ulEfLen    = 0;
    PS_MEM_SET(&stUsimStub, 0, sizeof(stUsimStub));

    /* ????nv????nv???????????????? */

    PS_MEM_SET(&stOperNameServiceCfg, 0x00, sizeof(stOperNameServiceCfg));
    enModemID  = MODEM_ID_0;

    ulRet      = AT_GetModemIdFromClient(ucIndex, &enModemID);

    if (VOS_OK != ulRet)
    {
        return AT_ERROR;
    }

    if(NV_OK != NV_ReadEx(enModemID, en_NV_Item_ENHANCED_OPERATOR_NAME_SRV_CFG, &stOperNameServiceCfg,
                          sizeof(TAF_NVIM_ENHANCED_OPER_NAME_SERVICE_CFG_STRU)))
    {
        return AT_ERROR;
    }

    if (VOS_FALSE == stOperNameServiceCfg.ucReserved5)
    {
        return AT_ERROR;
    }

    (VOS_VOID)At_String2Hex(gastAtParaList[0].aucPara, gastAtParaList[0].usParaLen, &ulEfId);
    (VOS_VOID)At_String2Hex(gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen, &ulApptype);
    (VOS_VOID)At_String2Hex(gastAtParaList[2].aucPara, gastAtParaList[2].usParaLen, &ulTotalNum);
    (VOS_VOID)At_String2Hex(gastAtParaList[3].aucPara, gastAtParaList[3].usParaLen, &ulEfLen);

    stUsimStub.ucTotalNum = (VOS_UINT8)ulTotalNum;
    stUsimStub.usEfId     = (VOS_UINT16)ulEfId;
    stUsimStub.usEfLen    = (VOS_UINT16)ulEfLen;
    stUsimStub.ulApptype  = (VOS_UINT8)ulApptype;

    for (i=0; i < (gastAtParaList[4].usParaLen/2); i++)
    {
        (VOS_VOID)At_String2Hex(gastAtParaList[4].aucPara+ 2*i, 2, &ulEf);

        if (ucNum >= TAF_MMA_MAX_EF_LEN)
        {
           return AT_ERROR;
        }

        PS_MEM_CPY(&stUsimStub.aucEf[ucNum], &ulEf, 1);
        ucNum++;
    }

    TAF_SetUsimStub(gastAtClientTab[ucIndex].usClientId,
                    gastAtClientTab[ucIndex].opId,
                    &stUsimStub);

    return AT_OK;
}


/*****************************************************************************
 ?? ?? ??  : At_SetRefreshStub
 ????????  : ????pih????refresh??????mma
             ??1????????????pid??
             ??2????????refresh??????
             0:USIMM_REFRESH_ALL_FILE
             1:USIMM_REFRESH_FILE_LIST
             2:USIMM_REFRESH_3G_SESSION_RESET
             ??2????????refresh????????????refresh??USIMM_REFRESH_FILE_LIST??????

 ????????  : VOS_VOID
 ?? ?? ??  : VOS_VOID
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??3??31??
    ??    ??   : z00161729
    ????????   : ????????
*****************************************************************************/
VOS_UINT32 At_SetRefreshStub(VOS_UINT8 ucIndex)
{
    TAF_MMA_REFRESH_STUB_SET_REQ_STRU                       stRefreshStub;
    VOS_UINT8                                               i;
    VOS_UINT32                                              ulTotalNum;
    VOS_UINT32                                              ulRefreshFileType;
    VOS_UINT32                                              ulReceivePid;
    VOS_UINT32                                              ulFileId;
    TAF_NVIM_ENHANCED_OPER_NAME_SERVICE_CFG_STRU            stOperNameServiceCfg;
    MODEM_ID_ENUM_UINT16                                    enModemID;
    VOS_UINT32                                              ulRet;

    ulTotalNum        = 0;
    ulRefreshFileType = 0;
    ulReceivePid      = 0;
    ulFileId          = 0;
    PS_MEM_SET(&stRefreshStub, 0, sizeof(stRefreshStub));

    /* ????nv????nv???????????????? */
    PS_MEM_SET(&stOperNameServiceCfg, 0x00, sizeof(stOperNameServiceCfg));
    enModemID  = MODEM_ID_0;

    ulRet      = AT_GetModemIdFromClient(ucIndex, &enModemID);

    if (VOS_OK != ulRet)
    {
        return AT_ERROR;
    }

    if(NV_OK != NV_ReadEx(enModemID, en_NV_Item_ENHANCED_OPERATOR_NAME_SRV_CFG, &stOperNameServiceCfg,
                          sizeof(TAF_NVIM_ENHANCED_OPER_NAME_SERVICE_CFG_STRU)))
    {
        return AT_ERROR;
    }

    if (VOS_FALSE == stOperNameServiceCfg.ucReserved5)
    {
        return AT_ERROR;
    }

    (VOS_VOID)At_String2Hex(gastAtParaList[0].aucPara, gastAtParaList[0].usParaLen, &ulReceivePid);
    (VOS_VOID)At_String2Hex(gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen, &ulRefreshFileType);
    (VOS_VOID)At_String2Hex(gastAtParaList[2].aucPara, gastAtParaList[2].usParaLen, &ulTotalNum);

    stRefreshStub.ulReceivePid      = ulReceivePid;
    stRefreshStub.ucTotalNum        = (VOS_UINT8)ulTotalNum;
    stRefreshStub.usRefreshFileType = (VOS_UINT8)ulRefreshFileType;

    if (stRefreshStub.ucTotalNum > TAF_MMA_MAX_FILE_ID_NUM)
    {
        stRefreshStub.ucTotalNum = TAF_MMA_MAX_FILE_ID_NUM;
    }

    for (i = 0; i < stRefreshStub.ucTotalNum; i++)
    {
        (VOS_VOID)At_String2Hex(gastAtParaList[i+3].aucPara, gastAtParaList[i+3].usParaLen, &ulFileId);
        stRefreshStub.ausEfId[i] = (VOS_UINT16)ulFileId;
    }

    TAF_SetRefreshStub(gastAtClientTab[ucIndex].usClientId,
                    gastAtClientTab[ucIndex].opId,
                    &stRefreshStub);

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetAutoReselStub
 ????????  : ????????at+cops=0????????????
             ??1??????????????????1??????????0??????????

 ????????  : VOS_VOID
 ?? ?? ??  : VOS_VOID
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??5??29??
    ??    ??   : b00269685
    ????????   : ????????
*****************************************************************************/
VOS_UINT32 At_SetAutoReselStub(VOS_UINT8 ucIndex)
{
    TAF_MMA_AUTO_RESEL_STUB_SET_REQ_STRU                    stAutoReselStub;

    PS_MEM_SET(&stAutoReselStub, 0, sizeof(stAutoReselStub));

    stAutoReselStub.ucActiveFlg = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    TAF_SetAutoReselStub(gastAtClientTab[ucIndex].usClientId,
                    gastAtClientTab[ucIndex].opId,
                    &stAutoReselStub);

    return AT_OK;
}
/* Added by c00318887 for file refresh??????????????, 2015-4-28, begin */
/* Added by c00318887 for file refresh??????????????, 2015-4-28, end */


/********************************************************************
  Function:       At_CrsmFilePathCheck
  Description:    ????CRSM??????????<path>????(????????????????)
  Input:          TAF_UINT32 ulEfId:????ID
                  TAF_UINT8 *pucFilePath:????????
                  TAF_UINT16 *pusPathLen:????????????
  Output:         ??
  Return:         AT_SUCCESS??????????????????
  Others:
  History        : ---
  1.Date         : 2012-05-04
    Author       : h59254
    Modification : Created function
  2.??    ??   : 2015??3??16??
    ??    ??   : w00316404
    ????????   : DTS2015031601183:????CRSM??????????
********************************************************************/
TAF_UINT32  At_CrsmFilePathCheck(TAF_UINT32 ulEfId, TAF_UINT8 *pucFilePath, TAF_UINT16 *pusPathLen)
{
    TAF_UINT16                          usLen;
    TAF_UINT16                          ausPath[USIMM_MAX_PATH_LEN]  = {0};
    TAF_UINT16                          ausTmpPath[USIMM_MAX_PATH_LEN]  = {0};
    TAF_UINT16                          usPathLen;
    TAF_UINT16                          i;

    usPathLen   = *pusPathLen;
    usLen       = 0;

    if (usPathLen > USIMM_MAX_PATH_LEN)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    for (i = 0; i < (usPathLen/sizeof(TAF_UINT16)); i++)
    {
        ausTmpPath[i] = ((pucFilePath[i*2]<<0x08)&0xFF00) + pucFilePath[(i*2)+1];
    }

    /* ??????????????3F00??????????????3F00?????? */
    if (MFID != ausTmpPath[0])
    {
        if (USIMM_MAX_PATH_LEN == usPathLen)
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        ausPath[0] = MFID;

        usLen++;
    }

    VOS_MemCpy(&ausPath[usLen], ausTmpPath, usPathLen);

    usLen += (usPathLen/sizeof(TAF_UINT16));

    if ((ulEfId & 0xFF00) == EFIDUNDERMF)
    {
        usLen = 1;
    }
    /* 4F????????5F??????????????3 */
    else if ((ulEfId & 0xFF00) == EFIDUNDERMFDFDF)
    {
        if ((usLen != 3)
            ||((ausPath[1]&0xFF00) != DFIDUNDERMF)
            ||((ausPath[2]&0xFF00) != DFIDUNDERMFDF))
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
    }
    /* 6F????????7F??????????????2 */
    else if ((ulEfId & 0xFF00) == EFIDUNDERMFDF)
    {
        if ((usLen != 2)
            ||((ausPath[1]&0xFF00) != DFIDUNDERMF))
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
    }
    else
    {
        /* return AT_CME_INCORRECT_PARAMETERS; */
    }

    *pusPathLen  = usLen;

    VOS_MemCpy(pucFilePath, ausPath, (VOS_SIZE_T)(usLen*2));

    return AT_SUCCESS;
}

/********************************************************************
  Function:       At_CrsmApduParaCheck
  Description:    ????CRSM????????????????????????
  Input:          ??
  Output:         ??
  Return:         AT_SUCCESS??????????????????
  Others:
  History        : ---
  1.Date         : 2012-05-04
    Author       : h59254
    Modification : Created function
********************************************************************/
TAF_UINT32  At_CrsmApduParaCheck(VOS_VOID)
{
    TAF_UINT16                          usFileTag;

    /* ???????????????????????????????????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        AT_ERR_LOG("At_SetCrsmPara: command type null");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??STATUS????????????ID???????????? */
    if ((0 == gastAtParaList[1].ulParaValue)
        && (USIMM_STATUS != gastAtParaList[0].ulParaValue))
    {
        AT_ERR_LOG("At_CrsmApduParaCheck: File Id null.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????ID?????? */
    usFileTag   = (gastAtParaList[1].ulParaValue >> 8) & (0x00FF);

    /* ??????????ID??????EF????????????????????3F/5F/7F */
    if ((MFLAB == usFileTag)
       || (DFUNDERMFLAB == usFileTag)
       || (DFUNDERDFLAB == usFileTag))
    {
        AT_ERR_LOG("At_CrsmApduParaCheck: File Id error.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* <P1><P2><P3>?????????????????? */
    if ((0 == gastAtParaList[2].usParaLen)
        && (0 == gastAtParaList[3].usParaLen)
        && (0 == gastAtParaList[4].usParaLen))
    {
        return AT_SUCCESS;
    }

    /* <P1><P2><P3>???????????????????? */
    if ((0 != gastAtParaList[2].usParaLen)
        && (0 != gastAtParaList[3].usParaLen)
        && (0 != gastAtParaList[4].usParaLen))
    {
        return AT_SUCCESS;
    }

    /* ??????????????????AT?????????????? */
    return AT_CME_INCORRECT_PARAMETERS;

}

/********************************************************************
  Function:       At_CrsmFilePathParse
  Description:    ????CRSM??????????????????????
  Input:          ??
  Output:         *pstCommand??CRSM??????????????
  Return:          AT_SUCCESS??????????????????
  Others:
  History        : ---
  1.Date         : 2012-05-04
    Author       : h59254
    Modification : Created function
********************************************************************/
TAF_UINT32 At_CrsmFilePathParse(USIMM_RACCESS_REQ_STRU *pstCommand)
{
    TAF_UINT32                          ulResult;

    /* ???????????????????????????????????????????????????????????????????? */
    if (0 == gastAtParaList[6].usParaLen)
    {
        return AT_SUCCESS;
    }

    /* ????????????????????????????????4???????? */
    if (0 != (gastAtParaList[6].usParaLen % 4))
    {
        AT_ERR_LOG("At_CrsmFilePathParse: Path error");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    /*????????????????????????????????*/
    if(AT_FAILURE == At_AsciiNum2HexString(gastAtParaList[6].aucPara, &gastAtParaList[6].usParaLen))
    {
        AT_ERR_LOG("At_CrsmFilePathParse: At_AsciiNum2HexString error.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????????????ID??????????????????????????????????????????U16?????? */
    ulResult = At_CrsmFilePathCheck((TAF_UINT16)gastAtParaList[1].ulParaValue,
                                    gastAtParaList[6].aucPara,
                                    &gastAtParaList[6].usParaLen);

    if (AT_SUCCESS != ulResult)
    {
        AT_ERR_LOG("At_CrsmFilePathParse: At_CrsmFilePathCheck error.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????????????? */
    pstCommand->usPathLen   = gastAtParaList[6].usParaLen;

    /* ??????????????U16????????????????????????????2 */
    PS_MEM_CPY(pstCommand->ausPath, gastAtParaList[6].aucPara, (VOS_SIZE_T)(gastAtParaList[6].usParaLen*sizeof(VOS_UINT16)));

    return AT_SUCCESS;
}

/********************************************************************
  Function:       At_CrsmParaStatusCheck
  Description:    ????CRSM??????STATUS??????????????
  Input:          ??
  Output:         *pstCommand??CRSM??????????????
  Return:          AT_SUCCESS??????????????????
  Others:
  History        : ---
  1.Date         : 2012-05-04
    Author       : h59254
    Modification : Created function
********************************************************************/
TAF_UINT32 At_CrsmParaStatusCheck (USIMM_RACCESS_REQ_STRU *pstCommand)
{
    /* STATUS????????????????????ID??????????????????????????????STATUS???? */
    if (0 == gastAtParaList[1].ulParaValue)
    {
        pstCommand->usEfId = VOS_NULL_WORD;
    }
    else
    {
        pstCommand->usEfId = (TAF_UINT16)gastAtParaList[1].ulParaValue;
    }

    /* ????????????????<P1><P2><P3>??????IE?? */
    pstCommand->ucP1        =   (TAF_UINT8)gastAtParaList[2].ulParaValue;
    pstCommand->ucP2        =   (TAF_UINT8)gastAtParaList[3].ulParaValue;
    pstCommand->ucP3        =   (TAF_UINT8)gastAtParaList[4].ulParaValue;
    pstCommand->enCmdType   =   USIMM_STATUS;

    return At_CrsmFilePathParse(pstCommand);
}

/********************************************************************
  Function:       At_CrsmParaReadBinaryCheck
  Description:    ????CRSM??????Read Binary??????????????
  Input:          ??
  Output:         *pstCommand??CRSM??????????????
  Return:          AT_SUCCESS??????????????????
  Others:
  History        : ---
  1.Date         : 2012-05-04
    Author       : h59254
    Modification : Created function
********************************************************************/
TAF_UINT32 At_CrsmParaReadBinaryCheck (USIMM_RACCESS_REQ_STRU *pstCommand)
{

    /* ????????????????<P1><P2><P3>??????IE?? */
    pstCommand->ucP1        =   (TAF_UINT8)gastAtParaList[2].ulParaValue;
    pstCommand->ucP2        =   (TAF_UINT8)gastAtParaList[3].ulParaValue;
    pstCommand->ucP3        =   (TAF_UINT8)gastAtParaList[4].ulParaValue;
    pstCommand->usEfId      =   (TAF_UINT16)gastAtParaList[1].ulParaValue;
    pstCommand->enCmdType   =   USIMM_READ_BINARY;

    /* ?????????????????????????????????? */
    return At_CrsmFilePathParse(pstCommand);
}


/********************************************************************
  Function:       At_CrsmParaReadBinaryCheck
  Description:    ????CRSM??????Read Record??????????
  Input:          ??
  Output:         *pstCommand??CRSM??????????????
  Return:         AT_SUCCESS??????????????????
  Others:
  History        : ---
  1.Date         : 2012-05-04
    Author       : h59254
    Modification : Created function
********************************************************************/
TAF_UINT32 At_CrsmParaReadRecordCheck(USIMM_RACCESS_REQ_STRU *pstCommand)
{

    /* ????????????????<P1><P2><P3>??????IE?? */
    pstCommand->ucP1        =   (TAF_UINT8)gastAtParaList[2].ulParaValue;
    pstCommand->ucP2        =   (TAF_UINT8)gastAtParaList[3].ulParaValue;
    pstCommand->ucP3        =   (TAF_UINT8)gastAtParaList[4].ulParaValue;
    pstCommand->usEfId      =   (TAF_UINT16)gastAtParaList[1].ulParaValue;
    pstCommand->enCmdType   =   USIMM_READ_RECORD;

    /* ?????????????????????????????????? */
    return At_CrsmFilePathParse(pstCommand);
}

/********************************************************************
  Function:       At_CrsmParaGetRspCheck
  Description:    ????CRSM??????Get Response????????????
  Input:
  Output:         *pstCommand??CRSM???????????????
  Return:         AT_SUCCESS??????????????????
  Others:
  History        : ---
  1.Date         : 2012-05-04
    Author       : h59254
    Modification : Created function
********************************************************************/
VOS_UINT32 At_CrsmParaGetRspCheck(USIMM_RACCESS_REQ_STRU *pstCommand)
{

    /* ????????????????2??????????????????????????ID */
    if (gucAtParaIndex < 2)
    {
        AT_ERR_LOG("At_CrsmParaGetRspCheck: Para less than 2.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????????<P1><P2><P3>??????IE?? */
    pstCommand->ucP1        =   (TAF_UINT8)gastAtParaList[2].ulParaValue;
    pstCommand->ucP2        =   (TAF_UINT8)gastAtParaList[3].ulParaValue;
    pstCommand->ucP3        =   (TAF_UINT8)gastAtParaList[4].ulParaValue;
    pstCommand->usEfId      =   (TAF_UINT16)gastAtParaList[1].ulParaValue;
    pstCommand->enCmdType   =   USIMM_GET_RESPONSE;

    /* ?????????????????????????????????? */
    return At_CrsmFilePathParse(pstCommand);
}

/********************************************************************
  Function:       At_CrsmParaUpdateBinaryCheck
  Description:    ????CRSM??????Update Binary????????
  Input:          ??
  Output:         *pstCommand??CRSM??????????????
  Return:         AT_SUCCESS??????????????????
  Others:
  History        : ---
  1.Date         : 2012-05-04
    Author       : h59254
    Modification : Created function
********************************************************************/
VOS_UINT32 At_CrsmParaUpdateBinaryCheck (USIMM_RACCESS_REQ_STRU *pstCommand)
{

    /* Update Binary????????????6???????????????????????? */
    if (gucAtParaIndex < 6)
    {
        AT_ERR_LOG("At_CrsmParaUpdateBinaryCheck: Para less than 6.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????????<P1><P2><P3>??????IE?? */
    pstCommand->ucP1        =   (TAF_UINT8)gastAtParaList[2].ulParaValue;
    pstCommand->ucP2        =   (TAF_UINT8)gastAtParaList[3].ulParaValue;
    pstCommand->ucP3        =   (TAF_UINT8)gastAtParaList[4].ulParaValue;
    pstCommand->usEfId      =   (TAF_UINT16)gastAtParaList[1].ulParaValue;
    pstCommand->enCmdType   =   USIMM_UPDATE_BINARY;

    /* ????????????????<data>????????????????????????????2??????????????0 */
    if ((0 != (gastAtParaList[5].usParaLen % 2))
        || (0 == gastAtParaList[5].usParaLen))
    {
        AT_ERR_LOG("At_CrsmParaUpdateBinaryCheck: <data> error.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(AT_FAILURE == At_AsciiNum2HexString(gastAtParaList[5].aucPara, &gastAtParaList[5].usParaLen))
    {
        AT_ERR_LOG("At_CrsmParaUpdateBinaryCheck: At_AsciiNum2HexString fail.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<data>??????????<data>??????????????P3????????????????????<data>????????????P3???????? */
    PS_MEM_CPY((TAF_VOID*)pstCommand->aucContent,
               (TAF_VOID*)gastAtParaList[5].aucPara,
               gastAtParaList[5].usParaLen);

    return At_CrsmFilePathParse(pstCommand);
}

/********************************************************************
  Function:       At_CrsmParaUpdateRecordCheck
  Description:    ????CRSM??????????????
  Input:          ??
  Output:         *pstCommand??CRSM??????????????
  Return:         AT_SUCCESS??????????????????
  Others:
  History        : ---
  1.Date         : 2012-05-04
    Author       : h59254
    Modification : Created function
********************************************************************/
VOS_UINT32 At_CrsmParaUpdateRecordCheck (USIMM_RACCESS_REQ_STRU *pstCommand)
{

    /* Update Binary????????????6???????????????????????? */
    if (gucAtParaIndex < 6)
    {
        AT_ERR_LOG("At_CrsmParaUpdateRecordCheck: Para less than 6.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????????<P1><P2><P3>??????IE?? */
    pstCommand->ucP1        =   (TAF_UINT8)gastAtParaList[2].ulParaValue;
    pstCommand->ucP2        =   (TAF_UINT8)gastAtParaList[3].ulParaValue;
    pstCommand->ucP3        =   (TAF_UINT8)gastAtParaList[4].ulParaValue;
    pstCommand->usEfId      =   (TAF_UINT16)gastAtParaList[1].ulParaValue;
    pstCommand->enCmdType   =   USIMM_UPDATE_RECORD;

     /* ????????????????<data>????????????????????2??????????????0 */
    if ((0 != (gastAtParaList[5].usParaLen % 2))
        || (0 == gastAtParaList[5].usParaLen))
    {
        AT_ERR_LOG("At_CrsmParaUpdateRecordCheck: <data> error.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(AT_FAILURE == At_AsciiNum2HexString(gastAtParaList[5].aucPara, &gastAtParaList[5].usParaLen))
    {
        AT_ERR_LOG("At_CrsmParaUpdateRecordCheck: At_AsciiNum2HexString fail.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<data>??????????<data>??????????????P3????????????????????<data>????????????P3???????? */
    PS_MEM_CPY((TAF_VOID*)pstCommand->aucContent,
               (TAF_VOID*)gastAtParaList[5].aucPara,
               gastAtParaList[5].usParaLen);

    return At_CrsmFilePathParse(pstCommand);
}

/*****************************************************************************
 Prototype      : At_SetCrsmPara
 Description    : +CRSM=<command>[,<fileid>[,<P1>,<P2>,<P3>[,<data>,<pathid>]]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2008-03-02
    Author      : h59254
    Modification: Created function
  2.Date        : 2012-05-05
    Author      : h59254
    Modification: ??????????????????????
*****************************************************************************/
TAF_UINT32 At_SetCrsmPara(TAF_UINT8 ucIndex)
{
    USIMM_RACCESS_REQ_STRU              stCommand;
    TAF_UINT32                          ulResult;

    /* ???????? */
    if (gucAtParaIndex > 7)
    {
        AT_ERR_LOG("At_SetCrsmPara: too many para");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????????<P1><P2><P3>?????????????????????????????? */
    if (AT_SUCCESS != At_CrsmApduParaCheck())
    {
       AT_ERR_LOG("At_SetCrsmPara: At_CrsmApduParaCheck fail.");

       return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????? */
    PS_MEM_SET(&stCommand, 0x00, sizeof(USIMM_RACCESS_REQ_STRU));

    switch(gastAtParaList[0].ulParaValue)
    {
        case USIMM_STATUS:
            ulResult = At_CrsmParaStatusCheck(&stCommand);
            break;
        case USIMM_READ_BINARY:
            ulResult = At_CrsmParaReadBinaryCheck(&stCommand);
            break;
        case USIMM_READ_RECORD:
            ulResult = At_CrsmParaReadRecordCheck(&stCommand);
            break;
        case USIMM_GET_RESPONSE:
            ulResult = At_CrsmParaGetRspCheck(&stCommand);
            break;
        case USIMM_UPDATE_BINARY:
            ulResult = At_CrsmParaUpdateBinaryCheck(&stCommand);
            break;
        case USIMM_UPDATE_RECORD:
            ulResult = At_CrsmParaUpdateRecordCheck(&stCommand);
            break;
        default:
            return AT_CME_INCORRECT_PARAMETERS;
    }

    if (AT_SUCCESS != ulResult )
    {
        AT_ERR_LOG("At_SetCrsmPara: para parse fail");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if(AT_SUCCESS == Taf_UsimRestrictedAccessCommand(gastAtClientTab[ucIndex].usClientId, 0,&stCommand))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CRSM_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}


/*****************************************************************************
 Prototype      : At_CheckCpinPara
 Description    : ??+cpin??^cpin????????????
 Input          : ??
 Output         : ??
 Return Value   : AT_XXX  --- ATC??????

 History        : ---
  1.Date        : 2011-03-28
    Author      : j00168360
    Modification: Created function

  2.??    ??   : 2012??04??16??
    ??    ??   : l00198894
    ????????   : AP-Modem???????????? ????AP-Modem????????????

*****************************************************************************/
TAF_UINT32 At_CheckCpinPara(VOS_VOID)
{
    VOS_UINT8                          *pucSystemAppConfig;

    pucSystemAppConfig                  = AT_GetSystemAppConfigAddr();


    /* ???????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (gucAtParaIndex > 2)
    {
        return AT_TOO_MANY_PARA;
    }

    /* ????<pin>???????????????????????? */
    if ( (TAF_PH_PINCODELENMAX < gastAtParaList[0].usParaLen)
      || (TAF_PH_PINCODELENMIN > gastAtParaList[0].usParaLen) )
    {
        if (SYSTEM_APP_ANDROID != *pucSystemAppConfig)
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
        else
        {
            /* AP-MODEM????????????????????1??, ????????????????????16 */
            if ( (TAF_PH_UNLOCKCODELEN != gastAtParaList[0].usParaLen)
              || (1 != gucAtParaIndex) )
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }
        }
    }

    /* ????????????????<newpin>???????????????????????? */
    if (2 == gucAtParaIndex)
    {
        if ( (TAF_PH_PINCODELENMAX < gastAtParaList[1].usParaLen)
          || (TAF_PH_PINCODELENMIN > gastAtParaList[1].usParaLen) )
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
    }

    return AT_SUCCESS;

}

/*****************************************************************************
 Prototype      : At_SetCpinPara
 Description    : +CPIN=<pin>[,<newpin>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
  3.??    ??   : 2009-10-16
    ??    ??   : h44270
    ????????   : ????????: AT2D15084,????3??PIN??????????OK
  4.??    ??   : 2009-10-22
    ??    ??   : h44270
    ????????   : ????????: AT2D15221,??pin??????
  5.??    ??   : 2011??11??3??
    ??    ??   : c00173809
    ????????   : AT ????????,AT^CPIN????????????????
*****************************************************************************/
TAF_UINT32 At_SetCpinPara(TAF_UINT8 ucIndex)
{
    TAF_UINT32                          ulResult;
    MN_PH_SET_CPIN_REQ_STRU             stSetCPinReq;

    /* ???????? */
    ulResult = At_CheckCpinPara();
    if(AT_SUCCESS != ulResult)
    {
        return ulResult;
    }

    stSetCPinReq.usPara0Len = gastAtParaList[0].usParaLen;
    stSetCPinReq.usPara1Len = gastAtParaList[1].usParaLen;
    PS_MEM_CPY((VOS_VOID*)stSetCPinReq.aucPara0,(VOS_VOID*)gastAtParaList[0].aucPara,stSetCPinReq.usPara0Len);
    PS_MEM_CPY((VOS_VOID*)stSetCPinReq.aucPara1,(VOS_VOID*)gastAtParaList[1].aucPara,stSetCPinReq.usPara1Len);


    /* ????TAF_MSG_MMA_SET_PIN ??????????CPIN */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      At_GetOpId(),
                                      TAF_MSG_MMA_SET_PIN,
                                      (VOS_VOID*)&stSetCPinReq,
                                      sizeof(stSetCPinReq),
                                      I0_WUEPS_PID_MMA);

    if(AT_SUCCESS == ulResult)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_MSG_MMA_SET_PIN;
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;

}
/*****************************************************************************
 Prototype      : At_SetCpin2Para
 Description    : +CPIN2=<pin>[,<newpin>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
*****************************************************************************/
TAF_UINT32 At_SetCpin2Para(TAF_UINT8 ucIndex)
{
    TAF_PH_PIN_DATA_STRU stPinData;
    TAF_UINT32           ulResult;

    /* ???????? */
    ulResult = At_CheckCpinPara();
    if(AT_SUCCESS != ulResult)
    {
        return ulResult;
    }

    /* ?????? */
    /* PS_MEM_SET(&stPinData,0x00,sizeof(stPinData)); */
    SI_PB_MemSet(sizeof(stPinData), 0xFF, (VOS_UINT8*)&stPinData);

    /* ????<pin> */
    if(0 != gastAtParaList[0].usParaLen)
    {
        PS_MEM_CPY((TAF_VOID*)stPinData.aucOldPin,(TAF_VOID*)gastAtParaList[0].aucPara,gastAtParaList[0].usParaLen);
    }

    /* ????<newpin> */
    if(0 != gastAtParaList[1].usParaLen)
    {
        PS_MEM_CPY((TAF_VOID*)stPinData.aucNewPin,(TAF_VOID*)gastAtParaList[1].aucPara,gastAtParaList[1].usParaLen);
    }

    /* ????CmdType */
    if(0 == gastAtParaList[1].usParaLen)
    {
        stPinData.PinType = TAF_SIM_PIN2;
        stPinData.CmdType = TAF_PIN_VERIFY;
    }
    else
    {
        stPinData.PinType = TAF_SIM_PUK2;
        stPinData.CmdType = TAF_PIN_UNBLOCK;
    }

    /* ???????????? */
    if(AT_SUCCESS == Taf_PhonePinHandle(gastAtClientTab[ucIndex].usClientId, 0,&stPinData))
    {
        /* ???????????????? */
        if(0 == gastAtParaList[1].usParaLen)
        {
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPIN2_VERIFY_SET;
        }
        else
        {
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPIN2_UNBLOCK_SET;
        }
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 Prototype      : At_SetIccidPara
 Description    : ^ICCID
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetIccidPara(TAF_UINT8 ucIndex)
{
    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????????????????AT_OK */
    return AT_OK;
}

/*******************************************************************************
*Function   : At_SetPNNPara
*Description: ????????????????????????AT????????????????????Taf_ParaQuery????????
              ??AT????????????????Taf_ParaQuery??OpId??????0xFF??????????PNN??????
              ????????
*Input      :
*Output     :
*Return     : TAF_UINT32
*Others     :
*History    :
  1.Date        : 2008-03-03
    Author      : h59254
    Modification: Created function
  2.??    ?? : 2013-09-05
    ??    ?? : l00208543
    ???????? : DTS2013090309526??????A????????????????????????????PNN LIST????????????????
********************************************************************************/
TAF_UINT32 At_SetPNNPara(TAF_UINT8 ucIndex)
{
    TAF_PH_QRY_USIM_INFO_STRU           stUsimInfo;

    PS_MEM_SET(&stUsimInfo, 0x00, sizeof(stUsimInfo));

    /* ???????? */
    if(0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if((0 != gastAtParaList[0].ulParaValue)
        &&(1 != gastAtParaList[0].ulParaValue))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }
    if (0 == gastAtParaList[0].ulParaValue)
    {
        stUsimInfo.Icctype = TAF_PH_ICC_SIM;
    }
    else
    {
        stUsimInfo.Icctype = TAF_PH_ICC_USIM;
    }
    stUsimInfo.enEfId = TAF_PH_PNN_FILE;
    /*linear fixed file only support 254 reocrd*/
    if(0 != gastAtParaList[1].usParaLen)
    {
        if( (gastAtParaList[1].ulParaValue > 0xFE)
         || (gastAtParaList[1].ulParaValue == 0))
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
        else
        {
            stUsimInfo.ulRecNum = gastAtParaList[1].ulParaValue;
        }
    }
    else
    {
        stUsimInfo.ulRecNum = 0;

        /* ??????PNN??????????????????????????????????TAF_MMA_PNN_INFO_MAX_NUM??????????A?????????????????????? */
        stUsimInfo.stPnnQryIndex.usPnnCurrIndex = 0;   /* ??????????????????Index??0????????????TAF??CNF?????????????????????????? */
        stUsimInfo.stPnnQryIndex.usPnnNum       = TAF_MMA_PNN_INFO_MAX_NUM;
    }

    /* ???????????? */
    if(AT_SUCCESS == TAF_QryUsimInfo(gastAtClientTab[ucIndex].usClientId,0,&stUsimInfo))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_PNN_READ;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*******************************************************************************
*Function   : At_SetCPNNPara
*Description: ????????????????????????AT????????????????????Taf_ParaQuery????????
              ??AT??????????.
*Input      :
*Output     :
*Return     : TAF_UINT32
*Others     :
*History    :
  1.??    ??   : 2009??09??12??
    ??    ??   : l00130025
    ????????   : ??????AT2D14435,^CPNN??????????
********************************************************************************/
TAF_UINT32 At_SetCPNNPara(TAF_UINT8 ucIndex)
{
    TAF_PH_ICC_TYPE                     IccType;

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if((0 != gastAtParaList[0].ulParaValue)
        &&(1 != gastAtParaList[0].ulParaValue))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }
    if (0 == gastAtParaList[0].ulParaValue)
    {
        IccType = TAF_PH_ICC_SIM;
    }
    else
    {
        IccType = TAF_PH_ICC_USIM;
    }

    /* ???????????? */
    if(AT_SUCCESS == TAF_QryCpnnInfo(gastAtClientTab[ucIndex].usClientId,0,IccType))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPNN_READ;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*******************************************************************************
*Function   : At_SetOPLPara
*Description: ????????????????????????AT????????????????????Taf_ParaQuery????????
              ??AT????????????????Taf_ParaQuery??OpId??????0xFF??????????OPL??????
              ????????
*Input      :
*Output     :
*Return     : TAF_UINT32
*Others     :
*History    :
  1.Date        : 2008-03-06
    Author      : h59254
    Modification: Created function
********************************************************************************/
TAF_UINT32 At_SetOPLPara (TAF_UINT8 ucIndex)
{
    TAF_PH_QRY_USIM_INFO_STRU           stUsimInfo;

    /* ???????? */
    if(0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if((0 != gastAtParaList[0].ulParaValue)
        &&(1 != gastAtParaList[0].ulParaValue))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (0 == gastAtParaList[0].ulParaValue)
    {
        stUsimInfo.Icctype = TAF_PH_ICC_SIM;
    }
    else
    {
        stUsimInfo.Icctype = TAF_PH_ICC_USIM;
    }
    stUsimInfo.enEfId = TAF_PH_OPL_FILE;
    /*linear fixed file only support 254 reocrd*/
    if((0 != gastAtParaList[1].usParaLen))
    {
        if((gastAtParaList[1].ulParaValue > 0xFE)
        || (gastAtParaList[1].ulParaValue == 0))
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
        else
        {
            stUsimInfo.ulRecNum = gastAtParaList[1].ulParaValue;
        }
    }
    else
    {
        stUsimInfo.ulRecNum = 0;
    }

    /* ???????????? */
    if(AT_SUCCESS == TAF_QryUsimInfo(gastAtClientTab[ucIndex].usClientId,0,&stUsimInfo))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_OPL_READ;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }

}
/*****************************************************************************
 Prototype      : At_SetCardlockPara
 Description    : ^CARDLOCK
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2008-03-15
    Author      : luojian
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetCardlockPara(TAF_UINT8 ucIndex)
{
    TAF_ME_PERSONALISATION_DATA_STRU    stMePersonalisationData;

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* <unlock_code>????????????8???????????? */
    if( TAF_PH_ME_PERSONALISATION_PWD_LEN_MAX == gastAtParaList[0].usParaLen)
    {
        if ( AT_FAILURE == At_CheckNumString(gastAtParaList[0].aucPara,
                                             TAF_PH_ME_PERSONALISATION_PWD_LEN_MAX)
           )
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
        else
        {
            PS_MEM_SET( &stMePersonalisationData,0,sizeof(TAF_ME_PERSONALISATION_DATA_STRU) );
            /* ?????????????? */
            PS_MEM_CPY( stMePersonalisationData.aucOldPwd,
                        gastAtParaList[0].aucPara,
                        TAF_PH_ME_PERSONALISATION_PWD_LEN_MAX);
        }
    }
    else
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }
    /* ?????????????????????? */
    stMePersonalisationData.CmdType        = TAF_ME_PERSONALISATION_VERIFY;
    /* ???????????????? */
    stMePersonalisationData.MePersonalType = TAF_OPERATOR_PERSONALISATION;
     /* ???????????? */
    if(AT_SUCCESS == Taf_MePersonalisationHandle(gastAtClientTab[ucIndex].usClientId, 0,&stMePersonalisationData))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CARD_LOCK_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_FillSsBsService
 ????????  : ????AT????????????TAF_SS_ERASESS_REQ_STRU??????BsService????
 ????????  : AT_PARSE_PARA_TYPE_STRU   *pstAtPara    -- AT????CLASS????
 ????????  : TAF_SS_ERASESS_REQ_STRU   *pstSSPara    -- ??????????????SS??????
 ?? ?? ??  : VOS_OK     -- ????????????
             VOS_ERR    -- ????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??12??31??
    ??    ??   : l00198894
    ????????   : ????+CLCK??????????????????????

*****************************************************************************/
VOS_UINT32 AT_FillSsBsService(
    TAF_SS_ERASESS_REQ_STRU            *pstSSPara,
    AT_PARSE_PARA_TYPE_STRU            *pstAtPara
)
{
    if ( (0 == pstAtPara->usParaLen )
      || (AT_CLCK_PARA_CLASS_ALL == pstAtPara->ulParaValue) )
    {
        /* ?????? */
        pstSSPara->OP_BsService = 0;
    }
    else
    {
        if(AT_FAILURE == At_SsPrint2Class(&(pstSSPara->BsService),
                                          (VOS_UINT8)pstAtPara->ulParaValue))
        {
            return VOS_ERR;
        }
        pstSSPara->OP_BsService = 1;
    }

    return VOS_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_FillSsNoRepCondTime
 ????????  : ????AT????????????TAF_SS_REGISTERSS_REQ_STRU??????NoRepCondTime????
 ????????  : ucSsCode                                     -- SS??????
             AT_PARSE_PARA_TYPE_STRU        *pstAtPara    -- AT????CLASS????
 ????????  : TAF_SS_REGISTERSS_REQ_STRU     *pstSSPara    -- ??????????????SS??????
 ?? ?? ??  : VOS_OK     -- ????????????
             VOS_ERR    -- ????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??6??12??
    ??    ??   : w00176964
    ????????   : ????????

*****************************************************************************/
VOS_UINT32 AT_FillSsNoRepCondTime(
    VOS_UINT8                           ucSsCode,
    AT_PARSE_PARA_TYPE_STRU            *pstAtPara,
    TAF_SS_REGISTERSS_REQ_STRU         *pstSSPara
)
{
    if ((TAF_ALL_FORWARDING_SS_CODE      == ucSsCode)
     || (TAF_ALL_COND_FORWARDING_SS_CODE == ucSsCode)
     || (TAF_CFNRY_SS_CODE               == ucSsCode))
    {
        if (pstAtPara->usParaLen)
        {
            pstSSPara->OP_NoRepCondTime = 1;
            pstSSPara->NoRepCondTime    = (TAF_SS_NOREPLYCONDITIONTIME)pstAtPara->ulParaValue;
        }
        else
        {
            /* ?????? */
            pstSSPara->OP_NoRepCondTime = 1;
            pstSSPara->NoRepCondTime    = 20;
        }
    }

    return VOS_OK;
}

/*****************************************************************************
 Prototype      : At_SetCcwaPara
 Description    : +CCWA=[<n>[,<mode>[,<class>]]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??    : 2007??01??11??
    ??    ??    : d49431
    ????????    : ??????A32D08327
  3.Date        : 2007-11-07
    Author      : F62575
    Modification: ??????A32D13382(????????????????)
  4.??    ??   : 2010-09-19
    ??    ??   : z00161729
    ????????   : DTS2010092001723??VP??????????CCFC??CCWA??CLCK????
  5.??    ??   : 2012??12??29??
    ??    ??   : l00198894
    ????????   : DTS2012122900551: ????+CLCK??????????????????????
  6.??    ??   : 2013??2??21??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCcwaPara(TAF_UINT8 ucIndex)
{
    TAF_SS_ERASESS_REQ_STRU             para;
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, Begin */
    AT_MODEM_SS_CTX_STRU               *pstSsCtx = VOS_NULL_PTR;

    pstSsCtx = AT_GetModemSsCtxAddrFromClientId(ucIndex);
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, End */

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 3)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????? */
    PS_MEM_SET(&para,0x00,sizeof(para));

    /* ????SsCode */
    para.SsCode = TAF_CW_SS_CODE;

    /* Modified by l60609 for DSDA Phase III, 2013-2-21, Begin */
    /* ????<n> */
    if(0 != gastAtParaList[0].usParaLen)
    {
        pstSsCtx->ucCcwaType = (AT_CCWA_TYPE)gastAtParaList[0].ulParaValue;
    }
    else
    {
        pstSsCtx->ucCcwaType = AT_CCWA_DISABLE_TYPE;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, End */

    if(0 == gastAtParaList[1].usParaLen)
    {
        return AT_OK;
    }

    /* ????<class> */
    if (VOS_OK != AT_FillSsBsService(&para, &gastAtParaList[2]))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    switch(gastAtParaList[1].ulParaValue)
    {
    case 0: /* disable */
        if(AT_SUCCESS == TAF_DeactivateSSReq(gastAtClientTab[ucIndex].usClientId, 0,&para))
        {
            /* ???????????????? */
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CCWA_DISABLE;
            return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
        }
        else
        {
            return AT_ERROR;
        }

    case 1: /* enable */
        if(AT_SUCCESS == TAF_ActivateSSReq(gastAtClientTab[ucIndex].usClientId, 0,&para))
        {
            /* ???????????????? */
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CCWA_ENABLE;
            return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
        }
        else
        {
            return AT_ERROR;
        }

    default: /* query status */
        gastAtClientTab[ucIndex].ulTemp = gastAtParaList[2].ulParaValue;
        para.OP_BsService = 0;
        if(AT_SUCCESS == TAF_InterrogateSSReq(gastAtClientTab[ucIndex].usClientId, 0,&para))
        {
            /* ???????????????? */
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CCWA_QUERY;
            return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
        }
        else
        {
            return AT_ERROR;
        }
    }
}

/*****************************************************************************
?? ?? ??  : AT_CheckCcfcParaValid
????????  : ????AT????AT+CFCC??????????????
????????  : ??
????????  : ??
?? ?? ??  : VOS_UINT32
????????  :
????????  :

????????      :
1.??    ??   : 2010??1??19??
??    ??   : ???? \ z40661
????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_CheckCcfcParaValid( VOS_VOID  )
{

    /* ???????? */
    if ( (0 == gastAtParaList[0].usParaLen)
        || (0 == gastAtParaList[1].usParaLen) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( gucAtParaIndex > 8 )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<number>?????????????????? */
    if ( gastAtParaList[2].usParaLen > TAF_SS_MAX_FORWARDED_TO_NUM_LEN )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<subaddr>?????????????????? */
    if ( gastAtParaList[5].usParaLen > TAF_SS_MAX_FORWARDED_TO_SUBADDRESS_LEN )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????NUM?????????????? */
    if ( 0 != gastAtParaList[2].usParaLen )
    {
        if( AT_FAILURE == At_CheckDialString(gastAtParaList[2].aucPara,
            gastAtParaList[2].usParaLen) )
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
    }

    /* ????SubAddress?????????????? */
    if ( 0 != gastAtParaList[5].usParaLen )
    {
        if( AT_FAILURE == At_CheckDialString(gastAtParaList[5].aucPara,
            gastAtParaList[5].usParaLen) )
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
    }

    return AT_OK;
}

/*****************************************************************************
?? ?? ??  : AT_GetSsCodeFromCfccPara
????????  : ????????AT??????????SsCode
????????  : VOS_UINT32
ulPara
????????  : ??
?? ?? ??  : TAF_SS_CODE
????????  :
????????  :

????????      :
1.??    ??   : 2010??1??19??
??    ??   : ???? \ z40661
????????   : ??????????

*****************************************************************************/
TAF_SS_CODE AT_GetSsCodeFromCfccPara( VOS_VOID  )
{
    TAF_SS_CODE                         ssCode;

    /* ????SsCode */
    switch( gastAtParaList[0].ulParaValue )
    {
    case 0:
        ssCode = TAF_CFU_SS_CODE;
        break;

    case 1:
        ssCode = TAF_CFB_SS_CODE;
        break;

    case 2:
        ssCode = TAF_CFNRY_SS_CODE;
        break;

    case 3:
        ssCode = TAF_CFNRC_SS_CODE;
        break;

    case 4:
        ssCode = TAF_ALL_FORWARDING_SS_CODE;
        break;

    default:
        ssCode = TAF_ALL_COND_FORWARDING_SS_CODE;
        break;
    }

    return ssCode;
}

/*****************************************************************************
?? ?? ??  : AT_SetNumAttribute
????????  : ??????????????????
????????  : ??
????????  : ??
?? ?? ??  : VOS_VOID
????????  :
????????  :

????????      :
1.??    ??   : 2010??1??19??
??    ??   : ???? \ z40661
????????   : ??????????
 2.??    ??   : 2013??05??28??
   ??    ??   : s46746
   ????????   : SS FDN&Call Control??????CCFC????????????????+????????BCD????????
*****************************************************************************/
VOS_VOID AT_SetNumAttribute(
    TAF_SS_NUMTYPE                      *pNumType,
    TAF_UINT8                           *pucFwdToNum
    )
{
    /* Modified by s46746 for SS FDN&Call Control, 2013-05-28, begin */
    /* +?????????????????????????????????????????????????????? */
    if ('+' == gastAtParaList[2].aucPara[0])
    {
        PS_MEM_CPY((TAF_CHAR*)pucFwdToNum,
            (TAF_CHAR*)(gastAtParaList[2].aucPara+1),
            (VOS_SIZE_T)(gastAtParaList[2].usParaLen-1));
    }
    else
    {
        PS_MEM_CPY((TAF_CHAR*)pucFwdToNum,
            (TAF_CHAR*)gastAtParaList[2].aucPara,
            gastAtParaList[2].usParaLen);
    }
    /* Modified by s46746 for SS FDN&Call Control, 2013-05-28, end */

    if( gastAtParaList[3].usParaLen )
    {
        *pNumType = (TAF_SS_NUMTYPE)gastAtParaList[3].ulParaValue;
    }
    else
    {
        *pNumType = At_GetCodeType(gastAtParaList[2].aucPara[0]);
    }
}

/*****************************************************************************
?? ?? ??  : AT_SetSubAddrAttribute
????????  : ????SubAddr??????
????????  : ??
????????  : ??
?? ?? ??  : VOS_VOID
????????  :
????????  :

????????      :
1.??    ??   : 2010??1??19??
??    ??   : ???? \ z40661
????????   : ??????????

*****************************************************************************/
VOS_VOID AT_SetSubAddrAttribute(
    TAF_SS_SUBADDRTYPE                  *pSubAddrType,
    TAF_UINT8                           *pucFwdToSubAddr
)
{
    PS_MEM_CPY((TAF_CHAR*)pucFwdToSubAddr,
        (TAF_CHAR*)gastAtParaList[5].aucPara,
        gastAtParaList[5].usParaLen);

    if( gastAtParaList[6].usParaLen )
    {
        *pSubAddrType = (TAF_UINT8)gastAtParaList[6].ulParaValue;
    }
    else
    {
        *pSubAddrType = 128;
    }

}

/*****************************************************************************
?? ?? ??  : AT_DeactivateSSReq
????????  : ??????????????????
????????  : ??
????????  : ??
?? ?? ??  : VOS_VOID
????????  :
????????  :

????????      :
1.??    ??   : 2010??1??19??
??    ??   : ???? \ z40661
????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_DeactivateSSReq(
    TAF_UINT8                           ucIndex,
    TAF_SS_ERASESS_REQ_STRU             *pstEraseReq
)
{
    if( AT_SUCCESS == TAF_DeactivateSSReq(gastAtClientTab[ucIndex].usClientId,
        0,
        pstEraseReq) )
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CCFC_DISABLE;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }

    return AT_ERROR;
}

/*****************************************************************************
?? ?? ??  : AT_ActivateSSReq
????????  : ????????????????
????????  : ??
????????  : ??
?? ?? ??  : VOS_UINT32
????????  :
????????  :

????????      :
1.??    ??   : 2010??1??19??
  ??    ??   : ???? \ z40661
  ????????   : ??????????

2.??    ??   : 2011??10??22??
  ??    ??   : o00132663
  ????????   : AT??????????????????????????????
3.??    ??   : 2013??01??30??
  ??    ??   : f62575
  ????????   : DTS2013013001894??????OP_LongFTN_Supported
*****************************************************************************/
VOS_UINT32 AT_ActivateSSReq(
    TAF_UINT8                           ucIndex,
    TAF_SS_ERASESS_REQ_STRU             *pstActivateReq
)
{
    if( AT_SUCCESS == TAF_ActivateSSReq(gastAtClientTab[ucIndex].usClientId,
        0,
        pstActivateReq) )
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CCFC_ENABLE;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }

    return AT_ERROR;
}

/*****************************************************************************
?? ?? ??  : AT_InterrogateSSReq
????????  : ????????????????????
????????  : ??
????????  : ??
?? ?? ??  :
????????  :
????????  :

????????      :
1.??    ??   : 2010??1??19??
  ??    ??   : ???? \ z40661
  ????????   : ??????????

2.??    ??   : 2011??10??22??
  ??    ??   : o00132663
  ????????   : AT??????????????????????????????
3.??    ??   : 2012??08??13??
  ??    ??   : l65478
  ????????   : DTS2012080303098,????????IE longFtn??,????????
*****************************************************************************/
VOS_UINT32  AT_InterrogateSSReq(
    TAF_UINT8                           ucIndex,
    TAF_SS_ERASESS_REQ_STRU             *pstInterrogateReq
)
{
    gastAtClientTab[ucIndex].ulTemp = gastAtParaList[4].ulParaValue;

    if ( AT_SUCCESS == TAF_InterrogateSSReq(gastAtClientTab[ucIndex].usClientId,
        0,
        pstInterrogateReq) )
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CCFC_QUERY;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }

    return AT_ERROR;
}

/*****************************************************************************
?? ?? ??  : AT_RegisterSSReq
????????  : ????????????????????
????????  : ??
????????  : ??
?? ?? ??  : VOS_UINT32
????????  :
????????  :

????????      :
1.??    ??   : 2010??1??19??
  ??    ??   : ???? \ z40661
  ????????   : ??????????

2.??    ??   : 2011??10??22??
  ??    ??   : o00132663
  ????????   : AT??????????????????????????????
3.??    ??   : 2013??01??30??
  ??    ??   : f62575
  ????????   : DTS2013013001894??????OP_LongFTN_Supported
*****************************************************************************/
VOS_UINT32 AT_RegisterSSReq(
    TAF_UINT8                           ucIndex,
    TAF_SS_REGISTERSS_REQ_STRU          *pstRegisterReq
)
{
    if ( AT_SUCCESS == TAF_RegisterSSReq(gastAtClientTab[ucIndex].usClientId,
        0,
        pstRegisterReq) )
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CCFC_REGISTRATION;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }

    return AT_ERROR;
}

/*****************************************************************************
?? ?? ??  : AT_EraseSSReq
????????  : ????????????????????
????????  : ??
????????  : ??
?? ?? ??  : VOS_UINT32
????????  :
????????  :

????????      :
1.??    ??   : 2010??1??19??
??    ??   : ???? \ z40661
????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_EraseSSReq(
    TAF_UINT8                           ucIndex,
    TAF_SS_ERASESS_REQ_STRU             *pstEraseSSReq
)
{
    if ( AT_SUCCESS == TAF_EraseSSReq(gastAtClientTab[ucIndex].usClientId,
        0,
        pstEraseSSReq) )
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CCFC_ERASURE;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }

    return AT_ERROR;
}

/*****************************************************************************
 Prototype      : At_SetCcfcPara
 Description    : +CCFC=<reason>,<mode>[,<number>[,<type>
                        [,<class>[,<subaddr>[,<satype>[,<time>]]]]]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
  3.Date        : 2007-11-07
    Author      : F62575
    Modification: ??????A32D13382(????????????????)
  4.??    ??   : 2010??1??19??
    ??    ??   : ???? \ z40661
    ????????   : NAS R7????????????????????
  5.??    ??   : 2010-09-19
    ??    ??   : z00161729
    ????????  : DTS2010092001723??VP??????????CCFC??CCWA??CLCK????
  6.??    ??   : 2012??12??29??
    ??    ??   : l00198894
    ????????   : DTS2012122900551: ????+CLCK??????????????????????
  7.??    ??   : 2013??6??1??
    ??    ??   : w00176964
    ????????   : SS FDN&Call Control????:??????????????????????????????????T??
*****************************************************************************/
TAF_UINT32 At_SetCcfcPara(TAF_UINT8 ucIndex)
{
    TAF_SS_REGISTERSS_REQ_STRU          para;
    TAF_SS_ERASESS_REQ_STRU             sndpara;
    VOS_UINT32                          ulRet;

    ulRet = AT_CheckCcfcParaValid();
    if ( AT_OK != ulRet )
    {
        return ulRet;
    }

    /* ?????? */
    PS_MEM_SET(&para,0x00,sizeof(para));
    PS_MEM_SET(&sndpara,0x00,sizeof(sndpara));

    para.SsCode = AT_GetSsCodeFromCfccPara();

    /* ????<number>,<type> */
    if ( 0 != gastAtParaList[2].usParaLen )
    {
        para.OP_FwdToNum = 1;
        para.OP_NumType  = 1;
        AT_SetNumAttribute(&para.NumType,para.aucFwdToNum);
    }
    else
    {
        para.OP_FwdToNum = 0;
        para.OP_NumType  = 0;
    }

    /* ????<subaddr>,<satype> */
    if ( 0 != gastAtParaList[5].usParaLen )
    {
        para.OP_FwdToAddr = 1;
        para.OP_SubAddrType = 1;
        AT_SetSubAddrAttribute(&(para.SubAddrType), para.aucFwdToSubAddr);
    }
    else
    {
        para.OP_FwdToAddr   = 0;
        para.OP_SubAddrType = 0;
    }

    /* ????<time> */
    AT_FillSsNoRepCondTime(para.SsCode, &gastAtParaList[7], &para);

    /* ????<class> */
    if (VOS_OK != AT_FillSsBsService(&sndpara, &gastAtParaList[4]))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    sndpara.SsCode    = para.SsCode;

    if (VOS_TRUE == sndpara.OP_BsService)
    {
        para.OP_BsService               = sndpara.OP_BsService;
        para.BsService.BsType           = sndpara.BsService.BsType;
        para.BsService.BsServiceCode    = sndpara.BsService.BsServiceCode;
    }

    /* ???????????? */
    switch(gastAtParaList[1].ulParaValue)
    {
    case 0: /* <mode>: disable */
        ulRet = AT_DeactivateSSReq(ucIndex,&sndpara);
        break;

    case 1: /* <mode>: enable */
        ulRet = AT_ActivateSSReq(ucIndex,&sndpara);
        break;

    case 2: /* <mode>: query status */
        ulRet = AT_InterrogateSSReq(ucIndex,&sndpara);
        break;

    case 3: /* <mode>: registration */
        ulRet = AT_RegisterSSReq(ucIndex,&para);
        break;

    default:    /* <mode>: erasure */
        ulRet = AT_EraseSSReq(ucIndex,&sndpara);
        break;
    }

    return ulRet;
}


/*****************************************************************************
 Prototype      : At_SetCmlckPara
 Description    : +CLCK=<fac>,<action>[,<passwd>[,<data>]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2007-10-06
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetCmlckPara (TAF_UINT8 ucIndex)
{
    TAF_UINT32 ulresult;


    /* ???????? */
    if((0 == gastAtParaList[0].usParaLen) || (0 == gastAtParaList[1].usParaLen))

    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 4)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    switch(gastAtParaList[0].ulParaValue)
    {
        case AT_CMLCK_PS_TYPE:
        {
            TAF_ME_PERSONALISATION_DATA_STRU stMePersonalisationData;

            if(TAF_PH_PINCODELENMAX < gastAtParaList[2].usParaLen)
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }

            /* ?????? */
            PS_MEM_SET(&stMePersonalisationData,0x00,sizeof(TAF_ME_PERSONALISATION_DATA_STRU));

            /* ????<passwd> */
            if(0 != gastAtParaList[2].usParaLen)
            {
                PS_MEM_CPY((TAF_CHAR*)stMePersonalisationData.aucOldPwd,(VOS_CHAR*)gastAtParaList[2].aucPara,gastAtParaList[2].usParaLen);
            }

            /* ????PinType */
            stMePersonalisationData.MePersonalType = TAF_SIM_PERSONALISATION;

            if(0 != gastAtParaList[3].usParaLen)
            {
                ulresult = At_AsciiNum2Num(stMePersonalisationData.unMePersonalisationSet.SimPersionalisationStr.aucSimPersonalisationStr,
                                           gastAtParaList[3].aucPara,
                                           gastAtParaList[3].usParaLen);
                if (AT_SUCCESS != ulresult)
                {
                    return AT_CME_INCORRECT_PARAMETERS;
                }
                /*
                At_AsciiNum2HexString(gastAtParaList[3].aucPara,&gastAtParaList[3].usParaLen);
                PS_MEM_CPY((VOS_CHAR*)stMePersonalisationData.unMePersonalisationSet.aucSimPersonalisationStr,
                          (VOS_CHAR*)gastAtParaList[3].aucPara,
                          gastAtParaList[3].usParaLen);
                */
                stMePersonalisationData.unMePersonalisationSet.SimPersionalisationStr.DataLen= (VOS_UINT8)gastAtParaList[3].usParaLen;
            }


            /* ????CmdType */
            switch(gastAtParaList[1].ulParaValue)
            {
            case 0:
                if ((15 < gastAtParaList[3].usParaLen) || (0 == gastAtParaList[3].usParaLen))
                {
                    return AT_CME_INCORRECT_PARAMETERS;
                }
                stMePersonalisationData.CmdType = TAF_ME_PERSONALISATION_SET;

                break;

            case 1:
                stMePersonalisationData.CmdType = TAF_ME_PERSONALISATION_RETRIEVE;

                break;

            default:
                return AT_CME_INCORRECT_PARAMETERS;
            }

            /* ???????????? */
            if(AT_SUCCESS == Taf_MePersonalisationHandle(gastAtClientTab[ucIndex].usClientId, 0,&stMePersonalisationData))
            {
                /* ???????????????? */
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CLCK_PIN_HANDLE;
                return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
            }
            else
            {
                return AT_ERROR;
            }

        }

        default:
            return AT_CME_INCORRECT_PARAMETERS;
    }


}

/*****************************************************************************
 ?? ?? ??  : AT_CheckPinLength
 ????????  : ????PIN??????
 ????????  : VOS_UINT16                          usLen
             VOS_UINT8                          *pucPin
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??6??4??
    ??    ??   : l60609
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_CheckPinLength(
    VOS_UINT16                          usLen,
    VOS_UINT8                          *pucPin
)
{
    if (VOS_NULL_PTR == pucPin)
    {
        AT_ERR_LOG("AT_CheckPinLength():PIN is NULL PTR");
        return VOS_ERR;
    }

    if ((usLen > TAF_PH_PINCODELENMAX)
     || (usLen < TAF_PH_PINCODELENMIN))
    {
        AT_ERR_LOG("AT_CheckPinLength():PIN LENGTH is Error");
        return VOS_ERR;
    }

    return VOS_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_CheckPinValue
 ????????  : ????PIN????
 ????????  : VOS_UINT16                          usLen
             VOS_UINT8                          *pucPin
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??6??4??
    ??    ??   : l60609
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_CheckPinValue(
    VOS_UINT16                          usLen,
    VOS_UINT8                          *pucPin
)
{
    VOS_UINT8                           i;

    if (VOS_NULL_PTR == pucPin)
    {
        AT_ERR_LOG("AT_CheckPinValue(): PIN is NULL PTR");
        return VOS_ERR;
    }

    for (i = 0; i < usLen ; i++ )
    {
        if ( (pucPin[i] >'9' )
           ||(pucPin[i] <'0'))
        {
            AT_ERR_LOG("AT_CheckPinValue(): PIN Value is Error");
            return VOS_ERR;
        }
    }

    return VOS_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_CheckPinAvail
 ????????  : ????PIN??????
 ????????  : VOS_UINT16                          usLen,
             VOS_UINT8                          *pucPin
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??6??4??
    ??    ??   : l60609
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_CheckPinAvail(
    VOS_UINT16                          usLen,
    VOS_UINT8                          *pucPin
)
{
    if (VOS_OK != AT_CheckPinLength(usLen, pucPin))
    {
        AT_ERR_LOG("AT_CheckPinAvail(): PIN Length is Error");
        return VOS_ERR;
    }
    else
    {
        if (VOS_OK != AT_CheckPinValue(usLen, pucPin))
        {
            AT_ERR_LOG("AT_CheckPinAvail():PIN Value is Error");
            return VOS_ERR;
        }
    }
    return VOS_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_GetSimlockUnlockCategoryFromClck
 ????????  : ????CLCK????????????????????
 ????????  : ??
 ????????  : ??
 ?? ?? ??  : AT_MTA_PERS_CATEGORY_ENUM_UINT8
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??4??7??
    ??    ??   : w00316404
    ????????   : ??????????

*****************************************************************************/
AT_MTA_PERS_CATEGORY_ENUM_UINT8 AT_GetSimlockUnlockCategoryFromClck(VOS_VOID)
{
    switch(gastAtParaList[0].ulParaValue)
    {
        case AT_CLCK_PN_TYPE:
            return AT_MTA_PERS_CATEGORY_NETWORK;
        case AT_CLCK_PU_TYPE:
            return AT_MTA_PERS_CATEGORY_NETWORK_SUBSET;
        case AT_CLCK_PP_TYPE:
            return AT_MTA_PERS_CATEGORY_SERVICE_PROVIDER;
        default:
            return AT_MTA_PERS_CATEGORY_BUTT;
    }

}

/*****************************************************************************
 ?? ?? ??  : AT_SetCLCKFacEqualPNPUPPPara
 ????????  : +CLCK <fac> ??PN?? PU??PP??????
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??4??7??
    ??    ??   : w00316404
    ????????   : ??????????
*****************************************************************************/
TAF_UINT32 AT_SetClckFacEqualPNPUPPPara(TAF_UINT8 ucIndex)
{
    AT_MTA_SIMLOCKUNLOCK_REQ_STRU       stSimlockUnlockSetReq;

    switch(gastAtParaList[1].ulParaValue)
    {
        case AT_CLCK_MODE_UNLOCK:/* ????<mode>??0???????????????????????? */
            {

                PS_MEM_SET(&stSimlockUnlockSetReq, 0, sizeof(AT_MTA_SIMLOCKUNLOCK_REQ_STRU));
                stSimlockUnlockSetReq.enCategory = AT_GetSimlockUnlockCategoryFromClck();

                /* <password>???????? */
                if (AT_SIMLOCKUNLOCK_PWD_PARA_LEN != gastAtParaList[2].usParaLen)
                {
                    return AT_CME_INCORRECT_PARAMETERS;
                }

                /* ????????????????????????16????0??-??9??ASCII????,??????ASCII?????????????????? */
                if (AT_SUCCESS != At_AsciiNum2Num(stSimlockUnlockSetReq.aucPassword,
                       gastAtParaList[2].aucPara,
                       gastAtParaList[2].usParaLen))
                {
                    return AT_CME_INCORRECT_PARAMETERS;
                }

                /* ??????????????C??, ???????????? */
                if (TAF_SUCCESS != AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                              gastAtClientTab[ucIndex].opId,
                              ID_AT_MTA_SIMLOCKUNLOCK_SET_REQ,
                              &stSimlockUnlockSetReq,
                              sizeof(AT_MTA_SIMLOCKUNLOCK_REQ_STRU),
                              I0_UEPS_PID_MTA))
                {
                    return AT_ERROR;
                }

                /* ???????????????? */
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CLCK_SIMLOCKUNLOCK;
                return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */


            }
        case AT_CLCK_MODE_LOCK:/* ????<mode>??1???????????????????? */
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }
        case AT_CLCK_MODE_QUERY_STATUS:/* ????<mode>??2???????????????????????????? */
            {
                /* ??????????????C??, ???????????????? */
                if (TAF_SUCCESS != AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                              gastAtClientTab[ucIndex].opId,
                              DRV_AGENT_SIMLOCKDATAREAD_QRY_REQ,
                              VOS_NULL_PTR,
                              0,
                              I0_WUEPS_PID_DRV_AGENT))
                {
                    return AT_ERROR;
                }

                /* ???????????????? */
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CLCK_SIMLOCKDATAREAD;
                return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
            }
        default:
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }
    }

}


/*****************************************************************************
 Prototype      : At_SetClckPara
 Description    : +CLCK=<fac>,<mode>[,<passwd>[,<class>]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function

  2.Date        : 2010-06-19
    Author      : z00161729
    Modification: ??????DTS2010061900248

  3.??    ??   : 2010-09-19
    ??    ??   : z00161729
    ????????   : DTS2010092001723??VP??????????CCFC??CCWA??CLCK????

  4.??    ??   : 2011??10??4??
    ??    ??   : o00132663
    ????????   : AT??????????PB_MEM_SET API????????PS_MEM_SET

  5.??    ??   : 2012??12??29??
    ??    ??   : l00198894
    ????????   : DTS2012122900551: ????+CLCK??????????????????????
  6.??    ??   : 2013??05??06??
    ??    ??   : f62575
    ????????   : SS FDN&Call Control??????SS??????????SS????
  7.??    ??   : 2014??3??27??
    ??    ??   : n00269697
  8.??    ??   : 2015??4??7??
    ??    ??   : w00316404
    ????????   : M project A characeristic AT part
*****************************************************************************/
TAF_UINT32 At_SetClckPara(TAF_UINT8 ucIndex)
{
    /* Added by j00174725 for V3R3C60_eCall????, 2014-3-29, begin */
    VOS_UINT8                           aucPin[TAF_PH_PINCODELENMAX];
    VOS_UINT32                          CmdType;
    VOS_UINT32                          Result;
    /* Added by j00174725 for V3R3C60_eCall????, 2014-3-29, end */

    /* ???????? */
    if((0 == gastAtParaList[0].usParaLen) || (0 == gastAtParaList[1].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 4)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<fac> */
    switch(gastAtParaList[0].ulParaValue)
    {
    case AT_CLCK_P2_TYPE:
        return AT_CME_INCORRECT_PARAMETERS;

    case AT_CLCK_SC_TYPE:
        {
            TAF_PH_PIN_DATA_STRU stPinData;

            if (TAF_PH_PINCODELENMAX < gastAtParaList[2].usParaLen)
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }

            /* ?????? */
            PS_MEM_SET(&stPinData, 0xFF, sizeof(stPinData));

            /* ????<passwd> */
            if(0 != gastAtParaList[2].usParaLen)
            {
                PS_MEM_CPY((TAF_CHAR*)stPinData.aucOldPin,(TAF_CHAR*)gastAtParaList[2].aucPara,gastAtParaList[2].usParaLen);
            }

            stPinData.PinType = TAF_SIM_PIN;

            /* ????CmdType */
            switch(gastAtParaList[1].ulParaValue)
            {
            case 0:
                stPinData.CmdType = TAF_PIN_DISABLE;
                if (VOS_OK != AT_CheckPinAvail(gastAtParaList[2].usParaLen, gastAtParaList[2].aucPara))
                {
                    return AT_CME_INCORRECT_PARAMETERS;
                }
                break;

            case 1:
                stPinData.CmdType = TAF_PIN_ENABLE;
                if (VOS_OK != AT_CheckPinAvail(gastAtParaList[2].usParaLen, gastAtParaList[2].aucPara))
                {
                    return AT_CME_INCORRECT_PARAMETERS;
                }
                break;

            default:
                stPinData.CmdType = TAF_PIN_QUERY;
                break;
            }

            /* ???????????? */
            if(AT_SUCCESS == Taf_PhonePinHandle(gastAtClientTab[ucIndex].usClientId, 0,&stPinData))
            {
                /* ???????????????? */
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CLCK_PIN_HANDLE;
                return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
            }
            else
            {
                return AT_ERROR;
            }
        }
    case AT_CLCK_FD_TYPE:
        {
            if(TAF_PH_PINCODELENMAX < gastAtParaList[2].usParaLen)
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }

            /* ?????? */
            PS_MEM_SET(aucPin, 0xFF, sizeof(aucPin));

            /* ????<passwd> */
            if(0 != gastAtParaList[2].usParaLen)
            {
                PS_MEM_CPY((TAF_CHAR*)aucPin,(TAF_CHAR*)gastAtParaList[2].aucPara, gastAtParaList[2].usParaLen);
            }

            CmdType = gastAtParaList[1].ulParaValue;

            /* ??????????????????????FDN????????????AT????????????BDN???? */
            if(SI_PIH_FDN_BDN_ENABLE == CmdType)
            {
                Result = SI_PIH_FdnEnable(gastAtClientTab[ucIndex].usClientId, 0, aucPin);
            }
            else if(SI_PIH_FDN_BDN_DISABLE == CmdType)
            {
                Result = SI_PIH_FdnDisable(gastAtClientTab[ucIndex].usClientId, 0, aucPin);
            }
            else
            {
                Result = SI_PIH_FdnBdnQuery(gastAtClientTab[ucIndex].usClientId, 0, SI_PIH_FDN_QUERY);
            }

            if(AT_SUCCESS == Result)
            {
                /* ???????????????? */
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CLCK_PIN_HANDLE;
                return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
            }
            else
            {
                return AT_ERROR;
            }
        }

    case AT_CLCK_PS_TYPE:
        {
            TAF_ME_PERSONALISATION_DATA_STRU stMePersonalisationData;

            if(TAF_PH_PINCODELENMAX < gastAtParaList[2].usParaLen)
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }

            /* ?????? */
            PS_MEM_SET(&stMePersonalisationData,0x00,sizeof(TAF_ME_PERSONALISATION_DATA_STRU));

            /* ????<passwd> */
            if(0 != gastAtParaList[2].usParaLen)
            {
                PS_MEM_CPY((VOS_CHAR*)stMePersonalisationData.aucOldPwd,(VOS_CHAR*)gastAtParaList[2].aucPara,gastAtParaList[2].usParaLen);
            }

            /* ????PinType */
            stMePersonalisationData.MePersonalType = TAF_SIM_PERSONALISATION;


            /* ????CmdType */
            switch(gastAtParaList[1].ulParaValue)
            {
            case 0:
                stMePersonalisationData.CmdType = TAF_ME_PERSONALISATION_DEACTIVE;
                break;

            case 1:
                stMePersonalisationData.CmdType = TAF_ME_PERSONALISATION_ACTIVE;
                break;

            default:
                stMePersonalisationData.CmdType = TAF_ME_PERSONALISATION_QUERY;
                break;
            }

            /* ???????????? */
            if(AT_SUCCESS == Taf_MePersonalisationHandle(gastAtClientTab[ucIndex].usClientId, 0,&stMePersonalisationData))
            {
                /* ???????????????? */
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CLCK_PIN_HANDLE;
                return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
            }
            else
            {
                return AT_ERROR;
            }
        }

    case AT_CLCK_PN_TYPE:
    case AT_CLCK_PU_TYPE:
    case AT_CLCK_PP_TYPE:
        {
            return AT_SetClckFacEqualPNPUPPPara(ucIndex);
        }



    default:
        {
            TAF_SS_ERASESS_REQ_STRU para;

            /* ?????? */
            PS_MEM_SET(&para,0x00,sizeof(para));

            /* ????<password> */
            /* Modified by f62575 for SS FDN&Call Control, 2013-05-06, begin */
            if (gastAtParaList[2].usParaLen > 0)
            {
                if (TAF_SS_MAX_PASSWORD_LEN != gastAtParaList[2].usParaLen)
                {
                    return AT_CME_INCORRECT_PARAMETERS;
                }

                para.OP_Password = VOS_TRUE;
                PS_MEM_CPY((VOS_CHAR *)para.aucPassword,
                           (VOS_CHAR *)gastAtParaList[2].aucPara,
                           gastAtParaList[2].usParaLen);
            }

            /* Modified by f62575 for SS FDN&Call Control, 2013-05-06, end */

            /* ????SsCode */
            At_SsPrint2Code(&para.SsCode,(TAF_UINT8)gastAtParaList[0].ulParaValue);

            /* ????<class> */
            if (VOS_OK != AT_FillSsBsService(&para, &gastAtParaList[3]))
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }

            /* ???????????? */
            switch(gastAtParaList[1].ulParaValue)
            {
            case 0: /* <mode>: unlock */
                if(AT_SUCCESS == TAF_DeactivateSSReq(gastAtClientTab[ucIndex].usClientId, 0,&para))
                {
                    /* ???????????????? */
                    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CLCK_LOCK;
                    return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
                }
                else
                {
                    return AT_ERROR;
                }

            case 1: /* <mode>: lock */
                if(AT_SUCCESS == TAF_ActivateSSReq(gastAtClientTab[ucIndex].usClientId, 0,&para))
                {
                    /* ???????????????? */
                    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CLCK_UNLOCK;
                    return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
                }
                else
                {
                    return AT_ERROR;
                }

            default: /* <mode>: query status */
                /*????????????class????????????DTS2010061900248 IOT????????*/
                para.OP_BsService = 0;
                gastAtClientTab[ucIndex].ulTemp = gastAtParaList[3].ulParaValue;
                if(AT_SUCCESS == TAF_InterrogateSSReq(gastAtClientTab[ucIndex].usClientId, 0,&para))
                {
                    /* ???????????????? */
                    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CLCK_QUERY;
                    return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
                }
                else
                {
                    return AT_ERROR;
                }
            }
        }
    }
}

/*****************************************************************************
 Prototype      : At_SetCtfrPara
 Description    : +CTFR=<number>[,<type>[,<subaddr>[,<satype>]]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??  : 2012??03??03??
   ??    ??   : s62952
   ????????   : BalongV300R002 Build????????  :????NAS_FEATURE_CALL_DEFLECTION??
  3.??    ??  : 2012??05??07??
   ??    ??   : f00179208
   ????????   : DTS2012050307234, ??ASCII????????????????BCD????????????????????????????
*****************************************************************************/
TAF_UINT32 At_SetCtfrPara(TAF_UINT8 ucIndex)
{
    MN_CALL_SUPS_PARAM_STRU             stCallSupsParam;
    VOS_UINT32                          ulRst;

    /* ???????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 4)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<number>?????????????????? */
    if(gastAtParaList[0].usParaLen > (MN_CALL_MAX_BCD_NUM_LEN * 2))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<subaddr>?????????????????? */
    if(gastAtParaList[2].usParaLen > (MN_CALL_MAX_BCD_NUM_LEN * 2))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    gastAtParaList[0].aucPara[gastAtParaList[0].usParaLen]='\0';

    ulRst = AT_AsciiNumberToBcd((VOS_CHAR *)gastAtParaList[0].aucPara,
                                stCallSupsParam.stRedirectNum.aucBcdNum,
                                &stCallSupsParam.stRedirectNum.ucNumLen);
    if (MN_ERR_NO_ERROR != ulRst)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    stCallSupsParam.callId = 0;
    stCallSupsParam.enCallSupsCmd = MN_CALL_SUPS_CMD_DEFLECT_CALL;
    stCallSupsParam.stRedirectNum.enNumType = (TAF_UINT8)gastAtParaList[1].ulParaValue;

    if (AT_SUCCESS == MN_CALL_Sups(gastAtClientTab[ucIndex].usClientId, 0,&stCallSupsParam))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CTFR_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : At_SetCusdPara
 ????????  : +CUSD=[<n>[,<str>[,<dcs>]]]
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  --- ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2005??04??19??
    ??    ??   : z40661
    ????????   : ??????????
  2.??    ??   : 2010??03??02??
    ??    ??   : s62952
    ????????   : ????????:A32D16512
  3.??    ??   : 2011??02??20??
    ??    ??   : z00161729
    ????????   : ????????DTS2011021900108:????PCUI??????USSD????????????????modem??????
                 at+cusd=2????????USSD????????????????USSD??????????
  4.??    ??   : 2011??10??08??
    ??    ??   : c00173809
    ????????   : AT????????????????????????????Ti????????????C??????????????
  5.??    ??   : 2013??2??21??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  6.??    ??   : 2013??4??3??
    ??    ??   : s00217060
    ????????   : ????????AT??????????????C??

  7.??    ??   : 2013??11??29??
    ??    ??   : z00234330
    ????????   : dts2012112912543
*****************************************************************************/
VOS_UINT32 At_SetCusdPara(VOS_UINT8 ucIndex)
{
    TAF_SS_PROCESS_USS_REQ_STRU        *pPara;
    VOS_UINT32                          ulRet;
    TAF_SS_DATA_CODING_SCHEME           DatacodingScheme;
    AT_MODEM_SS_CTX_STRU               *pstSsCtx;

    /* Modified by l60609 for DSDA Phase III, 2013-2-21, Begin */
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-8, begin */

    ulRet =  AT_ERROR;

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 3)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(0 == gastAtParaList[2].usParaLen)
    {
        /* ??????7bit???? */
        DatacodingScheme = TAF_SS_7bit_LANGUAGE_UNSPECIFIED;
    }
    else
    {
        DatacodingScheme = (TAF_SS_DATA_CODING_SCHEME)gastAtParaList[2].ulParaValue;

        /*??????????????uss2??ussd*/
    }

    /* ????<str>?????????????????????? */
    if(AT_FAILURE == At_CheckUssdNumLen(ucIndex, DatacodingScheme, gastAtParaList[1].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    pPara    = (TAF_SS_PROCESS_USS_REQ_STRU *)PS_MEM_ALLOC(WUEPS_PID_AT, sizeof(TAF_SS_PROCESS_USS_REQ_STRU));
    if (TAF_NULL_PTR == pPara)
    {
        return AT_ERROR;
    }

    /* ?????? */
    PS_MEM_SET(pPara,0x00,sizeof(TAF_SS_PROCESS_USS_REQ_STRU));

    /* ????<n> */
    if(0 != gastAtParaList[0].usParaLen)
    {
        if(2 != gastAtParaList[0].ulParaValue)
        {
            pPara->enCusdType    = (TAF_SS_CUSD_TYPE_ENUM_UINT8)gastAtParaList[0].ulParaValue;
        }
    }
    else
    {
        pPara->enCusdType    = TAF_SS_CUSD_TYPE_DISABLE;
    }

    /* <n>: cancel session */
    if(2 == gastAtParaList[0].ulParaValue)
    {
        if(AT_SUCCESS == TAF_SsReleaseComplete(gastAtClientTab[ucIndex].usClientId, 0))
        {
            ulRet = AT_OK;

        }
        else
        {
            ulRet = AT_ERROR;
        }
    }
    else
    {
        /*  AT+CUSD=0????????????C??????????????????C?????? */
        if(0 == gastAtParaList[1].usParaLen)
        {
            PS_MEM_SET(&(pPara->UssdStr), 0, sizeof(pPara->UssdStr));
        }
        else
        {

            PS_MEM_CPY(pPara->UssdStr.aucUssdStr,gastAtParaList[1].aucPara,gastAtParaList[1].usParaLen);
            pPara->UssdStr.usCnt = gastAtParaList[1].usParaLen;

            pstSsCtx = AT_GetModemSsCtxAddrFromClientId(ucIndex);

            if ((0 == pstSsCtx->usUssdTransMode) && (AT_CSCS_UCS2_CODE == gucAtCscsType))
            {
                if ( (TAF_SS_7bit_LANGUAGE_UNSPECIFIED == DatacodingScheme)
                   ||(TAF_SS_8bit == DatacodingScheme))
                {
                    if(AT_FAILURE == At_UnicodePrintToAscii(pPara->UssdStr.aucUssdStr,&pPara->UssdStr.usCnt))
                    {
                        PS_MEM_FREE(WUEPS_PID_AT, pPara);
                        return AT_CME_INCORRECT_PARAMETERS;
                    }
                }
            }

            if (TAF_SS_UCS2 == DatacodingScheme)
            {
                if(AT_FAILURE == At_UnicodePrint2Unicode(pPara->UssdStr.aucUssdStr,&pPara->UssdStr.usCnt))
                {
                    PS_MEM_FREE(WUEPS_PID_AT, pPara);
                    return AT_CMS_INVALID_TEXT_MODE_PARAMETER;
                }
            }
        }
        /* ????<dcs> */
        pPara->DatacodingScheme = DatacodingScheme;

        /* ???????????? */
        if(AT_SUCCESS == TAF_ProcessUnstructuredSSReq(gastAtClientTab[ucIndex].usClientId, 0, pPara))
        {
            /*  AT+CUSD=0????????????C??????????????????C?????? */
            if(0 == gastAtParaList[1].usParaLen)
            {
                ulRet =  AT_OK;
            }
            else
            {
                /* ???????????????? */
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CUSD_REQ;

                /* ???????????????????? */
                ulRet =  AT_WAIT_ASYNC_RETURN;
            }
        }
        else
        {
            ulRet =  AT_ERROR;
        }

    }
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-8, end */
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, End */

    PS_MEM_FREE(WUEPS_PID_AT, pPara);
    return ulRet;
}
/*****************************************************************************
 Prototype      : At_SetCpwdPara
 Description    : +CPWD=<fac>,<oldpwd>,<newpwd>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)

  3.??    ??   : 2009-10-16
    ??    ??   : h44270
    ????????   : ????????: AT2D15084,????3??PIN??????????OK

  4.??    ??   : 2011??10??4??
    ??    ??   : o00132663
    ????????   : AT??????????PB_MEM_SET API????????PS_MEM_SET
*****************************************************************************/
TAF_UINT32 At_SetCpwdPara(TAF_UINT8 ucIndex)
{
    VOS_UINT32   i;
    /* ???????? */
    if((0 == gastAtParaList[0].usParaLen) || (0 == gastAtParaList[1].usParaLen) || (0 == gastAtParaList[2].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 3)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<fac> */
    switch(gastAtParaList[0].ulParaValue)
    {
    case AT_CLCK_P2_TYPE:
    case AT_CLCK_SC_TYPE:
        {
            TAF_PH_PIN_DATA_STRU stPinData;

            if((TAF_PH_PINCODELENMAX < gastAtParaList[1].usParaLen) || (TAF_PH_PINCODELENMAX < gastAtParaList[2].usParaLen)
             ||(TAF_PH_PINCODELENMIN > gastAtParaList[1].usParaLen) || (TAF_PH_PINCODELENMIN > gastAtParaList[2].usParaLen))
            {
                return AT_ERROR;
            }

            /* ?????? */
            PS_MEM_SET(&stPinData, 0xFF, sizeof(stPinData));

            /* ????<pin> */
            if(0 != gastAtParaList[1].usParaLen)
            {
                for(i=0; i<gastAtParaList[1].usParaLen; i++)
                {
                    if((gastAtParaList[1].aucPara[i] > '9' )||(gastAtParaList[1].aucPara[i] < '0'))
                    {
                        return AT_CME_INCORRECT_PARAMETERS;
                    }
                }

                PS_MEM_CPY((TAF_VOID*)stPinData.aucOldPin,(TAF_VOID*)gastAtParaList[1].aucPara,gastAtParaList[1].usParaLen);
            }

            /* ????<newpin> */
            if(0 != gastAtParaList[2].usParaLen)
            {
                for(i=0; i<gastAtParaList[2].usParaLen; i++)
                {
                    if((gastAtParaList[2].aucPara[i] > '9' )||(gastAtParaList[2].aucPara[i] < '0'))
                    {
                        return AT_CME_INCORRECT_PARAMETERS;
                    }
                }

                PS_MEM_CPY((TAF_VOID*)stPinData.aucNewPin,(TAF_VOID*)gastAtParaList[2].aucPara,gastAtParaList[2].usParaLen);
            }
            /* ????PinType */
            if(AT_CLCK_P2_TYPE == gastAtParaList[0].ulParaValue)
            {
                stPinData.PinType = TAF_SIM_PIN2;
            }
            else
            {
                stPinData.PinType = TAF_SIM_PIN;
            }

            /* ????CmdType */
            stPinData.CmdType = TAF_PIN_CHANGE;

            /* ???????????? */
            if(AT_SUCCESS == Taf_PhonePinHandle(gastAtClientTab[ucIndex].usClientId, 0,&stPinData))
            {
                /* ???????????????? */
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPWD_CHANGE_PIN;
                return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
            }
            else
            {
                return AT_ERROR;
            }
        }

    case AT_CLCK_PS_TYPE:
        {
            TAF_ME_PERSONALISATION_DATA_STRU stMePersonalisationData;

            if((TAF_PH_PINCODELENMAX < gastAtParaList[1].usParaLen) || (TAF_PH_PINCODELENMAX < gastAtParaList[2].usParaLen))
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }

            /* ?????? */
            PS_MEM_SET(&stMePersonalisationData,0x00,sizeof(stMePersonalisationData));

            /* ????<oldpwd> */
            PS_MEM_CPY((VOS_VOID*)stMePersonalisationData.aucOldPwd,(VOS_VOID*)gastAtParaList[1].aucPara,gastAtParaList[1].usParaLen);

            /* ????<newpwd> */
            PS_MEM_CPY((VOS_CHAR*)stMePersonalisationData.aucNewPwd,(VOS_CHAR*)gastAtParaList[2].aucPara,gastAtParaList[2].usParaLen);

            /* ????MePersonalType */
            stMePersonalisationData.MePersonalType = TAF_SIM_PERSONALISATION;

            /* ????CmdType */
            stMePersonalisationData.CmdType = TAF_ME_PERSONALISATION_PWD_CHANGE;

            /* ???????????? */
            if(AT_SUCCESS == Taf_MePersonalisationHandle(gastAtClientTab[ucIndex].usClientId, 0,&stMePersonalisationData))
            {
                /* ???????????????? */
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPWD_CHANGE_PIN;
                return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
            }
            else
            {
                return AT_ERROR;
            }
        }


    default:
        {
            TAF_SS_REGPWD_REQ_STRU para;

            if((TAF_SS_MAX_PASSWORD_LEN < gastAtParaList[1].usParaLen) || (TAF_SS_MAX_PASSWORD_LEN < gastAtParaList[2].usParaLen))
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }

            /* ?????? */
            PS_MEM_SET(&para,0x00,sizeof(para));

            /* ????<oldpwd> */
            PS_MEM_CPY((TAF_CHAR*)para.aucOldPwdStr,(TAF_CHAR*)gastAtParaList[1].aucPara,gastAtParaList[1].usParaLen);

            /* ????<newpwd> */
            PS_MEM_CPY((TAF_CHAR*)para.aucNewPwdStr,(TAF_CHAR*)gastAtParaList[2].aucPara,gastAtParaList[2].usParaLen);

            /* ????<newpwd> */
            PS_MEM_CPY((TAF_CHAR*)para.aucNewPwdStrCnf,(TAF_CHAR*)gastAtParaList[2].aucPara,gastAtParaList[2].usParaLen);

            /* ????SsCode */
            At_SsPrint2Code(&para.SsCode,(TAF_UINT8)gastAtParaList[0].ulParaValue);

            /* ???????????? */
            if(AT_SUCCESS == TAF_RegisterPasswordReq(gastAtClientTab[ucIndex].usClientId, 0,&para))
            {
                /* ???????????????? */
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPWD_SET;
                return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
            }
            else
            {
                return AT_ERROR;
            }
        }
    }
}
/*****************************************************************************
 Prototype      : At_SetDialIGPara
 Description    : D...[I][G][;]
 Input          : ucIndex     --- ????????
                  ucParaIndex --- ????????
 Output         :
 Return Value   : ---
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2013??2??21??
    ??    ??   : l60609
    ????????   : DSDA PHASE III

*****************************************************************************/
TAF_VOID At_SetDialIGPara(TAF_UINT8 ucIndex,TAF_UINT8 ucParaIndex,TAF_UINT8 *pClir, MN_CALL_CUG_CFG_STRU *pstCcug)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, Begin */
    AT_MODEM_SS_CTX_STRU               *pstSsCtx = VOS_NULL_PTR;

    pstSsCtx = AT_GetModemSsCtxAddrFromClientId(ucIndex);

    /*->A32D08138*/
    /* ??????????????CCA???????????? */

    *pClir   = pstSsCtx->ucClirType;
    *pstCcug = pstSsCtx->stCcugCfg;
    /*<-A32D08138*/
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, End */

    switch(gastAtParaList[ucParaIndex].aucPara[0])
    {
    case 'i':
        *pClir = MN_CALL_CLIR_SUPPRESS;
        break;

    case 'I':
        *pClir = MN_CALL_CLIR_INVOKE;
        break;

    case 'g':
    case 'G':
        pstCcug->bEnable = 1;
        break;

    default:
        break;
    }

    switch(gastAtParaList[ucParaIndex + 1].aucPara[0])
    {
    case 'g':
    case 'G':
        pstCcug->bEnable = 1;
        break;

    default:
        break;
    }
}

/*****************************************************************************
 ?? ?? ??  : At_SetDialGprsPara
 ????????  : GPRS????????????
 ????????  : TAF_UINT8 ucIndex  ????????
             TAF_UINT8 ucCid    cid
             TAF_GPRS_ACTIVE_TYPE_UINT8 enActiveType   ????????
 ????????  : ??
 ?? ?? ??  : TAF_UINT32 AT_XXX  --- ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2005-04-19
    ??    ??   :
    ????????   : ??????????
  2.??    ??   : 2011??10??22??
    ??    ??   : f62575
    ????????   : AT PROJECT NAS_EventReport -> AT_EventReport
                            OM_GreenChannel -> OM_AppGreenChannel
  3.??    ??   : 2015??07??23??
    ??    ??   : wx270776
    ????????   : OM????
*****************************************************************************/
TAF_UINT32 At_SetDialGprsPara(
    TAF_UINT8                           ucIndex,
    TAF_UINT8                           ucCid,
    TAF_GPRS_ACTIVE_TYPE_UINT8          enActiveType
)
{
    TAF_PPP_REQ_CONFIG_INFO_STRU        stPppReqConfigInfo;
    VOS_UINT16                          usPppId = 0;
    VOS_UINT8                           aucEventInfo[4];
    PS_MEM_SET(&stPppReqConfigInfo, 0x00, sizeof(TAF_PPP_REQ_CONFIG_INFO_STRU));

    /* ???????????? */
    if(TAF_IP_ACTIVE_TE_PPP_MT_PPP_TYPE == enActiveType)    /* MT??????PPP */
    {
        gastAtClientTab[ucIndex].ucCid = ucCid;   /* ??????????????cid */

        if(AT_SUCCESS == Ppp_CreatePppReq(&usPppId))    /* TE????????PPP??MT??????PPP */
        {
            /*EVENT-At_SetDialGprsPara: usPppId/index*/
            aucEventInfo[0] = (TAF_UINT8)(usPppId >> 8);
            aucEventInfo[1] = (TAF_UINT8)usPppId;
            aucEventInfo[2] = ucIndex;
            AT_EventReport(WUEPS_PID_AT, NAS_OM_EVENT_DCE_CREATE_PPP,
                           aucEventInfo, sizeof(aucEventInfo));

            gastAtPppIndexTab[usPppId] = ucIndex;       /* ????PPP id??Index?????????? */
            gastAtClientTab[ucIndex].usPppId = usPppId; /* ????PPP id */

            At_SetMode(ucIndex,AT_DATA_MODE,AT_PPP_DATA_MODE);   /* ??????PPP???????? */

            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_D_PPP_CALL_SET;

            return AT_CONNECT;
        }
        else
        {
            /* Deleted by wx270776 for OM????, 2015-6-29, begin */

            /* Deleted by wx270776 for OM????, 2015-6-29, end */
            return AT_ERROR;
        }
    }
    else
    {
        stPppReqConfigInfo.stAuth.enAuthType = TAF_PDP_AUTH_TYPE_NONE;
        stPppReqConfigInfo.stIPCP.usIpcpLen  = 0;

        /* ??????????PPP???? */
        if (AT_SUCCESS != Ppp_CreateRawDataPppReq(&usPppId))
        {

            /* Deleted by wx270776 for OM????, 2015-6-29, begin */
            /* Deleted by wx270776 for OM????, 2015-6-29, end */
            return AT_ERROR;
        }

        if ( VOS_OK != TAF_PS_PppDialOrig(WUEPS_PID_AT,
                                          AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                          0,
                                          ucCid,
                                          &stPppReqConfigInfo) )
        {
            PPP_RcvAtCtrlOperEvent(usPppId, PPP_AT_CTRL_REL_PPP_RAW_REQ);

            /*??PPP????HDLC??????????*/
            PPP_RcvAtCtrlOperEvent(usPppId, PPP_AT_CTRL_HDLC_DISABLE);
            return AT_ERROR;
        }

        gastAtPppIndexTab[usPppId]          = ucIndex;  /* ????PPP id??Index?????????? */
        gastAtClientTab[ucIndex].usPppId    = usPppId;  /* ????PPP id */

        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_D_IP_CALL_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
}


/*****************************************************************************
 Prototype      : At_SetDial98Para
 Description    : D*<GPRS_SC_IP>[*<cid>]#
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2010-07-25
    ??    ?? : A00165503
    ???????? : ????????: DTS2011070501192, Modem??????IPv6????, IPv6????????
               ??, Modem????????????IPv4.
  3.??    ??   : 2011??10??22??
    ??    ??   : f62575
    ????????   : AT PROJECT OM_GreenChannel -> OM_AppGreenChannel
  4.??    ??   : 2011??10??22??
    ??    ??   : A00165503
    ????????   : AT Project: ????????????????CID??????PDP????
*****************************************************************************/
TAF_UINT32 At_SetDial98Para(TAF_UINT8 ucIndex)
{
    TAF_ATD_PARA_STRU                   stAtdPara;

    /* ?????? */
    PS_MEM_SET(&stAtdPara, 0x00, sizeof(TAF_ATD_PARA_STRU));

    /* CID???? */
    if (0 != gastAtParaList[4].usParaLen)
    {
        if(AT_FAILURE == At_Auc2ul(gastAtParaList[4].aucPara,gastAtParaList[4].usParaLen,&gastAtParaList[4].ulParaValue))
        {
            return AT_ERROR;
        }

        if(gastAtParaList[4].ulParaValue > 0xFF)   /* ?????????????????? */
        {
            return AT_ERROR;
        }

        /* ??????????????????CID */
        stAtdPara.ucCid = (VOS_UINT8)gastAtParaList[4].ulParaValue;
    }
    else
    {
        /* ????????CID */
        stAtdPara.ucCid = AT_DIAL_DEFAULT_CID;
    }

    /* ????GPRS???????? */
    if ( VOS_OK != TAF_PS_GetGprsActiveType(WUEPS_PID_AT,
                                            AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                            0,
                                            &stAtdPara) )
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_D_GPRS_SET;

    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : At_SetDial99Para
 ????????  : D*<GPRS_SC>[*[<called_address>][*[<L2P>][*[<cid>]]]]#
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  --- ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2005-04-19
    ??    ??   : ---
    ????????   : ??????????

  2.??    ??   : 2014??1??13??
    ??    ??   : A00165503
    ????????   : DTS2013122609183: L2P????????????, ??????????????????
*****************************************************************************/
VOS_UINT32 At_SetDial99Para(VOS_UINT8 ucIndex)
{
    VOS_INT32                           lParaPPPFlg;
    VOS_INT32                           lParaNULLFlg;
    VOS_UINT8                           ucTmp;
    VOS_UINT8                           ucStar;
    VOS_UINT8                           ucL2pIndex;
    VOS_UINT8                           ucCidIndex;
    TAF_ATD_PARA_STRU                   stAtdPara;

    /* ?????? */
    ucTmp      = 0;
    ucStar     = 0;
    ucL2pIndex = 0;
    ucCidIndex = 0;
    PS_MEM_SET(&stAtdPara, 0x00, sizeof(TAF_ATD_PARA_STRU));

    /* ???????????? */
    for (ucTmp = 1; ucTmp < gucAtParaIndex; ucTmp++)
    {
        if ('*' == gastAtParaList[ucTmp].aucPara[0])
        {
            ucStar++;
        }
        else
        {
            switch (ucStar)
            {
                case 1:
                case 2:
                    break;

                case 3:
                    ucL2pIndex = ucTmp;
                    break;

                case 4:
                    ucCidIndex = ucTmp;
                    break;

                default:
                    return AT_ERROR;
            }
        }
    }

    /* ????CID: ??????CID??????, ????????1 */
    if (0 != ucCidIndex)
    {
        if (AT_FAILURE == At_Auc2ul(gastAtParaList[ucCidIndex].aucPara,gastAtParaList[ucCidIndex].usParaLen,&gastAtParaList[ucCidIndex].ulParaValue))
        {
            return AT_ERROR;
        }

        /* ?????????????????? */
        if (gastAtParaList[ucCidIndex].ulParaValue > 0xFF)
        {
            return AT_ERROR;
        }

        stAtdPara.ucCid = (VOS_UINT8)gastAtParaList[ucCidIndex].ulParaValue;
    }
    else
    {
        stAtdPara.ucCid = AT_DIAL_DEFAULT_CID;
    }

    /* ????L2P????????: ???????????????????? */
    if (0 != ucL2pIndex)
    {
        lParaPPPFlg =  VOS_StrCmp((TAF_CHAR*)gastAtParaList[ucL2pIndex].aucPara,"1");
        lParaNULLFlg = VOS_StrCmp((TAF_CHAR*)gastAtParaList[ucL2pIndex].aucPara,"0");

        if ( (0 == VOS_StrCmp((TAF_CHAR*)gastAtParaList[ucL2pIndex].aucPara,"PPP"))
          || (0 == lParaPPPFlg) )
        {
            stAtdPara.bitOpL2p  = VOS_TRUE;
            stAtdPara.enL2p     = TAF_L2P_PPP;
        }
        else if ( (0 == VOS_StrCmp((TAF_CHAR*)gastAtParaList[ucL2pIndex].aucPara,"NULL"))
               || (0 == lParaNULLFlg) )
        {
            stAtdPara.bitOpL2p  = VOS_TRUE;
            stAtdPara.enL2p     = TAF_L2P_NULL;
        }
        else
        {
            ;
        }
    }
    else
    {
        ;
    }

    /* ????GPRS???????? */
    if ( VOS_OK != TAF_PS_GetGprsActiveType(WUEPS_PID_AT,
                                            AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                            0,
                                            &stAtdPara) )
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_D_GPRS_SET;

    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : At_SetDial777Para
 ????????  : #777????
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??08??27??
    ??    ??   : y00314741
    ????????   : ??????????
*****************************************************************************/
TAF_UINT32 At_SetDial777Para(TAF_UINT8 ucIndex)
{
    TAF_ATD_PARA_STRU                   stAtdPara;

    /* ?????? */
    PS_MEM_SET(&stAtdPara, 0x00, sizeof(TAF_ATD_PARA_STRU));

    /* ????????CID */
    stAtdPara.ucCid = AT_DIAL_DEFAULT_CID;

    /* ????GPRS???????? */
    if ( VOS_OK != TAF_PS_GetGprsActiveType(WUEPS_PID_AT,
                                            AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                            0,
                                            &stAtdPara) )
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_D_GPRS_SET;

    return AT_WAIT_ASYNC_RETURN;
}

/* Modified by n00269697 for V3R3C60_eCall????, 2014-3-29, begin */
/*****************************************************************************
 ?? ?? ??  : AT_FillCalledNumPara
 ????????  : ????CalledNum??????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??09??18??
    ??    ??   : y00213812
    ????????   : STK&DCM ????????????

  2.??    ??   : 2012??10??29??
    ??    ??   : l00198894
    ????????   : DTS2012100901666: ??????????????40??????80

  3.??    ??   : 2014??03??29??
    ??    ??   : n00269697
    ????????   : V3R3C60_eCall????,??????????????MN_CALL_ORIG_PARAM_STRU????????
                 MN_CALL_CALLED_NUM_STRU????,????????????????
*****************************************************************************/
VOS_UINT32 AT_FillCalledNumPara(
    VOS_UINT8                          *pucAtPara,
    VOS_UINT16                          usLen,
    MN_CALL_CALLED_NUM_STRU            *pstCalledNum
)
{
    VOS_UINT32                          ulRelt;

    /* ???????????? */
    if ('+' == *pucAtPara)
    {
        /* ??????????????????????????????,??????????81?????? */
        if (usLen > (MN_CALL_MAX_CALLED_ASCII_NUM_LEN + 1))
        {
            return VOS_ERR;
        }

        *(pucAtPara + usLen) = '\0';
        pucAtPara  += 1;

        pstCalledNum->enNumType
            = (MN_CALL_IS_EXIT | (MN_CALL_TON_INTERNATIONAL << 4) | MN_CALL_NPI_ISDN);
    }
    else
    {
        /* ????????????????????????????80?????? */
        if (usLen > MN_CALL_MAX_CALLED_ASCII_NUM_LEN)
        {
            return VOS_ERR;
        }

        *(pucAtPara + usLen) = '\0';

        pstCalledNum->enNumType
            = (MN_CALL_IS_EXIT | (MN_CALL_TON_UNKNOWN << 4) | MN_CALL_NPI_ISDN);
    }

    ulRelt = AT_AsciiNumberToBcd((VOS_CHAR *)pucAtPara,
                                 pstCalledNum->aucBcdNum,
                                 &pstCalledNum->ucNumLen);

    if (MN_ERR_NO_ERROR != ulRelt)
    {
        return VOS_ERR;
    }

    return VOS_OK;
}
/* Modified by n00269697 for V3R3C60_eCall????, 2014-3-29, end */

/*****************************************************************************
 Prototype      : At_SetDialNumPara
 Description    : D[<dial_string>][I][G][;]
 Input          : ucIndex --- ????????
                  CallType --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function

  2.??    ??   : 2012??9??25??
    ??    ??   : A00165503
    ????????   : STK&DCM????: CS????????????

  3.??    ??   : 2012??9??25??
    ??    ??   : y00213812
    ????????   : STK&DCM????: ????????????

  4.??    ??   : 2013??2??21??
    ??    ??   : l60609
    ????????   : DSDA PHASE III

  5.??    ??   : 2014??03??29??
    ??    ??   : n00269697
    ????????   : V3R3C60_eCall??????AT_FillCalledNumPara????????????????????????????????
*****************************************************************************/
TAF_UINT32 At_SetDialNumPara(TAF_UINT8 ucIndex,MN_CALL_TYPE_ENUM_U8 CallType)
{
    MN_CALL_ORIG_PARAM_STRU             stOrigParam;
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, Begin */
    AT_MODEM_SS_CTX_STRU               *pstSsCtx = VOS_NULL_PTR;

    pstSsCtx = AT_GetModemSsCtxAddrFromClientId(ucIndex);

    /*??????????????AT??????????????????????????????????????????*/

    /* ?????? */
    PS_MEM_SET(&stOrigParam,0x00,sizeof(stOrigParam));

    /* Modified by n00269697 for V3R3C60_eCall????, 2014-3-29, begin */
    /* ????<dial_string> */
    if (VOS_OK != AT_FillCalledNumPara(gastAtParaList[1].aucPara,
                                       gastAtParaList[1].usParaLen,
                                       &stOrigParam.stDialNumber))
    {
        AT_SetCsCallErrCause(ucIndex, TAF_CS_CAUSE_INVALID_PARAMETER);
        return AT_CME_INCORRECT_PARAMETERS;
    }
    /* Modified by n00269697 for V3R3C60_eCall????, 2014-3-29, end */

    stOrigParam.enCallType = CallType;

    At_SetDialIGPara(ucIndex,2,&stOrigParam.enClirCfg,&stOrigParam.stCugCfg);

    stOrigParam.enCallMode = pstSsCtx->enCModType;

    stOrigParam.stDataCfg = pstSsCtx->stCbstDataCfg;

    /* ????????????????????????????????????????3GPP?? */
    if (MN_CALL_TYPE_VIDEO == CallType)
    {
        stOrigParam.enVoiceDomain = TAF_CALL_VOICE_DOMAIN_3GPP;
    }
    else
    {
        stOrigParam.enVoiceDomain = TAF_CALL_VOICE_DOMAIN_AUTO;
    }

    /* ????????6????????????????????????I??G????????????????D???????? */
    if(AT_SUCCESS == MN_CALL_Orig(gastAtClientTab[ucIndex].usClientId,
                                  0,
                                  &gastAtClientTab[ucIndex].AtCallInfo.CallId,
                                  &stOrigParam))
    {
        if(MN_CALL_TYPE_VOICE == CallType)
        {
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_D_CS_VOICE_CALL_SET;
        }
        else
        {
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_D_CS_DATA_CALL_SET;
        }
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        AT_SetCsCallErrCause(ucIndex, TAF_CS_CAUSE_UNKNOWN);

        return AT_ERROR;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, End */
}
/*****************************************************************************
 ?? ?? ??  : At_DialNumByIndexFromPb
 ????????  : ??????????????????????
 ????????  : VOS_UINT8 ucIndex
             SI_PB_EVENT_INFO_STRU  *pEvent
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??26??
    ??    ??   : ????
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 At_DialNumByIndexFromPb(VOS_UINT8              ucIndex,
                                            SI_PB_EVENT_INFO_STRU  *pEvent)
{

    /*????????????????????????gastAtParaList[1].aucPara*/
    VOS_MemCpy(&gastAtParaList[1].aucPara[0],
               pEvent->PBEvent.PBReadCnf.PBRecord.Number,
               pEvent->PBEvent.PBReadCnf.PBRecord.NumberLength);
    gastAtParaList[1].aucPara[pEvent->PBEvent.PBReadCnf.PBRecord.NumberLength] = '\0';
    gastAtParaList[1].usParaLen = pEvent->PBEvent.PBReadCnf.PBRecord.NumberLength;
    /* D[<dial_string>][I][G][;] */
    return At_SetDialNumPara(ucIndex,gastAtClientTab[ucIndex].AtCallInfo.CallType);
}

/*****************************************************************************
 Prototype      : At_SetDialVoiceIndexPara
 Description    : D><n>[I][G][;]
 Input          : ucIndex --- ????????
                  CallType --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetDialVoiceIndexPara(TAF_UINT8 ucIndex, MN_CALL_TYPE_ENUM_U8 enCallType)
{
    TAF_UINT32 uLIndex = 0;
    SI_PB_STORATE_TYPE  Storage = SI_PB_STORAGE_UNSPECIFIED;

    if(AT_FAILURE == At_Auc2ul(gastAtParaList[2].aucPara,gastAtParaList[2].usParaLen,&uLIndex))
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].AtCallInfo.CallType = enCallType;

    At_SetDialIGPara(ucIndex,3,&gastAtClientTab[ucIndex].AtCallInfo.ClirInfo,&gastAtClientTab[ucIndex].AtCallInfo.CugMode);

    if ( AT_SUCCESS == SI_PB_Read( gastAtClientTab[ucIndex].usClientId,
                                    0,
                                    Storage,
                                    (TAF_UINT16)uLIndex,
                                    (TAF_UINT16)uLIndex)
        )
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_D_GET_NUMBER_BEFORE_CALL;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}
/*****************************************************************************
 Prototype      : At_SetDialVoiceNamePara
 Description    : D><name>[I][G][;]
 Input          : ucIndex --- ????????
                  CallType --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetDialVoiceNamePara(TAF_UINT8 ucIndex,MN_CALL_TYPE_ENUM_U8 CallType)
{

    if(AT_FAILURE == At_CheckNumLen(SI_PB_ALPHATAG_MAX_LEN,gastAtParaList[2].usParaLen))
    {
        return AT_ERROR;
    }

    if(AT_FAILURE == At_CheckStringPara(&gastAtParaList[2]))
    {
        return AT_ERROR;
    }

    /* ????ucAlphaTagType */
    if(AT_CSCS_UCS2_CODE == gucAtCscsType)
    {
        /* AlphaTagType = TAF_PB_ALPHATAG_TYPE_UCS2; */
        if(AT_FAILURE == At_UnicodePrint2Unicode(gastAtParaList[2].aucPara,&gastAtParaList[2].usParaLen))
        {
            return AT_ERROR;
        }
    }

    gastAtClientTab[ucIndex].AtCallInfo.CallType = CallType;

    At_SetDialIGPara(ucIndex,3,&gastAtClientTab[ucIndex].AtCallInfo.ClirInfo,&gastAtClientTab[ucIndex].AtCallInfo.CugMode);


    return AT_ERROR;
}
/*****************************************************************************
 Prototype      : At_SetDialVoiceMemPara
 Description    : D>mem<n>[I][G][;]
 Input          : ucIndex --- ????????
                  CallType --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
2.??    ??   : 2007??10??24??
  ??    ??   : zhuli 00100318
  ????????   : ??????????A32D13155

*****************************************************************************/
TAF_UINT32 At_SetDialVoiceMemPara(TAF_UINT8 ucIndex, MN_CALL_TYPE_ENUM_U8 CallType)
{
    TAF_UINT32 uLIndex = 0;
    SI_PB_STORATE_TYPE  Storage = SI_PB_STORAGE_UNSPECIFIED;

    if(AT_FAILURE == At_Auc2ul(gastAtParaList[3].aucPara,gastAtParaList[3].usParaLen,&uLIndex))
    {
        return AT_ERROR;
    }

    if(0 == VOS_StrCmp((TAF_CHAR*)"SM",(TAF_CHAR*)gastAtParaList[2].aucPara))
    {
        Storage = SI_PB_STORAGE_SM;
    }
    else
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].AtCallInfo.CallType = CallType;

    At_SetDialIGPara(ucIndex,4,&gastAtClientTab[ucIndex].AtCallInfo.ClirInfo,&gastAtClientTab[ucIndex].AtCallInfo.CugMode);

    if ( AT_SUCCESS == SI_PB_Read ( gastAtClientTab[ucIndex].usClientId,
                                    0,
                                    Storage,
                                    (TAF_UINT16)uLIndex,
                                    (TAF_UINT16)uLIndex)
        )
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_D_GET_NUMBER_BEFORE_CALL;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}
/*****************************************************************************
 ?? ?? ??  : At_SetDMmiNumWithClirPara
 ????????  : ????????????
 ????????  : ucIndex ?? ????????
             enClirType ?? clir????
             pcStrNum ?? ????????
             ulStrLen ?? ????????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  - ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??4??20??
    ??    ??   : h44270
    ????????   : ??????????

  2.??    ??   : 2011??10??22??
    ??    ??   : o00132663
    ????????   : AT??????????MN_AsciiNumberToBcd API????AT_AsciiNumberToBcd
  3.??    ??   : 2013??2??21??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetDMmiNumWithClirPara(
    TAF_UINT8                         ucIndex,
    MN_CALL_CLIR_CFG_ENUM_U8          enClirType,
    TAF_INT8                         *pcStrNum,
    TAF_UINT32                        ulStrLen
)
{
    MN_CALL_ORIG_PARAM_STRU             stOrigParam;
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, Begin */
    AT_MODEM_SS_CTX_STRU               *pstSsCtx = VOS_NULL_PTR;

    pstSsCtx = AT_GetModemSsCtxAddrFromClientId(ucIndex);
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, End */

    /* ???????? */
    if( (MN_CALL_MAX_BCD_NUM_LEN*2) < ulStrLen)
    {
        return AT_CME_DIAL_STRING_TOO_LONG;
    }

    /* ?????? */
    PS_MEM_SET(&stOrigParam,0x00,sizeof(stOrigParam));

    /* ????<dial_string> */
    if ('+' == pcStrNum[0])
    {
        stOrigParam.stDialNumber.enNumType
            = (0x80 | (MN_CALL_TON_INTERNATIONAL << 4) | MN_CALL_NPI_ISDN);
        if (MN_ERR_NO_ERROR != AT_AsciiNumberToBcd((TAF_CHAR *)pcStrNum + 1,
                            stOrigParam.stDialNumber.aucBcdNum,
                            &stOrigParam.stDialNumber.ucNumLen))
        {
            AT_WARN_LOG("At_SetDMmiNumWithClirPara():AT_AsciiNumberToBcd fail");
        }
    }
    else
    {
        stOrigParam.stDialNumber.enNumType
            = (0x80 | (MN_CALL_TON_UNKNOWN << 4) | MN_CALL_NPI_ISDN);
        if (MN_ERR_NO_ERROR != AT_AsciiNumberToBcd((TAF_CHAR *)pcStrNum,
                            stOrigParam.stDialNumber.aucBcdNum,
                            &stOrigParam.stDialNumber.ucNumLen))
        {
            AT_WARN_LOG("At_SetDMmiNumWithClirPara():AT_AsciiNumberToBcd fail");
        }
    }

    stOrigParam.enCallType = MN_CALL_TYPE_VOICE;
    stOrigParam.enClirCfg  = enClirType;

    stOrigParam.enVoiceDomain = TAF_CALL_VOICE_DOMAIN_AUTO;

    /* Modified by l60609 for DSDA Phase III, 2013-2-21, Begin */
    stOrigParam.enCallMode = pstSsCtx->enCModType;
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, End */

    if(AT_SUCCESS == MN_CALL_Orig(gastAtClientTab[ucIndex].usClientId,
                                  0,
                                  &gastAtClientTab[ucIndex].AtCallInfo.CallId,
                                  &stOrigParam))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_D_CS_VOICE_CALL_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : At_SetDMmiPara
 ????????  : ????ATD????mmi????
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  - ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??4??20??
    ??    ??   : h44270
    ????????   : ??????????
*****************************************************************************/
TAF_UINT32 At_SetDMmiPara(TAF_UINT8 ucIndex)
{
    TAF_UINT8                           pucPara[6];

    VOS_MemSet(pucPara, 0 ,sizeof(pucPara));
    gastAtParaList[0].aucPara[gastAtParaList[0].usParaLen - 1] = '\0';

    VOS_StrNCpy((TAF_CHAR *)pucPara, (TAF_CHAR*)gastAtParaList[0].aucPara, sizeof(pucPara) - 1);

    if ((VOS_OK == VOS_StrCmp((TAF_CHAR*)pucPara,"D*31#")))
    {
        return At_SetDMmiNumWithClirPara(ucIndex,
                                         MN_CALL_CLIR_SUPPRESS,
                                         (VOS_INT8*)(gastAtParaList[0].aucPara + VOS_StrLen("D*31#")),
                                         VOS_StrLen((VOS_CHAR *)gastAtParaList[0].aucPara) - VOS_StrLen("D*31#"));
    }
    else if (VOS_OK == VOS_StrCmp((TAF_CHAR*)pucPara,"d*31#"))
    {
        return At_SetDMmiNumWithClirPara(ucIndex,
                                         MN_CALL_CLIR_SUPPRESS,
                                         (VOS_INT8*)(gastAtParaList[0].aucPara + VOS_StrLen("d*31#")),
                                         VOS_StrLen((VOS_CHAR *)gastAtParaList[0].aucPara) - VOS_StrLen("d*31#"));
    }
    else if ((VOS_OK == VOS_StrCmp((TAF_CHAR*)pucPara,"D#31#")))
    {
        return At_SetDMmiNumWithClirPara(ucIndex,
                                         MN_CALL_CLIR_INVOKE,
                                         (VOS_INT8*)(gastAtParaList[0].aucPara + VOS_StrLen("D#31#")),
                                         VOS_StrLen((VOS_CHAR *)gastAtParaList[0].aucPara) - VOS_StrLen("D#31#"));
    }
    else if ((VOS_OK == VOS_StrCmp((TAF_CHAR*)pucPara,"d#31#")))
    {
        return At_SetDMmiNumWithClirPara(ucIndex,
                                         MN_CALL_CLIR_INVOKE,
                                         (VOS_INT8*)(gastAtParaList[0].aucPara + VOS_StrLen("d#31#")),
                                         VOS_StrLen((VOS_CHAR *)gastAtParaList[0].aucPara) - VOS_StrLen("d#31#"));
    }
    else
    {
        /* D*752#+436644101453; */
        gastAtParaList[0].aucPara[gastAtParaList[0].usParaLen - 1] = 0;
        gastAtParaList[0].usParaLen--;
        return AT_ERROR;
    }

}
/*****************************************************************************
 ?? ?? ??  : At_CheckAtDPin
 ????????  : ????????????????????pin??
 ????????  : ??
 ????????  : ??
 ?? ?? ??  :??????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??5??19??
    ??    ??   : s62952
    ????????   : ??????????

  2.??    ??   : 2012??12??24??
    ??    ??   : l60609
    ????????   : DSDA Phase II
*****************************************************************************/
TAF_UINT32  At_CheckAtDPin(VOS_UINT8 ucIndex)
{
    TAF_UINT32                          ulRst;
    /* Modified by l60609 for DSDA Phase II, 2012-12-24, Begin */
    MODEM_ID_ENUM_UINT16                enModemId;
    VOS_UINT32                          ulGetModemIdRslt;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_USIM_INFO_CTX_STRU              *pstUsimInfoCtx = VOS_NULL_PTR;

    enModemId = MODEM_ID_0;

    ulGetModemIdRslt = AT_GetModemIdFromClient(ucIndex, &enModemId);

    if (VOS_OK != ulGetModemIdRslt)
    {
        AT_ERR_LOG("At_CheckAtDPin:Get Modem Id fail!");
        return AT_ERROR;
    }

    pstUsimInfoCtx = AT_GetUsimInfoCtxFromModemId(enModemId);

    /* Modified by l60609 for DSDA Phase II, 2012-12-24, End */

    /*SIM??????????*/
    switch (pstUsimInfoCtx->enCardStatus)
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */
    {
        case USIMM_CARD_SERVIC_AVAILABLE:
            ulRst = AT_SUCCESS;
            break;
        case USIMM_CARD_SERVIC_SIM_PIN:
            ulRst = AT_CME_SIM_PIN_REQUIRED;
            break;
        case USIMM_CARD_SERVIC_SIM_PUK:
            ulRst = AT_CME_SIM_PUK_REQUIRED;
            break;
        case USIMM_CARD_SERVIC_UNAVAILABLE:
        case USIMM_CARD_SERVIC_NET_LCOK:
        case USIMM_CARD_SERVICE_IMSI_LOCK:
            ulRst = AT_CME_SIM_FAILURE;
            break;
        case USIMM_CARD_SERVIC_ABSENT:
            ulRst = AT_CME_SIM_NOT_INSERTED;
            break;
        default:
            ulRst = AT_ERROR;
            break;
    }

    return ulRst;
}

/*****************************************************************************
 ?? ?? ??  : At_PsDPara
 ????????  :????PS????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??5??19??
    ??    ??   : s62952
    ????????   : ??????????

  2.??    ??   : 2011??10??28??
    ??    ??   : ????/l60609
    ????????   : AT Project:??????????????????????????????

  3.??    ??   : 2011??12??17??
    ??    ??   : C00173809
    ????????   : PS??????????????????API

  4.??    ??   : 2012??8??22??
    ??    ??   : A00165503
    ????????   : ????PS????????????????
*****************************************************************************/
TAF_UINT32  At_PsDPara(TAF_UINT8 ucIndex)
{
    TAF_UINT32    ulRst;

    ulRst = At_CheckAtDPin(ucIndex);
    if (AT_SUCCESS != ulRst)
    {
        return ulRst;
    }

    if(AT_SUCCESS == At_CheckSemicolon(gastAtParaList[0].aucPara[gastAtParaList[0].usParaLen - 1])) /* ??????????,D*752#+436644101453; */
    {

        /* D*752#+436644101453; */
        gastAtParaList[0].aucPara[gastAtParaList[0].usParaLen - 1] = 0;
        gastAtParaList[0].usParaLen--;
    }
    else if('#' == gastAtParaList[0].aucPara[gastAtParaList[0].usParaLen - 1])
    {
        /* Modified by L60609 for AT Project??2011-10-28,  Begin*/
        if(0 == VOS_StrNiCmp((TAF_CHAR*)gastAtParaList[2].aucPara,"98", gastAtParaList[2].usParaLen))
        {
            /* D*<GPRS_SC_IP>[*<cid>[,<cid>]]# */
            return At_SetDial98Para(ucIndex);
        }
        else if(0 == VOS_StrNiCmp((TAF_CHAR*)gastAtParaList[2].aucPara,"99", gastAtParaList[2].usParaLen))
        {
            /* D*<GPRS_SC>[*[<called_address>][*[<L2P>][*[<cid>]]]]# */
            return At_SetDial99Para(ucIndex);
        }
        else if(0 == VOS_StrNiCmp((TAF_CHAR*)gastAtParaList[2].aucPara, "777", gastAtParaList[2].usParaLen))
        {
            return At_SetDial777Para(ucIndex);
        }
        else
        {

        }
        /* Modified by L60609 for AT Project??2011-10-28,  End*/
    }
    else
    {

    }
    return AT_ERROR;

}
/*****************************************************************************
 ?? ?? ??  : At_CheckDialStrPara
 ????????  : ????ATD??????????????????????????*,#????????,????????????????
             ????????????????????gastAtParaList[1].aucPara??,
             ????At_ParseCmd()??????????????????
 ????????  : ??
 ????????  : ??
 ?? ?? ??  : ??
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??11??11??
    ??    ??   : z00161729
    ????????   : ??????????,??????:DTS2010111200726:CS????????????????????????*????????

*****************************************************************************/
VOS_VOID At_CheckDialStrPara(VOS_VOID)
{
    if (AT_SUCCESS == At_CheckMmiString(gastAtParaList[0].aucPara,gastAtParaList[0].usParaLen))
    {
        if(';' != gastAtParaList[0].aucPara[gastAtParaList[0].usParaLen - 1])
        {
            PS_MEM_CPY(gastAtParaList[1].aucPara, &gastAtParaList[0].aucPara[1], (VOS_SIZE_T)(gastAtParaList[0].usParaLen - 1));
            gastAtParaList[1].usParaLen = gastAtParaList[0].usParaLen - 1;
        }
        else
        {
            PS_MEM_CPY(gastAtParaList[1].aucPara, &gastAtParaList[0].aucPara[1], (VOS_SIZE_T)(gastAtParaList[0].usParaLen - 2));
            gastAtParaList[1].usParaLen = gastAtParaList[0].usParaLen - 2;
        }
    }

    return;
}

/*****************************************************************************
 ?? ?? ??  : At_JudgeIfIsPsCall
 ????????  : ??????????????PS Call
 ????????  : ??
 ????????  : ??
 ?? ?? ??  : VOS_TRUE  - ??PS CALL
             VOS_FALSE - ??PS CALL
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??11??11??
    ??    ??   : z00161729
    ????????   : ??????????,??????:DTS2010111200726:CS????????????????????????*????????

  2.??    ??   : 2014??10??9??
    ??    ??   : l00198894
    ????????   : DTS2014100903201: "ATD*98;"CS????????

*****************************************************************************/
VOS_UINT8 At_JudgeIfIsPsCall(VOS_VOID)
{
    VOS_UINT8                           ucPsCallFlg;

    if ('#' != gastAtParaList[0].aucPara[gastAtParaList[0].usParaLen - 1])
    {
        ucPsCallFlg = VOS_FALSE;
    }
    else if (AT_CheckStrStartWith(&gastAtParaList[0].aucPara[1], (VOS_UINT8 *)"*98"))
    {
        ucPsCallFlg = VOS_TRUE;
    }
    else if (AT_CheckStrStartWith(&gastAtParaList[0].aucPara[1], (VOS_UINT8 *)"*99"))
    {
        ucPsCallFlg = VOS_TRUE;
    }
    else if (AT_CheckStrStartWith(&gastAtParaList[1].aucPara[0], (VOS_UINT8 *)"#777"))
    {
        ucPsCallFlg = VOS_TRUE;
    }
    else
    {
        ucPsCallFlg = VOS_FALSE;
    }

    return ucPsCallFlg;
}
/*****************************************************************************
 Prototype      : At_SetDPara
 Description    : D[<dial_string>][I][G][;]
                  D[<dial_string>] ????????
                  D>mem<n>[I][G][;]
                  D><n>[I][G][;]
                  D><name>[I][G][;]
                  D*<GPRS_SC>[*[<called_address>][*[<L2P>][*[<cid>]]]]#
                  D*<GPRS_SC_IP>[*<cid>]#
                  D**61*+1812555673*11*25#  ---  ????????????,????????????????MMI????
                  D*752#+436644101453;
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2010??11??11??
    ??    ??   : z00161729
    ????????   : ??????:DTS2010111200726:CS????????????????????????*????????
  3.??    ??   : 2010??12??29??
    ??    ??   : z00161729
    ????????  : ??????DTS2010123000175:TME????????????????????????????????????????no number
  4.??    ??   : 2012??11??16??
    ??    ??   : f62575
    ????????  : ??????DTS2012111409590: ??????ATD38944425#123i??????50????????????
*****************************************************************************/
TAF_UINT32 At_SetDPara(TAF_UINT8 ucIndex)
{
    /* cS call */
    if(VOS_TRUE != At_JudgeIfIsPsCall())
    {
        MN_CALL_TYPE_ENUM_U8 CallType = MN_CALL_TYPE_VOICE;

        g_ucDtrDownFlag = VOS_FALSE;

        if(';' != gastAtParaList[0].aucPara[gastAtParaList[0].usParaLen - 1])
        {
            CallType = MN_CALL_TYPE_VIDEO;
        }

        if('>' == gastAtParaList[1].aucPara[0])
        {
            if(('A' <= gastAtParaList[2].aucPara[0]) && (gastAtParaList[2].aucPara[0] <= 'Z'))
            {
                /* D>mem<n>[I][G][;] */
                return At_SetDialVoiceMemPara(ucIndex,CallType);
            }
            else if(('0' <= gastAtParaList[2].aucPara[0]) && (gastAtParaList[2].aucPara[0] <= '9'))
            {
                /* D><n>[I][G][;] */
                return At_SetDialVoiceIndexPara(ucIndex,CallType);
            }
            else
            {
                /* D><name>[I][G][;] */
                return At_SetDialVoiceNamePara(ucIndex,CallType);
            }
        }
        else
        {
            /* D[<dial_string>][I][G][;] */
            return At_SetDialNumPara(ucIndex,CallType);
        }
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    else
    {
        return At_PsDPara(ucIndex);
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, end */

}

/*****************************************************************************
 Prototype      : At_SetAPara
 Description    : A
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2010??05??07??
    ??    ??   : z00161729
    ????????   : ??????????AT2D19199,??????????????????????active??????????
  3.??    ??   : 2010??11??27??
    ??    ??   : w00166186
    ????????   : DTS2010111800201 ??????????????????????????????MP????
  4.??    ??   : 2011??2??10??
    ??    ??   : z00161729
    ????????  : DTS2011021002220:??????????????????????ATA??????????????????
  5.??    ??   : 2011??10??06??
    ??    ??   : f00179208
    ????????   : AT??????????????AT????????????????????
  6.??    ??   : 2011??12??29??
    ??    ??   : w00199382
    ????????   : ????MN_CALL_GetCallInfos??????????????????API
  7.??    ??   : 2012??4??7??
    ??    ??   : l60609
    ????????   : DTS2012031702864:????????????????????????????
  8.??    ??   : 2012??8??10??
    ??    ??   : L00171473
    ????????   : DTS2012082204471, TQE????
  9.??    ??   : 2013??2??21??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  10.??    ??   : 2013??12??17??
    ??    ??   : z00161729
    ????????   : DTS2013121800233:????????????????????ata????????active??????hold????????????????active
                 ??????????????????ata????????ok
*****************************************************************************/
TAF_UINT32 At_SetAPara(TAF_UINT8 ucIndex)
{
    MN_CALL_SUPS_PARAM_STRU   stCallMgmtParam;
    VOS_UINT32                ulTimerId;

    /* Modified by w00199382 for PS Project??2011-12-06,  Begin*/
    VOS_UINT8                           ucNumOfCalls;
    VOS_UINT8                           ucTmp;
    VOS_UINT32                          ulRlst;
    TAFAGERNT_MN_CALL_INFO_STRU         astCallInfos[MN_CALL_MAX_NUM];
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, Begin */
    AT_MODEM_CC_CTX_STRU               *pstCcCtx = VOS_NULL_PTR;

    pstCcCtx = AT_GetModemCcCtxAddrFromClientId(ucIndex);


    PS_MEM_SET(astCallInfos, 0x00, sizeof(astCallInfos));


    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }


/* Modified by s00217060 for VoLTE_PhaseII  ????, 2013-10-15, begin */
    /*??????API????????????*/
    /* Modified by l60609 for DSDA PhaseIII, 2013-3-13, begin */
    ulRlst = TAF_AGENT_GetCallInfoReq(gastAtClientTab[ucIndex].usClientId,
                                      &ucNumOfCalls,
                                      astCallInfos);
    /* Modified by l60609 for DSDA PhaseIII, 2013-3-13, end */

    if (VOS_OK != ulRlst)
    {
        return AT_ERROR;
    }

    if (0 == ucNumOfCalls)
    {
        return AT_NO_CARRIER;
    }

    for (ucTmp = 0; ucTmp < ucNumOfCalls; ucTmp++)
    {
        /*??????????????????????????????????????incoming??????????ATA??????????ok*/
        if ((MN_CALL_S_INCOMING == astCallInfos[ucTmp].enCallState)
             && (0 != pstCcCtx->stS0TimeInfo.ucS0TimerLen)
             && (TAF_FALSE == pstCcCtx->stS0TimeInfo.bTimerStart))
        {
            return AT_OK;
        }
        /*????????????????????????????????????????incoming??????????ATA??????????error*/
        else if ((0 != pstCcCtx->stS0TimeInfo.ucS0TimerLen)
              && (TAF_FALSE == pstCcCtx->stS0TimeInfo.bTimerStart))
        {
            return AT_NO_CARRIER;
        }
        /* ??????????active??????????ata????????ok */
        else if (MN_CALL_S_ACTIVE == astCallInfos[ucTmp].enCallState)
        {
            return AT_OK;
        }
        else
        {
        }
    }
    /* Modified by w00199382 for PS Project??2011-12-06,  End*/
/* Modified by s00217060 for VoLTE_PhaseII  ????, 2013-10-15, end */


    PS_MEM_SET(&stCallMgmtParam, 0, sizeof(stCallMgmtParam));
    stCallMgmtParam.enCallSupsCmd = MN_CALL_SUPS_CMD_HOLD_ACT_ACPT_OTH;

    if(AT_SUCCESS == MN_CALL_Sups(gastAtClientTab[ucIndex].usClientId, 0, &stCallMgmtParam))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_A_SET;
        if (TAF_TRUE == pstCcCtx->stS0TimeInfo.bTimerStart)
        {
            ulTimerId = pstCcCtx->stS0TimeInfo.ulTimerName;

            AT_StopRelTimer(ulTimerId, &(pstCcCtx->stS0TimeInfo.s0Timer));
            pstCcCtx->stS0TimeInfo.bTimerStart = TAF_FALSE;
            pstCcCtx->stS0TimeInfo.ulTimerName = 0;
        }
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_NO_CARRIER;
    }

    /* Modified by l60609 for DSDA Phase III, 2013-2-21, End */

}

/*****************************************************************************
 ?? ?? ??  : AT_MODEM_HangupCall
 ????????  : ????PPP????????
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  - ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??9??23??
    ??    ??   : A00165503
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_MODEM_HangupCall(VOS_UINT8 ucIndex)
{
    AT_UART_LINE_CTRL_STRU             *pstLineCtrl = VOS_NULL_PTR;
    VOS_UINT32                          ulRslt;

    pstLineCtrl = AT_GetUartLineCtrlInfo();

    /* ONLINE-COMMAND??????, ????????PPP???????? */
    if (AT_ONLINE_CMD_MODE == gastAtClientTab[ucIndex].Mode)
    {
        /* ????????PPP????????, ????????, ??????????????????AT_CMD_H_PS_SET */
        if (AT_CMD_PS_DATA_CALL_END_SET == gastAtClientTab[ucIndex].CmdCurrentOpt)
        {
            AT_STOP_TIMER_CMD_READY(ucIndex);
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_H_PS_SET;
            ulRslt = AT_WAIT_ASYNC_RETURN;
        }
        /* ????????PPP??????????, ????????, ????OK */
        else if (AT_CMD_WAIT_PPP_PROTOCOL_REL_SET == gastAtClientTab[ucIndex].CmdCurrentOpt)
        {
            AT_STOP_TIMER_CMD_READY(ucIndex);
            At_SetMode(ucIndex, AT_CMD_MODE, AT_NORMAL_MODE);
            At_FormatResultData(ucIndex, AT_OK);

            if (AT_UART_DCD_MODE_CONNECT_ON == pstLineCtrl->enDcdMode)
            {
                AT_CtrlDCD(ucIndex, AT_IO_LEVEL_LOW);
            }

            ulRslt = AT_SUCCESS;
        }
        else
        {
            (VOS_VOID)TAF_PS_CallEnd(WUEPS_PID_AT,
                                     AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                     0,
                                     gastAtClientTab[ucIndex].ucCid);

            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_H_PS_SET;
            ulRslt = AT_WAIT_ASYNC_RETURN;
        }
    }
    /* ??????????, ????????????OK */
    else
    {
        ulRslt = AT_OK;
    }

    return ulRslt;
}

/*****************************************************************************
 ?? ?? ??  : At_SetHPara
 ????????  : ????????????????????????????????????????????????????????????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2005??04??19??
    ??    ??   : ---
    ????????   : ??????????

  2.??    ??   : 2007??06??29??
    ??    ??   : s62952
    ????????   : ????????:A32D11842

  3.??    ??   : 2011??10??06??
    ??    ??   : f00179208
    ????????   : AT????????, ????????????Idle??????Call????C??

  4.??    ??   : 2013??9??23??
    ??    ??   : A00165503
    ????????   : UART-MODEM: ????????PS??????????
*****************************************************************************/
VOS_UINT32 At_SetHPara(VOS_UINT8 ucIndex)
{
    MN_CALL_SUPS_PARAM_STRU             stCallMgmtParam;

    /* ????????????????????????????????OK?????? */

    /*??Modem??????????????: ????ATH????????OK??
      ????Modem????????????????????????????*/
    if ((AT_MODEM_USER == gastAtClientTab[ucIndex].UserType)
     && (AT_CLIENT_USED == gastAtClientTab[ucIndex].ucUsed))
    {
        return AT_OK;
    }

    /* ????????????????:
     * (1) ONLINE-COMMAND???? - ??????????????PPP????????
     * (2) COMMAND????        - ????????OK
     */
    if (AT_HSUART_USER == gastAtClientTab[ucIndex].UserType)
    {
        return AT_MODEM_HangupCall(ucIndex);
    }

    /*????????????????????????????????????????????????????????????????
      ??????????????ATH??????CHUP??????*/
    /* Added by y00245242 for VoLTE_PhaseII  ????, 2013-7-15, begin */
    PS_MEM_SET(&stCallMgmtParam, 0, sizeof(stCallMgmtParam));
    /* Added by y00245242 for VoLTE_PhaseII  ????, 2013-7-15, begin */
    stCallMgmtParam.enCallSupsCmd = MN_CALL_SUPS_CMD_REL_ALL_CALL;
    if(AT_SUCCESS == MN_CALL_Sups(gastAtClientTab[ucIndex].usClientId, 0, &stCallMgmtParam))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_H_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}
/*****************************************************************************
 Prototype      : At_SetEPara
 Description    : E[<value>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetEPara(TAF_UINT8 ucIndex)
{
    if(0 != gastAtParaList[0].usParaLen)
    {
        gucAtEType = (AT_CMD_ECHO_TYPE)gastAtParaList[0].ulParaValue;
    }
    else
    {
        gucAtEType = AT_E_ECHO_CMD;
    }
    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetVPara
 Description    : V[<value>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function

  2.??    ??   : 2012??4??23??
    ??    ??   : L60609
    ????????   : DTS2012031400877:ATV??????ATV0
*****************************************************************************/
TAF_UINT32 At_SetVPara(TAF_UINT8 ucIndex)
{
    if(0 != gastAtParaList[0].usParaLen)
    {
        gucAtVType = (AT_V_TYPE)gastAtParaList[0].ulParaValue;
    }
    else
    {
        gucAtVType = AT_V_ENTIRE_TYPE;
    }
    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetTPara
 Description    : T
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2009-05-27
    Author      : L47619
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetTPara(TAF_UINT8 ucIndex)
{
    /* ????Q??????:This commands will have no effect in our code*/
    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetPPara
 Description    : P
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2009-05-27
    Author      : L47619
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetPPara(TAF_UINT8 ucIndex)
{
    /* ????Q??????:This commands will have no effect in our code*/
    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetXPara
 Description    : X[value]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2009-05-27
    Author      : L47619
    Modification: Created function
   2.??    ??   : 2010??07??10??
     ??    ??   : w00167002
     ????????   : ??????????DTS2010071000468,????????????????????????????????????gucAtXType??0.
*****************************************************************************/
TAF_UINT32 At_SetXPara(TAF_UINT8 ucIndex)
{
    if(0 != gastAtParaList[0].usParaLen)
    {
        gucAtXType = (TAF_UINT8)gastAtParaList[0].ulParaValue;
    }
    else
    {
        gucAtXType = 0;
    }
    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetZPara
 Description    : Z[value]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2009-05-27
    Author      : L47619
    Modification: Created function
  2.??    ??   : 2013??5??17??
    ??    ??   : l00167671
    ????????   : NV??????????, ??NV??????????????????
  3.??    ??   : 2014??5??30??
    ??    ??   : j00174725
    ????????   : TQE
*****************************************************************************/
TAF_UINT32 At_SetZPara(TAF_UINT8 ucIndex)
{
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    TAF_AT_TZ_STRU                      stTz;
    VOS_CHAR                            acTzStr[AT_SETZ_LEN+1];

    VOS_UINT16                          usLength;
    VOS_UINT8                          *pucSystemAppConfig;

    pucSystemAppConfig                  = AT_GetSystemAppConfigAddr();

    PS_MEM_SET(&stTz, 0x0, sizeof(stTz));

    if ( SYSTEM_APP_WEBUI == *pucSystemAppConfig)
    {
        if (NV_OK == NV_ReadEx(MODEM_ID_0, en_NV_Item_ATSETZ_RET_VALUE, &stTz,
                             AT_SETZ_LEN))
        {
            PS_MEM_CPY(acTzStr, stTz.acTz, AT_SETZ_LEN);
            acTzStr[AT_SETZ_LEN] = 0;
            if ( VOS_StrLen(acTzStr) > 0 )
            {
                usLength  = 0;
                usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                                 (VOS_CHAR *)pgucAtSndCodeAddr,
                                                 (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                                 "%s",gaucAtCrLf);
                usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                                  (VOS_CHAR *)pgucAtSndCodeAddr,
                                                  (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                                  "%s",acTzStr);
                usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                                 (VOS_CHAR *)pgucAtSndCodeAddr,
                                                 (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                                 "%s",gaucAtCrLf);

                At_SendResultData((VOS_UINT8)ucIndex,pgucAtSndCodeAddr,usLength);

                return AT_SUCCESS;
            }
        }
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, end */

    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetQPara
 Description    : Q[value]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2009-08-06
    Author      : L47619
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetQPara(TAF_UINT8 ucIndex)
{
    if(0 != gastAtParaList[0].usParaLen)
    {
        gucAtQType = (AT_CMD_ECHO_TYPE)gastAtParaList[0].ulParaValue;
    }
    else
    {
        gucAtQType = 0;
    }
    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetAmpCPara
 ????????  : &C[value]
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  --- ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2009??5??27??
    ??    ??   : L47169
    ????????   : ????????

  2.??    ??   : 2013??9??30??
    ??    ??   : z00189113
    ????????   : ????UART????????????
*****************************************************************************/
VOS_UINT32 At_SetAmpCPara(VOS_UINT8 ucIndex)
{
    AT_UART_CTX_STRU                   *pstUartCtx = VOS_NULL_PTR;
    AT_UART_DCD_MODE_ENUM_UINT8         enDcdMode;

    pstUartCtx = AT_GetUartCtxAddr();

    /* ??????UART???????? */
    if (VOS_TRUE != AT_CheckHsUartUser(ucIndex))
    {
        return AT_OK;
    }

    /* ???????? */
    if (0 != gastAtParaList[0].usParaLen)
    {
        if ((0 != gastAtParaList[0].ulParaValue)
         && (1 != gastAtParaList[0].ulParaValue))
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        enDcdMode = (AT_UART_DCD_MODE_ENUM_UINT8)gastAtParaList[0].ulParaValue;
    }
    else
    {
        /* AT&C ?????? AT&C1 */
        enDcdMode = AT_UART_DEFAULT_DCD_MODE;
    }

    /* ????DCD Line Mode???????? */
    pstUartCtx->stLineCtrl.enDcdMode = enDcdMode;

    /* DCD???????? */
    if(AT_UART_DCD_MODE_ALWAYS_ON == enDcdMode)
    {
        AT_CtrlDCD(ucIndex, AT_IO_LEVEL_HIGH);
    }
    else
    {
        if (AT_CMD_MODE == gastAtClientTab[ucIndex].Mode)
        {
            AT_CtrlDCD(ucIndex, AT_IO_LEVEL_LOW);
        }
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetAmpDPara
 ????????  : &D[value]
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  --- ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2009??5??27??
    ??    ??   : L47169
    ????????   : ????????

  2.??    ??   : 2013??9??30??
    ??    ??   : z00189113
    ????????   : ????UART ????????????
*****************************************************************************/
VOS_UINT32 At_SetAmpDPara(VOS_UINT8 ucIndex)
{
    AT_UART_CTX_STRU                   *pstUartCtx = VOS_NULL_PTR;
    AT_UART_DTR_MODE_ENUM_UINT8         enDtrMode;

    pstUartCtx = AT_GetUartCtxAddr();

    /* ??????UART???????? */
    if (VOS_TRUE != AT_CheckHsUartUser(ucIndex))
    {
        return AT_OK;
    }

    /* ???????? */
    if (0 != gastAtParaList[0].usParaLen)
    {
        enDtrMode = (AT_UART_DTR_MODE_ENUM_UINT8)gastAtParaList[0].ulParaValue;
    }
    else
    {
        /* AT&D ?????? AT&D2 */
        enDtrMode = AT_UART_DEFAULT_DTR_MODE;
    }

    /* ????DTR Line Mode???????? */
    pstUartCtx->stLineCtrl.enDtrMode = enDtrMode;

    return AT_OK;
}


/*****************************************************************************
 ?? ?? ??  : AT_SetLPara
 ????????  : L,????????????????????????????????X????modem??????????????????
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : OK
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??3??06??
    ??    ??   : Y00213812
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetLPara(VOS_UINT8 ucIndex)
{
    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetMPara
 ????????  : M,????????????????????????????????X????modem??????????????????
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : OK
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??3??06??
    ??    ??   : Y00213812
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetMPara(VOS_UINT8 ucIndex)
{
    return AT_OK;
}



/*****************************************************************************
 Prototype      : At_SetFPara
 Description    : &F<value>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2006??11??27??
    ??    ??   : z40661
    ????????   : ??????A32D07303??
  3.??    ??   : 2010??11??20??
    ??    ??   : S62952
    ????????   : ??????201011902567,modenNV??????

  4.??    ??   : 2010??11??23??
    ??    ??   : zhoujun 40661
    ????????   : ??????????????????????????????
  5.??    ??   : 2010??12??23??
    ??    ??   : lijun 00171473
    ????????   : DTS2010122104338 OM????????????????????????,NAS????????
  6.??    ??   : 2011??07??19??
    ??    ??   : l60609
    ????????   : DTS2011071902114 ????????????????????????
  7.??    ??   : 2011??11??04??
    ??    ??   : f00179208
    ????????   : AT Project:NV_RestoreManufactureDefault??C??????
*****************************************************************************/
TAF_UINT32 At_SetFPara(TAF_UINT8 ucIndex)
{
    VOS_UINT32                          ulRet;
    /* Added by L60609 for AT Project??2011-10-24,  Begin*/
    /* ??if 0??????????????????????????????????8229??8265????NV??????????????????????????????????????????????????????????#if 0????????*/
    /* Added by L60609 for AT Project??2011-10-24,  End*/

    /*????MODEN????????????????????????moden????????NV??????????????OK*/
    if ( (AT_MODEM_USER == gastAtClientTab[ucIndex].UserType)
      || (AT_HSUART_USER == gastAtClientTab[ucIndex].UserType) )
    {
        return AT_OK;
    }
    if ( VOS_TRUE == g_bSetFlg )
    {
        return AT_OK;
    }

    /* Modified by o00132663 for AT Project??2011-10-24,  Begin*/
    /* DPM_SleepDisable(DPM_SLEEP_NV); */
    /* Modified by o00132663 for AT Project??2011-10-24,  Begin*/


    ulRet = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   DRV_AGENT_NVRESTORE_MANU_DEFAULT_REQ,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_WUEPS_PID_DRV_AGENT);

    if (TAF_SUCCESS == ulRet)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_F_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }


}

/*****************************************************************************
 Prototype      : At_SetS0Para
 Description    : S0=[<value>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function

  2.??    ??   : 2007??06??29??
    ??    ??   : s62952
    ????????   : ????????:A32D11842

  3.??    ??   : 2012??8??10??
    ??    ??   : L00171473
    ????????   : DTS2012082204471, TQE????

  4.??    ??   : 2013??2??21??
    ??    ??   : l60609
    ????????   : DSDA PHASE III

  5.??    ??   : 2013??9??23??
    ??    ??   : A00165503
    ????????   : UART-MODEM: ????????????????????????????????OK??????
*****************************************************************************/
TAF_UINT32 At_SetS0Para(TAF_UINT8 ucIndex)
{
    TAF_CCA_TELE_PARA_STRU              stTimeInfo;
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, Begin */
    AT_MODEM_CC_CTX_STRU               *pstCcCtx = VOS_NULL_PTR;
    MODEM_ID_ENUM_UINT16                enModemId;
    VOS_UINT32                          ulRslt;

    enModemId = MODEM_ID_0;

    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????????????????????????OK?????? */

    ulRslt = AT_GetModemIdFromClient(ucIndex, &enModemId);

    if (VOS_OK != ulRslt)
    {
        AT_ERR_LOG("At_SetS0Para: Get modem id fail.");
        return AT_ERROR;
    }

    pstCcCtx = AT_GetModemCcCtxAddrFromModemId(enModemId);

    pstCcCtx->stS0TimeInfo.ucS0TimerLen = (TAF_UINT8)gastAtParaList[0].ulParaValue;
    pstCcCtx->stS0TimeInfo.usClientId   = gastAtClientTab[ucIndex].usClientId;

    PS_MEM_SET(&stTimeInfo, 0x00, sizeof(stTimeInfo));

    if (NV_OK == NV_ReadEx(enModemId, en_NV_Item_CCA_TelePara, &stTimeInfo, sizeof(TAF_CCA_TELE_PARA_STRU)))
    {
        if ( stTimeInfo.ucS0TimerLen == pstCcCtx->stS0TimeInfo.ucS0TimerLen )
        {
            AT_INFO_LOG("At_SetS0Para():The content to write is same as NV's");
            return AT_OK;
        }
    }
    stTimeInfo.ucS0TimerLen = pstCcCtx->stS0TimeInfo.ucS0TimerLen;
    if (NV_OK != NV_WriteEx(enModemId, en_NV_Item_CCA_TelePara, &stTimeInfo, sizeof(TAF_CCA_TELE_PARA_STRU)))
    {
        return AT_ERROR;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, End */

    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetS3Para
 Description    : S3=[<value>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetS3Para(TAF_UINT8 ucIndex)
{
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(0 != gastAtParaList[0].usParaLen)
    {
        ucAtS3 = (TAF_UINT8)gastAtParaList[0].ulParaValue;
    }
    else
    {
        ucAtS3 = 13;
    }
    gaucAtCrLf[0] = ucAtS3;
    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetS4Para
 Description    : S4=[<value>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetS4Para(TAF_UINT8 ucIndex)
{
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(0 != gastAtParaList[0].usParaLen)
    {
        ucAtS4 = (TAF_UINT8)gastAtParaList[0].ulParaValue;
    }
    else
    {
        ucAtS4 = 10;
    }
    gaucAtCrLf[1] = ucAtS4;
    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetS5Para
 Description    : S5=[<value>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetS5Para(TAF_UINT8 ucIndex)
{
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(0 != gastAtParaList[0].usParaLen)
    {
        ucAtS5 = (TAF_UINT8)gastAtParaList[0].ulParaValue;
    }
    else
    {
        ucAtS5 = 8;
    }
    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetS6Para
 Description    : S6=[<value>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2009-05-27
    Author      : L47619
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetS6Para(TAF_UINT8 ucIndex)
{
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(0 != gastAtParaList[0].usParaLen)
    {
        ucAtS6 = (TAF_UINT8)gastAtParaList[0].ulParaValue;
    }
    else
    {
        /* refer to V.250:
           Recommended default setting
           2       Wait two seconds before blind dialling
         */
        ucAtS6 = 2;
    }
    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetS7Para
 Description    : S7=[<value>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2009-05-27
    Author      : L47619
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetS7Para(TAF_UINT8 ucIndex)
{
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /*
      refer to V.250:
      S7:Number of seconds in which connection must be established or call will be disconnected
     */
    if(0 != gastAtParaList[0].usParaLen)
    {
        ucAtS7 = (TAF_UINT8)gastAtParaList[0].ulParaValue;
    }
    else
    {
        /* ????Q??????????????????50 */
        ucAtS7 = 50;
    }
    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetDefaultRatPrioList
 ????????  : ????????????????gsm/wcdma/LTE??????
 ????????  : MODEM_ID_ENUM_UINT16                enModemId,
             TAF_MMA_RAT_ORDER_STRU              *pstSysCfgRatOrder,
             VOS_UINT8                           ucUserSptLteFlag
 ????????  : pstSysCfgRatOrder - ??????????????
 ?? ?? ??  : ??
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??7??13??
    ??    ??   : z00161729
    ????????   : ??????????

  2.??    ??   : 2012??12??25??
    ??    ??   : z00220246
    ????????   : DSDA Phase II

  3.??    ??   : 2015??4??10??
    ??    ??   : h00313353
    ????????   : SysCfg????
*****************************************************************************/
VOS_VOID AT_SetDefaultRatPrioList(
    MODEM_ID_ENUM_UINT16                enModemId,
    TAF_MMA_RAT_ORDER_STRU             *pstSysCfgRatOrder,
    VOS_UINT8                           ucUserSptLteFlag
)
{
    VOS_UINT8                           ucUserRatNum;

    ucUserRatNum = 0;

    /* ????????????????LTE */
    if (VOS_TRUE == ucUserSptLteFlag)
    {
        /* ????????LTE */
        if (VOS_TRUE == AT_IsModemSupportRat(enModemId, TAF_MMA_RAT_LTE))
        {
             pstSysCfgRatOrder->aenRatOrder[ucUserRatNum] = TAF_MMA_RAT_LTE;
             ucUserRatNum++;
        }
    }

    /* ????????WCDMA */
    if (VOS_TRUE == AT_IsModemSupportRat(enModemId, TAF_MMA_RAT_WCDMA))
    {
         pstSysCfgRatOrder->aenRatOrder[ucUserRatNum] = TAF_MMA_RAT_WCDMA;
         ucUserRatNum++;
    }

    /* ????????GSM */
    if (VOS_TRUE == AT_IsModemSupportRat(enModemId, TAF_MMA_RAT_GSM))
    {
         pstSysCfgRatOrder->aenRatOrder[ucUserRatNum] = TAF_MMA_RAT_GSM;
         ucUserRatNum++;
    }

    pstSysCfgRatOrder->ucRatOrderNum = ucUserRatNum;
    return;
}

/*****************************************************************************
 ?? ?? ??  :  AT_GetGuAccessPrioNvim
 ????????  : ??en_NV_Item_MMA_AccessMode????????GU??????????????
 ????????  : ??
 ????????  : enModemId   - ModemId
             penAcqorder - NVIM??????????????????
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??4??20??
    ??    ??   : z40661
    ????????   : ??????????
  2.??    ??   : 2012??12??13??
    ??    ??   : L00171473
    ????????   : DTS2012121802573, TQE????
  3.??    ??   : 2013??3??4??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  4.??    ??   : 2013??05??20??
    ??    ??   : m00217266
    ????????   : nv??????
*****************************************************************************/
VOS_VOID AT_GetGuAccessPrioNvim (
    MODEM_ID_ENUM_UINT16                enModemId,
    AT_SYSCFG_RAT_PRIO_ENUM_UINT8      *penAcqorder
)
{
    NAS_MMA_NVIM_ACCESS_MODE_STRU        stAccessMode;
    VOS_UINT32                           ulLength;

    ulLength = 0;

    PS_MEM_SET(&stAccessMode, 0x00, sizeof(NAS_MMA_NVIM_ACCESS_MODE_STRU));

    (VOS_VOID)NV_GetLength(en_NV_Item_MMA_AccessMode, &ulLength);
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, Begin */
    if (NV_OK != NV_ReadEx(enModemId,
                            en_NV_Item_MMA_AccessMode ,
                            &stAccessMode,
                            ulLength))

    {
        *penAcqorder = AT_SYSCFG_RAT_PRIO_AUTO;
        return ;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, End */

    *penAcqorder = stAccessMode.aucAccessMode[1];
}


/*****************************************************************************
 ?? ?? ??  : AT_GetRatOrderNvim
 ????????  : ??en_NV_Item_RAT_PRIO_LIST??????GU??????????????????
 ????????  : MODEM_ID_ENUM_UINT16                enModemId,
             TAF_MMA_RAT_ORDER_STRU              *pstSysCfgRatOrder,
             VOS_UINT8                           ucUserSptLteFlag
 ????????  :
 ?? ?? ??  : ??
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??7??13??
    ??    ??   : z00161729
    ????????   : ??????????
  2.??    ??   : 2012??8??10??
    ??    ??   : L00171473
    ????????   : DTS2012082204471, TQE????
  3.??    ??   : 2012??12??24??
    ??    ??   : z00220246
    ????????   : DSDA Phase II
  4.??    ??   : 2013??5??17??
    ??    ??   : l00167671
    ????????   : NV??????????, ??NV??????????????????
  5.??    ??   : 2015??4??10??
    ??    ??   : h00313353
    ????????   : SysCfg????
*****************************************************************************/
VOS_VOID AT_GetRatOrderNvim(
    MODEM_ID_ENUM_UINT16                enModemId,
    TAF_MMA_RAT_ORDER_STRU             *pstSysCfgRatOrder,
    VOS_UINT8                           ucUserSptLteFlag
)
{
    TAF_PH_NVIM_RAT_ORDER_STRU          stPrioRatList;
    VOS_UINT8                           i;
    VOS_UINT8                           ucIndex;
    ucIndex = 0;


    PS_MEM_SET(&stPrioRatList, 0x00, sizeof(stPrioRatList));


    /* ??en_NV_Item_RAT_PRIO_LIST????????????stSysCfgRatOrder */
    if (NV_OK != NV_ReadEx(enModemId, en_NV_Item_RAT_PRIO_LIST, &stPrioRatList, sizeof(stPrioRatList)))
    {
        AT_SetDefaultRatPrioList(enModemId, pstSysCfgRatOrder, ucUserSptLteFlag);
        return;
    }

    /* ???????????????????????? */
    if ((stPrioRatList.ucRatOrderNum > TAF_PH_MAX_GUL_RAT_NUM)
     || (0 == stPrioRatList.ucRatOrderNum))
    {
        AT_SetDefaultRatPrioList(enModemId, pstSysCfgRatOrder, ucUserSptLteFlag);
        return;
    }

    for (i = 0; i < stPrioRatList.ucRatOrderNum; i++)
    {
        pstSysCfgRatOrder->aenRatOrder[ucIndex] = stPrioRatList.aenRatOrder[i];
        ucIndex++;
    }

    pstSysCfgRatOrder->ucRatOrderNum = ucIndex;


    return;
}

/*****************************************************************************
 ?? ?? ??  : AT_IsSupportGMode
 ????????  : ????????????????????????G??
 ????????  : pstRatOrder - ??????????????????
 ????????  : ??
 ?? ?? ??  : VOS_TRUE  - ????????????????G
             VOS_FALSE - ??????????????????G
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??7??13??
    ??    ??   : z00161729
    ????????   : ??????????
  2.??    ??   : 2015??4??10??
    ??    ??   : h00313353
    ????????   : SysCfg????
*****************************************************************************/
VOS_UINT32 AT_IsSupportGMode(
    TAF_MMA_RAT_ORDER_STRU             *pstRatOrder
)
{
    VOS_UINT32                          i;
    for (i = 0; i < pstRatOrder->ucRatOrderNum; i++)
    {
        if (TAF_MMA_RAT_GSM == pstRatOrder->aenRatOrder[i])
        {
            return VOS_TRUE;
        }
    }

    return VOS_FALSE;
}


/*****************************************************************************
 ?? ?? ??  : AT_IsSupportLMode
 ????????  : ????????????????????????L??
 ????????  : pstRatOrder - ??????????????????
 ????????  : ??
 ?? ?? ??  : VOS_TRUE  - ????????????????L
             VOS_FALSE - ??????????????????L
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??10??28??
    ??    ??   : z00161729
    ????????   : ??????????

  2.??    ??   : 2015??4??10??
    ??    ??   : h00313353
    ????????   : SysCfg????
*****************************************************************************/
VOS_UINT32 AT_IsSupportLMode(
    TAF_MMA_RAT_ORDER_STRU             *pstRatOrder
)
{
    VOS_UINT32                          i;

    for (i = 0; i < pstRatOrder->ucRatOrderNum; i++)
    {
        if (TAF_MMA_RAT_LTE == pstRatOrder->aenRatOrder[i])
        {
            return VOS_TRUE;
        }
    }

    return VOS_FALSE;
}

/*****************************************************************************
 ?? ?? ??  : AT_IsSupportWMode
 ????????  : ????????????????????????W??
 ????????  : pstRatOrder - ??????????????????
 ????????  : ??
 ?? ?? ??  : VOS_TRUE  - ????????????????W
             VOS_FALSE - ??????????????????W
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??7??13??
    ??    ??   : z00161729
    ????????   : ??????????
  2.??    ??   : 2015??4??10??
    ??    ??   : h00313353
    ????????   : SysCfg????
*****************************************************************************/
VOS_UINT32 AT_IsSupportWMode(
    TAF_MMA_RAT_ORDER_STRU             *pstRatOrder
)
{
    VOS_UINT32                          i;

    for (i = 0; i < pstRatOrder->ucRatOrderNum; i++)
    {
        if (TAF_MMA_RAT_WCDMA == pstRatOrder->aenRatOrder[i])
        {
            return VOS_TRUE;
        }
    }

    return VOS_FALSE;
}

/*****************************************************************************
 ?? ?? ??  : AT_ConvertCpamRatOrderPara
 ????????  : ??act??pri??????????TAF_MMA_RAT_ORDER_STRU????????
 ????????  : enMode - cpam??????act????
             enAcqorder - cpam??????pri????
             ucClientId - AT??????
 ????????  : pstRatOrder - act??pri????????TAF_MMA_RAT_ORDER_STRU????????
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??7??11??
    ??    ??   : z00161729
    ????????   : ??????????

  2.??    ??   : 2012??4??20??
    ??    ??   : z40661
    ????????   : DTS2012033105463,????AUTO??,????????W??????

  3.??    ??   : 2012??4??30??
    ??    ??   : z40661
    ????????   : DTS2012042404404,????CPAM??????

  4.??    ??   : 2012??12??24??
    ??    ??   : z00220246
    ????????   : DSDA Phase II

  5.??    ??   : 2015??4??10??
    ??    ??   : h00313353
    ????????   : SysCfg????
*****************************************************************************/
VOS_UINT32 AT_ConvertCpamRatOrderPara(
    VOS_UINT8                           ucClientId,
    MN_MMA_CPAM_RAT_TYPE_ENUM_UINT8     enMode,
    MN_MMA_CPAM_RAT_PRIO_ENUM_UINT8     enAcqorder,
    TAF_MMA_RAT_ORDER_STRU             *pstRatOrder,
    AT_SYSCFG_RAT_PRIO_ENUM_UINT8      *penSyscfgRatPrio
)
{
    AT_SYSCFG_RAT_PRIO_ENUM_UINT8       enNvimRatPrio;
    MODEM_ID_ENUM_UINT16                enModemId;
    VOS_UINT32                          ulRst;

    enModemId = MODEM_ID_0;

    ulRst = AT_GetModemIdFromClient(ucClientId, &enModemId);
    if (VOS_OK != ulRst)
    {
        AT_ERR_LOG1("AT_ConvertCpamRatOrderPara:Get ModemID From ClientID fail,ClientID=%d", ucClientId);
        return AT_ERROR;
    }

    /* ????????????????????????????NVIM?????? */
    /* ????NVIM????????????????CPAM?????????????????????????? */
    if ( MN_MMA_CPAM_RAT_PRIO_NO_CHANGE == enAcqorder )
    {
        /* Modified by l60609 for DSDA Phase III, 2013-3-4, Begin */
        AT_GetGuAccessPrioNvim(enModemId, &enNvimRatPrio);
        /* Modified by l60609 for DSDA Phase III, 2013-3-4, End */
        *penSyscfgRatPrio = enNvimRatPrio;
    }
    else if ( MN_MMA_CPAM_RAT_PRIO_GSM == enAcqorder )
    {
        *penSyscfgRatPrio = AT_SYSCFG_RAT_PRIO_GSM;
    }
    else
    {
        *penSyscfgRatPrio = AT_SYSCFG_RAT_PRIO_WCDMA;
    }



    switch (enMode)
    {
        case MN_MMA_CPAM_RAT_TYPE_WCDMA_GSM:
            if (AT_SYSCFG_RAT_PRIO_GSM == *penSyscfgRatPrio)
            {
                /* GSM???? */
                pstRatOrder->ucRatOrderNum  = TAF_PH_MAX_GU_RAT_NUM;
                pstRatOrder->aenRatOrder[0] = TAF_MMA_RAT_GSM;
                pstRatOrder->aenRatOrder[1] = TAF_MMA_RAT_WCDMA;
                pstRatOrder->aenRatOrder[2] = TAF_MMA_RAT_BUTT;
            }
            else
            {
                /* WCDMA???? */
                pstRatOrder->ucRatOrderNum  = TAF_PH_MAX_GU_RAT_NUM;
                pstRatOrder->aenRatOrder[0] = TAF_MMA_RAT_WCDMA;
                pstRatOrder->aenRatOrder[1] = TAF_MMA_RAT_GSM;
                pstRatOrder->aenRatOrder[2] = TAF_MMA_RAT_BUTT;
            }

            break;

        case MN_MMA_CPAM_RAT_TYPE_GSM:
            /* G???? */
            pstRatOrder->ucRatOrderNum = 1;
            pstRatOrder->aenRatOrder[0] = TAF_MMA_RAT_GSM;
            pstRatOrder->aenRatOrder[1] = TAF_MMA_RAT_BUTT;
            pstRatOrder->aenRatOrder[2] = TAF_MMA_RAT_BUTT;
            break;

        case MN_MMA_CPAM_RAT_TYPE_WCDMA:
            /* W???? */
            pstRatOrder->ucRatOrderNum = 1;
            pstRatOrder->aenRatOrder[0] = TAF_MMA_RAT_WCDMA;
            pstRatOrder->aenRatOrder[1] = TAF_MMA_RAT_BUTT;
            pstRatOrder->aenRatOrder[2] = TAF_MMA_RAT_BUTT;
            break;

        case MN_MMA_CPAM_RAT_TYPE_NOCHANGE:
            AT_GetRatOrderNvim(enModemId, pstRatOrder, VOS_FALSE);
            AT_GetOnlyGURatOrder(pstRatOrder);

            if (TAF_PH_MAX_GU_RAT_NUM == pstRatOrder->ucRatOrderNum)
            {
                if (AT_SYSCFG_RAT_PRIO_WCDMA == *penSyscfgRatPrio)
                {
                    pstRatOrder->ucRatOrderNum  = TAF_PH_MAX_GU_RAT_NUM;
                    pstRatOrder->aenRatOrder[0] = TAF_MMA_RAT_WCDMA;
                    pstRatOrder->aenRatOrder[1] = TAF_MMA_RAT_GSM;
                    pstRatOrder->aenRatOrder[2] = TAF_MMA_RAT_BUTT;
                }
                else if (AT_SYSCFG_RAT_PRIO_GSM == *penSyscfgRatPrio)
                {
                    pstRatOrder->ucRatOrderNum  = TAF_PH_MAX_GU_RAT_NUM;
                    pstRatOrder->aenRatOrder[0] = TAF_MMA_RAT_GSM;
                    pstRatOrder->aenRatOrder[1] = TAF_MMA_RAT_WCDMA;
                    pstRatOrder->aenRatOrder[2] = TAF_MMA_RAT_BUTT;
                }
                else
                {
                }

            }

            /* ???????????????????????? */

            break;

        default:
            return AT_CME_INCORRECT_PARAMETERS;

    }

    return AT_OK;

}

/*****************************************************************************
 Prototype      : At_SetCpamPara
 Description    : +CPAM=<act>,<pri>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2009-09-07
    ??    ??   : l00130025
    ????????   : ????????: AT2D14224/AT2D14259,AT^SYSCFG??????AT????????W900??W1700??????
  3.??    ??   : 2011-07-11
    ??    ??   : z00161729
    ????????   : V7R1 phase II????syscfgex????

  4.??    ??   : 2012??4??16??
    ??    ??   : z40661
    ????????   : DTS2012033105267??CPAM??????????????????????
  5.??    ??   : 2012??12??24??
    ??    ??   : z00220246
    ????????   : DSDA Phase II
  6.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III

  7.??    ??   : 2014??2??13??
    ??    ??   : w00167002
    ????????   : L-C??????????:????SYSCFG??????????????
  8.??    ??   : 2015??4??9??
    ??    ??   : h00313353
    ????????   : SysSrvDomain ????????????
*****************************************************************************/
VOS_UINT32 At_SetCpamPara(VOS_UINT8 ucIndex)
{
    /* Modified by w00167002 for L-C??????????, 2014-2-13, begin */
    TAF_MMA_SYS_CFG_PARA_STRU           stSysCfgSetPara;
    /* Modified by w00167002 for L-C??????????, 2014-2-13, end */

    VOS_UINT32                          ulRst;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_NET_CTX_STRU              *pstNetCtx = VOS_NULL_PTR;

    pstNetCtx = AT_GetModemNetCtxAddrFromClientId(ucIndex);
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

    ulRst = AT_OK;

    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (gucAtParaIndex > 2)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ( 0 == gastAtParaList[0].usParaLen )
    {
        gastAtParaList[0].ulParaValue = MN_MMA_CPAM_RAT_TYPE_NOCHANGE;
    }


    if ( 0 == gastAtParaList[1].usParaLen )
    {
        gastAtParaList[1].ulParaValue = MN_MMA_CPAM_RAT_PRIO_NO_CHANGE;
    }



    /* Deleted by w00167002 for L-C??????????, 2014-2-13, begin */
    /* Deleted by w00167002 for L-C??????????, 2014-2-13, end */


    ulRst = AT_ConvertCpamRatOrderPara(ucIndex,
                                       (VOS_UINT8)gastAtParaList[0].ulParaValue,
                                       (VOS_UINT8)gastAtParaList[1].ulParaValue,
                                       &stSysCfgSetPara.stRatOrder,
                                       &stSysCfgSetPara.enUserPrio);

    if (AT_OK != ulRst)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* stSysCfgSetPara???????????? */
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    if (AT_ROAM_FEATURE_ON == pstNetCtx->ucRoamFeature)
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */
    {
        stSysCfgSetPara.enRoam = TAF_MMA_ROAM_UNCHANGE;
    }
    else
    {
        stSysCfgSetPara.enRoam = AT_ROAM_FEATURE_OFF_NOCHANGE;
    }
    stSysCfgSetPara.enSrvDomain         = TAF_MMA_SERVICE_DOMAIN_NOCHANGE;
    stSysCfgSetPara.stGuBand.ulBandLow  = TAF_PH_BAND_NO_CHANGE;
    stSysCfgSetPara.stGuBand.ulBandHigh = 0;
    stSysCfgSetPara.stLBand.ulBandLow   = TAF_PH_BAND_NO_CHANGE;
    stSysCfgSetPara.stLBand.ulBandHigh  = 0;

    /* Modified by w00167002 for L-C??????????, 2014-2-13, begin */

    /* ???????????? */
    if (VOS_TRUE == TAF_MMA_SetSysCfgReq(WUEPS_PID_AT, gastAtClientTab[ucIndex].usClientId, 0, &stSysCfgSetPara))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPAM_SET;

        /* ???????????????????? */
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
    /* Modified by w00167002 for L-C??????????, 2014-2-13, end */

}

/*****************************************************************************
 Prototype      : At_SetStsfPara
 Description    : ^STSF
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---
 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2012??12??11??
    ??    ??   : l00167671
    ????????   : DTS2012121802573, TQE????
  3.??    ??   : 2013??7??29??
    ??    ??   : h59254
    ????????   : V9R1 STK????
*****************************************************************************/
TAF_UINT32 At_SetStsfPara(TAF_UINT8 ucIndex)
{
    USIMM_STK_CFG_STRU                  ProfileContent;
    TAF_UINT32                          Result;
    TAF_UINT16                          Len = sizeof(USIMM_STK_CFG_STRU);
    MODEM_ID_ENUM_UINT16                usModemId;

    if(gastAtParaList[0].usParaLen != 1)        /* check the para */
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(gucAtParaIndex > 3)                          /* para too many */
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    Result = NV_ReadEx(MODEM_ID_0, en_NV_Item_TerminalProfile_Set, &ProfileContent, Len);

    if(NV_OK != Result)
    {
        return AT_ERROR;
    }

    if (VOS_OK != AT_GetModemIdFromClient(ucIndex, &usModemId))
    {
        return AT_ERROR;
    }

    ProfileContent.ucFuncEnable = (TAF_UINT8)gastAtParaList[0].aucPara[0]-0x30;       /* change the string to Ascii value */

    if(gastAtParaList[1].usParaLen != 0x00)         /* have the <config> para */
    {
        if(AT_FAILURE == At_AsciiNum2HexString(gastAtParaList[1].aucPara,&gastAtParaList[1].usParaLen)) /* change the string formate */
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        if(gastAtParaList[1].usParaLen > 32)        /* according the etsi102.223,the most len or Terminal Profile is 32 */
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        if (USIMM_CARD_USIM == AT_GetUsimInfoCtxFromModemId(usModemId)->enCardType)
        {
            ProfileContent.stUsimProfile.ucProfileLen = (TAF_UINT8)gastAtParaList[1].usParaLen;

            VOS_MemCpy(ProfileContent.stUsimProfile.aucProfile, gastAtParaList[1].aucPara, ProfileContent.stUsimProfile.ucProfileLen);
        }
        else
        {
            ProfileContent.stSimProfile.ucProfileLen = (TAF_UINT8)gastAtParaList[1].usParaLen;

            VOS_MemCpy(ProfileContent.stSimProfile.aucProfile, gastAtParaList[1].aucPara, ProfileContent.stSimProfile.ucProfileLen);
        }
    }

    if(gastAtParaList[2].usParaLen != 0x00)     /* ave the <Timer>  para */
    {
        Result = At_Auc2ul(gastAtParaList[2].aucPara, gastAtParaList[2].usParaLen, &gastAtParaList[2].ulParaValue);
        if (AT_SUCCESS != Result)
        {
            AT_WARN_LOG("At_SetStsfPara():Warning: At_Auc2ul convert failed!");

            return AT_CME_INCORRECT_PARAMETERS;
        }

        if((gastAtParaList[2].ulParaValue> 0xFF)||(gastAtParaList[2].ulParaValue == 0))
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        ProfileContent.ucTimer = (TAF_UINT8)gastAtParaList[2].ulParaValue;
    }

    Result = NV_WriteEx(MODEM_ID_0, en_NV_Item_TerminalProfile_Set, &ProfileContent, Len);

    if(Result != NV_OK)
    {
        return AT_ERROR;
    }

    return AT_OK;
}

/*****************************************************************************
 Prototype      : At_ChangeSATCmdType
 Description    : chang the cmdNo to cmdType
 Input          :
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_ChangeSATCmdType(TAF_UINT32 cmdNo, TAF_UINT32 *CmdType)
{
    TAF_UINT32 Result = AT_SUCCESS;

    switch(cmdNo)
    {
        case SI_AT_CMD_DISPLAY_TEXT:
            *CmdType = SI_STK_DISPLAYTET;
            break;
        case SI_AT_CMD_GET_INKEY:
            *CmdType = SI_STK_GETINKEY;
            break;
        case SI_AT_CMD_GET_INPUT:
            *CmdType = SI_STK_GETINPUT;
            break;
        case SI_AT_CMD_SETUP_CALL:
            *CmdType = SI_STK_SETUPCALL;
            break;
        case SI_AT_CMD_PLAY_TONE:
            *CmdType = SI_STK_PLAYTONE;
            break;
        case SI_AT_CMD_SELECT_ITEM:
            *CmdType = SI_STK_SELECTITEM;
            break;
        case SI_AT_CMD_REFRESH:
            *CmdType = SI_STK_REFRESH;
            break;
        case SI_AT_CMD_SEND_SS:
            *CmdType = SI_STK_SENDSS;
            break;
        case SI_AT_CMD_SEND_SMS:
            *CmdType = SI_STK_SENDSMS;
            break;
        case SI_AT_CMD_SEND_USSD:
            *CmdType = SI_STK_SENDUSSD;
            break;
        case SI_AT_CMD_LAUNCH_BROWSER:
            *CmdType = SI_STK_LAUNCHBROWSER;
            break;
        case SI_AT_CMD_SETUP_IDLE_MODE_TEXT:
            *CmdType = SI_STK_SETUPIDLETEXT;
            break;
        case SI_AT_CMD_LANGUAGENOTIFICATION:
            *CmdType = SI_STK_LANGUAGENOTIFICATION;
            break;
        case SI_AT_CMD_SETFRAMES:
            *CmdType = SI_STK_SETFRAMES;
            break;
        case SI_AT_CMD_GETFRAMESSTATUS:
            *CmdType = SI_STK_GETFRAMESSTATUS;
            break;
        default:
            Result = AT_ERROR;
            break;
    }

    return Result;
}


/*****************************************************************************
 Prototype      : At_SetStgiPara
 Description    : ^STGI
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetStgiPara(TAF_UINT8 ucIndex)
{
    TAF_UINT32 Result;
    TAF_UINT32 CmdType;

    if(TAF_FALSE == g_ulSTKFunctionFlag)
    {
        return AT_ERROR;
    }

    if(0 == gastAtParaList[0].usParaLen)        /* check the para */
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(gucAtParaIndex != 2)                         /* the para number is must be 2 */
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(gastAtParaList[0].ulParaValue > 0x0C)        /* the <cmdType> is not more the 12 */
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(gastAtParaList[0].ulParaValue== 0x00)        /* get the main menu content */
    {
        Result = SI_STK_GetMainMenu(gastAtClientTab[ucIndex].usClientId,0);
    }
    else  if(AT_ERROR == At_ChangeSATCmdType(gastAtParaList[0].ulParaValue, &CmdType))  /* get other SAT content */
    {
        return AT_ERROR;
    }
    else
    {
        Result = SI_STK_GetSTKCommand(gastAtClientTab[ucIndex].usClientId, 0, CmdType);
    }

    if(AT_SUCCESS == Result)
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_STGI_SET;

        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 Prototype      : At_SetClvlPara
 Description    : +CLVL=<level>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          :
 Called By      :

 History        :
  1.Date        : 2007-07-11
    Author      : d49431
    Modification: Created function
 2.??    ?? : 2010-07-26
   ??    ?? : h44270
   ???????? : ????????:DTS2010071700317,????????
 3.??    ??   : 2011??10??06??
   ??    ??   : f00179208
   ????????   : AT????????, TAF_UINT8??????VOS_UINT8
 4.??    ??   : 2012??5??10??
   ??    ??   : l60609
   ????????   : DTS2011102400120:AT+CLVL????NV????
 5.??    ??   : 2015??3??16??
   ??    ??   : w00316404
   ????????   : DTS2015031003847:????"AT+CLVL="????????????
*****************************************************************************/
VOS_UINT32 At_SetClvlPara(VOS_UINT8 ucIndex)
{
    VOS_UINT8           aucIntraVolume[] = {AT_CMD_CLVL_LEV_0,AT_CMD_CLVL_LEV_1,
                                            AT_CMD_CLVL_LEV_2,AT_CMD_CLVL_LEV_3,
                                            AT_CMD_CLVL_LEV_4,AT_CMD_CLVL_LEV_5};


    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????????? */
    if ((1 != gucAtParaIndex) || (1 != gastAtParaList[0].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????????????????????????????????????0~5????????????????????0~92??
       ????????????????????????????0~80?????????? */

    /* ????????AT_SUCCESS????VOS_OK??????????  */
    if (VOS_OK == APP_VC_SetVoiceVolume(gastAtClientTab[ucIndex].usClientId, 0, aucIntraVolume[gastAtParaList[0].ulParaValue]))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CLVL_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 Prototype      : At_SetVMSETPara
 Description    : ^VMSET=<mode>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          :
 Called By      :

 History        :
  1.Date        : 2007-07-11
    Author      : d49431
    Modification: Created function
  2.??    ??   : 2011??10??06??
    ??    ??   : f00179208
    ????????   : AT????????, TAF_UINT8??????VOS_UINT8
  3.??    ??   : 2013??9??30??
    ??    ??   : Y00213812
    ????????   : DTS2013092802198: DSDA????????AudioRil??????????????????????
                 ^VMSET??????????????????????????????????????????????????????
  4.??    ??   : 2015??3??16??
    ??    ??   : w00316404
    ????????   : DTS2015031003847:????"AT+VMSET="????????????
  5.??    ??   : 2015??5??28??
    ??    ??   : l00198894
    ????????   : TSTS
  6.??    ??   : 2016??6??16??
    ??    ??   : h00360002
    ????????   : DTS2016052303305
*****************************************************************************/
VOS_UINT32 At_SetVMSETPara(VOS_UINT8 ucIndex)
{
    VOS_UINT8                          ucVoiceMode;


    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if((1 != gucAtParaIndex) || (1 != gastAtParaList[0].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ucVoiceMode = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    if (VOS_OK != APP_VC_SetVoiceMode(gastAtClientTab[ucIndex].usClientId, 0, ucVoiceMode, I1_WUEPS_PID_VC))
    {
        return AT_ERROR;
    }

    if (VOS_OK != APP_VC_SetVoiceMode(gastAtClientTab[ucIndex].usClientId, 0, ucVoiceMode, I2_WUEPS_PID_VC))
    {
        return AT_ERROR;
    }

    if (VOS_OK != APP_VC_SetVoiceMode(gastAtClientTab[ucIndex].usClientId, 0, ucVoiceMode, I0_WUEPS_PID_VC))
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_VMSET_SET;

    return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
}

/*****************************************************************************
 Prototype      : At_SetTestPara
 Description    : +TEST=[<n>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetTestPara(TAF_UINT8 ucIndex)
{
    return AT_OK;
}

/* ==> x68770 For WAS AutoTest */
/*****************************************************************************
 Prototype      : At_SetCwasPara
 Description    : ^CWAS=<n>,[<para1>,<para2>]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2007-11-19
    Author      : ---
    Modification: Created function

  2.??    ??   : 2011??10??22??
    ??    ??   : o00132663
    ????????   : AT??????????API????????????????
  3.??    ??   : 2012??12??26??
    ??    ??   : m00217266
    ????????   : DSDA C??????????????(??????????????MTA)
*****************************************************************************/
TAF_UINT32 At_SetCwasPara(TAF_UINT8 ucIndex)
{
    AT_MTA_WRR_AUTOTEST_QRY_PARA_STRU   stAtCmd;
    VOS_UINT32                          ulRst;


    /* ???????? */
    if ((gucAtParaIndex > 4) || (gucAtParaIndex < 1))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }


    /* ?????? */
    PS_MEM_SET(&stAtCmd, 0, sizeof(AT_MTA_WRR_AUTOTEST_QRY_PARA_STRU));
    stAtCmd.ucCmd = (TAF_UINT8)gastAtParaList[0].ulParaValue;

    for ( stAtCmd.ucParaNum = 0;
          stAtCmd.ucParaNum < (gucAtParaIndex-1);
          stAtCmd.ucParaNum++)
    {
        stAtCmd.aulPara[stAtCmd.ucParaNum]
            = gastAtParaList[stAtCmd.ucParaNum+1].ulParaValue;
    }


    /* ??????????C?????? */
    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_WRR_AUTOTEST_QRY_REQ,
                                   &stAtCmd,
                                   sizeof(AT_MTA_WRR_AUTOTEST_QRY_PARA_STRU),
                                   I0_UEPS_PID_MTA);

    if (AT_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CWAS_QUERY;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }


}

/*****************************************************************************
 ?? ?? ??  : At_SetCGasPara
 ????????  :
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??5??19??
    ??    ??   : luojian id:107747
    ????????   : ??????????

  2.??    ??   : 2008??06??26??
    ??    ??   : l00107747
    ????????   : ??????????AT2D03815,????^CGAS????

  3.??    ??   : 2011??10??4??
    ??    ??   : o00132663
    ????????   : AT??????????GAS_AtCmd API????????????????????
  4.??    ??   : 2012??03??22??
    ??    ??   : w00199382
    ????????   : DTS2012032105731,????????????
*****************************************************************************/
TAF_UINT32 At_SetCGasPara(TAF_UINT8 ucIndex)
{
    GAS_AT_CMD_STRU                     stAtCmd;
    VOS_UINT32                          ulRst;

    /* ???????? */
    if ((gucAtParaIndex > 2) || (gucAtParaIndex < 1))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /*????????????*/
    if (1 != gastAtParaList[0].usParaLen)
    {
        return  AT_CME_INCORRECT_PARAMETERS;
    }

    if ((7 != gastAtParaList[0].ulParaValue)
       &&(gucAtParaIndex > 1))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }



    /* ???????????? */
    stAtCmd.ucCmd = (TAF_UINT8)gastAtParaList[0].ulParaValue;
    for (stAtCmd.ucParaNum = 0; stAtCmd.ucParaNum < (gucAtParaIndex-1); stAtCmd.ucParaNum++)
    {
        stAtCmd.aulPara[stAtCmd.ucParaNum] = gastAtParaList[stAtCmd.ucParaNum+1].ulParaValue;
    }

    /* ????????DRV_AGENT_GAS_MNTN_CMD??C?????? */
    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   DRV_AGENT_GAS_MNTN_CMD,
                                   &stAtCmd,
                                   sizeof(GAS_AT_CMD_STRU),
                                   I0_WUEPS_PID_DRV_AGENT);

    if (AT_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CGAS_QUERY;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }

}

/*****************************************************************************
 ?? ?? ??  : At_SetAppDialModePara
 ????????  : ??????????????????????????????????????????0:??????????1:????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????
  1.??    ??   : 2011??03??15??
    ??    ??   : z00161729
    ????????  : ????????
*****************************************************************************/
VOS_UINT32 At_SetAppDialModePara(VOS_UINT8 ucIndex)
{
     VOS_UINT32                         ulStatus;
     /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
     VOS_UINT8                         *pucSystemAppConfig;

     pucSystemAppConfig                  = AT_GetSystemAppConfigAddr();

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }


    if (SYSTEM_APP_WEBUI != *pucSystemAppConfig)
    {
        return AT_ERROR;
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, end */


     /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }
    else
    {
        if (1 == gastAtParaList[0].ulParaValue)
        {
            /*????????????????????????????*/
            ulStatus = AT_USB_ENABLE_EVENT;
        }
        else if(0 == gastAtParaList[0].ulParaValue)
        {
            /*????????????????????????????????*/
            ulStatus = AT_USB_SUSPEND_EVENT;
        }
        else
        {
             return AT_CME_INCORRECT_PARAMETERS;
        }

    }

    DRV_AT_SETAPPDAILMODE(ulStatus);

    return AT_OK;
}


/*****************************************************************************
 ?? ?? ??  : At_SetCmmPara
 ????????  :
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??5??7??
    ??    ??   : luojian id:107747
    ????????   : ??????????

  2.??    ??   : 2011??10??22??
    ??    ??   : o00132663
    ????????   : AT??????????Taf_DefMmTestPara API????????????????????

  3.??    ??   : 2015??3??27??
    ??    ??   : y00322978
    ????????   : ????AT CMM????????????????
*****************************************************************************/
TAF_UINT32   At_SetCmmPara(TAF_UINT8 ucIndex)
{
    MM_TEST_AT_CMD_STRU                    stAtCmd;

    /* ???????? */
    if( gucAtParaIndex > 2)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_SET(&stAtCmd, 0x00, sizeof(MM_TEST_AT_CMD_STRU));

    stAtCmd.ucCmd = (TAF_UINT8)gastAtParaList[0].ulParaValue;
    for (stAtCmd.ucParaNum = 0; stAtCmd.ucParaNum < (gucAtParaIndex-1); stAtCmd.ucParaNum++)
    {
        stAtCmd.aulPara[stAtCmd.ucParaNum]=gastAtParaList[stAtCmd.ucParaNum+1].ulParaValue;
    }

    if(VOS_TRUE == TAF_MMA_SetCmmReq(WUEPS_PID_AT,
                                     gastAtClientTab[ucIndex].usClientId,
                                     0,
                                     &stAtCmd))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_MM_TEST_CMD_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }

}

/*****************************************************************************
 ?? ?? ??  : AT_ShowCccRst
 ????????  : AT????????????CC????????????
 ????????  : pstCcState  -  CC????????????
             pusLength   -  ??????????????
 ????????  : pusLength   -  ????????????????
 ?? ?? ??  : ??
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??3??17??
    ??    ??   : zhoujun /z40661
    ????????   : ??????????

  2.??    ??   : 2011??10??22??
    ??    ??   : o00132663
    ????????   : AT??????????????????????
*****************************************************************************/
VOS_VOID AT_ShowCccRst(
    NAS_CC_STATE_INFO_STRU              *pstCcState,
    VOS_UINT16                          *pusLength
)
{
    VOS_UINT16                          usLength;

    usLength = *pusLength;

    usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                      (TAF_CHAR *)pgucAtSndCodeAddr,
                                      (TAF_CHAR *)pgucAtSndCodeAddr+usLength,
                                      "%d,",
                                      pstCcState->ucCallId);

    usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                      (TAF_CHAR *)pgucAtSndCodeAddr,
                                      (TAF_CHAR *)pgucAtSndCodeAddr+usLength,
                                      "%d,",
                                      pstCcState->ucTi);

    usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                      (TAF_CHAR *)pgucAtSndCodeAddr,
                                      (TAF_CHAR *)pgucAtSndCodeAddr+usLength,
                                      "%d,",
                                      pstCcState->enCallState);

    usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                      (TAF_CHAR *)pgucAtSndCodeAddr,
                                      (TAF_CHAR *)pgucAtSndCodeAddr+usLength,
                                      "%d,",
                                      pstCcState->enHoldAuxState);

    usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                      (TAF_CHAR *)pgucAtSndCodeAddr,
                                      (TAF_CHAR *)pgucAtSndCodeAddr+usLength,
                                      "%d",
                                      pstCcState->enMptyAuxState);

    usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,(TAF_CHAR *)pgucAtSndCodeAddr,(TAF_CHAR *)pgucAtSndCodeAddr + usLength,"%s",gaucAtCrLf);

    *pusLength = usLength;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCccPara
 ????????  : ????????AT??????????????????CC??????????????
 ????????  : ucIndex   -  AT????????
 ????????  : ??
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??3??17??
    ??    ??   : zhoujun /z40661
    ????????   : ??????????

  2.??    ??   : 2011??10??24??
    ??    ??   : o00132663
    ????????   : AT??????????API NAS_CC_AtTest????????????????????
*****************************************************************************/
VOS_UINT32  AT_SetCccPara( TAF_UINT8 ucIndex )
{
    VOS_UINT8                           ucCallId;
    VOS_UINT32                          ulRst;

    if ((gucAtParaIndex > 2) || (0 == gucAtParaIndex))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ( 0 == gastAtParaList[0].ulParaValue )
    {
        ucCallId = 0;   /* 0????????????call Id */
    }
    else
    {
        /* gastAtParaList[1].ulParaValue??????????????????,????CallId = 1?????????? */
        if ( 0 == gastAtParaList[1].usParaLen )
        {
            ucCallId = 1;
        }
        else
        {
            ucCallId = (VOS_UINT8)gastAtParaList[1].ulParaValue;
        }

    }

    /* ????????AT_CC_MSG_STATE_QRY_REQ??CC????CC???????? */
    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   AT_CC_MSG_STATE_QRY_REQ,
                                   &ucCallId,
                                   sizeof(VOS_UINT8),
                                   I0_WUEPS_PID_CC);

    if (VOS_OK == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CC_STATE_QUERY;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }

}

/*****************************************************************************
 ?? ?? ??  : At_SetSPNPara
 ????????  :
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??11??14??
    ??    ??   : ouyang fei 00132663
    ????????   : ????????????????AT2D06705?????? AT^SPN ????????
  2.??    ??   : 2009??10??12??
    ??    ??   : l00130025
    ????????   : ????????: AT2D15082,??MP????????????SPN DispRplmnMode & 0x01
  3.??    ??   : 2010??02??02??
    ??    ??   : l00130025
    ????????   : ????????: AT2D16519,SPN??0x00??????????UCCII????????????????
  4.??    ??   : 2010??04??10??
    ??    ??   : l00130025
    ????????   : ????????: AT2D18291,SPN??GSM 7bit????????????????
  5.??    ??   : 2010??12??11??
    ??    ??   : lijun 00171473
    ????????   : DTS2010120903940, ??SPN??????????????????????
  6.??    ??   : 2011??05??30??
    ??    ??   : f00179208
    ????????   : DTS2011052800301, AT^SPN??????????<disp_rplmn>??????????b1??????????????????b1??b2????
  7.??    ??   : 2011??06??15??
    ??    ??   : c00173809
    ????????   : DTS2011062900558, ??????????????????????????????????????????????????Balong??????????????????????CMCC??????.
  8.??    ??   : 2013??2??25??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  9.??    ??   : 2015??03??30??
    ??    ??   : K00902809
    ????????   : Added new function TAF_MMA_QrySpnReq to send message to MMA.
*****************************************************************************/
TAF_UINT32   At_SetSPNPara(TAF_UINT8 ucIndex)
{
    VOS_UINT8                           ucSpnType;
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, Begin */
    AT_MODEM_NET_CTX_STRU              *pstNetCtx = VOS_NULL_PTR;

    pstNetCtx = AT_GetModemNetCtxAddrFromClientId(ucIndex);

    /* ???????? */
    if( gucAtParaIndex != 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????????? */
    ucSpnType = (TAF_UINT8)gastAtParaList[0].ulParaValue;
    if ( ucSpnType > 1 )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????AT^SPN??????SPN???? */
    pstNetCtx->ucSpnType = ucSpnType;
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, End */

    /* ??MMA????????????????????????TAF_PH_SPN_VALUE_PARA */
    /* Modified by k902809 for Iteration 11, 2015-3-30, begin */
    if(VOS_TRUE == TAF_MMA_QrySpnReq(WUEPS_PID_AT,
                                     gastAtClientTab[ucIndex].usClientId,
                                     0))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SPN_QUERY;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
    /* Modified by k902809 for Iteration 11, Iteration 11 2015-3-30, end */
}

/*****************************************************************************
 ?? ?? ??  : At_SetCardModePara
 ????????  :
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??11??15??
    ??    ??   : ouyang fei 00132663
    ????????   : ????????????????AT2D06703?????? AT^CARDMODE ????????
  2.??    ??   : 2011??10??18??
    ??    ??   : o00132663
    ????????   : AT??????????API????????????????????????
  3.??    ??   : 2012??12??24??
    ??    ??   : l60609
    ????????   : DSDA Phase II
*****************************************************************************/
TAF_UINT32   At_SetCardModePara(TAF_UINT8 ucIndex)
{
    TAF_UINT8               ucCardMode = 0;   /* 0: card not exists, 1: SIM card, 2: USIM card */
    TAF_UINT16              usLength = 0;
    /* Modified by l60609 for DSDA Phase II, 2012-12-24, Begin */
    MODEM_ID_ENUM_UINT16                enModemId;
    VOS_UINT32                          ulGetModemIdRslt;
    AT_USIM_INFO_CTX_STRU              *pstUsimInfoCtx = VOS_NULL_PTR;

    enModemId = MODEM_ID_0;

    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ulGetModemIdRslt = AT_GetModemIdFromClient(ucIndex, &enModemId);

    if (VOS_OK != ulGetModemIdRslt)
    {
        AT_ERR_LOG("At_SetCardModePara:Get Modem Id fail!");
        return AT_ERROR;
    }

    pstUsimInfoCtx = AT_GetUsimInfoCtxFromModemId(enModemId);
    /* Modified by l60609 for DSDA Phase II, 2012-12-24, End */

    if (USIMM_CARD_SERVIC_BUTT == pstUsimInfoCtx->enCardStatus)
    {
        AT_ERR_LOG("At_SetCardModePara:Sim card status butt!");
        return AT_CME_SIM_BUSY;
    }

    /* ?????????? */
    if ( USIMM_CARD_SERVIC_ABSENT != pstUsimInfoCtx->enCardStatus)
    {
        if (USIMM_CARD_SIM == pstUsimInfoCtx->enCardType)
        {
            ucCardMode = 1;
        }
        else if (USIMM_CARD_USIM == pstUsimInfoCtx->enCardType)
        {
            ucCardMode = 2;
        }
        else
        {
            ucCardMode = 0;
        }
    }
    else
    {
        ucCardMode = 0;
    }

    /* ????????: ^CARDMODE:cardmode */
    usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                       (TAF_CHAR *)pgucAtSndCodeAddr,
                                       (TAF_CHAR *)pgucAtSndCodeAddr+usLength,
                                       "%s:",
                                       g_stParseContext[ucIndex].pstCmdElement->pszCmdName);

    usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                       (TAF_CHAR *)pgucAtSndCodeAddr,
                                       (TAF_CHAR*)pgucAtSndCodeAddr+usLength,
                                       "%d",
                                       ucCardMode );

    gstAtSendData.usBufLen = usLength;

    return AT_OK;
}



/*****************************************************************************
 ?? ?? ??  : At_SetDialModePara
 ????????  : ^DIALMODE=<value>
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??12??01??
    ??    ??   : L47619
    ????????   : ??????????????????AT????:AT^DIALMODE
*****************************************************************************/
TAF_UINT32   At_SetDialModePara(TAF_UINT8 ucIndex)
{
    /*??????????????????????????????????????ERROR*/
    return AT_ERROR;
}

/*****************************************************************************
 ?? ?? ??  : At_SetPortSelPara
 ????????  :
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??11??26??
    ??    ??   : ouyang fei 00132663
    ????????   : ????????????????AT2D06578?????? AT^PORTSEL??AT^HVER??AT+CLAC ????????

*****************************************************************************/
TAF_UINT32   At_SetPortSelPara(TAF_UINT8 ucIndex)
{
    TAF_UINT8               ucPortSel = 0;   /* 0: PCUI, 1: Modem */

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????? */
    if( 1 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????????? */
    ucPortSel = (TAF_UINT8)gastAtParaList[0].ulParaValue;
    if ( ucPortSel > 1 )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    gucAtPortSel = ucPortSel;

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetCurcPara
 ????????  :
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2009??07??09??
    ??    ??   : ouyang fei 00132663
    ????????   : ????????????????AT2D12839?????? ????????????????????^CURC
  2.??    ??   : 2011??01??24??
    ??    ??   : lijun 00171473
    ????????   : DTS2011012405909,??????????????????
  3.??    ??   : 2012??09??18??
    ??    ??   : l00198894
    ????????   : STK??????????DCM????????????????
  4.??    ??   : 2013??2??20??
    ??    ??   : l60609
    ????????   : DSDA Phase III
  5.??    ??   : 2013??4??1??
    ??    ??   : s00217060
    ????????   : ????????AT??????????????C??
  6.??    ??   : 2015??4??10??
    ??    ??   : h00313353
    ????????   : SysCfg????
*****************************************************************************/
TAF_UINT32   At_SetCurcPara(TAF_UINT8 ucIndex)
{
    AT_MTA_CURC_SET_NOTIFY_STRU         stAtCmd;
    VOS_UINT32                          ulResult;

    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, begin */
    L4A_IND_CFG_STRU                    stL4AIndCfgReq;
    MODEM_ID_ENUM_UINT16                enModemId;

    enModemId  = MODEM_ID_0;
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, end */

    /* ???????? */
    if ( (gucAtParaIndex > 2)
      || (gucAtParaIndex < 1) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, begin */
    PS_MEM_SET(&stAtCmd, 0, sizeof(stAtCmd));
    stAtCmd.enCurcRptType = (AT_MTA_RPT_GENERAL_CTRL_TYPE_ENUM_UINT8)gastAtParaList[0].ulParaValue;

    /* mode=0?????????????????????? */
    if (0 == gastAtParaList[0].ulParaValue)
    {
        PS_MEM_SET(gastAtParaList[1].aucPara, 0x00, sizeof(gastAtParaList[1].aucPara));
    }
    else if (1 == gastAtParaList[0].ulParaValue)
    {
        /* mode=1?????????????????????? */
        PS_MEM_SET(gastAtParaList[1].aucPara, 0xFF, sizeof(gastAtParaList[1].aucPara));
    }
    else if (2 == gastAtParaList[0].ulParaValue)
    {
        /* mode=2??????BIT????????????????????,??????????????????????????<report_cfg>???? */
        if ( (2 != gucAtParaIndex)
          || (AT_CURC_RPT_CFG_PARA_LEN != gastAtParaList[1].usParaLen) )
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        ulResult = At_AsciiNum2HexString(gastAtParaList[1].aucPara, &gastAtParaList[1].usParaLen);
        if (AT_SUCCESS != ulResult)
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
    }
    else
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_CPY(stAtCmd.aucRptCfg, gastAtParaList[1].aucPara, (AT_CURC_RPT_CFG_MAX_SIZE));

    /* ????MTA????curc?????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_CURC_SET_NOTIFY,
                                   &stAtCmd,
                                   sizeof(AT_MTA_CURC_SET_NOTIFY_STRU),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS != ulResult)
    {
        return AT_ERROR;
    }

    ulResult = AT_GetModemIdFromClient(ucIndex, &enModemId);

    if (VOS_OK != ulResult)
    {
        AT_ERR_LOG1("At_SetCurcPara:Get ModemID From ClientID fail,ClientID=%d", ucIndex);
        return AT_ERROR;
    }

    if (VOS_TRUE == AT_IsModemSupportRat(enModemId, TAF_MMA_RAT_LTE))
    {
        /* ????????????LTE */
        PS_MEM_SET(&stL4AIndCfgReq, 0, sizeof(stL4AIndCfgReq));
        stL4AIndCfgReq.curc_bit_valid  = 1;
        PS_MEM_CPY(stL4AIndCfgReq.aucCurcCfgReq, gastAtParaList[1].aucPara,
                   sizeof(stL4AIndCfgReq.aucCurcCfgReq));

        /* ????L????curc?????? */
        return AT_SetLIndCfgReq(ucIndex, &stL4AIndCfgReq);
    }
    else
    {
        return AT_OK;
    }
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, end */
}

/*****************************************************************************
 ?? ?? ??  : At_SetBOOTPara
 ????????  :
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??11??25??
    ??    ??   : ouyang fei 00132663
    ????????   : ??????AT2D07005?????? AT^BOOT ????????

*****************************************************************************/
TAF_UINT32   At_SetBOOTPara(TAF_UINT8 ucIndex)
{

    /* ???????? */
    if( gucAtParaIndex > 2)
    {
        return AT_TOO_MANY_PARA;
    }

    /* ???????? */
    if( gucAtParaIndex < 2)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????????, para2?????? 0 */
    if ( (gastAtParaList[1].usParaLen != 1) || (gastAtParaList[1].aucPara[0]!= '0') )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????????OK. */
    return AT_OK;
}

/*****************************************************************************
 Prototype      : At_SetCellInfoPara
 Description    : ^CELLINFO=<n>
                  AT^CELLINFO=0 ??????????????
                  AT^CELLINFO=1 ????????????
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2007-11-19
    Author      : ---
    Modification: Created function

  2.??    ??   : 2011??10??18??
    ??    ??   : o00132663
    ????????   : AT??????????????API????????????????
  3.??    ??   : 2012??12??26??
    ??    ??   : m00217266
    ????????   : DSDA C??????????????(??????????????MTA)
*****************************************************************************/
TAF_UINT32 At_SetCellInfoPara(TAF_UINT8 ucIndex)
{
    VOS_UINT32                          ulAtCmdCellInfo;
    VOS_UINT32                          ulRst;

    /* ???????? */
    if(gucAtParaIndex != 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ulAtCmdCellInfo = gastAtParaList[0].ulParaValue;


    /* ????????ID_AT_MTA_WRR_CELLINFO_QRY_REQ??C??AT AGENT???? */
    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_WRR_CELLINFO_QRY_REQ,
                                   &ulAtCmdCellInfo,
                                   sizeof(VOS_UINT32),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CELLINFO_QUERY;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }


}

/*****************************************************************************
 ?? ?? ??  : At_GetMeanRpt
 ????????  : ????????10????????????????
 ????????  : ??
 ????????  : ??
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??3??14??
    ??    ??   : wanglingping
    ????????   : ??????????

  2.??    ??   : 2011??10??24??
    ??    ??   : o00132663
    ????????   : AT??????????WAS API Was_Mntn_AutoTestGetMeanRpt????????????
                 ????
  3.??    ??   : 2012??3??23??
    ??    ??   : c00173809
    ????????   : DTS2012032107414,????????????
  4.??    ??   : 2012??12??26??
    ??    ??   : m00217266
    ????????   : DSDA C??????????????(??????????????MTA)
*****************************************************************************/
TAF_UINT32  At_GetMeanRpt( TAF_UINT8 ucIndex )
{
    VOS_UINT32                          ulRst;

    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????ID_AT_MTA_WRR_MEANRPT_QRY_REQ??AT AGENT???? */
    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_WRR_MEANRPT_QRY_REQ,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_MEANRPT_QUERY;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}

/*<--W101153 For Was AutoTest*/

/*****************************************************************************
 Prototype      : At_SetRRCVersion
 Description    : ^HSPA=<n>
                  AT^HSPA=0    ????RRC ??????R99
                  AT^HSPA=1    ????RRC ??????R5
                  AT^HSPA=2    ????RRC ??????R6

 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2008-04-04
    Author      : C29528
    Modification: Created function

  2.??    ??   : 2011??10??18??
    ??    ??   : o00132663
    ????????   : AT??????????????API????????????????
  3.??    ??   : 2012??12??26??
    ??    ??   : m00217266
    ????????   : DSDA C??????????????(??????????????MTA)
*****************************************************************************/
TAF_UINT32 At_SetRRCVersion(TAF_UINT8 ucIndex)
{
    VOS_UINT8                           ucRRCVersion;
    VOS_UINT32                          ulRst;

    /* ???????????????????? */
    if(gucAtParaIndex != 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ucRRCVersion = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ????????DRV_AGENT_RRC_VERSION_SET_REQ??AT???????? */

    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_WRR_RRC_VERSION_SET_REQ,
                                   &ucRRCVersion,
                                   sizeof(VOS_UINT8),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_RRC_VERSION_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }

}

/*****************************************************************************
 Prototype      : At_SetCSNR
 Description    :
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.??    ??   : 2008??11??28??
    ??    ??   : o00132663
    ????????   : ??????????AT2D07071,????GSM????AT^CSNR??????????
*****************************************************************************/
TAF_UINT32 At_SetCSNR(TAF_UINT8 ucIndex)
{
    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    return AT_OK;
}

/*****************************************************************************
 Prototype      : At_SetFreqLock
 Description    : ^FREQLOCK=<enable>[,<freq>]

                            <enable>??
                            0   ????????????????
                            1   ??????????????

                            <freq>??
                            ??????????????????????????????enable = 0 ?? freq ????????

 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2008-04-15
    Author      : C29528
    Modification: Created function
 2.??    ??   : 2011??01??24??
   ??    ??   : lijun 00171473
   ????????   : DTS2011012405909,??????????????????

 3.??    ??   : 2011??10??18??
   ??    ??   : o00132663
   ????????   : AT??????????????API????????????????
  4.??    ??   : 2012??12??26??
    ??    ??   : m00217266
    ????????   : DSDA C??????????????(??????????????MTA)
*****************************************************************************/
TAF_UINT32 At_SetFreqLock(TAF_UINT8 ucIndex)
{
    MTA_AT_WRR_FREQLOCK_CTRL_STRU       stFreqLock;
    VOS_UINT32                          ulRst;

    /* ???????????????????????????? */
    if ( (gucAtParaIndex != 1) && (gucAtParaIndex != 2) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????????????,????????????????????????????
       ??????????????????????*/
    if ( (gastAtParaList[0].ulParaValue == 1)
      && (gastAtParaList[1].usParaLen == 0) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }


    /* ???????????? */
    PS_MEM_SET(&stFreqLock, 0, sizeof(MTA_AT_WRR_FREQLOCK_CTRL_STRU));
    stFreqLock.ucFreqLockEnable = (VOS_UINT8)gastAtParaList[0].ulParaValue;
    stFreqLock.usLockedFreq     = (VOS_UINT16)gastAtParaList[1].ulParaValue;

    /* ???????? ID_AT_MTA_WRR_FREQLOCK_SET_REQ ??C?? AT ???????? */
    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_WRR_FREQLOCK_SET_REQ,
                                   &stFreqLock,
                                   sizeof(MTA_AT_WRR_FREQLOCK_CTRL_STRU),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_FREQLOCK_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }

}



/*****************************************************************************
 Prototype      : At_SetParaCmd
 Description    : ??????????????????????????????????????????????????????
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function

  2.??    ??   : 2011??10??24??
    ??    ??   : o00132663
    ????????   : AT??????????CALL ABORT????????????????????
*****************************************************************************/
TAF_UINT32 At_SetParaCmd(TAF_UINT8 ucIndex)
{
    AT_RRETURN_CODE_ENUM_UINT32         ulResult = AT_FAILURE;

    /*
    vts????????????????????????????????????????????TAF_NULL_PTR??????????????????????????????????
    ????????????????????????????????????????????????????0????????????
    */

    if(TAF_NULL_PTR != g_stParseContext[ucIndex].pstCmdElement->pfnSetProc)
    {
        ulResult = (AT_RRETURN_CODE_ENUM_UINT32)g_stParseContext[ucIndex].pstCmdElement->pfnSetProc(ucIndex);

        if(AT_WAIT_ASYNC_RETURN == ulResult)
        {
            g_stParseContext[ucIndex].ucClientStatus = AT_FW_CLIENT_STATUS_PEND;

            /* ???????? */
            if(AT_SUCCESS != At_StartTimer(g_stParseContext[ucIndex].pstCmdElement->ulSetTimeOut,ucIndex))
            {
                AT_ERR_LOG("At_SetParaCmd:ERROR:Start Timer");
                return AT_ERROR;
            }
        }
        return ulResult;
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 Prototype      : At_StgrSelMenu
 Description    :
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.Date        : 2006-11-16
    Author      : h44270
    Modification: modified by h44270 for A32D07185
  3.Date        : 2012??8??10??
    Author      : y00213812
    Modification: DTS2012082204471, TQE????
*****************************************************************************/
TAF_UINT32 At_StgrSelMenu(TAF_UINT8 ucIndex)
{
    SI_STK_MENU_SELECTION_STRU *pMenu;
    SI_STK_ENVELOPE_STRU        stENStru;
    VOS_UINT32                  ulRslt;

    /* ???????? */
    if(gucAtParaIndex > 4)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    stENStru.enEnvelopeType     = SI_STK_ENVELOPE_MENUSEL;
    stENStru.DeviceId.ucSDId    = SI_DEVICE_KEYPAD;
    stENStru.DeviceId.ucDDId    = SI_DEVICE_UICC;

    pMenu = &stENStru.uEnvelope.MenuSelect;
    PS_MEM_SET(pMenu, 0x00, sizeof(SI_STK_MENU_SELECTION_STRU));

    if(SI_AT_RESULT_HELP_REQUIRED == gastAtParaList[2].ulParaValue)
    {
        pMenu->OP_Help        = 1;
        pMenu->Help.aucRsv[0] = 1;
    }

    /*select item*/
    if(0 == gastAtParaList[3].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }
    else
    {
        /*modified by Y00213812 for DTS2012082204471 TQE????, 2012-08-10, begin*/
        ulRslt = At_Auc2ul(gastAtParaList[3].aucPara, gastAtParaList[3].usParaLen, &gastAtParaList[3].ulParaValue);
        if (AT_SUCCESS != ulRslt)
        {
            AT_WARN_LOG("At_StgiSelectItem():Warning: At_Auc2ul convert failed!");
            return AT_ERROR;
        }
        /*modified by Y00213812 for DTS2012082204471 TQE????, 2012-08-10, end*/

        pMenu->OP_ItemIp       = 1;
        pMenu->ItemId.ucItemId = (TAF_UINT8)gastAtParaList[3].ulParaValue;
    }

    /* ???????????? */
    if(AT_SUCCESS == SI_STK_MenuSelection(gastAtClientTab[ucIndex].usClientId, 0,&stENStru))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_STGR_SET;

        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;    /* ???????????????????? */
    }
}

/*****************************************************************************
 Prototype      : At_ChangeCmdResult
 Description    :
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_ChangeCmdResult(TAF_UINT32 resultNo,TAF_UINT8 *cmdResult)
{
    TAF_UINT32 ulResult;

    ulResult = AT_SUCCESS;

    switch(resultNo)
    {
        case SI_AT_RESULT_END_SESSION:
            *cmdResult = PROACTIVE_UICC_SESSION_TERMINATED_BY_THE_USER;
            break;
        case SI_AT_RESULT_PERFORM_SUCC:
            *cmdResult = COMMAND_PERFORMED_SUCCESSFULLY;
            break;
        case SI_AT_RESULT_HELP_REQUIRED:
            *cmdResult = HELP_INFORMATION_REQUIRED_BY_USER;
            break;
        case SI_AT_RESULT_BACKWARD_MOVE:
            *cmdResult = BACKWARD_MOVE_IN_THE_PROACTIVE_UICC_SESSION_REQUESTED_BY_USER;
            break;
        case SI_AT_RESULT_ME_NOT_SUPPORT:
            *cmdResult = COMMAND_BEYOND_TERMINALS_CAPABILITIES;
            break;
        case SI_AT_RESULT_ME_BROWSER_BUSY:
            *cmdResult = TERMINAL_CURRENTLY_UNABLE_TO_PROCESS_COMMAND;
            break;
        case SI_AT_RESULT_ME_SS_BUSY:
            *cmdResult = TERMINAL_CURRENTLY_UNABLE_TO_PROCESS_COMMAND;
            break;
        default:
            ulResult= AT_ERROR;
    }

    return ulResult;
}

/*****************************************************************************
 Prototype      : At_StgiGetKey
 Description    :
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_StgiGetKey(TAF_UINT8 ucIndex, SI_STK_TERMINAL_RSP_STRU *pRsp)
{
    TAF_UINT8 cmdResult;
    TAF_UINT8 InputKey[AT_PARA_MAX_LEN + 1];

    if(AT_ERROR == At_ChangeCmdResult(gastAtParaList[2].ulParaValue, &cmdResult))
    {
        return AT_ERROR;
    }

    pRsp->Result.Result = cmdResult;

    if(COMMAND_PERFORMED_SUCCESSFULLY == cmdResult)
    {
        /* ???????? */
        pRsp->uResp.GetInkeyRsp.TextStr.pucText = pRsp->aucData;

        VOS_MemCpy(InputKey, gastAtParaList[3].aucPara, gastAtParaList[3].usParaLen);

        /*????????????????????????AT??????????????????????????????????????????????
        ????????????????????????????2*/
        if(AT_FAILURE == At_AsciiString2HexText(&pRsp->uResp.GetInkeyRsp.TextStr,\
                                                    InputKey+1, gastAtParaList[3].usParaLen-2))
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        pRsp->uResp.GetInkeyRsp.OP_TextStr = 1;

        if((gucSTKCmdQualify&0x02)== 0x00)
        {
            pRsp->uResp.GetInkeyRsp.TextStr.ucDCS = 0x04;
        }
        else
        {
            pRsp->uResp.GetInkeyRsp.TextStr.ucDCS = 0x08;
        }

        if((gucSTKCmdQualify&0x04)== 0x04)
        {
            *pRsp->uResp.GetInkeyRsp.TextStr.pucText -=0x30;
        }
    }

    return AT_SUCCESS;
}
/*****************************************************************************
 Prototype      : At_StgiGetInput
 Description    :
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_StgiGetInput(TAF_UINT8 ucIndex,SI_STK_TERMINAL_RSP_STRU *pRsp)
{
    TAF_UINT8 cmdResult;
    TAF_UINT8 InputString[AT_PARA_MAX_LEN + 1];

    if(AT_ERROR == At_ChangeCmdResult(gastAtParaList[2].ulParaValue, &cmdResult))
    {
        return AT_ERROR;
    }

    pRsp->Result.Result = cmdResult;

    if(COMMAND_PERFORMED_SUCCESSFULLY == cmdResult)
    {
        /* ???????? */
        if(0x03 >  gastAtParaList[3].usParaLen)
        {
            pRsp->uResp.GetInkeyRsp.TextStr.pucText = TAF_NULL_PTR;

            pRsp->uResp.GetInkeyRsp.TextStr.ucLen = 0;
        }
        else
        {
            pRsp->uResp.GetInkeyRsp.TextStr.pucText = pRsp->aucData;

            VOS_MemCpy(InputString, gastAtParaList[3].aucPara, gastAtParaList[3].usParaLen);

            /*????????????????????????AT??????????????????????????????????????????????????????????????????????????2*/
            if(AT_FAILURE == At_AsciiString2HexText(&pRsp->uResp.GetInputRsp.TextStr,\
                                            InputString+1, gastAtParaList[3].usParaLen-2))
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }
        }

        pRsp->uResp.GetInputRsp.OP_TextStr = 1;

        if((gucSTKCmdQualify&0x02)== 0x00)
        {
            if((gucSTKCmdQualify&0x08)== 0x00)
            {
                pRsp->uResp.GetInkeyRsp.TextStr.ucDCS = 0x04;
            }
            else
            {
                pRsp->uResp.GetInkeyRsp.TextStr.ucDCS = 0x00;
            }
        }
        else
        {
            pRsp->uResp.GetInkeyRsp.TextStr.ucDCS = 0x08;
        }
    }

    return AT_SUCCESS;
}
/*****************************************************************************
 Prototype      : At_StgiSelectItem
 Description    :
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2012??8??10??
    ??    ??   : y00213812
    ????????   : DTS2012082204471, TQE????
*****************************************************************************/
TAF_UINT32 At_StgiSelectItem(TAF_UINT8 ucIndex,SI_STK_TERMINAL_RSP_STRU *pRsp)
{
    TAF_UINT8       cmdResult;
    VOS_UINT32      ulRslt;

    if(AT_ERROR == At_ChangeCmdResult(gastAtParaList[2].ulParaValue, &cmdResult))
    {
        return AT_ERROR;
    }

    pRsp->Result.Result = cmdResult;

    if(COMMAND_PERFORMED_SUCCESSFULLY == cmdResult)
    {
        /*modified by Y00213812 for DTS2012082204471 TQE????, 2012-08-10, begin*/
        ulRslt = At_Auc2ul(gastAtParaList[3].aucPara, gastAtParaList[3].usParaLen, &gastAtParaList[3].ulParaValue);
        if (AT_SUCCESS != ulRslt)
        {
            AT_WARN_LOG("At_StgiSelectItem():Warning: At_Auc2ul convert failed!");
            return AT_ERROR;
        }
        /*modified by Y00213812 for DTS2012082204471 TQE????, 2012-08-10, end*/

        /* ???????? */
        pRsp->uResp.SelectItemRsp.ItemId.ucItemId = (TAF_UINT8)gastAtParaList[3].ulParaValue;
        pRsp->uResp.SelectItemRsp.OP_ItemID       = 1;
    }

    return AT_SUCCESS;
}

/*****************************************************************************
 Prototype      : At_SetStgrPara
 Description    : ^STGR=<cmdnum>,<cmdtype>,<result>,<data>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetStgrPara(TAF_UINT8 ucIndex)
{
    SI_STK_TERMINAL_RSP_STRU Rsponse;
    TAF_UINT32 Result = 0;

    if(TAF_FALSE == g_ulSTKFunctionFlag)
    {
        return AT_ERROR;
    }

    if((gucAtParaIndex > 4)||(gucAtParaIndex < 3))          /* the para munber is too many or too few */
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if((0 == gastAtParaList[0].usParaLen)||(0 == gastAtParaList[1].usParaLen))  /* the para1 and para2 is must be inputed */
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    Rsponse.DeviceId.ucSDId = SI_DEVICE_KEYPAD;
    Rsponse.DeviceId.ucDDId = SI_DEVICE_UICC;

    /* At_Auc2ul(gastAtParaList[3].aucPara, gastAtParaList[3].usParaLen, &gastAtParaList[3].ulParaValue); */

    if(gastAtParaList[0].ulParaValue == 0x00)
    {
        if((gastAtParaList[2].ulParaValue== 1)||(gastAtParaList[2].ulParaValue == 2))   /* menu selection or need the help infomation */
        {
            return At_StgrSelMenu(ucIndex);
        }
        else
        {
            return AT_OK;
        }
    }

    PS_MEM_SET(&Rsponse, 0, sizeof(SI_STK_TERMINAL_RSP_STRU));

    if(SI_AT_CMD_END_SESSION == gastAtParaList[0].ulParaValue)
    {
        Rsponse.Result.Result = PROACTIVE_UICC_SESSION_TERMINATED_BY_THE_USER;
    }
    else if(AT_SUCCESS != At_ChangeSATCmdType(gastAtParaList[0].ulParaValue, &Rsponse.CmdType))
    {
        return AT_ERROR;
    }
    else
    {

    }

    switch(gastAtParaList[0].ulParaValue)
    {
        case SI_AT_CMD_GET_INKEY:
            Result = At_StgiGetKey(ucIndex, &Rsponse);       /* change the GetInkey response content */
            break;
        case SI_AT_CMD_GET_INPUT:
            Result = At_StgiGetInput(ucIndex, &Rsponse);     /* change the GetInput response content */
            break;
        case SI_AT_CMD_SELECT_ITEM:
            Result = At_StgiSelectItem(ucIndex, &Rsponse);   /* change the SelectItem response content */
            break;
        default:
            Result = At_ChangeCmdResult(gastAtParaList[2].ulParaValue, &Rsponse.Result.Result);
            break;
    }

    if(AT_SUCCESS != Result)
    {
        return Result;    /* return the error */
    }

    if(AT_SUCCESS == SI_STK_TerminalResponse(gastAtClientTab[ucIndex].usClientId, 0,&Rsponse))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_STGR_SET;

        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 Prototype      : At_SetCstrPara
 Description    : ^STGR=<Len>,<data>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetCstrPara(TAF_UINT8 ucIndex)
{
    VOS_UINT8   aucData[256];
    VOS_UINT8   ucDataLen;
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    VOS_UINT8                          *pucSystemAppConfig;

    pucSystemAppConfig                  = AT_GetSystemAppConfigAddr();



    if ( SYSTEM_APP_ANDROID != *pucSystemAppConfig)
    {
        return AT_ERROR;
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, end */

    if (gucAtParaIndex != 2)          /* the para munber is too many or too few */
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ((0 == gastAtParaList[0].usParaLen)||(0 == gastAtParaList[1].usParaLen))  /* the para1 and para2 is must be inputed */
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (AT_FAILURE == At_AsciiString2HexSimple(aucData, gastAtParaList[1].aucPara, (VOS_UINT16)gastAtParaList[0].ulParaValue))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ucDataLen = (TAF_UINT8)(gastAtParaList[0].ulParaValue/2);

    if (AT_SUCCESS == SI_STK_DataSendSimple(gastAtClientTab[ucIndex].usClientId, 0, SI_STK_TRSEND, ucDataLen, aucData))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CSTR_SET;

        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}


/*****************************************************************************
 Prototype      : At_SetCsinPara
 Description    : ^CSIN????????????
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2012-05-17
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetCsinPara(TAF_UINT8 ucIndex)
{
    VOS_UINT8                          *pucSystemAppConfig;

    pucSystemAppConfig                  = AT_GetSystemAppConfigAddr();

    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??ANDROID?????????? */
    if ( SYSTEM_APP_ANDROID != *pucSystemAppConfig)
    {
        return AT_ERROR;
    }

    /* ???????????????????????????????????????????? */
    if (AT_SUCCESS == SI_STK_GetSTKCommand(gastAtClientTab[ucIndex].usClientId, 0, 0))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CSEN_SET;

        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 Prototype      : At_SetCstrPara
 Description    : ^STGR=<Len>,<data>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetCsenPara(TAF_UINT8 ucIndex)
{
    VOS_UINT8   aucData[256];
    VOS_UINT8   ucDataLen;
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    VOS_UINT8                          *pucSystemAppConfig;

    pucSystemAppConfig                  = AT_GetSystemAppConfigAddr();



    if ( SYSTEM_APP_ANDROID != *pucSystemAppConfig)
    {
        return AT_ERROR;
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, end */

    if (gucAtParaIndex != 2)          /* the para munber is too many or too few */
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ((0 == gastAtParaList[0].usParaLen)||(0 == gastAtParaList[1].usParaLen))  /* the para1 and para2 is must be inputed */
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (AT_FAILURE == At_AsciiString2HexSimple(aucData, gastAtParaList[1].aucPara, (VOS_UINT16)gastAtParaList[0].ulParaValue))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ucDataLen = (TAF_UINT8)(gastAtParaList[0].ulParaValue/2);

    if (AT_SUCCESS == SI_STK_DataSendSimple(gastAtClientTab[ucIndex].usClientId, 0, SI_STK_ENVELOPESEND, ucDataLen, aucData))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CSEN_SET;

        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 Prototype      : At_SetCsmnPara
 Description    : ^CSMN
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetCsmnPara(TAF_UINT8 ucIndex)
{
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    VOS_UINT8                          *pucSystemAppConfig;

    pucSystemAppConfig                  = AT_GetSystemAppConfigAddr();



    if ( SYSTEM_APP_ANDROID != *pucSystemAppConfig)
    {
        return AT_ERROR;
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, end */

    if (gucAtParaIndex != 0)          /* the para munber is too many or too few */
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (AT_SUCCESS == SI_STK_GetMainMenu(gastAtClientTab[ucIndex].usClientId, 0))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CSEN_SET;

        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 Prototype      : At_SetCstcPara
 Description    : ^CSTC
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  3.??    ??   : 2012??03??03??
    ??    ??   : s62952
    ????????   : BalongV300R002 Build????????:OAM????AP??????????????
  4.??    ??   : 2012??09??18??
    ??    ??   : h59254
    ????????   : STK&DCM?????? ????????

*****************************************************************************/
TAF_UINT32 At_SetCstcPara(TAF_UINT8 ucIndex)
{
    /* Modified by h59254 for STK&DCM Project, 2012/09/18, begin */
    if (gucAtParaIndex != 1)          /* the para munber is too many or too few */
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (AT_SUCCESS == SI_STK_SetUpCallConfirm(gastAtClientTab[ucIndex].usClientId, gastAtParaList[0].ulParaValue))
    {
        return AT_OK;
    }

    return AT_ERROR;
    /* Modified by h59254 for STK&DCM Project, 2012/09/18, end */
}


/*****************************************************************************
 Prototype      : At_SetImsichgPara
 Description    : ^STGR=<cmdnum>,<cmdtype>,<result>,<data>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2010-02-11
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetImsichgPara(TAF_UINT8 ucIndex)
{
    if (VOS_FALSE == SI_STKIsDualImsiSupport())
    {
        return AT_CMD_NOT_SUPPORT;
    }

    if (1 != gucAtParaIndex)          /* the para munber is too many or too few */
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (0 == gastAtParaList[0].usParaLen)  /* the para1 must be inputed */
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (AT_SUCCESS == SI_STKDualIMSIChangeReq(gastAtClientTab[ucIndex].usClientId, 0))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_IMSICHG_SET;

        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_PhyNumIsNull
 ????????  : ????????????????????????????
 ????????  : MODEM_ID_ENUM_UINT16                enModemId
             AT_PHYNUM_TYPE_ENUM_UINT32          enSetType ??????????
 ????????  : pbPhyNumIsNull ??????????????????????????????????
 ?? ?? ??  : VOS_UINT32 AT_ERROR ??????????????????AT_OK????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??2??
    ??    ??   : ??????/f62575
    ????????   : ??????????
  2.??    ??   : 2012??1??3??
    ??    ??   : f62575
    ????????   : SMALL IMAGE????????: ????MAC????????????
  3.??    ??   : 2012??8??10??
    ??    ??   : L00171473
    ????????   : DTS2012082204471, TQE????
  4.??    ??   : 2013??3??4??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  5.??    ??   : 2013??05??20??
    ??    ??   : m00217266
    ????????   : nv??????
*****************************************************************************/
VOS_UINT32  AT_PhyNumIsNull(
    MODEM_ID_ENUM_UINT16                enModemId,
    AT_PHYNUM_TYPE_ENUM_UINT32          enSetType,
    VOS_BOOL                           *pbPhyNumIsNull
)
{
    VOS_UINT32                          ulRet;
    VOS_UINT32                          ulLoop;
    VOS_UINT32                          ulTotalNum;
    IMEI_STRU                           stImei;
    TAF_SVN_DATA_STRU                   stSvnData;
    VOS_UINT8                           *pucCheckNum;
    /* Added by f62575 for SMALL IMAGE, 2012-1-3, begin */
    VOS_UINT8                           aucMac[AT_PHYNUM_MAC_LEN + 1]; /* MAC????*/
    /* Added by f62575 for SMALL IMAGE, 2012-1-3, end */


    PS_MEM_SET(&stSvnData, 0x00, sizeof(stSvnData));


    /* ??????NV??IMEI??SVN????????????????????????????AT_ERROR */
    if (AT_PHYNUM_TYPE_IMEI == enSetType)
    {
        /* Modified by l60609 for DSDA Phase III, 2013-3-4, Begin */
        ulRet = NV_ReadEx(enModemId, en_NV_Item_IMEI, &stImei, NV_ITEM_IMEI_SIZE);
        /* Modified by l60609 for DSDA Phase III, 2013-3-4, End */
        if (NV_OK != ulRet)
        {
            AT_WARN_LOG("AT_PhyNumIsNull: Fail to read en_NV_Item_IMEI");
            return AT_ERROR;
        }

        /*NV??en_NV_Item_IMEI????15????UE??IMEI????????????????????????????*/
        ulTotalNum  = TAF_IMEI_DATA_LENGTH;
        pucCheckNum = stImei.aucImei;
    }
    else if (AT_PHYNUM_TYPE_SVN == enSetType)
    {
        /* Modified by l60609 for DSDA Phase III, 2013-3-4, Begin */
        ulRet = NV_ReadEx(enModemId, en_NV_Item_Imei_Svn, &stSvnData, sizeof(stSvnData));
        /* Modified by l60609 for DSDA Phase III, 2013-3-4, End */
        if (NV_OK != ulRet)
        {
            AT_WARN_LOG("AT_PhyNumIsNull: Fail to read en_Nv_Item_Imei_Svn");
            return AT_ERROR;
        }

        /* SVN?????????????????????? */
        if (NV_ITEM_ACTIVE != stSvnData.ucActiveFlag)
        {
            *pbPhyNumIsNull = VOS_TRUE;
            return AT_OK;
        }

        ulTotalNum  = TAF_SVN_DATA_LENGTH;
        pucCheckNum = stSvnData.aucSvn;
    }
    /* Added by f62575 for SMALL IMAGE, 2012-1-3, begin */
    else if (AT_PHYNUM_TYPE_MAC == enSetType)
    {
        /* ????????MAC???????????????? */
        AT_GetPhynumMac(aucMac);
        ulTotalNum  = AT_PHYNUM_MAC_LEN;
        pucCheckNum = aucMac;
    }
    /* Added by f62575 for SMALL IMAGE, 2012-1-3, end   */
    else
    {
        AT_WARN_LOG("AT_PhyNumIsNull: the type of physical is error.");
        return AT_ERROR;
    }

    /* NV??IMEI??SVN??????????0?????????????????????????? */
    for (ulLoop = 0; ulLoop < ulTotalNum; ulLoop++)
    {
        if (0 != *pucCheckNum)
        {
            *pbPhyNumIsNull = VOS_FALSE;
            return AT_OK;
        }

        pucCheckNum++;
    }

    *pbPhyNumIsNull = VOS_TRUE;

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_UpdateImei
 ????????  : ????IMEI??NV??en_NV_Item_IMEI
             IMEI??????IMEI(TAC8??,SNR6??)??????????????????
             IMEI??????NV????IMEI????15????1????????????????16????
 ????????  : MODEM_ID_ENUM_UINT16                enModemId
             VOS_UINT8  aucImei[]    IMEI????????????????????????????15????IMEI????
             VOS_UINT32 ulImeiLength IMEI??????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32 ????????????
             AT_OK                ????????????
             AT_PHYNUM_LENGTH_ERR ??????????????
             AT_PHYNUM_NUMBER_ERR ??????????
             AT_ERROR             NV????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??2??
    ??    ??   : ??????/f62575
    ????????   : ??????????
  2.??    ??   : 2013??3??4??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
VOS_UINT32 AT_UpdateImei(
    MODEM_ID_ENUM_UINT16                enModemId,
    VOS_UINT8                           aucImei[],
    VOS_UINT16                          usImeiLength
)
{
    VOS_UINT8                           aucBcdNum[TAF_PH_IMEI_LEN];
    VOS_UINT8                           ucCheckData;
    VOS_UINT32                          i;

    /* IMEI ????????: ??????????IMEI????????14????IMEI??1????CHECK NUM????15?? */
    if ((TAF_PH_IMEI_LEN - 1) != usImeiLength)
    {
        AT_NORM_LOG1("AT_UpdateImei: the length of imei is error ", (VOS_INT32)usImeiLength);
        return AT_PHYNUM_LENGTH_ERR;
    }

    /* IMEI ????????: ????<imei>????????????, ????ASCII????????BCD?? */
    if (AT_SUCCESS != At_AsciiNum2Num(aucBcdNum, aucImei, usImeiLength))
    {
        AT_NORM_LOG("AT_UpdateImei: the number of imei is error.");
        return AT_PHYNUM_NUMBER_ERR;
    }
    aucBcdNum[TAF_PH_IMEI_LEN - 1] = 0;

    /* IMEI ????????: IMEI??????IMEI(TAC8??,SNR6??)??????????????????
       ????????: 3GPP 23003 B.2 Computation of CD for an IMEI??B.3 Example of computation */
    ucCheckData = 0;
    for (i = 0; i < (TAF_IMEI_DATA_LENGTH - 1); i += 2)
    {
        ucCheckData += aucBcdNum[i]
                       + ((aucBcdNum[i + 1UL] + aucBcdNum[i + 1UL]) / 10)
                       + ((aucBcdNum[i + 1UL] + aucBcdNum[i + 1UL]) % 10);
    }
    ucCheckData = (10 - (ucCheckData % 10)) % 10;

    if (ucCheckData != aucBcdNum[TAF_PH_IMEI_LEN - 2])
    {
        AT_NORM_LOG("AT_UpdateImei: the checkdata of imei is error.");
        return AT_PHYNUM_NUMBER_ERR;
    }

    /* Modified by l60609 for DSDA Phase III, 2013-3-4, Begin */
    if (NV_OK != NV_WriteEx(enModemId, en_NV_Item_IMEI, aucBcdNum, TAF_PH_IMEI_LEN))
    {
         AT_WARN_LOG("AT_UpdateImei: Fail to write NV.");
         return AT_ERROR;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, End */

    return AT_OK;
}


/*****************************************************************************
 ?? ?? ??  : At_SetImeiPara
 ????????  : ????IMEI
 ????????  : TAF_UINT8 ucIndex ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32 ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2006??12??20??
    ??    ??   : luojian id:60022475
    ????????   : ?????????? ????????:A32D08019
  2.??    ??   : 2007??02??11??
    ??    ??   : luojian id:60022475
    ????????   : ????????:A32D08708
  3.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
  4.??    ??   : 2010??8??4??
    ??    ??   : ??????/f62575
    ????????   : AT??????????
  4.??    ??   : 2013??3??4??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetImeiPara(TAF_UINT8 ucIndex)
{
    VOS_BOOL                            bPhyNumIsNull;
    VOS_UINT32                          ulRet;
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, Begin */
    MODEM_ID_ENUM_UINT16                enModemId;

    enModemId = MODEM_ID_0;
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, End */

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        AT_NORM_LOG1("At_SetImeiPara: the number of parameter is error ",
                     (VOS_INT32)gucAtParaIndex);
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* Modified by l60609 for DSDA Phase III, 2013-3-4, Begin */
    ulRet = AT_GetModemIdFromClient(ucIndex, &enModemId);

    if (VOS_OK != ulRet)
    {
        AT_ERR_LOG("At_SetImeiPara: Get modem id fail.");
        return AT_ERROR;
    }

    /* ????????????????????????????????????????????????????1?????????????? */
    if (AT_OK != AT_PhyNumIsNull(enModemId, AT_PHYNUM_TYPE_IMEI, &bPhyNumIsNull))
    {
        return AT_ERROR;
    }

    if ((VOS_FALSE == bPhyNumIsNull) && (VOS_TRUE == g_bAtDataLocked))
    {
        AT_NORM_LOG("At_SetImeiPara: physical number is not null and data locked.");
        return AT_PHYNUM_TYPE_ERR;
    }

    /* ??????????NV??en_NV_Item_IMEI?????????????? */
    ulRet = AT_UpdateImei(enModemId, gastAtParaList[0].aucPara, gastAtParaList[0].usParaLen);
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, End */

    return ulRet;
}

/*****************************************************************************
 ?? ?? ??  : At_SetFPlmnPara
 ????????  : ????FPLMN??^CFPLMN
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2007??12??29??
    ??    ??   : luojian id:107747
    ????????   : ??????????,A32D13994
  2.??    ??   : 2012??3??26??
    ??    ??   : c00173809
    ????????   : DTS2012032105018,???????????? 0 ????????
*****************************************************************************/
TAF_UINT32 At_SetFPlmnPara(TAF_UINT8 ucIndex)
{
    TAF_PH_FPLMN_OPERATE_STRU stFplmnOperate;


    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if( gucAtParaIndex > 2 )

    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (gastAtParaList[0].usParaLen != 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ( 1 == gucAtParaIndex )
    {
        if ( 0 != gastAtParaList[0].ulParaValue )
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
        else
        {
            stFplmnOperate.stPlmn.Mcc = 0;
            stFplmnOperate.stPlmn.Mnc = 0;
            stFplmnOperate.ulCmdType = TAF_PH_FPLMN_DEL_ALL;
        }
    }
    else if ( 2 == gucAtParaIndex )
    {
        if ((gastAtParaList[1].usParaLen > 6)
         || (gastAtParaList[1].usParaLen < 5))
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
        /* Mcc */
        if(AT_FAILURE == At_String2Hex(gastAtParaList[1].aucPara,3,&stFplmnOperate.stPlmn.Mcc))
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
        /* Mnc */
        if(AT_FAILURE == At_String2Hex(&gastAtParaList[1].aucPara[3],
                                        gastAtParaList[1].usParaLen-3,
                                        &stFplmnOperate.stPlmn.Mnc))
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
        stFplmnOperate.stPlmn.Mcc &= 0x0FFF;

        if (5==gastAtParaList[1].usParaLen)
        {
            stFplmnOperate.stPlmn.Mnc |= 0x0F00;
        }

        stFplmnOperate.stPlmn.Mnc &= 0x0FFF;

        if ( 0 == gastAtParaList[0].ulParaValue)
        {
            stFplmnOperate.ulCmdType = TAF_PH_FPLMN_DEL_ONE;
        }
        else if ( 1 == gastAtParaList[0].ulParaValue)
        {
            stFplmnOperate.ulCmdType = TAF_PH_FPLMN_ADD_ONE;
        }
        else
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
    }
    else
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if (VOS_TRUE == TAF_MMA_SetFPlmnInfo(WUEPS_PID_AT,
                                         gastAtClientTab[ucIndex].usClientId,
                                         0,
                                         &stFplmnOperate))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CFPLMN_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }

}
/*****************************************************************************
 ?? ?? ??  : At_SetQuickStart
 ????????  : ????QuickStart
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2007??10??9??
    ??    ??   : luojian id:107747
    ????????   : ??????????
  2.??    ??   : 2012??05??07??
    ??    ??   : f00179208
    ????????   : DTS2012050307234,????????????
  3.??    ??   : 2015??3??24??
    ??    ??   : y00322978
    ????????   : ????????????TAF_DefQuickStart->TAF_MMA_QuickStartSetRep
*****************************************************************************/
TAF_UINT32 At_SetQuickStart(TAF_UINT8 ucIndex)
{
    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if(1 != gucAtParaIndex)
    {
        return AT_ERROR;
    }

    if (gastAtParaList[0].ulParaValue > 1)
    {
        return AT_ERROR;
    }

    /* ???????????? */
    if (VOS_TRUE == TAF_MMA_SetQuickStartReq(WUEPS_PID_AT,
                                             gastAtClientTab[ucIndex].usClientId,
                                             0,
                                             gastAtParaList[0].ulParaValue))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CQST_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }

}
/*****************************************************************************
 ?? ?? ??  : At_SetAutoAttach
 ????????  : ????Autto Attach
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??02??19??
    ??    ??   : x00115505
    ????????   : ??????????
  2.??    ??   : 2015??3??25??
    ??    ??   : y00322978
    ????????   : ????????AT??????????????
*****************************************************************************/
TAF_UINT32 At_SetAutoAttach(TAF_UINT8 ucIndex)
{
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (gucAtParaIndex > 1)
    {                                                                           /* ???????? */
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (gastAtParaList[0].ulParaValue > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (VOS_TRUE == TAF_MMA_SetAutoAttachReq(WUEPS_PID_AT,
                                             gastAtClientTab[ucIndex].usClientId,
                                             0,
                                             gastAtParaList[0].ulParaValue))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CAATT_SET;
        return AT_WAIT_ASYNC_RETURN;                                            /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}
/*****************************************************************************
 ?? ?? ??  : At_SetSystemInfo
 ????????  : ????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??02??29??
    ??    ??   : x00115505
    ????????   : ??????????

  2.??    ??   : 2011??12??24??
    ??    ??   : w00167002
    ????????   : DTS2011092401323:????????????AT^SYSINFO=1????????????????????
                  ????????????????????????AT^SYSINFO=????????????????

  3.??    ??   : 2015??3??28??
    ??    ??   : g00261581
    ????????   : ????????????
*****************************************************************************/
VOS_UINT32 At_SetSystemInfo(TAF_UINT8 ucIndex)
{
    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(VOS_TRUE == TAF_MMA_QrySystemInfoReq(WUEPS_PID_AT,
                                         gastAtClientTab[ucIndex].usClientId,
                                         0,
                                         VOS_FALSE))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SYSINFO_READ;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}
/*****************************************************************************
 ?? ?? ??  : At_GetBandPara
 Description    : ????SYSCFG??CBND??????????????????,
                  ????????????16??????????,??????????32??????????????,
                  ????????????64??????????,????????,??????32????????
                  ????????????????,band??????W900??W1700????64????????????.??????????:
                  00040000 00000000   WCDMA_IX_1700 -->00040000
                  00020000 00000000   WCDMA 900     -->00020000
                  ??MMA????????,????????64????????????????
 Input          : nptr --- ??????
 Output         :
 Return Value   : AT_SUCCESS --- ????
                  AT_FAILURE --- ????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2009??9??1??
    ??    ??   : l00130025
    ????????   : ??????????
*****************************************************************************/

TAF_UINT32 At_GetBandPara(TAF_UINT8 *nptr,TAF_UINT16 usLen,TAF_USER_SET_PREF_BAND64 * pStBand)
{
    const TAF_UINT8 ucHexLenOfUlongType = 8;
    TAF_UINT32  ulAtRslt1 = AT_SUCCESS;
    TAF_UINT32  ulAtRslt2 = AT_SUCCESS;

    pStBand->ulBandHigh = 0;
    pStBand->ulBandLow = 0;

    /* ????????????  */
    if (usLen <= ucHexLenOfUlongType)
    {
         ulAtRslt1 = At_String2Hex(nptr,usLen,&(pStBand->ulBandLow));
    }
    else
    {
        ulAtRslt1 = At_String2Hex(nptr,usLen-ucHexLenOfUlongType,&(pStBand->ulBandHigh));
        ulAtRslt2 = At_String2Hex(nptr+(usLen-ucHexLenOfUlongType),ucHexLenOfUlongType,&(pStBand->ulBandLow));
    }

    if ( ( AT_FAILURE == ulAtRslt1 ) || (  AT_FAILURE == ulAtRslt2))
    {
        return  AT_FAILURE;
    }

    return AT_SUCCESS;

}


/*****************************************************************************
 ?? ?? ??  : At_ConvertSysCfgExRat
 ????????  : ??SYSCFGEX????????????????????
             TAF_MMA_RAT_ORDER_STRU????????
 ????????  : pstSysCfgExRatOrder - SYSCFGEX??????????????
 ????????  : pstRatOrder         - ??acqorder??????????TAF_MMA_RAT_ORDER_STRU????????
 ?? ?? ??  : ??
 ????????  :
 ????????  :

 ????????      :
 1.??    ??   : 2011??7??25??
   ??    ??   : w00167002
   ????????   : ??????????
 2.??    ??   : 2012??5??24??
   ??    ??   : f62575
   ????????   : DTS2012052302088, ????DTS2012041006710??????????????????????
                030201????????????00????????DTS2012041006710??????????????????
                ??0302??00????????????????????????????????????????????????????

  3.??    ??   : 2012??12??25??
    ??    ??   : z00220246
    ????????   : DSDA Phase II

  4.??    ??   : 2015??4??10??
    ??    ??   : h00313353
    ????????   : SysCfg????
*****************************************************************************/
VOS_VOID At_ConvertSysCfgExRat(
    VOS_UINT8                           ucClientId,
    AT_SYSCFGEX_RAT_ORDER_STRU         *pstSysCfgExRatOrder,
    TAF_MMA_RAT_ORDER_STRU             *pstRatOrder
)
{
    VOS_UINT32                          i;
    MODEM_ID_ENUM_UINT16                enModemId;
    VOS_UINT32                          ulRst;

    enModemId = MODEM_ID_0;

    /* ????ModemID*/
    ulRst = AT_GetModemIdFromClient(ucClientId, &enModemId);
    if (VOS_OK != ulRst)
    {
        AT_ERR_LOG1("At_ConvertSysCfgExRat:Get ModemID From ClientID fail,ClientID=%d", ucClientId);
        return;
    }

    /* ??????????00?????????????? */
    if ( (1 == pstSysCfgExRatOrder->ucRatOrderNum)
      && (AT_SYSCFGEX_RAT_AUTO == pstSysCfgExRatOrder->aenRatOrder[0]))
    {
        AT_SetDefaultRatPrioList(enModemId, pstRatOrder, VOS_TRUE);
        return ;
    }

    /* ??????????99?????????????? */
    if ( (1 == pstSysCfgExRatOrder->ucRatOrderNum)
      && (AT_SYSCFGEX_RAT_NO_CHANGE == pstSysCfgExRatOrder->aenRatOrder[0]) )
    {
        AT_GetRatOrderNvim(enModemId, pstRatOrder, VOS_TRUE);
        return ;
    }

    /* ?????????????????????????? */
    pstRatOrder->ucRatOrderNum = pstSysCfgExRatOrder->ucRatOrderNum;
    for (i = 0; i < pstSysCfgExRatOrder->ucRatOrderNum; i++)
    {
        switch ( pstSysCfgExRatOrder->aenRatOrder[i] )
        {
            case AT_SYSCFGEX_RAT_LTE:
                pstRatOrder->aenRatOrder[i] = TAF_MMA_RAT_LTE;
                break;

            case AT_SYSCFGEX_RAT_WCDMA:
                pstRatOrder->aenRatOrder[i] = TAF_MMA_RAT_WCDMA;
                break;

            case AT_SYSCFGEX_RAT_GSM:
                pstRatOrder->aenRatOrder[i] = TAF_MMA_RAT_GSM;
                break;


            default:
                AT_ERR_LOG("At_ConvertSysCfgExRat");
                break;
        }

    }


}



/* Added by w00167002 for L-C??????????, 2014-2-22, begin */
/*****************************************************************************
 ?? ?? ??  : At_ConvertDetachTypeToServiceDomain
 ????????  : ??Detach??????????????????
 ????????  : ulCgcattMode
 ????????  : ??
 ?? ?? ??  : TAF_MMA_SERVICE_DOMAIN_ENUM_UINT8
 ????????  :
 ????????  :

 ????????      :
 1.??    ??   : 2014??2??22??
   ??    ??   : w00167002
   ????????   : ??????????
 2.??    ??   : 2015??4??9??
   ??    ??   : h00313353
   ????????   : SysCfg????
*****************************************************************************/
TAF_MMA_SERVICE_DOMAIN_ENUM_UINT8 At_ConvertDetachTypeToServiceDomain(
    VOS_UINT32                          ulCgcattMode
)
{
    switch ( ulCgcattMode )
    {
        case AT_CGCATT_MODE_PS :
            return TAF_MMA_SERVICE_DOMAIN_PS;

        case AT_CGCATT_MODE_CS :
            return TAF_MMA_SERVICE_DOMAIN_CS;

        case AT_CGCATT_MODE_CS_PS :
            return TAF_MMA_SERVICE_DOMAIN_CS_PS;

        default:
            AT_ERR_LOG("At_ConvertDetachTypeToServiceDomain Detach Type ERROR");
            return TAF_MMA_SERVICE_DOMAIN_CS_PS;
    }
}


/* Added by w00167002 for L-C??????????, 2014-2-22, end */

/*****************************************************************************
 ?? ?? ??  : At_ConvertCgcattModeToAttachType
 ????????  : ??Attach????????????AttachType
 ????????  : ulCgcattMode
 ????????  : ??
 ?? ?? ??  : TAF_MMA_ATTACH_TYPE_ENUM_UINT8
 ????????  :
 ????????  :

 ????????      :
 1.??    ??   : 2015??4??9??
   ??    ??   : h00313353
   ????????   : ??????????
*****************************************************************************/
TAF_MMA_ATTACH_TYPE_ENUM_UINT8 At_ConvertCgcattModeToAttachType(
    VOS_UINT32                          ulCgcattMode
)
{
    switch ( ulCgcattMode )
    {
        case AT_CGCATT_MODE_PS :
            return TAF_MMA_ATTACH_TYPE_GPRS;

        case AT_CGCATT_MODE_CS :
            return TAF_MMA_ATTACH_TYPE_IMSI;

        case AT_CGCATT_MODE_CS_PS :
            return TAF_MMA_ATTACH_TYPE_GPRS_IMSI;

        default:
            AT_ERR_LOG("At_ConvertCgcattModeToAttachType Attach Oper ERROR");
            return TAF_MMA_ATTACH_TYPE_GPRS_IMSI;
    }
}



/*****************************************************************************
 ?? ?? ??  : AT_ReadRoamCfgInfoNvim
 ????????  : ??en_NV_Item_Roam_Capa NV??????????????
 ????????  : VOS_UINT8                           ucIndex
 ????????  : ??
 ?? ?? ??  : ??
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??8??18??
    ??    ??   : z00161729
    ????????   : ??????????
  2.??    ??   : 2012??8??10??
    ??    ??   : L00171473
    ????????   : DTS2012082204471, TQE????
  3.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  4.??    ??   : 2013??5??17??
    ??    ??   : l00167671
    ????????   : NV??????????, ??NV??????????????????
*****************************************************************************/
VOS_VOID AT_ReadRoamCfgInfoNvim(
    VOS_UINT8                           ucIndex
)
{
    NAS_NVIM_ROAM_CFG_INFO_STRU          stRoamFeature;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    MODEM_ID_ENUM_UINT16                enModemId;
    VOS_UINT32                          ulRst;
    AT_MODEM_NET_CTX_STRU              *pstNetCtx = VOS_NULL_PTR;
    VOS_UINT32                          ulLength;

    enModemId = MODEM_ID_0;
    ulLength  = 0;

    /* ????ModemId */
    ulRst = AT_GetModemIdFromClient(ucIndex, &enModemId);
    if (VOS_OK != ulRst)
    {
        AT_ERR_LOG1("AT_ReadRoamCfgInfoNvim:Get ModemID From ClientID fail,ucIndex=%d", ucIndex);
        return;
    }


    stRoamFeature.ucRoamFeatureFlg = NV_ITEM_ACTIVE;
    stRoamFeature.ucRoamCapability = 0;

    (VOS_VOID)NV_GetLength(en_NV_Item_Roam_Capa, &ulLength);
    if (NV_OK != NV_ReadEx(enModemId, en_NV_Item_Roam_Capa,
                         &stRoamFeature, ulLength))
    {
        AT_WARN_LOG("AT_ReadRoamCfgInfoNvim():WARNING: en_NV_Item_Roam_Capa Error");

        return;
    }

    if ((NV_ITEM_ACTIVE != stRoamFeature.ucRoamFeatureFlg)
     && (NV_ITEM_DEACTIVE != stRoamFeature.ucRoamFeatureFlg))
    {
        return;
    }

    pstNetCtx                = AT_GetModemNetCtxAddrFromModemId(enModemId);
    pstNetCtx->ucRoamFeature = stRoamFeature.ucRoamFeatureFlg;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */
    return;
}

/*****************************************************************************
 ?? ?? ??  : AT_ConvertSysCfgExRatOrderPara
 ????????  : ????syscfgex??acqorder??????????,????????????????
             TAF_MMA_RAT_ORDER_STRU????????
 ????????  : VOS_UINT8                           ucClientId,
             TAF_MMA_RAT_ORDER_STRU              *pstSysCfgExRatOrder
 ????????  : pstSysCfgExRatOrder - ??acqorder??????????TAF_MMA_RAT_ORDER_STRU????????
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
 1.??    ??   : 2011??6??28??
   ??    ??   : z00161729
   ????????   : ??????????

  2.??    ??   : 2012??12??24??
    ??    ??   : z00220246
    ????????   : DSDA Phase II
*****************************************************************************/
VOS_UINT32 AT_ConvertSysCfgExRatOrderPara(
    VOS_UINT8                           ucClientId,
    TAF_MMA_RAT_ORDER_STRU             *pstSysCfgExRatOrder
)
{
    VOS_UINT32                          ulRst;
    VOS_UINT32                          i;
    VOS_UINT32                          ulRatOrder;
    VOS_UINT8                           ucIndex;
    VOS_UINT32                          ulRatAutoNoChangeExistFlag;
    AT_SYSCFGEX_RAT_ORDER_STRU          stSyscfgExRatOrder;

    ucIndex                    = 0;
    ulRatAutoNoChangeExistFlag = VOS_FALSE;

    /* acqorder???????????????? */
    if ((gastAtParaList[0].usParaLen % 2) != 0)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* acqorder?????????????? */
    ulRst = At_CheckNumString(gastAtParaList[0].aucPara, gastAtParaList[0].usParaLen);
    if (ulRst != AT_SUCCESS)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* acqorder??????????????????????6??????,??01/02/03??????????03/04/07?????? */
    if ((gastAtParaList[0].usParaLen / 2) > TAF_PH_MAX_GUL_RAT_NUM)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    for (i = 0; i < gastAtParaList[0].usParaLen; i += AT_SYSCFGEX_RAT_MODE_STR_LEN)
    {
        ulRst = At_String2Hex(&gastAtParaList[0].aucPara[i], AT_SYSCFGEX_RAT_MODE_STR_LEN, (VOS_UINT32 *)&ulRatOrder);
        if (AT_SUCCESS != ulRst)
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        /* ????ulRatOrder??0x99??????????????????????????????99 */
        if (AT_SYSCFGEX_RAT_NO_CHANGE_HEX_VALUE == ulRatOrder)
        {
            ulRatOrder = AT_SYSCFGEX_RAT_NO_CHANGE;
        }

        /* acqorder??????????00/01/02/03/04/07/99?????? */
        if ( VOS_FALSE == At_CheckSysCfgExRatTypeValid((AT_SYSCFGEX_RAT_TYPE_ENUM_UINT8)ulRatOrder) )
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        if ((AT_SYSCFGEX_RAT_AUTO == (AT_SYSCFGEX_RAT_TYPE_ENUM_UINT8)ulRatOrder)
         || (AT_SYSCFGEX_RAT_NO_CHANGE == (AT_SYSCFGEX_RAT_TYPE_ENUM_UINT8)ulRatOrder))
        {
            ulRatAutoNoChangeExistFlag = VOS_TRUE;
        }

        stSyscfgExRatOrder.aenRatOrder[ucIndex++] = (AT_SYSCFGEX_RAT_TYPE_ENUM_UINT8)ulRatOrder;

    }

    stSyscfgExRatOrder.ucRatOrderNum = ucIndex;

    /* acqorder????????00??99?????????????? */
    if ((VOS_TRUE == ulRatAutoNoChangeExistFlag)
     && (stSyscfgExRatOrder.ucRatOrderNum > 1))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* acqorder???????????????????? */
    if ( VOS_TRUE == At_CheckRepeatedRatOrder(&stSyscfgExRatOrder) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??SYSCFGEX????????????????????TAF_MMA_RAT_ORDER_STRU???????? */
    At_ConvertSysCfgExRat(ucClientId, &stSyscfgExRatOrder, pstSysCfgExRatOrder);

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_CheckRepeatedRatOrder
 ????????  : ????????????????????????
 ????????  : pstSyscfgExRatOrder - ????????????
 ????????  : ??
 ?? ?? ??  : VOS_TRUE: ??????????????????
              VOS_FALSE:????????????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??7??26??
    ??    ??   : w00167002
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 At_CheckRepeatedRatOrder(
    AT_SYSCFGEX_RAT_ORDER_STRU         *pstSyscfgExRatOrder
)
{
    VOS_UINT32                          i;
    VOS_UINT32                          j;

    for (i = 0; i < pstSyscfgExRatOrder->ucRatOrderNum; i++)
    {
        for (j = i + 1; j < pstSyscfgExRatOrder->ucRatOrderNum; j++)
        {
            if (pstSyscfgExRatOrder->aenRatOrder[i] == pstSyscfgExRatOrder->aenRatOrder[j])
            {
                return VOS_TRUE;
            }
        }
    }

    return VOS_FALSE;
}

/*****************************************************************************
 ?? ?? ??  : At_CheckSysCfgExRatTypeValid
 ????????  : ????SYSCFGEX??????????????????
 ????????  : ucRatOrder - ????????????
 ????????  : ??
 ?? ?? ??  : VOS_TRUE: ??????????????
              VOS_FALSE:????????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??7??26??
    ??    ??   : w00167002
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 At_CheckSysCfgExRatTypeValid(
    VOS_UINT8                           ucRatOrder
)
{
    switch ( ucRatOrder )
    {
        case AT_SYSCFGEX_RAT_AUTO:
        case AT_SYSCFGEX_RAT_NO_CHANGE:
        case AT_SYSCFGEX_RAT_LTE:
        case AT_SYSCFGEX_RAT_WCDMA:
        case AT_SYSCFGEX_RAT_GSM:
            return VOS_TRUE;

        default:
            return VOS_FALSE;
    }

}


/*****************************************************************************
 ?? ?? ??  : AT_ConvertSysCfgExBandPara
 ????????  : ????SYSCFGEX??????????????????,????????????16??????????
 ????????  : pucPara - ????????????????????
             usLen   - ??????????
 ????????  : pstPrefBandPara - ????????????
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??6??28??
    ??    ??   : z00161729
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_ConvertSysCfgExBandPara(
    VOS_UINT8                          *pucPara,
    VOS_UINT16                          usLen,
    TAF_USER_SET_PREF_BAND64           *pstPrefBandPara
)
{
    VOS_UINT32                          ulRslt;

    pstPrefBandPara->ulBandHigh = 0;
    pstPrefBandPara->ulBandLow  = 0;

    /* ??????????????????????*/
    if (0 == usLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????????32???? */
    if (usLen <= AT_HEX_LEN_OF_ULONG_TYPE)
    {
        ulRslt = At_String2Hex(pucPara, usLen, &(pstPrefBandPara->ulBandLow));
    }
    else
    {
        /* 64??????????32??????????????16???????????????????? */
        ulRslt = At_String2Hex(pucPara, (usLen - AT_HEX_LEN_OF_ULONG_TYPE),
                               &(pstPrefBandPara->ulBandHigh));
        if (AT_FAILURE == ulRslt)
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        /* 64??????????32??????????????16????????????????????  */
        ulRslt = At_String2Hex(pucPara + (usLen - AT_HEX_LEN_OF_ULONG_TYPE),
                               AT_HEX_LEN_OF_ULONG_TYPE, &(pstPrefBandPara->ulBandLow));
    }

    if (AT_FAILURE == ulRslt)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    return AT_OK;

}

/*****************************************************************************
 ?? ?? ??  : AT_CheckSysCfgExPara
 ????????  : ????syscfgex??????????????????
 ????????  : ??
 ????????  : pstSysCfgExSetPara - ????????MMA????????????
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??6??28??
    ??    ??   : z00161729
    ????????   : ??????????
  2.??    ??   : 2011??10??28??
    ??    ??   : z00161729
    ????????   : V7R1 phaseIII????????????:????l????????????cs only????????

  3.??    ??   : 2012??4??20??
    ??    ??   : z40661
    ????????   : DTS2012033105463,????AUTO??,????????W??????

  4.??    ??   : 2012??12??24??
    ??    ??   : z00220246
    ????????   : DSDA Phase II
  5.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  6.??    ??   : 2014??2??13??
    ??    ??   : w00167002
    ????????   : L-C??????????:????SYSCFG??????????????
  7.??    ??   : 2015??4??10??
    ??    ??   : h00313353
    ????????   : SysCfg????
*****************************************************************************/
/* Modified by w00167002 for L-C??????????, 2014-2-13, begin */
VOS_UINT32 AT_CheckSysCfgExPara(
    VOS_UINT8                           ucClientId,
    TAF_MMA_SYS_CFG_PARA_STRU          *pstSysCfgExSetPara
)
{
    VOS_UINT32                          ulRst;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_NET_CTX_STRU              *pstNetCtx = VOS_NULL_PTR;

    pstNetCtx = AT_GetModemNetCtxAddrFromClientId(ucClientId);
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

    /* ????????????,????????7????????AT_CME_INCORRECT_PARAMETERS*/
    if ( AT_SYSCFGEX_PARA_NUM != gucAtParaIndex )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????acqorder??????????,????????,??????????????,??????????????????????*/
    ulRst = AT_ConvertSysCfgExRatOrderPara(ucClientId, &pstSysCfgExSetPara->stRatOrder);
    if (AT_OK != ulRst)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }
    pstSysCfgExSetPara->enUserPrio = TAF_MMA_USER_SET_PRIO_NOCHANGE;
    if ( VOS_FALSE == AT_IsSupportLMode(&pstSysCfgExSetPara->stRatOrder))
    {
        if ( TAF_MMA_RAT_GSM == pstSysCfgExSetPara->stRatOrder.aenRatOrder[0])
        {
            pstSysCfgExSetPara->enUserPrio = TAF_MMA_USER_SET_PRIO_GSM_PREFER;
        }
        else
        {
            pstSysCfgExSetPara->enUserPrio = TAF_MMA_USER_SET_PRIO_AUTO;
        }
    }

    /* ??????????????????L,??????????cs only?????????? */
    if ((VOS_TRUE == AT_IsSupportLMode(&pstSysCfgExSetPara->stRatOrder))
     && ((TAF_MMA_SERVICE_DOMAIN_CS  == gastAtParaList[3].ulParaValue)
      || (TAF_MMA_SERVICE_DOMAIN_ANY == gastAtParaList[3].ulParaValue)))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????band??????????,????????,??????????????,??????????????????????*/
    ulRst = AT_ConvertSysCfgExBandPara(gastAtParaList[1].aucPara,
                                       gastAtParaList[1].usParaLen,
                                       &pstSysCfgExSetPara->stGuBand);
    if (AT_OK != ulRst)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????????????,????????????????0-2; ????????????,????????????????0-3 */
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_ReadRoamCfgInfoNvim(ucClientId);
    if (((AT_ROAM_FEATURE_OFF == pstNetCtx->ucRoamFeature) && (gastAtParaList[2].ulParaValue > AT_ROAM_FEATURE_OFF_NOCHANGE))
     || ((AT_ROAM_FEATURE_ON == pstNetCtx->ucRoamFeature) && (gastAtParaList[2].ulParaValue > TAF_MMA_ROAM_NATIONAL_OFF_INTERNATIONAL_OFF)))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

    pstSysCfgExSetPara->enRoam = (VOS_UINT8)gastAtParaList[2].ulParaValue;

    /* ????lteband??????????,????????,??????????????,??????????????????????*/
    ulRst = AT_ConvertSysCfgExBandPara(gastAtParaList[4].aucPara,
                                       gastAtParaList[4].usParaLen,
                                       &pstSysCfgExSetPara->stLBand);
    if (AT_OK != ulRst)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* Deleted by w00167002 for L-C??????????, 2014-2-13, begin */
    /* Deleted by w00167002 for L-C??????????, 2014-2-13, end */

    pstSysCfgExSetPara->enSrvDomain = (VOS_UINT8)gastAtParaList[3].ulParaValue;

    return ulRst;

}


/*****************************************************************************
 ?? ?? ??  : AT_SetSysCfgExPara
 ????????  : ????^syscfgex??????
             ????????:^SYSCFGEX=<acqorder>,<band>,<roam>,<srvdomain>,<lteband>,
                                <reserve1>,<reserve2>
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??6??28??
    ??    ??   : z00161729
    ????????   : ??????????
  2.??    ??   : 2014??2??13??
    ??    ??   : w00167002
    ????????   : L-C??????????:????SYSCFG??????????????
*****************************************************************************/
VOS_UINT32 AT_SetSysCfgExPara(
    VOS_UINT8                           ucIndex
)
{
    /* Modified by w00167002 for L-C??????????, 2014-2-13, begin */
    TAF_MMA_SYS_CFG_PARA_STRU           stSysCfgExSetPara;
    /* Modified by w00167002 for L-C??????????, 2014-2-13, end */

    VOS_UINT32                          ulRst;

    PS_MEM_SET(&stSysCfgExSetPara, 0, sizeof(stSysCfgExSetPara));

    /* Modified by w00167002 for L-C??????????, 2014-2-13, begin */

    /* ????????????????????,?????????????????? */
    ulRst = AT_CheckSysCfgExPara(ucIndex, &stSysCfgExSetPara);
    /* Modified by w00167002 for L-C??????????, 2014-2-13, end */

    if (AT_OK != ulRst)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* Modified by w00167002 for L-C??????????, 2014-2-13, begin */

    /* ??MMA???????????????????????????????????????????????????? */
    ulRst = TAF_MMA_SetSysCfgReq(WUEPS_PID_AT, gastAtClientTab[ucIndex].usClientId, 0, &stSysCfgExSetPara);

    if (VOS_TRUE == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SYSCFG_SET;

        /* ???????????????????? */
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
    /* Modified by w00167002 for L-C??????????, 2014-2-13, end */

}

/*****************************************************************************
 ?? ?? ??  : AT_GetValidNetScanPowerParam
 ????????  : ??????????POWER??????[-110,-47]????????????
 ????????  : ??
 ????????  : psCellPower - AT??????POWER??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??10??15??
    ??    ??   : w00242748
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_GetValidNetScanPowerParam(
    VOS_INT16                          *psCellPower
)
{
    VOS_UINT32                          ulCellPower;

    ulCellPower = 0;

    /* power[-110,-47]????????4??????3???????????? */
    if ( (AT_NETSCAN_POWER_PARA_MAX_LEN < gastAtParaList[1].usParaLen)
      || (AT_NETSCAN_POWER_PARA_MIN_LEN > gastAtParaList[1].usParaLen) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????????????'-'?????????????? */
    if ( '-' != gastAtParaList[1].aucPara[0] )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* POWER????????'-',???????????? */
    if ( AT_SUCCESS != atAuc2ul( &gastAtParaList[1].aucPara[1],
                                 gastAtParaList[1].usParaLen - 1,
                                 &ulCellPower) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????POWER?????????????????? */
    *psCellPower = -(VOS_INT16)ulCellPower;

    /* power????????[-110,-47] */
    if ( (AT_NETSCAN_POWER_MIN_VALUE > *psCellPower)
      || (AT_NETSCAN_POWER_MAX_VALUE < *psCellPower) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_GetValidNetScanBandPara
 ????????  : ????NETSCAN??????????????????,????????????16??????????
 ????????  : ??
 ????????  : pstPrefBandPara - ????????????
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??10??15??
    ??    ??   : w00242748
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_GetValidNetScanBandPara(
    TAF_USER_SET_PREF_BAND64           *pstPrefBandPara
)
{
    VOS_UINT8                          *pucPara             = VOS_NULL_PTR;
    VOS_UINT32                          ulRslt;
    VOS_UINT16                          usLen;

    pucPara         = gastAtParaList[3].aucPara;
    usLen           = gastAtParaList[3].usParaLen;

    pstPrefBandPara->ulBandHigh = 0;
    pstPrefBandPara->ulBandLow  = 0;

    /* ???????????????????????????????? */
    if (0 == usLen)
    {
        pstPrefBandPara->ulBandHigh = 0;
        pstPrefBandPara->ulBandLow  = AT_ALL_GU_BAND;

        return AT_OK;
    }

    /* ??????????32???? */
    if (usLen <= AT_HEX_LEN_OF_ULONG_TYPE)
    {
        ulRslt = At_String2Hex(pucPara, usLen, &(pstPrefBandPara->ulBandLow));
    }
    else
    {
        /* 64??????????32??????????????16???????????????????? */
        ulRslt = At_String2Hex(pucPara, (usLen - AT_HEX_LEN_OF_ULONG_TYPE),
                               &(pstPrefBandPara->ulBandHigh));
        if (AT_FAILURE == ulRslt)
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        /* 64??????????32??????????????16????????????????????  */
        ulRslt = At_String2Hex(pucPara + (usLen - AT_HEX_LEN_OF_ULONG_TYPE),
                               AT_HEX_LEN_OF_ULONG_TYPE, &(pstPrefBandPara->ulBandLow));
    }

    if (AT_FAILURE == ulRslt)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    return AT_OK;
}


/*****************************************************************************
 ?? ?? ??  : AT_GetValidNetScanPara
 ????????  : ????????????NETSCAN????????????????
 ????????  : ??
 ????????  : pstNetScanSetPara - ????????MMA????????????
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??10??15??
    ??    ??   : w00242748
    ????????   : ??????????
  2.??    ??   : 2015??4??10??
    ??    ??   : h00313353
    ????????   : SysCfg????
*****************************************************************************/
VOS_UINT32 AT_GetValidNetScanPara(
    TAF_MMA_NET_SCAN_REQ_STRU          *pstNetScanSetPara
)
{
    VOS_UINT32                          ulRst;

    /* ????????????,????????4????????AT_CME_INCORRECT_PARAMETERS*/
    if ( (AT_NETSCAN_PARA_MAX_NUM < gucAtParaIndex)
      || (AT_NETSCAN_PARA_MIN_NUM > gucAtParaIndex) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????CellNum */
    pstNetScanSetPara->usCellNum = (VOS_UINT16)gastAtParaList[0].ulParaValue;

    /* ????CellPow */
    if (AT_OK != AT_GetValidNetScanPowerParam(&(pstNetScanSetPara->sCellPow)))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<mode>??????????????<band>???????????????????? */
    if ( (0 == gastAtParaList[2].usParaLen)
      && (0 != gastAtParaList[3].usParaLen) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????????????????????????gastAtParaList[2].ulParaValue????0 */
    if ( 0 == gastAtParaList[2].usParaLen )
    {
        pstNetScanSetPara->enRat     = TAF_MMA_RAT_GSM;
    }
    else
    {
        pstNetScanSetPara->enRat     = (VOS_UINT8)gastAtParaList[2].ulParaValue;
    }


    /* ????band??????????,????????,??????????????,??????????????????????*/
    ulRst = AT_GetValidNetScanBandPara(&pstNetScanSetPara->stBand);

    if (AT_OK != ulRst)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    return ulRst;
}


/*****************************************************************************
 ?? ?? ??  : AT_SetNetScan
 ????????  : ????^NetScan??????
             ????????:^NETSCAN=<n>,<pow>[,<mode>[,<band>]]
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??10??15??
    ??    ??   : w00242748
    ????????   : ??????????
  2.??    ??   : 2015-03-25
    ??    ??   : K00902809
    ????????   : Added TAF_MMA_NetScanReq function to send request to MMA.

*****************************************************************************/
VOS_UINT32 AT_SetNetScan(
    VOS_UINT8                           ucIndex
)
{
    VOS_UINT32                          ulRst;
    /* Modified by k902809 for Iteration 11, 2015-3-25, begin */
    TAF_MMA_NET_SCAN_REQ_STRU           stNetScanSetPara;

    PS_MEM_SET(&stNetScanSetPara, 0, sizeof(stNetScanSetPara));

    ulRst = AT_GetValidNetScanPara(&stNetScanSetPara);
    if (AT_OK != ulRst)
    {
        TAF_LOG(WUEPS_PID_AT, VOS_NULL, PS_LOG_LEVEL_ERROR, "AT_SetNetScan:ERROR: AT_GetValidNetScanPara returns FAILURE");
        return ulRst;
    }

    ulRst = TAF_MMA_NetScanReq(WUEPS_PID_AT,
                               gastAtClientTab[ucIndex].usClientId,
                               0,
                               &stNetScanSetPara);
    if (VOS_TRUE == ulRst)
    {
        /* ???????????????????????????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_NETSCAN_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    /* Modified by k902809 for Iteration 11, Iteration 11 2015-3-25, end */
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_AbortNetScan
 ????????  : ????NetScan????
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??10??15??
    ??    ??   : w00242748
    ????????   : ??????????
  1.??    ??   : 2015??03??25??
    ??    ??   : K00902809
    ????????   : Added TAF_MMA_NetScanAbortReq to send message to MMA

*****************************************************************************/
VOS_UINT32 AT_AbortNetScan(
    VOS_UINT8                           ucIndex
)
{
    /* ????????????NETSCAN??????????, ???????????????????????? */
    if ( AT_CMD_NETSCAN_SET == gastAtClientTab[ucIndex].CmdCurrentOpt )
    {
        /* AT??MMA????????NETSCAN?????? */
        /* Modified by k902809 for Iteration 11, 2015-3-25, begin */
        if ( VOS_TRUE == TAF_MMA_NetScanAbortReq(WUEPS_PID_AT,
                                                 gastAtClientTab[ucIndex].usClientId,
                                                 0))
        {
            /* ????NETSCANAT???????????? */
            AT_StopRelTimer(ucIndex, &gastAtClientTab[ucIndex].hTimer);

            /* ???????????????? */
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_ABORT_NETSCAN;

            return AT_WAIT_ASYNC_RETURN;
        }
        /* Modified by k902809 for Iteration 11, Iteration 11 2015-3-25, end */

        /* AT??MMA????????NETSCAN???????????????????? */
        return AT_FAILURE;
    }

    /* ???????????????????????? */
    return AT_FAILURE;
}



/*****************************************************************************
 ?? ?? ??  : AT_ChangeSysCfgRatPrio
 ????????  : syscfg??????????????????????syscfg??Acqorder??????????????????
 ????????  : enAcqorder  - ??????????
 ????????  : pstRatOrder - ????TAF_MMA_RAT_ORDER_STRU????????
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??6??29??
    ??    ??   : z00161729
    ????????   : ??????????
  2.??    ??   : 2015??4??10??
    ??    ??   : h00313353
    ????????   : SysCfg????
*****************************************************************************/
VOS_VOID AT_ChangeSysCfgRatPrio(
    TAF_MMA_RAT_ORDER_STRU             *pstRatOrder,
    AT_SYSCFG_RAT_PRIO_ENUM_UINT8       enAcqorder

)
{
    if (TAF_PH_MAX_GU_RAT_NUM == pstRatOrder->ucRatOrderNum)
    {
        if (((AT_SYSCFG_RAT_PRIO_AUTO == enAcqorder)
         || (AT_SYSCFG_RAT_PRIO_WCDMA == enAcqorder)))
        {
            pstRatOrder->ucRatOrderNum  = TAF_PH_MAX_GU_RAT_NUM;
            pstRatOrder->aenRatOrder[0] = TAF_MMA_RAT_WCDMA;
            pstRatOrder->aenRatOrder[1] = TAF_MMA_RAT_GSM;
            pstRatOrder->aenRatOrder[2] = TAF_MMA_RAT_BUTT;
        }
        else if (AT_SYSCFG_RAT_PRIO_GSM == enAcqorder)
        {
            pstRatOrder->ucRatOrderNum  = TAF_PH_MAX_GU_RAT_NUM;
            pstRatOrder->aenRatOrder[0] = TAF_MMA_RAT_GSM;
            pstRatOrder->aenRatOrder[1] = TAF_MMA_RAT_WCDMA;
            pstRatOrder->aenRatOrder[2] = TAF_MMA_RAT_BUTT;
        }
        else
        {
        }

    }
    else
    {
        /* ???????????????????????? */
    }

}

/*****************************************************************************
 ?? ?? ??  : AT_ConverSysCfgRatOrderPara
 ????????  : ??mode??acqorder??????????TAF_MMA_RAT_ORDER_STRU????????
 ????????  : ucClientId - ??????
             enRatMode  - syscfg??????mode????
             enAcqorder - syscfg??????acqorder????
 ????????  : pstSysCfgRatOrder - mode??acqorder????????TAF_MMA_RAT_ORDER_STRU????????
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??6??29??
    ??    ??   : z00161729
    ????????   : ??????????

  2.??    ??   : 2012??4??20??
    ??    ??   : z40661
    ????????   : DTS2012033105463,????AUTO??,????????W??????

  3.??    ??   : 2012??12??24??
    ??    ??   : z00220246
    ????????   : DSDA Phase II

  4.??    ??   : 2015??4??10??
    ??    ??   : h00313353
    ????????   : SysCfg????
*****************************************************************************/
VOS_UINT32 AT_ConvertSysCfgRatOrderPara(
    VOS_UINT8                           ucClientId,
    AT_SYSCFG_RAT_TYPE_ENUM_UINT8       enRatMode,
    AT_SYSCFG_RAT_PRIO_ENUM_UINT8       enAcqorder,
    TAF_MMA_RAT_ORDER_STRU             *pstSysCfgRatOrder
)
{
    MODEM_ID_ENUM_UINT16                enModemId;
    VOS_UINT32                          ulRst;

    enModemId = MODEM_ID_0;
    /* ????ModemId */
    ulRst = AT_GetModemIdFromClient(ucClientId, &enModemId);
    if (VOS_OK != ulRst)
    {
        AT_ERR_LOG1("AT_ConvertSysCfgRatOrderPara:Get ModemID From ClientID fail,ClientID=%d", ucClientId);
        return AT_ERROR;
    }
    switch (enRatMode)
    {
        case AT_SYSCFG_RAT_AUTO:
            /* ????????????????????????????NVIM?????? */
            if ( AT_SYSCFG_RAT_PRIO_NO_CHANGE == enAcqorder )
            {
                /* Modified by l60609 for DSDA Phase III, 2013-3-4, Begin */
                AT_GetGuAccessPrioNvim(enModemId, &enAcqorder);
                /* Modified by l60609 for DSDA Phase III, 2013-3-4, End */
            }


            /* ucAcqorder??0????????WCDMA??GSM*/

            if (AT_SYSCFG_RAT_PRIO_AUTO == enAcqorder)
            {
                AT_SetDefaultRatPrioList(enModemId, pstSysCfgRatOrder, VOS_FALSE);
            }
            else if (AT_SYSCFG_RAT_PRIO_WCDMA == enAcqorder)
            {
                pstSysCfgRatOrder->ucRatOrderNum  = TAF_PH_MAX_GU_RAT_NUM;
                pstSysCfgRatOrder->aenRatOrder[0] = TAF_MMA_RAT_WCDMA;
                pstSysCfgRatOrder->aenRatOrder[1] = TAF_MMA_RAT_GSM;
                pstSysCfgRatOrder->aenRatOrder[2] = TAF_MMA_RAT_BUTT;
            }
            else if (AT_SYSCFG_RAT_PRIO_GSM == enAcqorder)
            {
                pstSysCfgRatOrder->ucRatOrderNum  = TAF_PH_MAX_GU_RAT_NUM;
                pstSysCfgRatOrder->aenRatOrder[0] = TAF_MMA_RAT_GSM;
                pstSysCfgRatOrder->aenRatOrder[1] = TAF_MMA_RAT_WCDMA;
                pstSysCfgRatOrder->aenRatOrder[2] = TAF_MMA_RAT_BUTT;
            }
            else
            {

            }

            break;

        case AT_SYSCFG_RAT_GSM:
            /* G???? */
            pstSysCfgRatOrder->ucRatOrderNum  = 1;
            pstSysCfgRatOrder->aenRatOrder[0] = TAF_MMA_RAT_GSM;
            pstSysCfgRatOrder->aenRatOrder[1] = TAF_MMA_RAT_BUTT;
            pstSysCfgRatOrder->aenRatOrder[2] = TAF_MMA_RAT_BUTT;
            break;

        case AT_SYSCFG_RAT_WCDMA:
            /* W????*/
            pstSysCfgRatOrder->ucRatOrderNum  = 1;
            pstSysCfgRatOrder->aenRatOrder[0] = TAF_MMA_RAT_WCDMA;
            pstSysCfgRatOrder->aenRatOrder[1] = TAF_MMA_RAT_BUTT;
            pstSysCfgRatOrder->aenRatOrder[2] = TAF_MMA_RAT_BUTT;
            break;


        case AT_SYSCFG_RAT_NO_CHANGE:
            AT_GetRatOrderNvim(enModemId, pstSysCfgRatOrder, VOS_FALSE);
            AT_GetOnlyGURatOrder(pstSysCfgRatOrder);
            AT_ChangeSysCfgRatPrio(pstSysCfgRatOrder, enAcqorder);
            break;

        default:
            return AT_CME_INCORRECT_PARAMETERS;

    }


    /*????????*/
    return AT_OK;
}


/*****************************************************************************
 ?? ?? ??  : At_SetSysCfgPara
 ????????  : ????syscfg??????????^SYSCFG=<mode>,<acqorder>,<band>,<roam>,<srvdomain>
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??4??21??
    ??    ??   : luojian id:107747
    ????????   : ??????????
  2.??    ??   : 2009-09-07
    ??    ??   : l00130025
    ????????   : ????????: AT2D14224/AT2D14259,AT^SYSCFG??????AT????????W900??W1700??????
  3.??    ??   : 2011??6??29??
    ??    ??   : z00161729
    ????????   : V7R1 phase II syscfgex??syscfg??????MMA????????
  4.??    ??   : 2012??3??27??
    ??    ??   : c00173809
    ????????   : DTS2012032207099,????????????????????

  5.??    ??   : 2012??4??20??
    ??    ??   : z40661
    ????????   : DTS2012033105463,????AUTO??,????????W??????

  6.??    ??   : 2012??12??24??
    ??    ??   : z00220246
    ????????   : DSDA Phase II:????????????????????????????
  7.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  8.??    ??   : 2014??1??27??
    ??    ??   : S00261364
    ????????   : L-C??????????
*****************************************************************************/
VOS_UINT32 At_SetSysCfgPara(VOS_UINT8 ucIndex)
{
    /* Modified by s00261364 for L-C??????????, 2014-1-27, begin */
    TAF_MMA_SYS_CFG_PARA_STRU           stSysCfgPara;
    /* Modified by s00261364 for L-C??????????, 2014-1-27, end */

    VOS_UINT32                          ulRst;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_NET_CTX_STRU              *pstNetCtx = VOS_NULL_PTR;

    pstNetCtx = AT_GetModemNetCtxAddrFromClientId(ucIndex);

    if ( 5 != gucAtParaIndex )
    {                                                                           /* ???????? */
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ((gastAtParaList[0].usParaLen == 0)
     || (gastAtParaList[1].usParaLen == 0)
     || (gastAtParaList[2].usParaLen == 0)
     || (gastAtParaList[3].usParaLen == 0)
     || (gastAtParaList[4].usParaLen == 0))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* Deleted by s00261364 for L-C??????????, 2014-1-27, begin */

    /* Deleted by s00261364 for L-C??????????, 2014-1-27, end */


    /* Modified by s00261364 for L-C??????????, 2014-1-27, begin */
    ulRst = AT_ConvertSysCfgRatOrderPara(ucIndex, (VOS_UINT8)gastAtParaList[0].ulParaValue,
                                         (VOS_UINT8)gastAtParaList[1].ulParaValue,
                                         &stSysCfgPara.stRatOrder);
    /* Modified by s00261364 for L-C??????????, 2014-1-27, end */
    if (AT_OK != ulRst)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* Deleted by s00261364 for L-C??????????, 2014-1-27, begin */

    /* Deleted by s00261364 for L-C??????????, 2014-1-27, end */

    /* Modified by s00261364 for L-C??????????, 2014-1-27, begin */
    ulRst = AT_ConvertSysCfgExBandPara(gastAtParaList[2].aucPara,
                                       gastAtParaList[2].usParaLen,
                                       &stSysCfgPara.stGuBand);
    /* Modified by s00261364 for L-C??????????, 2014-1-27, end */
    if (AT_OK != ulRst)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????L?????????????????? */
    stSysCfgPara.enUserPrio         = (VOS_UINT8)gastAtParaList[1].ulParaValue;
    stSysCfgPara.stLBand.ulBandLow  = TAF_PH_BAND_NO_CHANGE;
    stSysCfgPara.stLBand.ulBandHigh = 0;
    AT_ReadRoamCfgInfoNvim(ucIndex);

    if (((AT_ROAM_FEATURE_OFF == pstNetCtx->ucRoamFeature) && (gastAtParaList[3].ulParaValue > 2))
     || ((AT_ROAM_FEATURE_ON == pstNetCtx->ucRoamFeature) && (gastAtParaList[3].ulParaValue > 3)))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */
    /* Modified by s00261364 for L-C??????????, 2014-1-27, begin */
    stSysCfgPara.enRoam       = (VOS_UINT8) gastAtParaList[3].ulParaValue;
    stSysCfgPara.enSrvDomain  = (VOS_UINT8) gastAtParaList[4].ulParaValue;
    /* Modified by s00261364 for L-C??????????, 2014-1-27, end */



    /* Modified by s00261364 for L-C??????????, 2014-1-27, begin */

    /* ???????????? */
    if (VOS_TRUE == TAF_MMA_SetSysCfgReq(WUEPS_PID_AT,gastAtClientTab[ucIndex].usClientId, 0, &stSysCfgPara))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SYSCFG_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
    /* Modified by s00261364 for L-C??????????, 2014-1-27, end */
}


/*****************************************************************************
 Prototype      : At_CheckDataState
 Description    :
 Input          :
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ?? : 2007-03-27
    ??    ?? : h59254
    ???????? : ????????:A32D09820(PC-Lint????)
*****************************************************************************/
TAF_UINT32 At_CheckDataState(TAF_UINT8 ucDataMode)
{
    TAF_UINT8 ucIndex = 0;

    for(ucIndex = 0; ucIndex < AT_MAX_CLIENT_NUM; ucIndex++)
    {
        if( (AT_CLIENT_USED == gastAtClientTab[ucIndex].ucUsed)
         && (AT_DATA_MODE == gastAtClientTab[ucIndex].Mode)
         && (ucDataMode == gastAtClientTab[ucIndex].DataMode))
        {
            return AT_SUCCESS;
        }
    }

    return AT_FAILURE;
}


/*****************************************************************************
 Prototype      : At_SetCcinPara
 Description    :
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetCcinPara(TAF_UINT8 ucIndex)
{
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???? ??????????????????????????????
       ????OK????????????????????????????????
       ???? ??????????????????????????????
       ????OK????????????????????????????????*/

    gastAtClientTab[ucIndex].IndMode = (TAF_UINT8)gastAtParaList[0].ulParaValue;
    return AT_OK;
}
/*****************************************************************************
 Prototype      : At_SetTrigPara
 Description    :
 Input          : ---
 Output         : ---
 Return Value   : AT_SUCCESS --- ????
                  AT_FAILURE --- ????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2007-06-20
    Author      : ---
    Modification: Created function

  2.??    ??   : 2011??10??23??
    ??    ??   : A00165503
    ????????   : AT Project: ??????????????GPRS????
  3.??    ??   : 2012??8??10??
    ??    ??   : L00171473
    ????????   : DTS2012082204471, TQE????
*****************************************************************************/
TAF_UINT32 At_SetTrigPara (TAF_UINT8 ucIndex)
{
    TAF_UINT8                           i;
    TAF_GPRS_DATA_STRU                  stGprsDataInfo;


    PS_MEM_SET(&stGprsDataInfo, 0x00, sizeof(stGprsDataInfo));


    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(5 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }
    for(i=0;i<5;i++)
    {
        if (0==gastAtParaList[i].usParaLen)
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
    }
    stGprsDataInfo.ucMode = (TAF_UINT8)gastAtParaList[0].ulParaValue;
    if ((stGprsDataInfo.ucMode!=0) && (stGprsDataInfo.ucMode!=1))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }
    if((5 <= gastAtParaList[1].ulParaValue) && (gastAtParaList[1].ulParaValue <= 15))
    {
        stGprsDataInfo.ucNsapi = (TAF_UINT8)gastAtParaList[1].ulParaValue;
    }
    else
    {
        return AT_ERROR;
    }

    stGprsDataInfo.ulLength      = (TAF_UINT32)gastAtParaList[2].ulParaValue;
    stGprsDataInfo.ucTimes       = (TAF_UINT8)gastAtParaList[3].ulParaValue;
    stGprsDataInfo.ulMillisecond = (TAF_UINT32)gastAtParaList[4].ulParaValue;

    /* ???????????? */
    /* Modified by A00165503 for AT Project??2011-10-17, Begin */
    if ( TAF_PS_TrigGprsData(WUEPS_PID_AT,
                             AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                             gastAtClientTab[ucIndex].opId,
                             &stGprsDataInfo) )
    {
        return AT_ERROR;
    }
    /* Modified by A00165503for AT Project??2011-10-17, end */

    return AT_OK;
}

/*****************************************************************************
 Prototype      : At_SetGcfIndPara
 Description    : ????GCF??????
 Input          : ---
 Output         : ---
 Return Value   : AT_SUCCESS --- ????
                  AT_FAILURE --- ????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2009-05-26
    Author      : s62952
    Modification: Created function

  2.??    ??   : 2011??10??4??
    ??    ??   : o00132663
    ????????   : AT??????????g_ucGcfInd????????????????????????
*****************************************************************************/
TAF_UINT32 At_SetGcfIndPara (TAF_UINT8 ucIndex)
{
    VOS_UINT8                           ucGctTestFlag;
    VOS_UINT32                          ulRst;

    ucGctTestFlag = 0;

    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(1 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ucGctTestFlag = (VOS_UINT8)gastAtParaList[0].ulParaValue;
    if ((ucGctTestFlag != 0) && (ucGctTestFlag != 1))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   DRV_AGENT_GCF_IND,
                                   &ucGctTestFlag,
                                   sizeof(VOS_UINT8),
                                   I0_WUEPS_PID_DRV_AGENT);

    if (TAF_SUCCESS == ulRst)
    {
        return AT_OK;
    }
    else
    {
        return AT_ERROR;
    }

}

/*****************************************************************************
 ?? ?? ??  : At_SetGcapPara
 ????????  : ????MS????????????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??03??03??
    ??    ??   : x00115505
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 At_SetGcapPara(TAF_UINT8 ucIndex)
{
    TAF_UINT16           usLength = 0;

    /* ???????? */
    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(0 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    usLength += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,(TAF_CHAR *)pgucAtSndCodeAddr,(TAF_CHAR *)pgucAtSndCodeAddr + usLength,"%s: %s",g_stParseContext[ucIndex].pstCmdElement->pszCmdName,"+CGSM,+DS,+ES");

    gstAtSendData.usBufLen = usLength;

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetMsIdInfo
 ????????  : ????MS????????????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??03??03??
    ??    ??   : x00115505
    ????????   : ??????????

  2.??    ??   : 2011??10??3??
    ??    ??   : o00132663
    ????????   : AT??????????API????????????????
*****************************************************************************/
VOS_UINT32 At_SetMsIdInfo(TAF_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;

    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   DRV_AGENT_MSID_QRY_REQ,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_WUEPS_PID_DRV_AGENT);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_MSID_READ;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }

}

/*****************************************************************************
 ?? ?? ??  : AT_SetDsFlowClrPara
 ????????  : ????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??03??27??
    ??    ??   : x00115505
    ????????   : ??????????

  2.??    ??   : 2011??10??23??
    ??    ??   : A00165503
    ????????   : AT????????????????????????????DS FLOW
  3.??    ??   : 2012??3??19??
    ??    ??   : c00173809
    ????????   : DTS2012031400579:^DSFLOWCLR????????????????
*****************************************************************************/
TAF_UINT32 AT_SetDsFlowClrPara(TAF_UINT8 ucIndex)
{
    TAF_DSFLOW_CLEAR_CONFIG_STRU        stClearConfigInfo;

    /* ???????? */
    if ( AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????? */
    PS_MEM_SET(&stClearConfigInfo, 0x00, sizeof(TAF_DSFLOW_CLEAR_CONFIG_STRU));

    /* ???????? */
    stClearConfigInfo.enClearMode       = TAF_DSFLOW_CLEAR_TOTAL;

    /* ???????????? */
    if ( VOS_OK != TAF_PS_ClearDsFlowInfo(WUEPS_PID_AT,
                                          AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                          0, &stClearConfigInfo))
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt  = AT_CMD_DSFLOWCLR_SET;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetDsFlowQryPara
 ????????  : ????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??03??27??
    ??    ??   : x00115505
    ????????   : ??????????

  2.??    ??   : 2011??01??24??
    ??    ??   : lijun 00171473
    ????????   : DTS2011012405909,??????????????????

  3.??    ??   : 2011??10??23??
    ??    ??   : A00165503
    ????????   : AT????????????????????????????DS FLOW

*****************************************************************************/
TAF_UINT32 AT_SetDsFlowQryPara(TAF_UINT8 ucIndex)
{
    /* ???????? */
    if ( AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if ( VOS_OK != TAF_PS_GetDsFlowInfo(WUEPS_PID_AT,
                                        AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                        0))
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt  = AT_CMD_DSFLOWQRY_SET;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetDsFlowRptPara
 ????????  : ????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??03??27??
    ??    ??   : x00115505
    ????????   : ??????????
  2.??    ??   : 2010-12-22
    ??    ??   : A00165503
    ????????   : ????????: DTS2010122204474,????MP2.0??????????????

  3.??    ??   : 2011??10??23??
    ??    ??   : A00165503
    ????????   : AT????????????????????????????DS FLOW????

  4.??    ??   : 2011??12??20??
    ??    ??   : o00132663
    ????????   : PS????????????????????APS??????AT????????
*****************************************************************************/
TAF_UINT32 AT_SetDsFlowRptPara(TAF_UINT8 ucIndex)
{
    TAF_DSFLOW_REPORT_CONFIG_STRU       stReportConfigInfo;

    /* ?????? */
    PS_MEM_SET(&stReportConfigInfo, 0x00, sizeof(TAF_DSFLOW_REPORT_CONFIG_STRU));

    /* ???????? */
    if ( AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( gucAtParaIndex > 1 )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( 0 == gastAtParaList[0].usParaLen )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    stReportConfigInfo.ulRptEnabled         = gastAtParaList[0].ulParaValue;


    if ( VOS_TRUE == stReportConfigInfo.ulRptEnabled )
    {
        /* ???????????????????? */
        stReportConfigInfo.ulTimerLength    = 2000;
    }


    /* ???????????? */
    if ( VOS_OK != TAF_PS_ConfigDsFlowRpt(WUEPS_PID_AT,
                                          AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                          0, &stReportConfigInfo))
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt  = AT_CMD_DSFLOWRPT_SET;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : At_SetSrvstPara
 ????????  : ????????????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??03??27??
    ??    ??   : x00115505
    ????????   : ??????????
  2.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  3.??    ??   : 2013??4??1??
    ??    ??   : s00217060
    ????????   : ????????AT??????????????C??
*****************************************************************************/
TAF_UINT32 At_SetSrvstPara(TAF_UINT8 ucIndex)
{
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, begin */
    AT_MTA_UNSOLICITED_RPT_SET_REQ_STRU     stAtCmd;
    VOS_UINT32                              ulResult;

    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_SET(&stAtCmd, 0x00, sizeof(stAtCmd));
    stAtCmd.enReqType       = AT_MTA_SET_SRVST_RPT_TYPE;
    stAtCmd.u.ucSrvstRptFlg = 0;

    if (0 != gastAtParaList[0].usParaLen)
    {
        stAtCmd.u.ucSrvstRptFlg = (VOS_UINT8)gastAtParaList[0].ulParaValue;
    }

    /* ??MTA????^srvst???????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_UNSOLICITED_RPT_SET_REQ,
                                   &stAtCmd,
                                   sizeof(AT_MTA_UNSOLICITED_RPT_SET_REQ_STRU),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS != ulResult)
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_UNSOLICITED_RPT_SET;

    return AT_WAIT_ASYNC_RETURN;
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, end */
}

/*****************************************************************************
 ?? ?? ??  : At_SetRssiPara
 ????????  : RSSI????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2009??06??18??
    ??    ??   : o00132663
    ????????   : ??????????
  2.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  3.??    ??   : 2013??4??1??
    ??    ??   : s00217060
    ????????   : ????????AT??????????????C??
  4.??    ??   : 2014??12??15??
    ??    ??   : s00217060
    ????????   : Service_State_Optimize_PhaseI ????
*****************************************************************************/
TAF_UINT32 At_SetRssiPara(TAF_UINT8 ucIndex)
{
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, begin */
    AT_MTA_UNSOLICITED_RPT_SET_REQ_STRU     stAtCmd;
    VOS_UINT32                              ulResult;
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_SET(&stAtCmd, 0x00, sizeof(stAtCmd));
    stAtCmd.enReqType       = AT_MTA_SET_RSSI_RPT_TYPE;
    stAtCmd.u.ucRssiRptFlg  = AT_RSSI_RESULT_CODE_NOT_REPORT_TYPE;

    if (0 != gastAtParaList[0].usParaLen)
    {
        stAtCmd.u.ucRssiRptFlg  = (VOS_UINT8)gastAtParaList[0].ulParaValue;
    }

    /* ??MTA????^rssi???????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_UNSOLICITED_RPT_SET_REQ,
                                   &stAtCmd,
                                   sizeof(AT_MTA_UNSOLICITED_RPT_SET_REQ_STRU),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS != ulResult)
    {
        return AT_ERROR;
    }

    /* AT??????????L4A????MMC????LMM,????LMM????LRRC */

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_UNSOLICITED_RPT_SET;

    return AT_WAIT_ASYNC_RETURN;
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, end */

}


/*****************************************************************************
 ?? ?? ??  : At_SetCerssiPara
 ????????  : CERSSI????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??11??21??
    ??    ??   : z00161729
    ????????   : ??????????
  2.??    ??   : 2012??12??13??
    ??    ??   : L00171473
    ????????   : DTS2012121802573, TQE????
  3.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  4.??    ??   : 2013??1??9??
    ??    ??   : t00212959
    ????????   : DTS2013010809978, ????????????????
  5.??    ??   : 2013??2??28??
    ??    ??   : z00161729
    ????????   : DTS2013022509054, cerssi????????????????????????????????????????????
  6.??    ??   : 2013??4??1??
    ??    ??   : s00217060
    ????????   : ????????AT??????????????C??

  7.??    ??   : 2014??12??15??
    ??    ??   : s00217060
    ????????   : Service_State_Optimize_PhaseI ????

  8.??    ??   : 2015??3??23??
    ??    ??   : g00261581
    ????????   : ????AT->MMA??????????
*****************************************************************************/
VOS_UINT32 At_SetCerssiPara(VOS_UINT8 ucIndex)
{
    TAF_START_INFO_IND_STRU             stStartInfoInd;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_NET_CTX_STRU              *pstNetCtx = VOS_NULL_PTR;

    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, begin */
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, end */

    pstNetCtx = AT_GetModemNetCtxAddrFromClientId(ucIndex);


    PS_MEM_SET(&stStartInfoInd, 0x00, sizeof(stStartInfoInd));

    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ((gucAtParaIndex > 2)
     || (0 == gastAtParaList[0].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }




    if (1 == gucAtParaIndex)
    {
        pstNetCtx->ucCerssiReportType        = 0;
        pstNetCtx->ucCerssiMinTimerInterval  = 0;
        stStartInfoInd.ucMinRptTimerInterval = 0;
    }

    if (2 == gucAtParaIndex)
    {
        pstNetCtx->ucCerssiMinTimerInterval  = (VOS_UINT8)gastAtParaList[1].ulParaValue;
        stStartInfoInd.ucMinRptTimerInterval = (VOS_UINT8)gastAtParaList[1].ulParaValue;
    }

    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, end */
    if (0 != gastAtParaList[0].ulParaValue)
    {
        pstNetCtx->ucCerssiReportType  = (VOS_UINT8)gastAtParaList[0].ulParaValue;
        stStartInfoInd.ucActionType    = TAF_START_EVENT_INFO_FOREVER;
        stStartInfoInd.ucSignThreshold = (VOS_UINT8)gastAtParaList[0].ulParaValue;
        stStartInfoInd.ucRrcMsgType    = TAF_EVENT_INFO_CELL_SIGN;
    }
    else
    {
        /* ????+creg/+cgreg/+csq/^rssi????????RRMM_AT_MSG_REQ??GRRMM_AT_MSG_REQ????????????????????
           ??????????????????????????????????rssi 5db??????????AT_GetModemNetCtxAddrFromClientId(ucIndex)->ucCerssiReportType????????????^cerssi???????? */
        stStartInfoInd.ucActionType     = TAF_START_EVENT_INFO_FOREVER;
        stStartInfoInd.ucRrcMsgType     = TAF_EVENT_INFO_CELL_SIGN;
        stStartInfoInd.ucSignThreshold  = 0;
        pstNetCtx->ucCerssiReportType   = AT_CERSSI_REPORT_TYPE_NOT_REPORT;
        pstNetCtx->ucCerssiMinTimerInterval  = 0;
        stStartInfoInd.ucMinRptTimerInterval = 0;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

    if (VOS_TRUE == TAF_MMA_SetCerssiReq(WUEPS_PID_AT, gastAtClientTab[ucIndex].usClientId, 0, &stStartInfoInd))
    {
        /* Set at cmd type */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CERSSI_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }

    /* AT??????????L4A????MMC????LMM,????LMM????LRRC */

    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */
}


/*****************************************************************************
 ?? ?? ??  : At_SetCnmrPara
 ????????  : ^CNMR????2g??3g??4g??NMR??????
             at^cnmr=1????2g????NMR??????at^cnmr=2????3g????NMR?????aat^cnmr=3????4g????NMR????
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : ????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??11??21??
    ??    ??   : z00161729
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 At_SetCnmrPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;
    AT_MTA_QRY_NMR_REQ_STRU             stQryNmrReq;

    if (gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /*????????????*/
    if (1 != gastAtParaList[0].usParaLen)
    {
        return  AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????4g??nmr????????????L?????? */
    if (AT_CNMR_QRY_LTE_NMR_DATA == gastAtParaList[0].ulParaValue)
    {
        return At_QryCnmrPara(ucIndex);
    }

    /* ????????DRV_AGENT_AS_QRY_NMR_REQ??C?????? */
    PS_MEM_SET(&stQryNmrReq, 0x0, sizeof(stQryNmrReq));

    if (AT_CNMR_QRY_WAS_NMR_DATA == gastAtParaList[0].ulParaValue)
    {
        stQryNmrReq.ucRatType = 0;
    }
    else
    {
        stQryNmrReq.ucRatType = 1;
    }

    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   gastAtClientTab[ucIndex].opId,
                                   ID_AT_MTA_QRY_NMR_REQ,
                                   &stQryNmrReq,
                                   sizeof(stQryNmrReq),
                                   I0_UEPS_PID_MTA);

    if (AT_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CNMR_QUERY;
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;

}




/*****************************************************************************
 ?? ?? ??  : At_SetTimePara
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??3??23??
    ??    ??   : o00132663
    ????????   : ??????????
  2.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  3.??    ??   : 2013??4??1??
    ??    ??   : s00217060
    ????????   : ????????AT??????????????C??
*****************************************************************************/
TAF_UINT32  At_SetTimePara(TAF_UINT8 ucIndex)
{
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, begin */
    AT_MTA_UNSOLICITED_RPT_SET_REQ_STRU     stAtCmd;
    VOS_UINT32                              ulResult;

    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (gucAtParaIndex > 1)
    {
        return AT_TOO_MANY_PARA;
    }

    if ((0 == gastAtParaList[0].usParaLen) || (2 < gastAtParaList[0].ulParaValue))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_SET(&stAtCmd, 0x00, sizeof(stAtCmd));
    stAtCmd.enReqType       = AT_MTA_SET_TIME_RPT_TYPE;
    stAtCmd.u.ucTimeRptFlg  = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ??MTA????^time???????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_UNSOLICITED_RPT_SET_REQ,
                                   &stAtCmd,
                                   sizeof(AT_MTA_UNSOLICITED_RPT_SET_REQ_STRU),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS != ulResult)
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_UNSOLICITED_RPT_SET;

    return AT_WAIT_ASYNC_RETURN;

    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, end */
}

/*****************************************************************************
 ?? ?? ??  : At_SetTimePara
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??3??23??
    ??    ??   : o00132663
    ????????   : ??????????
  2.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  3.??    ??   : 2013??4??1??
    ??    ??   : s00217060
    ????????   : ????????AT??????????????C??
  4.??    ??   : 2015??11??20??
    ??    ??   : h00360002
    ????????   : ????+ctze????????,??????(0-1)????(0-2)
*****************************************************************************/
TAF_UINT32  At_SetCtzrPara(TAF_UINT8 ucIndex)
{
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, begin */
    AT_MTA_UNSOLICITED_RPT_SET_REQ_STRU     stAtCmd;
    VOS_UINT32                              ulResult;

    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (gucAtParaIndex > 1)
    {
        return AT_TOO_MANY_PARA;
    }

    /* ???????????? */
    if ((0 == gastAtParaList[0].usParaLen) || (2 < gastAtParaList[0].ulParaValue))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_SET(&stAtCmd, 0x00, sizeof(stAtCmd));
    stAtCmd.enReqType       = AT_MTA_SET_CTZR_RPT_TYPE;
    stAtCmd.u.ucCtzrRptFlg  = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ??MTA????^ctzr???????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_UNSOLICITED_RPT_SET_REQ,
                                   &stAtCmd,
                                   sizeof(AT_MTA_UNSOLICITED_RPT_SET_REQ_STRU),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS != ulResult)
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_UNSOLICITED_RPT_SET;

    return AT_WAIT_ASYNC_RETURN;

    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, end */
}

/*****************************************************************************
 ?? ?? ??  : At_SetModePara
 ????????  : ????????????????????????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??03??27??
    ??    ??   : x00115505
    ????????   : ??????????
  2.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  3.??    ??   : 2013??4??1??
    ??    ??   : s00217060
    ????????   : ????????AT??????????????C??
  4.??    ??   : 2015??4??10??
    ??    ??   : h00313353
    ????????   : SysCfg????
*****************************************************************************/
TAF_UINT32 At_SetModePara(TAF_UINT8 ucIndex)
{
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, begin */
    AT_MTA_UNSOLICITED_RPT_SET_REQ_STRU     stAtCmd;
    VOS_UINT32                              ulResult;
    L4A_IND_CFG_STRU                        stL4AIndCfgReq;
    MODEM_ID_ENUM_UINT16                    enModemId;

    enModemId  = MODEM_ID_0;

    /* AT?????????????????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_SET(&stAtCmd, 0x00, sizeof(stAtCmd));
    stAtCmd.enReqType       = AT_MTA_SET_MODE_RPT_TYPE;
    stAtCmd.u.ucModeRptFlg  = AT_MODE_RESULT_CODE_NOT_REPORT_TYPE;

    if (0 != gastAtParaList[0].usParaLen)
    {
        stAtCmd.u.ucModeRptFlg  = (VOS_UINT8)gastAtParaList[0].ulParaValue;
    }

    /* ??MTA????^mode???????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_UNSOLICITED_RPT_SET_REQ,
                                   &stAtCmd,
                                   sizeof(AT_MTA_UNSOLICITED_RPT_SET_REQ_STRU),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS != ulResult)
    {
        return AT_ERROR;
    }

    ulResult = AT_GetModemIdFromClient(ucIndex, &enModemId);

    if (VOS_OK != ulResult)
    {
        AT_ERR_LOG1("At_SetModePara:Get ModemID From ClientID fail,ClientID=%d", ucIndex);
        return AT_ERROR;
    }

    if (VOS_TRUE == AT_IsModemSupportRat(enModemId, TAF_MMA_RAT_LTE))
    {
        PS_MEM_SET(&stL4AIndCfgReq, 0, sizeof(stL4AIndCfgReq));
        stL4AIndCfgReq.mode_bit_valid  = 1;
        stL4AIndCfgReq.mode_bit        = gastAtParaList[0].ulParaValue;

        /* ????L????mode?????? */
        AT_SetLIndCfgReq(ucIndex, &stL4AIndCfgReq);
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_UNSOLICITED_RPT_SET;

    return AT_WAIT_ASYNC_RETURN;
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, end */

}
/*****************************************************************************
 ?? ?? ??  : At_SetSimstPara
 ????????  : SIM????????????????????????????SIM????LOCK????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??10??14??
    ??    ??   : x00115505
    ????????   : ??????????
  2.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  3.??    ??   : 2013??4??1??
    ??    ??   : s00217060
    ????????   : ????????AT??????????????C??
*****************************************************************************/
VOS_UINT32 At_SetSimstPara(TAF_UINT8 ucIndex)
{
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, begin */
    AT_MTA_UNSOLICITED_RPT_SET_REQ_STRU     stAtCmd;
    VOS_UINT32                              ulResult;

    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_SET(&stAtCmd, 0x00, sizeof(stAtCmd));
    stAtCmd.enReqType       = AT_MTA_SET_SIMST_RPT_TYPE;
    stAtCmd.u.ucSimstRptFlg = AT_SIMST_ENABLE_TYPE;

    if (0 != gastAtParaList[0].usParaLen)
    {
        stAtCmd.u.ucSimstRptFlg = (VOS_UINT8)gastAtParaList[0].ulParaValue;
    }

    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_UNSOLICITED_RPT_SET_REQ,
                                   &stAtCmd,
                                   sizeof(AT_MTA_UNSOLICITED_RPT_SET_REQ_STRU),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS != ulResult)
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_UNSOLICITED_RPT_SET;

    return AT_WAIT_ASYNC_RETURN;
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-1, end */
}
/*****************************************************************************
 ?? ?? ??  : At_SetHsPara
 ????????  : ????????????????????????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??06??13??
    ??    ??   : s46746
    ????????   : ??????????
  2.??    ??   : 2015??03??28??
    ??    ??   : m00270891
    ????????   : Add send HS query request to MMA
*****************************************************************************/
TAF_UINT32 At_SetHSPara(TAF_UINT8 ucIndex)
{
    TAF_UINT8 aucBuf[5];

    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (gucAtParaIndex > 2)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(0 != gastAtParaList[0].usParaLen)
    {
        PS_MEM_CPY(aucBuf, &gastAtParaList[0].ulParaValue, sizeof(TAF_UINT32));
    }
    else
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(0 != gastAtParaList[1].usParaLen)
    {
        aucBuf[4] = (TAF_UINT8)gastAtParaList[1].ulParaValue;
    }
    else
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????????????????????????????MMA */
    if(VOS_TRUE == TAF_MMA_QryHandShakeReq(WUEPS_PID_AT,
                                           gastAtClientTab[ucIndex].usClientId,
                                           0))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_HS_READ;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_UpdateSvn
 ????????  : ????SVN??????NV??en_Nv_Item_Imei_Svn??SVN????????????????2????
             NV??????????????????????????????????????????????????NV??????4??????
 ????????  : MODEM_ID_ENUM_UINT16                enModemId
             VOS_UINT8                           aucSvn[]    SVN????????????????????????????SVN????????
             VOS_UINT16                          usSvnLength SVN??????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32 ????????????
             AT_OK                ????????????
             AT_PHYNUM_LENGTH_ERR ??????????????
             AT_PHYNUM_NUMBER_ERR ??????????
             AT_ERROR             NV????????

 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??2??
    ??    ??   : ??????/f62575
    ????????   : ??????????
  2.??    ??   : 2012??8??10??
    ??    ??   : L00171473
    ????????   : DTS2012082204471, TQE????
  3.??    ??   : 2013??3??4??
    ??    ??   : L60609
    ????????   : DSDA PHASE III
*****************************************************************************/
VOS_UINT32 AT_UpdateSvn(
    MODEM_ID_ENUM_UINT16                enModemId,
    VOS_UINT8                           aucSvn[],
    VOS_UINT16                          usSvnLength
)
{
    TAF_SVN_DATA_STRU                   stSvn;


    PS_MEM_SET(&stSvn, 0x00, sizeof(stSvn));


    /* SVN ????????: ??????????SVN????????????2?? */
    if (TAF_SVN_DATA_LENGTH != usSvnLength)
    {
        AT_NORM_LOG("AT_UpdateSvn: the length of SVN is error.");
        return AT_PHYNUM_LENGTH_ERR;
    }

    /* SVN ??????????1: ????<SVN>????????????, ????ASCII????????BCD?? */
    if (AT_SUCCESS != At_AsciiNum2Num(stSvn.aucSvn, aucSvn, usSvnLength))
    {
        AT_NORM_LOG("AT_UpdateSvn: the number of SVN is error.");
        return AT_PHYNUM_NUMBER_ERR;
    }

    /* SVN ??????????2: 99??SVN????????????????AT_PHYNUM_NUMBER_ERR??????????
       ????????: 3GPP 23003 6.3 Allocation principles SVN value 99 is reserved for future use. */
    if ((9 == stSvn.aucSvn[0]) && (9 == stSvn.aucSvn[1]))
    {
        AT_NORM_LOG("AT_UpdateSvn: the number of SVN is reserved.");
        return AT_PHYNUM_NUMBER_ERR;
    }

    /* ????SVN??NV?????????????????????????????????????? */
    stSvn.ucActiveFlag = NV_ITEM_ACTIVE;

    /* ?????????????????? */
    stSvn.aucReserve[0] = 0;

    /* Modified by l60609 for DSDA Phase III, 2013-3-4, Begin */
    if (NV_OK !=  NV_WriteEx(enModemId, en_NV_Item_Imei_Svn, &stSvn, sizeof(stSvn)))
    {
         AT_WARN_LOG("AT_UpdateSvn: Fail to write NV.");
         return AT_ERROR;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, End */

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_CheckPhyNumPara
 ????????  : ????????????????????????????????????????????
 ????????  : ??
 ????????  : AT_PHYNUM_TYPE_ENUM_UINT32 *penSetType ????????????????
 ?? ?? ??  : VOS_UINT32 ????????????????????????
             AT_OK              ??????????????
             AT_PHYNUM_TYPE_ERR ????????????????
             AT_ERROR??         TIMES????????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??11??
    ??    ??   : ??????/f62575
    ????????   : ??????????

  2.??    ??   : 2012??1??3??
    ??    ??   : f62575
    ????????   : ??????????????????MAC??????????
*****************************************************************************/
VOS_UINT32 AT_CheckPhyNumPara(AT_PHYNUM_TYPE_ENUM_UINT32 *penSetType)
{
    VOS_UINT32                          ulTimes;
    VOS_UINT32                          ulRet;

    /* <type>????????: BALONG??????????????????IMEI??SVN??
       ????????????????????< err_code > ????????1???????????? */
    /* ???????????????????? */
    /* Added by f62575 for SMALL IMAGE, 2012-1-3, begin   */
    if(AT_FAILURE == At_UpString(gastAtParaList[0].aucPara, gastAtParaList[0].usParaLen))
    {
        return AT_ERROR;
    }
    /* Added by f62575 for SMALL IMAGE, 2012-1-3, end   */

    if (0 == VOS_StrCmp((VOS_CHAR *)gastAtParaList[0].aucPara, "IMEI"))
    {
        *penSetType = AT_PHYNUM_TYPE_IMEI;
    }
    else if (0 == VOS_StrCmp((VOS_CHAR *)gastAtParaList[0].aucPara, "SVN"))
    {
        *penSetType = AT_PHYNUM_TYPE_SVN;
    }
    /* Added by f62575 for SMALL IMAGE, 2012-1-3, begin */
    else if (0 == VOS_StrCmp((VOS_CHAR *)gastAtParaList[0].aucPara, "MACWLAN"))
    {
        *penSetType = AT_PHYNUM_TYPE_MAC;
    }
    /* Added by f62575 for SMALL IMAGE, 2012-1-3, end   */
    else
    {
        AT_NORM_LOG("AT_CheckPhyNumPara: the type of physical is error.");
        return AT_PHYNUM_TYPE_ERR;
    }

    /* < times >????????: ????< times >??????0-1??????????AT_ERROR */
    if (gastAtParaList[2].usParaLen != 0)
    {
        /* TIMES????????????0??1 */
        ulRet = At_Auc2ul(gastAtParaList[2].aucPara,
                          gastAtParaList[2].usParaLen,
                          &ulTimes);
        if ((AT_SUCCESS != ulRet) || (ulTimes > 1))
        {
            AT_NORM_LOG("AT_CheckPhyNumPara: times error.");
            return AT_ERROR;
        }
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetPhyNumPara
 ????????  : ??????????????????
             AT^PHYNUM =<type>,<number>[,< times >
 ????????  : VOS_UINT8 ucIndex ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32 ATC??????
             AT_OK                  ????????????
             AT_PHYNUM_LENGTH_ERR   ??????????????
             AT_PHYNUM_NUMBER_ERR   ????????????
                                    ??????????????????????????????????????????????
             AT_PHYNUM_TYPE_ERR     ??????????????
             AT_ERROR               MT??????????TIMES??????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??2??
    ??    ??   : ??????/f62575
    ????????   : ??????????

  2.??    ??   : 2012??1??3??
    ??    ??   : f62575
    ????????   : SMALL IMAGE????????: ????MAC????????
  3.??    ??   : 2013??3??4??
    ??    ??   : L60609
    ????????   : DSDA PHASE II
*****************************************************************************/
VOS_UINT32  AT_SetPhyNumPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRet;
    AT_PHYNUM_TYPE_ENUM_UINT32          enSetType;
    VOS_BOOL                            bPhyNumIsNull;
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, Begin */
    MODEM_ID_ENUM_UINT16                enModemId;

    enModemId = MODEM_ID_0;
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, End */

    /* ??????????????????: ????????????<type>,<number>????????
       ??????????????< times > ????????????????????AT_ERROR */
    if ((2 != gucAtParaIndex) && (3 != gucAtParaIndex))
    {
        AT_NORM_LOG("AT_SetPhyNumPara: the number of parameter is error.");
        return AT_ERROR;
    }

    /* Modified by l60609 for DSDA Phase III, 2013-3-4, Begin */
    ulRet = AT_GetModemIdFromClient(ucIndex, &enModemId);

    if (VOS_OK != ulRet)
    {
        AT_ERR_LOG("AT_SetPhyNumPara: Get modem id fail.");
        return AT_ERROR;
    }

    ulRet = AT_CheckPhyNumPara(&enSetType);
    if (AT_OK != ulRet)
    {
        return ulRet;
    }

    /* ??????????????????????????????????????????????< err_code > ????????1?????????????? */
    if (AT_OK != AT_PhyNumIsNull(enModemId, enSetType, &bPhyNumIsNull))
    {
        return AT_ERROR;
    }

    if ((VOS_FALSE == bPhyNumIsNull) && (VOS_TRUE == g_bAtDataLocked))
    {
        AT_NORM_LOG("AT_SetPhyNumPara: physical number is not null and data locked.");
        return AT_PHYNUM_TYPE_ERR;
    }

    /* ????????????????????????IMEI????????en_NV_Item_IMEI???????? */
    /* ????????????????????????SVN????????en_Nv_Item_Imei_Svn???????? */
    /* ????????????????????????MAC????????MAC??????????NV??(??????????MAC??????NV??)???????? */
    if (AT_PHYNUM_TYPE_IMEI == enSetType)
    {
        ulRet = AT_UpdateImei(enModemId, gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen);
    }
    /* Added by f62575 for SMALL IMAGE, 2012-1-3, begin */
    else if (AT_PHYNUM_TYPE_SVN == enSetType)
    {
        ulRet = AT_UpdateSvn(enModemId, gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen);
    }
    else
    {
        /*????MAC??????NV*/
        ulRet = AT_UpdateMacPara(gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen);
    }
    /* Added by f62575 for SMALL IMAGE, 2012-1-3, end   */
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, End */

    return ulRet;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetGTimerPara
 ????????  : ????GPRS??????????????????????????
             AT^GTIMER =< tgprs>
 ????????  : VOS_UINT8 ucIndex ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32 ATC??????
             AT_OK                  ????????????
             AT_DATA_UNLOCK_ERROR   ??????????????????
             AT_DEVICE_OTHER_ERROR  ????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??2??
    ??    ??   : ??????/f62575
    ????????   : ??????????
  2.??    ??   : 2011??06??29??
    ??    ??   : f00179208
    ????????   : ??????????DTS2011061400695,??V3C03B010????????AT??????????AT????????????????????????V1.1.4??????????
*****************************************************************************/
VOS_UINT32 AT_SetGTimerPara(VOS_UINT8 ucIndex)
{

    /* ??????????????????AT_DEVICE_OTHER_ERROR??????CME ERROR:1 */
    if (1 != gucAtParaIndex)
    {
        AT_NORM_LOG("AT_SetGTimerPara: the number of parameter is error.");
        return AT_ERROR;
    }

    /* ????????????????????AT_DATA_UNLOCK_ERROR??????CME ERROR:0 */
    if (g_bAtDataLocked != VOS_FALSE)
    {
        AT_NORM_LOG("AT_SetGTimerPara: data locked.");
        return AT_ERROR;
    }

    if (NV_OK !=  NV_WriteEx(MODEM_ID_0, en_NV_Item_GPRS_ActiveTimerLength,
                           &gastAtParaList[0].ulParaValue,
                           sizeof(gastAtParaList[0].ulParaValue)))
    {
         AT_WARN_LOG("AT_SetGTimerPara: Fail to write en_NV_Item_GPRS_ActiveTimerLength.");
         return AT_ERROR;
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetQcdmgPara
 ????????  : AT$QCDMG (??????????USB COM????????AT??????DIAG??????????)
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2008??06??10??
    ??    ??   : L47619
    ????????   : ??????????

  2.??    ??   : 2011??10??6??
    ??    ??   : ????/l60609
    ????????   : AT Project: ????OM????????
*****************************************************************************/
TAF_UINT32 At_SetQcdmgPara(TAF_UINT8 ucIndex)
{
    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????????? */
    if(0 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ucIndex????????AT????????PCUI/UART???? */
    if ((AT_USB_COM_PORT_NO != gastAtClientTab[ucIndex].ucPortNo)
     && (AT_UART_PORT_NO != gastAtClientTab[ucIndex].ucPortNo))
    {
        return AT_ERROR;
    }

    /*????????????????DIAG??????????*/
    if(AT_SUCCESS == At_CheckDataState(AT_DIAG_DATA_MODE))
    {
        return AT_ERROR;
    }

    /*????AT/DIAG??????????????????*/
    gucOmDiagIndex = ucIndex;

    /* Added by L60609 for AT Project??2011-10-06,  Begin*/
    /* ????OAM??????DIAG??????OAM???????? */
    if (AT_USB_COM_PORT_NO == gastAtClientTab[ucIndex].ucPortNo)
    {
        /*CBTCPM_NotifyChangePort(AT_PCUI_PORT, CPM_DIAG_COMM);*/
    }
    else
    {
        /*CBTCPM_NotifyChangePort(AT_UART_PORT, CPM_DIAG_COMM);*/
    }

    /*????????????????DIAG????*/
    At_SetMode(gucOmDiagIndex, AT_DATA_MODE, AT_DIAG_DATA_MODE);
    /* Added by L60609 for AT Project??2011-10-06,  End*/

    return AT_OK;
}


/*****************************************************************************
 ?? ?? ??  : At_SetU2DiagPara
 ????????  : AT^U2DIAG=<value> (??????????????USB????????)
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2009??06??27??
    ??    ??   : L47619
    ????????   : ??????????
  2.??    ??   : 2012??05??10??
    ??    ??   : f62575
    ????????   : DTS2012050704264??NV??31????????????????????????U2DIAG????
  3.??    ??   : 2012??8??10??
    ??    ??   : L00171473
    ????????   : DTS2012082204471, TQE????
*****************************************************************************/
TAF_UINT32 At_SetU2DiagPara(TAF_UINT8 ucIndex)
{
    AT_USB_ENUM_STATUS_STRU             stUsbEnumStatus;

    AT_PID_ENABLE_TYPE_STRU             stPidEnableType;


    PS_MEM_SET(&stUsbEnumStatus, 0x00, sizeof(stUsbEnumStatus));

    stPidEnableType.ulPidEnabled = VOS_FALSE;

    /* ????PID????NV?? */
    if (NV_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_PID_Enable_Type,
                        &stPidEnableType,
                        sizeof(AT_PID_ENABLE_TYPE_STRU)))
    {
        return AT_ERROR;
    }

    /* NV??????????????PID??????????????????????ERROR */
    if (VOS_FALSE != stPidEnableType.ulPidEnabled)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }
    /* ?????????????? */
    if (VOS_OK != DRV_U2DIAG_VALUE_CHECK(gastAtParaList[0].ulParaValue))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????stUsbEnumStatus?????? */
    PS_MEM_SET(&stUsbEnumStatus, 0, sizeof(AT_USB_ENUM_STATUS_STRU));

    if (NV_OK == NV_ReadEx(MODEM_ID_0, en_NV_Item_USB_Enum_Status, &stUsbEnumStatus, sizeof(AT_USB_ENUM_STATUS_STRU)))
    {
        if ( (gastAtParaList[0].ulParaValue == stUsbEnumStatus.ulValue)
            && (1 == stUsbEnumStatus.ulStatus))
        {
            AT_INFO_LOG("At_SetU2DiagPara():The content to write is same as NV's");
            return AT_OK;
        }
    }

    stUsbEnumStatus.ulStatus = 1;
    stUsbEnumStatus.ulValue  = gastAtParaList[0].ulParaValue;

    /* ????NVIM */
    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_USB_Enum_Status,
                           &stUsbEnumStatus,
                           sizeof(AT_USB_ENUM_STATUS_STRU)))
    {
        return AT_ERROR;
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_FistScanSetPortPara
 ????????  : ??????????SetPort??????????????????????????????????ERROR
 ????????  : VOS_UINT16     *pusSemiIndex
             VOS_UINT8      *pucInputString
             VOS_UINT16     usInputLen
 ????????  : ??
 ?? ?? ??  : VOS_BOOL
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??5??3??
    ??    ??   : l60609
    ????????   : ??????????
  2.??    ??   : 2012??4??20??
    ??    ??   : h00135900
    ????????   : V7????????: ????????????????????????????????????????????????????????

*****************************************************************************/
VOS_BOOL At_FistScanSetPortPara(
    VOS_UINT16                          *pusSemiIndex,
    VOS_UINT8                           *pucInputString,
    VOS_UINT16                          usInputLen
)
{
    VOS_UINT32                          i;
    VOS_UINT32                          j;
    VOS_UINT8                           ucSemiCount;
    /* Modify by h00135900 for V7????????, 2012-04-07, Begin   */
    VOS_UINT8                           aAvailableChar[] = {'0','1', '2', '3', '4',
                                                            '5', '6', '7', 'A',
                                                            'B', 'D', 'E', 'F',
                                                            ',', ';'};
   /* Modify by h00135900 for V7????????, 2012-04-07, End   */

    ucSemiCount = 0;

    for (i = 0; i < usInputLen; i++)
    {
        for (j = 0; j < (sizeof(aAvailableChar)/sizeof(VOS_UINT8)); j++)
        {
            if (*(pucInputString + i) == aAvailableChar[j])
            {
                if (';' == *(pucInputString + i))
                {
                    ucSemiCount++;
                    *pusSemiIndex = (VOS_UINT16)i;

                    /* ?????????????????? */
                    if (ucSemiCount > 1)
                    {
                        AT_ERR_LOG("At_FistScanSetPortPara:The num of semi can only be one!");
                        return VOS_FALSE;
                    }
                }
                break;
            }
        }

        /* ???????????? */
        if ((sizeof(aAvailableChar)/sizeof(VOS_UINT8)) == j)
        {
            AT_ERR_LOG("At_FistScanSetPortPara:Invalid character!");
            return VOS_FALSE;
        }
    }

    /* ?????????????????????????????????????????????????????? */
    if (( 0 == *pusSemiIndex ) || ((usInputLen - 1) == *pusSemiIndex))
    {
        AT_ERR_LOG("At_FistScanSetPortPara:The position of semi isn't suitable!");
        return VOS_FALSE;
    }

    /* ?????????????????????????? */
    if ((',' == *pucInputString) || (',' == pucInputString[usInputLen - 1]))
    {
        return VOS_FALSE;
    }

    return VOS_TRUE;
}

/*****************************************************************************
 ?? ?? ??  : At_SecScanSetPortFirstPara
 ????????  : ????????????????????????????A1??A2??ff
 ????????  : VOS_UINT16   usSemiIndex
             VOS_UINT8    *pucFirstParaCount
             VOS_UINT8    *pucInputString
             VOS_UINT16   usInputLen
 ????????  : ??
 ?? ?? ??  : VOS_BOOL
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??5??3??
    ??    ??   : l60609
    ????????   : ??????????

*****************************************************************************/
VOS_BOOL At_SecScanSetPortFirstPara(
    VOS_UINT16                          usSemiIndex,
    VOS_UINT8                           *pucFirstParaCount,
    VOS_UINT8                           *pucInputString,
    VOS_UINT16                          usInputLen
)
{
    VOS_UINT32                          i;
    VOS_UINT8                           ucCharCount;

    ucCharCount = 0;

    for (i = 0; i <= usSemiIndex; i++)
    {
        /* ???????????????????????? */
        if ((',' == *(pucInputString + i)) || (';' == *(pucInputString + i)))
        {
            /* ??????????????????????A1,,,,A2;1,2 ????ERROR */
            /* ??????????????A1,A2,FF */
            if (2 != ucCharCount)
            {
                AT_ERR_LOG("At_SecScanSetPortFirstPara:Invalid first parameter!");
                return VOS_FALSE;
            }

            /* LINT ERROR: ucCharCount = 2, i >= 2 */
            if ((i >= 2)
                && !((('A' == pucInputString[i - 2]) && ('1' == pucInputString[i - 1]))
                    || (('A' == pucInputString[i - 2]) && ('2' == pucInputString[i - 1]))
                    || (('F' == pucInputString[i - 2]) && ('F' == pucInputString[i - 1]))))

            {
                AT_ERR_LOG("At_SecScanSetPortFirstPara:Invalid first parameter!");
                return VOS_FALSE;
            }

            (*pucFirstParaCount)++;

            ucCharCount = 0;
        }
        else
        {
            ucCharCount++;
        }

        if (ucCharCount > 2)
        {
            AT_ERR_LOG("At_SecScanSetPortFirstPara:Invalid character!");
            return VOS_FALSE;
        }
    }

    return VOS_TRUE;
}

/*****************************************************************************
 ?? ?? ??  : At_SecScanSetPortSecPara
 ????????  : ????????????????????????????A1??A2??A??B??C??D??
             1??2??3??4??5??6??7??16????????????
 ????????  : VOS_UINT16   usSemiIndex
             VOS_UINT8    *pucSecParaCount
             VOS_UINT8    aucSecPara[AT_SETPORT_PARA_MAX_LEN][3]
             VOS_UINT8    *pInputString
             VOS_UINT16   usInputLen
 ????????  : ??
 ?? ?? ??  : VOS_BOOL
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??5??3??
    ??    ??   : l60609
    ????????   : ??????????
  2.??    ??   : 2012??4??20??
    ??    ??   : h00135900
    ????????   : V7????????: ????????????????????????????????????????????????????????

*****************************************************************************/
VOS_BOOL At_SecScanSetPortSecPara(
    VOS_UINT16                          usSemiIndex,
    VOS_UINT8                           *pucSecParaCount,
    VOS_UINT8                           aucSecPara[AT_SETPORT_PARA_MAX_LEN][3],
    VOS_UINT8                           *pucInputString,
    VOS_UINT16                          usInputLen
)
{
    VOS_UINT32                          i;
    VOS_UINT8                           ucCharCount;
    VOS_UINT8                           aucTmpInputString[AT_SETPORT_PARA_MAX_CHAR_LEN];
    VOS_UINT16                          usTmpInputStringLen;

    ucCharCount = 0;

    if (usInputLen > AT_SETPORT_PARA_MAX_CHAR_LEN)
    {
        return VOS_FALSE;
    }

    /*??????????????????????????????????????*/
    usTmpInputStringLen = usInputLen - usSemiIndex;
    PS_MEM_CPY(aucTmpInputString, pucInputString + usSemiIndex + 1, (VOS_SIZE_T)(usTmpInputStringLen - 1));
    aucTmpInputString[usTmpInputStringLen - 1] = ',';

    for (i = 0; i < usTmpInputStringLen; i++)
    {
        if (',' == *(aucTmpInputString + i))
        {
            /*??????????????????????A1,A2;1,,,2????eror*/
            if (0 == ucCharCount)
            {
                AT_ERR_LOG("At_SecScanSetPortSecPara:Invalid second parameter!");
                return VOS_FALSE;
            }

            /* ????????????????????A1,A2??16 */
            if (2 == ucCharCount)
            {
                /* LINT ERROR: ucCharCount = 2, i >= 2 */
                /* Modify by h00135900 for V7????????, 2012-04-07, Begin   */
                if ((i >= 2)
                    && !((('A' == aucTmpInputString[i - 2]) && ('1' == aucTmpInputString[i - 1]))
                      || (('A' == aucTmpInputString[i - 2]) && ('2' == aucTmpInputString[i - 1]))
                      || (('1' == aucTmpInputString[i - 2]) && ('6' == aucTmpInputString[i - 1]))
                      || (('1' == aucTmpInputString[i - 2]) && ('0' == aucTmpInputString[i - 1]))
                      || (('1' == aucTmpInputString[i - 2]) && ('1' == aucTmpInputString[i - 1]))
                      || (('1' == aucTmpInputString[i - 2]) && ('2' == aucTmpInputString[i - 1]))
                      || (('1' == aucTmpInputString[i - 2]) && ('3' == aucTmpInputString[i - 1]))
                      || (('1' == aucTmpInputString[i - 2]) && ('4' == aucTmpInputString[i - 1]))
                      || (('1' == aucTmpInputString[i - 2]) && ('5' == aucTmpInputString[i - 1]))
                 ))
                /* Modify by h00135900 for V7????????, 2012-04-07, End   */
                {
                    AT_ERR_LOG("At_SecScanSetPortSecPara:Invalid second parameter!");
                    return VOS_FALSE;
                }
            }

            /* ?????????????? */
            if (AT_SETPORT_PARA_MAX_LEN <= (*pucSecParaCount))
            {
                return VOS_FALSE;
            }

            PS_MEM_CPY(aucSecPara[*pucSecParaCount],
                (aucTmpInputString + i) - ucCharCount, ucCharCount);

            (*pucSecParaCount)++;

            ucCharCount = 0;
        }
        else
        {
            ucCharCount++;
        }

        if (ucCharCount > 2)
        {
            AT_ERR_LOG("At_SecScanSetPortSecPara:Invalid second parameter!");
            return VOS_FALSE;
        }
    }

    return VOS_TRUE;
}


/*****************************************************************************
 ?? ?? ??  : At_SaveSetPortFirstPara
 ????????  : ??????????????:??????A1,A2;A1;ff
 ????????  : VOS_UINT8    ucFirstParaCount
             VOS_UINT8    *pucFirstPort
             VOS_UINT8    *pucInputString
 ????????  : ??
 ?? ?? ??  : VOS_BOOL
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??5??3??
    ??    ??   : l60609
    ????????   : ??????????

*****************************************************************************/
VOS_BOOL At_SaveSetPortFirstPara(
    VOS_UINT8                           ucFirstParaCount,
    VOS_UINT8                           *pucFirstPort,
    VOS_UINT8                           *pucInputString
)
{
    /* ?????????????????? */
    if ((ucFirstParaCount != 1) && (ucFirstParaCount != 2))
    {
        return VOS_FALSE;
    }

    /* ????????????: FF????A1 */
    if (1 == ucFirstParaCount)
    {
        if (('F' == *pucInputString) && ('F' == *(pucInputString + 1)))
        {
            *pucFirstPort = 0xFF;
        }
        else if (('A' == *pucInputString) && ('1' == *(pucInputString + 1)))
        {
            *pucFirstPort = 0xA1;
        }
        else
        {
            AT_ERR_LOG("At_SaveSetPortFirstPara:Invalid first parameter!");
            return VOS_FALSE;
        }
    }
    /* ????????: A1,A2 */
    else
    {
        if (('A' == *pucInputString) && ('1' == pucInputString[1])
         && ('A' == pucInputString[3]) && ('2' == pucInputString[4]))
        {
            *pucFirstPort       = 0xA1;
            *(pucFirstPort + 1) = 0xA2;
        }
        else
        {
            AT_ERR_LOG("At_SaveSetPortFirstPara:Invalid first parameter!");
            return VOS_FALSE;
        }
    }
    return VOS_TRUE;
}


/*****************************************************************************
 ?? ?? ??  : At_SaveSetPortSecPara
 ????????  : ??????????????:????????
 ????????  : VOS_UINT8    ucSecParaCount
             VOS_UINT8    *pucSecPort
             VOS_UINT8    aucSecPara[AT_SETPORT_PARA_MAX_LEN][3]
 ????????  : ??
 ?? ?? ??  : VOS_BOOL
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??5??3??
    ??    ??   : l60609
    ????????   : ??????????
  2.??    ??   : 2012??4??20??
    ??    ??   : h00135900
    ????????   : V7????????: ??????????????????????????????????????

*****************************************************************************/
VOS_BOOL At_SaveSetPortSecPara(
    VOS_UINT8                           ucSecParaCount,
    VOS_UINT8                           *pucSecPort,
    VOS_UINT8                           aucSecPara[AT_SETPORT_PARA_MAX_LEN][3]
)
{
    VOS_UINT32                          i;
    VOS_UINT32                          j;

    /* ?????????????????? */
    if ((0 == ucSecParaCount) || (ucSecParaCount > AT_SETPORT_PARA_MAX_LEN))
    {
        AT_ERR_LOG("At_SaveSetPortSecPara:Invalid second parameter!");
        return VOS_FALSE;
    }

    /* ???????????? */
    for (i = 0; i < (VOS_UINT8)(ucSecParaCount - 1); i++)
    {
        for (j = i + 1; j < ucSecParaCount; j++)
        {
            if (!VOS_MemCmp(aucSecPara[i], aucSecPara[j], 3))
            {
                AT_ERR_LOG("At_SaveSetPortSecPara:Invalid second parameter!");
                return VOS_FALSE;
            }
        }
    }

    for (i = 0; i < ucSecParaCount; i++)
    {
        for (j = 0; j < AT_SETPORT_DEV_LEN; j++)
        {
            if (!VOS_MemCmp(aucSecPara[i], g_astSetPortParaMap[j].aucAtSetPara, 3))
            {
                pucSecPort[i] = g_astSetPortParaMap[j].ucDrvPara;
                break;
            }
        }

        /* ???????????????????????????????? */
        if (j >= AT_SETPORT_DEV_LEN)
        {
            AT_ERR_LOG("At_SaveSetPortSecPara:Invalid second parameter!");
            return VOS_FALSE;
        }
    }
    return VOS_TRUE;
}

/* Add by f62575 for V7????????, 2012-04-07, Begin   */
/*****************************************************************************
 ?? ?? ??  : AT_CheckPortTypePara
 ????????  : ??????????????????????????????????????????????
                            ????????????????AT_DEV_CDROM??AT_DEV_NONE
                            ????????????????AT_DEV_SD
 ????????  : VOS_UINT8                           ucFirstParaCount   ??????????????
                           VOS_UINT8                          *pucFirstPort         ??????????
                            VOS_UINT8                           ucSecParaCount  ??????????????
                            VOS_UINT8                          *pucSecPort         ??????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
                            VOS_TRUE        ????????????????????
                            VOS_FALSE       ??????????????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??4??20??
    ??    ??   : f62575
    ????????   : V7????????: ??????????????????????????

*****************************************************************************/
VOS_UINT32 AT_CheckPortTypePara(
    VOS_UINT8                           ucFirstParaCount,
    VOS_UINT8                          *pucFirstPort,
    VOS_UINT8                           ucSecParaCount,
    VOS_UINT8                          *pucSecPort
)
{
    VOS_UINT32                          ulRet;

    /* ????????????????????:
    ????????????????????A1(CDROM),????????ERROR??
    ??????????????????????A2(SD),????????ERROR??
    ????????????????????????????????????????FF,????????ERROR??
    */
    if (2 == ucFirstParaCount)
    {
        if ((AT_DEV_CDROM != *(pucFirstPort))
        || (AT_DEV_SD != *(pucFirstPort + 1)))
        {
            return VOS_FALSE;
        }

    }
    else if (1 == ucFirstParaCount)
    {
        if ((AT_DEV_CDROM != *(pucFirstPort))
        && (AT_DEV_NONE != *(pucFirstPort)))
        {
            return VOS_FALSE;
        }

    }
    else
    {
        return VOS_FALSE;
    }

    /*
    ????????????????????:
        1.????????????????2(PCUI),????????ERROR??
        2.????????????????????????????????????????????????????ERROR??
        3.??????????????????????????????ERROR??
        4.MASS ??????????????????????????????????ERROR
        5.??????????????????????????,????????ERROR??
    */
    /* Modified by zwx247453 for pc??????3650, 2015-08-24, begin */
    ulRet = (VOS_UINT32)DRV_USB_PORT_TYPE_VALID_CHECK(pucSecPort, ucSecParaCount);
    /* Modified by zwx247453 for pc??????3650, 2015-08-24, end */
    if (VOS_OK != ulRet)
    {
        return VOS_FALSE;
    }

    return VOS_TRUE;
}
/* Add by f62575 for V7????????, 2012-04-07, End   */

/*****************************************************************************
 ?? ?? ??  : At_IsAvailableSetPortPara
 ????????  : ????SETPORT????????????
 ????????  : VOS_UINT8    *pucInputString
             VOS_UINT16   usInputLen
             VOS_UINT8    *pucFirstPort
             VOS_UINT8    *pucSecPort
 ????????  : ??
 ?? ?? ??  : VOS_BOOL
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??5??3??
    ??    ??   : l60609
    ????????   : ??????????
  2.??    ??   : 2012??4??20??
    ??    ??   : f62575
    ????????   : V7????????: ????????????????

*****************************************************************************/
VOS_BOOL At_IsAvailableSetPortPara(
    VOS_UINT8                           *pucInputString,
    VOS_UINT16                          usInputLen,
    VOS_UINT8                           *pucFirstPort,
    VOS_UINT8                           *pucSecPort
)
{
    /* ?????????? */
    VOS_UINT16                          usSemiIndex;
    VOS_UINT8                           ucFirstParaCount;
    VOS_UINT8                           ucSecParaCount;
    VOS_UINT8                           aucSecPara[AT_SETPORT_PARA_MAX_LEN][3];
    VOS_BOOL                            bScanResult;
    /* Modify by f62575 for V7????????, 2012-04-07, Begin   */
    VOS_UINT32                          ulRet;
    /* Modify by f62575 for V7????????, 2012-04-07, End   */

    usSemiIndex         = 0;
    ucFirstParaCount    = 0;
    ucSecParaCount      = 0;

    VOS_MemSet(aucSecPara, 0x00, AT_SETPORT_PARA_MAX_LEN * 3);

    /* ??????????:?????????????? */
    bScanResult = At_FistScanSetPortPara(&usSemiIndex, pucInputString, usInputLen);

    if (VOS_TRUE != bScanResult)
    {
        AT_ERR_LOG("At_IsAvailableSetPortPara:First parameter is invalid!");
        return VOS_FALSE;
    }

    /* ??????????:??????????????A1,A2,FF,A,B,D,E,1,2,3,4,5,6,7 */
    /* ?????????? */
    bScanResult = At_SecScanSetPortFirstPara(usSemiIndex,
                                        &ucFirstParaCount,
                                        pucInputString,
                                        usInputLen);

    if (VOS_TRUE != bScanResult)
    {
        AT_ERR_LOG("At_IsAvailableSetPortPara:First parameter is invalid!");
        return VOS_FALSE;
    }

    /*??????????*/
    bScanResult = At_SecScanSetPortSecPara(usSemiIndex,
                                        &ucSecParaCount,
                                        aucSecPara,
                                        pucInputString,
                                        usInputLen);

    if (VOS_TRUE != bScanResult)
    {
        AT_ERR_LOG("At_IsAvailableSetPortPara:Second parameter is invalid!");
        return VOS_FALSE;
    }

    /*??????????????*/
    bScanResult = At_SaveSetPortFirstPara(ucFirstParaCount, pucFirstPort, pucInputString);

    if (VOS_TRUE != bScanResult)
    {
        AT_ERR_LOG("At_IsAvailableSetPortPara:Save first parameter fail!");
        return VOS_FALSE;
    }

    /*??????????????*/
    bScanResult = At_SaveSetPortSecPara(ucSecParaCount, pucSecPort, aucSecPara);

    if (VOS_TRUE != bScanResult)
    {
        AT_ERR_LOG("At_IsAvailableSetPortPara:Save second parameter fail!");
        return VOS_FALSE;
    }

    /* Modify by f62575 for V7????????, 2012-04-07, Begin   */
    ulRet = AT_CheckPortTypePara(ucFirstParaCount, pucFirstPort, ucSecParaCount, pucSecPort);

    return  ulRet;
    /* Modify by f62575 for V7????????, 2012-04-07, End   */
}


/*****************************************************************************
 ?? ?? ??  : At_SetPort
 ????????  : AT^SETPORT=<value>??????????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??4??29??
    ??    ??   : l60609
    ????????   : ??????????
  2.??    ??   : 2012??02??3??
    ??    ??   : f62575
    ????????   : B050 ??????????
                 DIAG????????????????????????????????????DIAG????????????????????
                 ????????????????????????????????????NV??en_NV_Item_PID_Enable_Type????
  3.??    ??   : 2012??8??10??
    ??    ??   : L00171473
    ????????   : DTS2012082204471, TQE????
*****************************************************************************/
VOS_UINT32 At_SetPort(VOS_UINT8 ucIndex)
{
    VOS_BOOL                            bValidPara;
    VOS_UINT8                           aucFirstPort[AT_SETPORT_PARA_MAX_LEN];
    VOS_UINT8                           aucSecPort[AT_SETPORT_PARA_MAX_LEN];
    AT_DYNAMIC_PID_TYPE_STRU            stDynamicPidType;
    /* Modified by f62575 for B050 Project, 2012-2-3, Begin   */
    AT_PID_ENABLE_TYPE_STRU             stPidEnableType;
    /* Modified by f62575 for B050 Project, 2012-2-3, end   */


    stPidEnableType.ulPidEnabled = VOS_FALSE;


    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_ERROR;
    }

    PS_MEM_SET(aucFirstPort, 0x00, AT_SETPORT_PARA_MAX_LEN);
    PS_MEM_SET(aucSecPort, 0x00, AT_SETPORT_PARA_MAX_LEN);
    PS_MEM_SET(&stDynamicPidType, 0x00, sizeof(AT_DYNAMIC_PID_TYPE_STRU));

    /* Modified by f62575 for B050 Project, 2012-2-3, Begin   */
    /* ????PID????NV?? */
    if (NV_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_PID_Enable_Type,
                         &stPidEnableType,
                         sizeof(AT_PID_ENABLE_TYPE_STRU)))
    {
        AT_ERR_LOG("At_SetPort:Read NV failed!");
        return AT_ERROR;
    }

    /* NV??????????????PID????????????????????????ERROR */
    if (VOS_TRUE != stPidEnableType.ulPidEnabled)
    {
        AT_WARN_LOG("At_SetPort:PID is not enabled");
        return AT_ERROR;
    }
    /* Modified by f62575 for B050 Project, 2012-2-3, End   */

    /* 1.????????
       2.????????????????
       ????????????: ???????????????????????? */
    if ((0 == gastAtParaList[0].usParaLen)
     || (gastAtParaList[0].usParaLen > ((AT_SETPORT_PARA_MAX_CHAR_LEN * 2) + 1)))
    {
        return AT_ERROR;
    }

    /* ??AT???????????????????????????????????????????????????????????? */
    At_UpString(gastAtParaList[0].aucPara, gastAtParaList[0].usParaLen);

    /* ???????? */
    bValidPara = At_IsAvailableSetPortPara(gastAtParaList[0].aucPara,
                                        gastAtParaList[0].usParaLen,
                                        aucFirstPort,
                                        aucSecPort);
    if (VOS_FALSE == bValidPara)
    {
        AT_WARN_LOG("At_SetPort:Parameter is invalid");
        return AT_ERROR;
    }

    /* ??NV??????????????ERROR */
    if (NV_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_Huawei_Dynamic_PID_Type,
                        &stDynamicPidType,
                        sizeof(AT_DYNAMIC_PID_TYPE_STRU)))
    {
        AT_ERR_LOG("At_SetPort:Read NV fail!");
        return AT_ERROR;
    }

    /* ??NV????????????NV??????????????????????????????ERROR */
    if (VOS_TRUE == stDynamicPidType.ulNvStatus)
    {
        /* ????????????????????NV????????????????????????????????????????OK */
        if(!(VOS_MemCmp(stDynamicPidType.aucFirstPortStyle, aucFirstPort, AT_SETPORT_PARA_MAX_LEN)))
        {
            if(!(VOS_MemCmp(stDynamicPidType.aucRewindPortStyle, aucSecPort, AT_SETPORT_PARA_MAX_LEN)))
            {
                AT_INFO_LOG("At_SetPort:Same, not need write");
                return AT_OK;
            }
        }
    }
    else
    {
        return AT_ERROR;
    }

    /* Added by f62575 for B050 Project, 2012-2-3, Begin   */
    /* ????????DIAG??????????    */
    if (AT_OK != AT_CheckSetPortRight(stDynamicPidType.aucRewindPortStyle,
                                      aucSecPort))
    {
        return AT_ERROR;
    }
    /* Added by f62575 for B050 Project, 2012-2-3, end   */

    PS_MEM_CPY(stDynamicPidType.aucFirstPortStyle, aucFirstPort, AT_SETPORT_PARA_MAX_LEN);
    PS_MEM_CPY(stDynamicPidType.aucRewindPortStyle, aucSecPort, AT_SETPORT_PARA_MAX_LEN);

    /* ????NV */
    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_Huawei_Dynamic_PID_Type,
                        &stDynamicPidType,
                        sizeof(AT_DYNAMIC_PID_TYPE_STRU)))
    {
        AT_ERR_LOG("At_SetPort:Write NV fail");
        return AT_ERROR;
    }
    else
    {
        return AT_OK;
    }
}

/* Added by l60609 for B070 Project, 2012/03/20, begin */
/*****************************************************************************
 ?? ?? ??  : AT_OpenSpecificPort
 ????????  : ????????????
 ????????  : VOS_UINT8 ucPort
 ????????  : ??
 ?? ?? ??  : VOS_UINT32             ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??3??20??
    ??    ??   : L60609
    ????????   : ??????????
  2.??    ??   : 2012??8??10??
    ??    ??   : L00171473
    ????????   : DTS2012082204471, TQE????
*****************************************************************************/
VOS_UINT32 AT_OpenSpecificPort(VOS_UINT8 ucPort)
{
    AT_DYNAMIC_PID_TYPE_STRU            stDynamicPidType;
    VOS_UINT32                          ulPortPos;
    VOS_UINT32                          ulPortNum;


    PS_MEM_SET(&stDynamicPidType, 0x00, sizeof(stDynamicPidType));

    ulPortPos = AT_DEV_NONE;


    /* ??NV??en_NV_Item_Huawei_Dynamic_PID_Type?????????????????? */
    if (NV_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_Huawei_Dynamic_PID_Type,
                        &stDynamicPidType,
                        sizeof(AT_DYNAMIC_PID_TYPE_STRU)))
    {
        AT_WARN_LOG("AT_OpenSpecificPort: Read NV fail!");
        return AT_ERROR;
    }

    /* ????????????????????: ??????????????????AT_OK */
    if (VOS_TRUE == stDynamicPidType.ulNvStatus)
    {
        /* ????NV??en_NV_Item_Huawei_Dynamic_PID_Type???????????????????? */
        AT_GetSpecificPort(ucPort,
                           stDynamicPidType.aucRewindPortStyle,
                           &ulPortPos,
                           &ulPortNum);

        if (AT_DEV_NONE != ulPortPos)
        {
            return AT_OK;
        }

    }
    else
    {
        AT_WARN_LOG("AT_OpenSpecificPort: en_NV_Item_Huawei_Dynamic_PID_Type is inactive!");
        return AT_ERROR;
    }

    /* ?????????????????? */
    if (ulPortNum >= AT_SETPORT_PARA_MAX_LEN)
    {
        return AT_ERROR;
    }

    stDynamicPidType.aucRewindPortStyle[ulPortNum] = ucPort;

    /* ??????????????????NV??en_NV_Item_Huawei_Dynamic_PID_Type */
    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_Huawei_Dynamic_PID_Type,
                        &stDynamicPidType,
                        sizeof(AT_DYNAMIC_PID_TYPE_STRU)))
    {
        AT_ERR_LOG("AT_OpenSpecificPort: Write NV fail");
        return AT_ERROR;
    }
    else
    {
        return AT_OK;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_CloseSpecificPort
 ????????  : ????PCSC????
 ????????  : VOS_UINT8 ucPort
 ????????  : ??
 ?? ?? ??  : VOS_UINT32             ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??3??20??
    ??    ??   : L60609
    ????????   : ??????????
  2.??    ??   : 2012??8??10??
    ??    ??   : L00171473
    ????????   : DTS2012082204471, TQE????
*****************************************************************************/
VOS_UINT32 AT_CloseSpecificPort(VOS_UINT8 ucPort)
{
    AT_DYNAMIC_PID_TYPE_STRU            stDynamicPidType;
    VOS_UINT32                          ulPortPos;
    VOS_UINT32                          ulPortNum;
    VOS_UINT32                          ulLoop;


    PS_MEM_SET(&stDynamicPidType, 0x00, sizeof(stDynamicPidType));

    ulPortPos = AT_DEV_NONE;


    /* ??NV??en_NV_Item_Huawei_Dynamic_PID_Type?????????????????? */
    if (NV_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_Huawei_Dynamic_PID_Type,
                          &stDynamicPidType,
                          sizeof(AT_DYNAMIC_PID_TYPE_STRU)))
    {
        AT_ERR_LOG("AT_CloseSpecificPort: Read NV fail!");
        return AT_ERROR;
    }

    /* ??????????????????????: ??????????????????AT_OK */
    if (VOS_TRUE == stDynamicPidType.ulNvStatus)
    {
        /* ????NV??en_NV_Item_Huawei_Dynamic_PID_Type???????????????????? */
        AT_GetSpecificPort(ucPort,
                           stDynamicPidType.aucRewindPortStyle,
                           &ulPortPos,
                           &ulPortNum);

        if (AT_DEV_NONE == ulPortPos)
        {
            return AT_OK;
        }
    }
    else
    {
        return AT_ERROR;
    }

    /* ????NV?????????????? */
    stDynamicPidType.aucRewindPortStyle[ulPortPos] = 0;
    ulPortNum--;

    for (ulLoop = ulPortPos; ulLoop < ulPortNum; ulLoop++)
    {
        stDynamicPidType.aucRewindPortStyle[ulLoop] = stDynamicPidType.aucRewindPortStyle[ulLoop + 1UL];
    }

    stDynamicPidType.aucRewindPortStyle[ulPortNum] = 0;

    /* ????????????????: ????????????????????????????????????MASS????(0xa1,0xa2) */
    if (0 != ulPortNum)
    {
        if ((AT_DEV_CDROM == stDynamicPidType.aucRewindPortStyle[0])
         || (AT_DEV_SD == stDynamicPidType.aucRewindPortStyle[0]))
        {
            return AT_ERROR;
        }
    }

    /* ??????????????????NV??en_NV_Item_Huawei_Dynamic_PID_Type */
    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_Huawei_Dynamic_PID_Type,
                          &stDynamicPidType,
                          sizeof(AT_DYNAMIC_PID_TYPE_STRU)))
    {
        AT_ERR_LOG("AT_CloseSpecificPort: Write NV fail");
        return AT_ERROR;
    }
    else
    {
        return AT_OK;
    }
}
/* Added by l60609 for B070 Project, 2012/03/20, end */

/*****************************************************************************
 ?? ?? ??  : At_SetPcscInfo
 ????????  : AT^PCSCINFO=<value> (??????????????????????PCSC????)
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??03??19??
    ??    ??   : L60609
    ????????   : ??????????

  2.??    ??   : 2011??10??24??
    ??    ??   : o00132663
    ????????   : AT????????????????????????????????????????

  3.??    ??   : 2012??3??20??
    ??    ??   : l60609
    ????????   : B070 Project:????????NV??????????????????
  4.??    ??   : 2012??8??10??
    ??    ??   : L00171473
    ????????   : DTS2012082204471, TQE????
*****************************************************************************/
TAF_UINT32 At_SetPcscInfo(TAF_UINT8 ucIndex)
{
    AT_DYNAMIC_PID_TYPE_STRU            stDynamicPidType;
    AT_PID_ENABLE_TYPE_STRU             stPidEnableType;


    stPidEnableType.ulPidEnabled = VOS_FALSE;


    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_ERROR;
    }

    PS_MEM_SET(&stDynamicPidType, 0x00, sizeof(AT_DYNAMIC_PID_TYPE_STRU));

    /* ????PID????NV?? */
    if (NV_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_PID_Enable_Type,
                         &stPidEnableType,
                         sizeof(AT_PID_ENABLE_TYPE_STRU)))
    {
        AT_ERR_LOG("At_SetPcscInfo:Read NV31 failed!");
        return AT_ERROR;
    }

    /* NV??????????????PID????????????????????????ERROR */
    if (VOS_TRUE != stPidEnableType.ulPidEnabled)
    {
        AT_WARN_LOG("At_SetPcscInfo:PID is not enabled!");
        return AT_ERROR;
    }

    /*  ????PCSC??*/
    if ( VOS_TRUE == gastAtParaList[0].ulParaValue )
    {
        return AT_OpenSpecificPort(AT_DEV_PCSC);
    }
    /* ????PCSC?? */
    else
    {
        return AT_CloseSpecificPort(AT_DEV_PCSC);
    }
}

/*****************************************************************************
 ?? ?? ??  : At_SetCellSearch
 ????????  : AT^CELLSRCH=<value> (??????????????????????????????????????????)
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??06??03??
    ??    ??   : s46746
    ????????   : ??????????
  2.??    ??   : 2011??10??05??
    ??    ??   : c00173809
    ????????   : AT????????????????????WAS api????????????????????
  3.??    ??   : 2012??12??26??
    ??    ??   : m00217266
    ????????   : DSDA C??????????????(??????????????MTA)
*****************************************************************************/
VOS_UINT32 At_SetCellSearch(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;
    VOS_UINT8                           ucCellSrh;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_TOO_MANY_PARA;
    }

    /* ???????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_ERROR;
    }

    ucCellSrh = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ???????? ID_AT_MTA_WRR_CELLSRH_SET_REQ ?? AT AGENT ??????????????????(VOS_UINT8)gastAtParaList[0].ulParaValue */
    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   At_GetOpId(),
                                   ID_AT_MTA_WRR_CELLSRH_SET_REQ,
                                   (VOS_VOID*)&ucCellSrh,
                                   sizeof(ucCellSrh),
                                   I0_UEPS_PID_MTA);

    if (AT_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_WAS_MNTN_SET_CELLSRH;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}


/*****************************************************************************
 Prototype      : At_SetGetportmodePara
 Description    :
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2009-07-13
    Author      : S62952
    Modification: Created function
  2.??    ??   : 2012??12??13??
    ??    ??   : L00171473
    ????????   : DTS2012121802573, TQE????
  3.??    ??   : 2013??05??20??
    ??    ??   : m00217266
    ????????   : nv??????
  4.??    ??   : 2013??10??08??
    ??    ??   : j00174725
    ????????   : TQE
*****************************************************************************/
TAF_UINT32 At_SetGetportmodePara (TAF_UINT8 ucIndex)
{
    TAF_PH_PORT_STRU     stPortInfo;
    TAF_PH_FMR_ID_STRU   stFmrID;
    TAF_UINT16           usDataLen = 0;
    TAF_UINT32           ulRslt;
    TAF_UINT32           ulPortInfoLen;

     /* ???????? */
    if ((AT_CMD_OPT_SET_PARA_CMD == g_stATParseCmd.ucCmdOptType) && (0 == gastAtParaList[0].usParaLen))
    {
        return AT_ERROR;
    }

    PS_MEM_SET(&stPortInfo, 0, sizeof(TAF_PH_PORT_STRU));

    /* MMA_CardType((VOS_CHAR *)stPortInfo.ProductName.aucProductName); */
    VOS_StrNCpy((VOS_CHAR *)stPortInfo.ProductName.aucProductName,
                 PRODUCTION_CARD_TYPE,
                 sizeof(stPortInfo.ProductName.aucProductName));



    PS_MEM_SET(&stFmrID, 0x00, sizeof(TAF_PH_FMR_ID_STRU));

    if (NV_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_FMRID, &stFmrID, sizeof(TAF_PH_FMR_ID_STRU)))
    {
        AT_WARN_LOG("At_SetMsIdInfo:WARNING:NVIM Read en_NV_Item_FMRID falied!");
        return AT_ERROR;
    }
    else
    {
        PS_MEM_CPY(stPortInfo.FmrId.aucMfrId, &stFmrID, sizeof(TAF_PH_FMR_ID_STRU));
    }

    ulPortInfoLen = TAF_MAX_PORT_INFO_LEN + 1;

    ulRslt = (VOS_UINT32)(DRV_GET_PORT_MODE((char *)stPortInfo.PortId.aucPortInfo, &ulPortInfoLen));
    if( VOS_OK != ulRslt )
    {
        AT_WARN_LOG("At_SetGetportmodePara:DRV_GET_PORT_MODE Info fail.");
        return AT_ERROR;
    }

    usDataLen =  (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,(TAF_CHAR *)pgucAtSndCodeAddr,(TAF_CHAR*)pgucAtSndCodeAddr, "%s: ",g_stParseContext[ucIndex].pstCmdElement->pszCmdName);
    usDataLen += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,(TAF_CHAR *)pgucAtSndCodeAddr,(TAF_CHAR *)pgucAtSndCodeAddr + usDataLen, "%s: %s", "TYPE", stPortInfo.ProductName.aucProductName);
    usDataLen += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,(TAF_CHAR *)pgucAtSndCodeAddr,(TAF_CHAR *)pgucAtSndCodeAddr + usDataLen, ": %s,",  stPortInfo.FmrId.aucMfrId);
    usDataLen += (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,(TAF_CHAR *)pgucAtSndCodeAddr,(TAF_CHAR *)pgucAtSndCodeAddr + usDataLen, "%s",  stPortInfo.PortId.aucPortInfo);

    gstAtSendData.usBufLen = usDataLen;
    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetCvoicePara
 ????????  : ^CVOICE=<mode>
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
  1.Date        : 2009-07-13
    Author      : S62952
    Modification: Created function
  2.??    ??   : 2011??10??06??
    ??    ??   : f00179208
    ????????   : AT????????, TAF_UINT8??????VOS_UINT8
  3.??    ??   : 2012??03??03??
    ??    ??   : s62952
    ????????   : BalongV300R002 Build????????  :????FEATURE_PC_VOICE??
  4.??    ??   : 2012??05??07??
    ??    ??   : w00199382
    ????????   : DTS2012050307304????????????????????????
  5.??    ??   : 2013??9??30??
    ??    ??   : Y00213812
    ????????   : DTS2013092802198: ????????stick??????????????????
                 ????????????????????????
  6.??    ??   : 2015??5??28??
    ??    ??   : l00198894
    ????????   : TSTS
*****************************************************************************/
VOS_UINT32   At_SetCvoicePara (VOS_UINT8 ucIndex)
{
    APP_VC_VOICE_MODE_ENUM_U16          usVoiceMode;


    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }


    /* ???????? */
    if(gucAtParaIndex != 1)
    {
        return AT_ERROR;
    }

    /* ??????????PC VOICE???? */
    usVoiceMode = (APP_VC_VOICE_MODE_ENUM_U16)gastAtParaList[0].ulParaValue;

    if (APP_VC_VOICE_MODE_PCVOICE != usVoiceMode)
    {
        return AT_ERROR;
    }

    /* ????????AT_SUCCESS????VOS_OK??????????  */
    if (VOS_OK == APP_VC_SetVoiceMode(gastAtClientTab[ucIndex].usClientId,
                                      0,
                                      (VOS_UINT8)APP_VC_AppVcVoiceMode2VcPhyVoiceMode(usVoiceMode),
                                      I0_WUEPS_PID_VC))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CVOICE_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }


}

/*****************************************************************************
 ?? ?? ??  : At_SetDdsetexPara
 ????????  : ??????????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2009??07??13??
    ??    ??   : S62952
    ????????   : ??????????
  2.??    ??   : 2010??07??28??
    ??    ??   : s62952
    ????????   : ??????????DTS2010072800659????
  3.??    ??   : 2011??10??06??
    ??    ??   : f00179208
    ????????   : AT??????????API????????????????
  4.??    ??   : 2012??03??03??
    ??    ??   : s62952
    ????????   : BalongV300R002 Build????????:????NAS_FEATURE_CS_VC
*****************************************************************************/
VOS_UINT32 At_SetDdsetexPara (VOS_UINT8 ucIndex)
{
    APP_VC_VOICE_PORT_ENUM_U8           ucVoicePort;


    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_TOO_MANY_PARA;
    }

    /* ??????????DIAG */
    ucVoicePort = (APP_VC_VOICE_PORT_ENUM_U8)gastAtParaList[0].ulParaValue;

    if (APP_VC_VOICE_PORT_DIAG != ucVoicePort)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (VOS_OK == APP_VC_SetVoicePort(gastAtClientTab[ucIndex].usClientId,
                                      0,
                                      ucVoicePort))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_DDSETEX_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }

}

/*****************************************************************************
 Prototype      : At_SetCmsrPara
 Description    : ^CMSR=<ReadTag>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2012??03??03??
    ??    ??   : s62952
    ????????   : BalongV300R002 Build????????:????NAS_FEATURE_CS_VC
  3.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCmsrPara (TAF_UINT8 ucIndex)
{
    /* Added by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);
    /* Added by l60609 for DSDA Phase III, 2013-2-22, End */

    /* ???????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ((0 != gastAtParaList[0].ulParaValue)&&( 1 != gastAtParaList[0].ulParaValue))
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ???????? */
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    pstSmsCtx->ucParaCmsr = (VOS_UINT8)gastAtParaList[0].ulParaValue;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetCmgiPara
 ????????  : ^CMGI=<stat>
 ????????  : TAF_UINT8 ucIndex  ????????
 ????????  : ??
 ?? ?? ??  : TAF_UINT32         ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   :
    ??    ??   : sunshaohua
    ????????   : ??????????
  2.??    ??   : 2011??3??21??
    ??    ??   : ??????/f62575
    ????????   : DTS2011032106013??ME????????????255??????????????????????????
  3.??    ??   : 2011??11??2??
    ??    ??   : f62575
    ????????   : AT PROJECT ??????????????????????
  4.??    ??   : 2013??2??25??
    ??    ??   : L60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCmgiPara (TAF_UINT8 ucIndex)
{
    MN_MSG_STATUS_TYPE_ENUM_U8          enMsgStatus;
    MN_MSG_LIST_PARM_STRU               stListPara;
    /* Added by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);
    /* Added by l60609 for DSDA Phase III, 2013-2-22, End */

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ????<stat> */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_ERROR;
    }
    else
    {
        enMsgStatus = (VOS_UINT8)gastAtParaList[0].ulParaValue;
    }

    stListPara.bChangeFlag = VOS_FALSE;
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, Begin */
    stListPara.enMemStore  = pstSmsCtx->stCpmsInfo.enMemReadorDelete;
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, End */
    stListPara.enStatus    = enMsgStatus;
    PS_MEM_SET(stListPara.aucReserve1, 0x00, sizeof(stListPara.aucReserve1));

    gastAtClientTab[ucIndex].opId = At_GetOpId();
    if (MN_ERR_NO_ERROR == MN_MSG_Delete_Test(gastAtClientTab[ucIndex].usClientId,
                                              gastAtClientTab[ucIndex].opId,
                                              &stListPara))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CMGI_SET;
        g_stParseContext[ucIndex].ucClientStatus = AT_FW_CLIENT_STATUS_PEND;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 Prototype      : At_ SetCmmtPara
 Description    : +CMMT=<index><stat>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2005-04-19
    Author      : ---
    Modification: Created function
  2.??    ??   : 2013??2??25??
    ??    ??   : L60609
    ????????   : DSDA PHASE III
*****************************************************************************/
TAF_UINT32 At_SetCmmtPara (TAF_UINT8 ucIndex)
{
    MN_MSG_MODIFY_STATUS_PARM_STRU               stModifyParm;
    /* Added by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_SMS_CTX_STRU              *pstSmsCtx = VOS_NULL_PTR;

    pstSmsCtx = AT_GetModemSmsCtxAddrFromClientId(ucIndex);
    /* Added by l60609 for DSDA Phase III, 2013-2-22, End */

    /* ???????? */
    if(gucAtParaIndex > 2)
    {
          return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ???????? */
    if ((AT_CMD_OPT_SET_PARA_CMD == g_stATParseCmd.ucCmdOptType) && (0 == gastAtParaList[0].usParaLen))
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ?????? */
    PS_MEM_SET(&stModifyParm,0x00,sizeof(stModifyParm));

    stModifyParm.ulIndex = gastAtParaList[0].ulParaValue;

    /* ????<stat> */
    if (0 == gastAtParaList[1].ulParaValue)
    {
        stModifyParm.enStatus = MN_MSG_STATUS_MT_NOT_READ;
    }
    else
    {
        stModifyParm.enStatus = MN_MSG_STATUS_MT_READ;
    }

    /* ?????????????? */
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, Begin */
    stModifyParm.enMemStore = pstSmsCtx->stCpmsInfo.enMemReadorDelete;
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, End */

     /* ???????????? */
    gastAtClientTab[ucIndex].opId = At_GetOpId();
    if (MN_ERR_NO_ERROR == MN_MSG_ModifyStatus(gastAtClientTab[ucIndex].usClientId,
                                               gastAtClientTab[ucIndex].opId,
                                               &stModifyParm))

    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CMMT_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}
/*****************************************************************************
 ?? ?? ??  : At_SetUssdModePara
 ????????  : ^USSDMODE=<value>
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2009??06??23??
    ??    ??   : S62952
    ????????   : ??????????????????AT????:AT^USSDMODE
  2.??    ??   : 2010??04??11??
    ??    ??   : S62952
    ????????   : AT2D17553

  3.??    ??   : 2011??12??30??
    ??    ??   : w00167002
    ????????   : DTS2011123001149:????AT^USSDMODE=0????????????????????
                 ????en_NV_Item_CUST_USSD_MODE????????????????????????????????????
  4.??    ??   : 2012??04??21??
    ??    ??   : f00179208
    ????????   : ????????:DTS2012041701780:????USSD??????????????????????????????NV??
  5.??    ??   : 2012??05??08??
    ??    ??   : f00179208
    ????????   : DTS2012050801468: ????^USSDMODE??????????????C??
  6.??    ??   : 2013??2??25??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  7.??    ??   : 2013??5??17??
    ??    ??   : W000176964
    ????????   : SS FDN&Call Control????:????????????PID??TAF
*****************************************************************************/
TAF_UINT32 At_SetUssdModePara(TAF_UINT8 ucIndex)
{
    USSD_TRANS_MODE_STRU                stUssdTranMode;
    /* Added by l60609 for DSDA Phase III, 2013-2-25, Begin */
    AT_MODEM_SS_CTX_STRU               *pstSsCtx = VOS_NULL_PTR;
    /* Added by l60609 for DSDA Phase III, 2013-2-25, End */

    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????????, ?????? 0/1 */
    if ((1 != gastAtParaList[0].ulParaValue) && (0 != gastAtParaList[0].ulParaValue))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, Begin */
    pstSsCtx                        = AT_GetModemSsCtxAddrFromClientId(ucIndex);
    pstSsCtx->usUssdTransMode       = (VOS_UINT16)gastAtParaList[0].ulParaValue;

    stUssdTranMode.ucStatus         = VOS_TRUE;
    stUssdTranMode.ucUssdTransMode  = (VOS_UINT8)pstSsCtx->usUssdTransMode;
    /* Modified by l60609 for DSDA Phase III, 2013-2-25, End */

    /* ????????????????????C?????????? */
    if (TAF_SUCCESS != AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                               gastAtClientTab[ucIndex].opId,
                                               TAF_MSG_SET_USSDMODE_MSG,
                                               &stUssdTranMode,
                                               sizeof(USSD_TRANS_MODE_STRU),
                                               I0_WUEPS_PID_TAF))
    {
        return AT_ERROR;
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetAdcTempPara
 ????????  : ^ADCTEMP=<value1>,<value2>,<value3>,<value4>
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2009??08??13??
    ??    ??   : m00128685
    ????????   : ??????????????????AT????:AT^ADCTEMP
  2.??    ??   : 2011??11??15??
    ??    ??   : ??????/f62575
    ????????   : ADCTEMP??????????????C??
*****************************************************************************/
TAF_UINT32 At_SetAdcTempPara(TAF_UINT8 ucIndex)
{
    SPY_TEMP_THRESHOLD_PARA_STRU stTempPara;
    VOS_UINT32                   ulChangeFlag = AT_SPY_TEMP_THRESHOLD_PARA_UNCHANGE;
    /* Added by ??????/f62575 for ADCTEMP??????????????C??, 2011/11/15, begin */
    VOS_UINT32                   ulRet;
    /* Added by ??????/f62575 for ADCTEMP??????????????C??, 2011/11/15, end */

    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 4)
    {
        return AT_TOO_MANY_PARA;
    }

    /*????????????*/
    PS_MEM_SET(&stTempPara,0xFF,sizeof(stTempPara));


    if(0 != gastAtParaList[0].usParaLen)
    {
        stTempPara.ulIsEnable   = gastAtParaList[0].ulParaValue;
        ulChangeFlag = AT_SPY_TEMP_THRESHOLD_PARA_CHANGE;
    }

    if(0 != gastAtParaList[1].usParaLen)
    {
        stTempPara.lCloseAdcThreshold = (VOS_INT)gastAtParaList[1].ulParaValue;
        ulChangeFlag = AT_SPY_TEMP_THRESHOLD_PARA_CHANGE;
    }

    if(0 != gastAtParaList[2].usParaLen)
    {
        stTempPara.lAlarmAdcThreshold = (VOS_INT)gastAtParaList[2].ulParaValue;
        ulChangeFlag = AT_SPY_TEMP_THRESHOLD_PARA_CHANGE;
    }

    if(0 != gastAtParaList[3].usParaLen)
    {
        stTempPara.lResumeAdcThreshold = (VOS_INT)gastAtParaList[3].ulParaValue;
        ulChangeFlag = AT_SPY_TEMP_THRESHOLD_PARA_CHANGE;
    }

    if(AT_SPY_TEMP_THRESHOLD_PARA_CHANGE == ulChangeFlag)
    {
        /*??????????????????*/
        /* Added by ??????/f62575 for ADCTEMP??????????????C??, 2011/11/15, begin */
        /* ????????C?????? ??????????????  */
        ulRet = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                       gastAtClientTab[ucIndex].opId,
                                       DRV_AGENT_ADC_SET_REQ,
                                       &stTempPara,
                                       sizeof(stTempPara),
                                       I0_WUEPS_PID_DRV_AGENT);
        if (TAF_SUCCESS != ulRet)
        {
            AT_WARN_LOG("At_SetAdcTempPara: AT_FillAndSndAppReqMsg fail.");
            return AT_ERROR;
        }

        /* ????AT???????????????????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_ADC_SET;
        return AT_WAIT_ASYNC_RETURN;
        /* Added by ??????/f62575 for ADCTEMP??????????????C??, 2011/11/15, end */

    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetCommDebugPara
 ????????  : OAM????????????AT????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2009??10??10??
    ??    ??   : m00128685
    ????????   : ????
  2.??    ??   : 2013??05??17??
    ??    ??   : m00217266
    ????????   : nv??????
*****************************************************************************/
TAF_UINT32 At_SetCommDebugPara(TAF_UINT8 ucIndex)
{
    SPY_TEMP_THRESHOLD_PARA_STRU        stTempPara;
    TAF_AT_NVIM_COMMDEGBUG_CFG_STRU     stDebugFlag;
    VOS_UINT16                          usFlag;
    USIMM_ACTIVECARD_REQ_STRU                     *pstMsg = VOS_NULL_PTR;

    stDebugFlag.ulCommDebugFlag = VOS_FALSE;

    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_TOO_MANY_PARA;
    }

    /*????????????*/
    PS_MEM_SET(&stTempPara,0xFF,sizeof(stTempPara));


    if(0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    switch(gastAtParaList[0].ulParaValue)
    {
        case 0x00:
            /*??????????Debug????*/
            if(NV_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_COMMDEGBUG_CFG, &(stDebugFlag.ulCommDebugFlag), sizeof(TAF_AT_NVIM_COMMDEGBUG_CFG_STRU)))
            {
                LogPrint("At_SetOamDebugPara:NV_ReadEx Debug Flag0 Fail\r\n");

                return AT_CME_OPERATION_NOT_ALLOWED;
            }

            if(0x00 != stDebugFlag.ulCommDebugFlag)
            {
                stDebugFlag.ulCommDebugFlag = 0x00;

                if(NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_COMMDEGBUG_CFG,&(stDebugFlag.ulCommDebugFlag),sizeof(TAF_AT_NVIM_COMMDEGBUG_CFG_STRU)))
                {
                    LogPrint("At_SetOamDebugPara:NV_WriteEx Debug Flag0 Fail\r\n");

                    return AT_CME_OPERATION_NOT_ALLOWED;
                }

            }

            break;
        case 0x01:
            /*????DRX????????????????*/
            if(NV_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_COMMDEGBUG_CFG, &(stDebugFlag.ulCommDebugFlag), sizeof(TAF_AT_NVIM_COMMDEGBUG_CFG_STRU)))
            {
                LogPrint("At_SetOamDebugPara:NV_ReadEx Debug Flag Fail\r\n");

                return AT_CME_OPERATION_NOT_ALLOWED;
            }

            if(0x01 != (stDebugFlag.ulCommDebugFlag&0x01))
            {
                stDebugFlag.ulCommDebugFlag |= 0x01;

                if(NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_COMMDEGBUG_CFG,&(stDebugFlag.ulCommDebugFlag),sizeof(TAF_AT_NVIM_COMMDEGBUG_CFG_STRU)))
                {
                    LogPrint("At_SetOamDebugPara:NV_WriteEx Debug Flag Fail\r\n");

                    return AT_CME_OPERATION_NOT_ALLOWED;
                }

            }

            break;
        case 0x03:
            /*????USIMM??????????????????*/
            if(NV_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_COMMDEGBUG_CFG, &(stDebugFlag.ulCommDebugFlag), sizeof(TAF_AT_NVIM_COMMDEGBUG_CFG_STRU)))
            {
                LogPrint("At_SetOamDebugPara:NV_ReadEx Debug Flag2 Fail\r\n");

                return AT_CME_OPERATION_NOT_ALLOWED;
            }

            if(0x02 != (stDebugFlag.ulCommDebugFlag&0x02))
            {
                stDebugFlag.ulCommDebugFlag |= 0x02;

                if(NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_COMMDEGBUG_CFG,&(stDebugFlag.ulCommDebugFlag),sizeof(TAF_AT_NVIM_COMMDEGBUG_CFG_STRU)))
                {
                    LogPrint("At_SetOamDebugPara:NV_WriteEx Debug Flag2 Fail\r\n");

                    return AT_CME_OPERATION_NOT_ALLOWED;
                }

            }

            break;

        case 0x05:

            usFlag = 1;

            if(NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_Usim_Debug_Mode_Set, &usFlag, sizeof(VOS_UINT16)))
            {
                LogPrint("At_SetOamDebugPara:NV_WriteEx Usim Debug Flag Fail\r\n");

                return AT_CME_OPERATION_NOT_ALLOWED;
            }

            break;

        case 0x06:

            usFlag = 0;

            if(NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_Usim_Debug_Mode_Set, &usFlag, sizeof(VOS_UINT16)))
            {
                LogPrint("At_SetOamDebugPara:NV_WriteEx Usim Debug Flag Fail\r\n");

                return AT_CME_OPERATION_NOT_ALLOWED;
            }

            break;

        case 0x07:
            pstMsg = (USIMM_ACTIVECARD_REQ_STRU *)VOS_AllocMsg(WUEPS_PID_AT, sizeof(USIMM_ACTIVECARD_REQ_STRU)-VOS_MSG_HEAD_LENGTH);

            if(VOS_NULL_PTR == pstMsg)
            {
                LogPrint("USIMM_InitCardStart:AllocMsg Failed.");

                return VOS_ERR;
            }

            pstMsg->stMsgHeader.ulReceiverPid      = WUEPS_PID_USIM;
            pstMsg->stMsgHeader.enMsgName          = USIMM_ACTIVECARD_REQ;
            if (VOS_OK != VOS_SendMsg(WUEPS_PID_AT, pstMsg))
            {
                LogPrint("USIMM_InitCardStart:sndmsg Failed.");
            }
            break;

        default:
            break;
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetDwinsPara
 ????????  : ^DWINS=<value> (????????????????????????WINS????)
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2009??07??11??
    ??    ??   : L47619
    ????????   : ??????????
  2.??    ??   : 2011??10??23??
    ??    ??   : A00165503
    ????????   : ??????????????WINS(NBNS)????
  3.??    ??   : 2013??5??17??
    ??    ??   : l00167671
    ????????   : NV??????????, ??NV??????????????????
*****************************************************************************/
TAF_UINT32 AT_SetDwinsPara(TAF_UINT8 ucIndex)
{
    VOS_UINT32                          ulEnabled;
    WINS_CONFIG_STRU                    stWins;
    VOS_UINT32                          ulLength;

    ulLength = 0;
    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( gucAtParaIndex > 1 )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( 0 == gastAtParaList[0].usParaLen )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    ulEnabled = gastAtParaList[0].ulParaValue;
    (VOS_VOID)NV_GetLength(en_NV_Item_WINS_Config, &ulLength);
    /* ????stWins?????? */
    PS_MEM_SET(&stWins, 0, sizeof(WINS_CONFIG_STRU));

    if ( NV_OK == NV_ReadEx(MODEM_ID_0, en_NV_Item_WINS_Config, &stWins, ulLength) )
    {
        if ( (1 == stWins.ucStatus) && (ulEnabled == stWins.ucWins) )
        {
            AT_INFO_LOG("AT_SetDwinsPara():The content to write is same as NV's");

            /* ????PPP??WINS???? */
            PPP_UpdateWinsConfig((VOS_UINT8)gastAtParaList[0].ulParaValue);

            /* ????APS??WINS???? */
            TAF_PS_ConfigNbnsFunction(WUEPS_PID_AT,
                                      AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                      0,
                                      ulEnabled);

            return AT_OK;
        }
    }

    stWins.ucStatus = 1;
    stWins.ucWins   = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ????NVIM */
    (VOS_VOID)NV_GetLength(en_NV_Item_WINS_Config, &ulLength);
    if ( NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_WINS_Config, &stWins, ulLength) )
    {
        return AT_ERROR;
    }
    else
    {
        /* ????PPP??WINS???? */
        PPP_UpdateWinsConfig((VOS_UINT8)gastAtParaList[0].ulParaValue);

        /* ????APS??WINS???? */
        TAF_PS_ConfigNbnsFunction(WUEPS_PID_AT,
                                  AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                  0,
                                  ulEnabled);

        return AT_OK;
    }
}

/*****************************************************************************
 Prototype      : At_SetYjcxPara
 Description    :<PCB??????><FLASH????????>,<FLASH_id>,<flash????>,<flash page????>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2009-08-07
    Author      : S62952
    Modification: Created function

  2.??    ??   : 2011??10??18??
    ??    ??   : o00132663
    ????????   : AT??????????????API????????????????
*****************************************************************************/
TAF_UINT32 At_SetYjcxPara (TAF_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;

    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   DRV_AGENT_YJCX_SET_REQ,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_WUEPS_PID_DRV_AGENT);

    if(AT_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_YJCX_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}
/*****************************************************************************
 ?? ?? ??  : At_SetAt2OmPara
 ????????  : AT^AT2OM (??????????USB COM????????AT??????om??????????)
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2009??08??14??
    ??    ??   : S62952
    ????????   : ??????????

  2.??    ??   : 2011??10??6??
    ??    ??   : ????/l60609
    ????????   : AT Project: ????OM????????
  3.??    ??   : 2011??12??7??
    ??    ??   : ???? l00171473
    ????????   : DTS2011120801675,UART????????????

  4.??    ??   : 2013??12??02??
    ??    ??   : j00174725
    ????????   : ????UART????

  5.??    ??   : 2015??5??22??
    ??    ??   : l00198894
    ????????   : TSTS
*****************************************************************************/
TAF_UINT32 At_SetAt2OmPara(TAF_UINT8 ucIndex)
{
    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????????? */
    if(0 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /*ucIndex????????AT????????AT/OM????*/
    if ( (AT_USB_COM_PORT_NO != gastAtClientTab[ucIndex].ucPortNo)
      && (AT_UART_PORT_NO    != gastAtClientTab[ucIndex].ucPortNo)
      && (AT_CTR_PORT_NO     != gastAtClientTab[ucIndex].ucPortNo)
      && (AT_PCUI2_PORT_NO   != gastAtClientTab[ucIndex].ucPortNo)
      && (AT_HSUART_PORT_NO  != gastAtClientTab[ucIndex].ucPortNo))
    {
        return AT_ERROR;
    }

    /*????????????????OM??????AT????*/
    if(AT_SUCCESS == At_CheckDataState(AT_OM_DATA_MODE))
    {
        return AT_ERROR;
    }

    /*????AT/OM??????????????????*/
    gucAtOmIndex = ucIndex;

    /* Modified by L60609 for AT Project??2011-10-05,  Begin*/
    /* ????OAM??????OM???? */
    if (AT_USB_COM_PORT_NO == gastAtClientTab[ucIndex].ucPortNo)
    {
        CBTCPM_NotifyChangePort(AT_PCUI_PORT);
    }
    else if (AT_UART_PORT_NO == gastAtClientTab[ucIndex].ucPortNo)
    {
        CBTCPM_NotifyChangePort(AT_UART_PORT);
    }

    else if (AT_HSUART_PORT_NO == gastAtClientTab[ucIndex].ucPortNo)
    {
        CBTCPM_NotifyChangePort(AT_HSUART_PORT);
    }
    else
    {
    }

    /*????????????????OM????*/
    At_SetMode(gucAtOmIndex, AT_DATA_MODE, AT_OM_DATA_MODE);
    /* Modified by L60609 for AT Project??2011-10-05,  End*/

    return AT_OK;
}

/*****************************************************************************
 Prototype      : AT_ResumeOm2AtMode
 Description    : ??OM????????AT??
 Input          : ucPortNo    - ??????
 Output         : ---
 Return Value   : AT_SUCCESS --- ????
                  AT_FAILURE --- ????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2009-08-14
    Author      :S62952
    Modification: Created function
*****************************************************************************/
TAF_UINT32 AT_ResumeOm2AtMode(TAF_VOID)
{
    /*????????????????OM??????????*/
    if(AT_SUCCESS != At_CheckDataState(AT_OM_DATA_MODE))
    {
        return VOS_ERR;
    }

    At_SetMode(gucAtOmIndex,AT_CMD_MODE,AT_NORMAL_MODE);   /* ???????????? */
    return VOS_OK;
}
/*****************************************************************************
 ?? ?? ??  : AT_GetOperatorNameFromParam
 ????????  : ??AT????????????????????????
 ????????  :
 ????????  : ??
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??10??24??
    ??    ??   : c00173809
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_GetOperatorNameFromParam(
    VOS_UINT16                         *usOperNameLen,
    VOS_CHAR                           *pucOperName,
    VOS_UINT16                          usBufSize,
    VOS_UINT32                          ulFormatType
)
{
    if ((AT_COPS_LONG_ALPH_TYPE == ulFormatType)
     && (usBufSize > gastAtParaList[2].usParaLen)
     && (0 != gastAtParaList[2].usParaLen))
    {
        PS_MEM_CPY((VOS_CHAR*)pucOperName,(VOS_CHAR*)gastAtParaList[2].aucPara,gastAtParaList[2].usParaLen);
        pucOperName[gastAtParaList[2].usParaLen] = 0;
        *usOperNameLen = gastAtParaList[2].usParaLen;

        return AT_OK;
    }
    else if ((AT_COPS_SHORT_ALPH_TYPE == ulFormatType)
          && (usBufSize > gastAtParaList[2].usParaLen)
          && (0 != gastAtParaList[2].usParaLen))
    {
        PS_MEM_CPY((VOS_CHAR*)pucOperName,(VOS_CHAR*)gastAtParaList[2].aucPara,gastAtParaList[2].usParaLen);
        pucOperName[gastAtParaList[2].usParaLen] = 0;
        *usOperNameLen = gastAtParaList[2].usParaLen;

        return AT_OK;
    }
    else if ((usBufSize > gastAtParaList[2].usParaLen)
          && ((5 == gastAtParaList[2].usParaLen)
           || (6 == gastAtParaList[2].usParaLen)))
    {
        PS_MEM_CPY((VOS_CHAR*)pucOperName,(VOS_CHAR*)gastAtParaList[2].aucPara,gastAtParaList[2].usParaLen);
        pucOperName[gastAtParaList[2].usParaLen] = 0;
        *usOperNameLen = gastAtParaList[2].usParaLen;

        return AT_OK;
    }
    else
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }
}
/*****************************************************************************
 ?? ?? ??  : At_SetCpolPara
 ????????  : AT+CPOL??????????
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  --- ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2009??08??19??
    ??    ??   : z40661
    ????????   : ??????????
  2.??    ??    : 2010??2??1??
    ??    ??    : sunxibo
    ????????    : ??????????????????????
  3.??    ??   : 2011??10??05??
    ??    ??   : c00173809
    ????????   : AT????????????AT??????????????????C??????C??????????
  4.??    ??   : 2013??2??22??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  5.??    ??   : 2015??2??3??
    ??    ??   : y00307564
    ????????   : Iteration 8????
*****************************************************************************/
VOS_UINT32 At_SetCpolPara(VOS_UINT8 ucIndex)
{
    TAF_PH_SET_PREFPLMN_STRU            stPrefPlmn;
    VOS_UINT32                          ulRst;
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    AT_MODEM_NET_CTX_STRU              *pstNetCtx = VOS_NULL_PTR;

    pstNetCtx = AT_GetModemNetCtxAddrFromClientId(ucIndex);

    PS_MEM_SET(&stPrefPlmn,0,sizeof(stPrefPlmn));

    /* ???????? */
    if ( gucAtParaIndex > 7 )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ( (2 == gucAtParaIndex)
      && (0 == gastAtParaList[0].usParaLen)
      && (0 != gastAtParaList[1].usParaLen))
    {
        /* ??????????<format>????????????????<oper>??????????????????????<oper>
           ??format???????? */
        pstNetCtx->ucCpolFormatType = (AT_COPS_FORMAT_TYPE)gastAtParaList[1].ulParaValue;
        return AT_OK;
    }

    if (pstNetCtx->enPrefPlmnType > MN_PH_PREF_PLMN_HPLMN)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /*????????????????????????MMA????????*/
    stPrefPlmn.enPrefPlmnType           = pstNetCtx->enPrefPlmnType;
    stPrefPlmn.ucAtParaIndex            = gucAtParaIndex;
    stPrefPlmn.usIndexLen               = gastAtParaList[0].usParaLen;
    stPrefPlmn.usIndex                  = gastAtParaList[0].ulParaValue;
    stPrefPlmn.usFormatLen              = gastAtParaList[1].usParaLen;
    stPrefPlmn.usFormat                 = gastAtParaList[1].ulParaValue;
    stPrefPlmn.usGsmRatLen              = gastAtParaList[3].usParaLen;
    stPrefPlmn.usGsmRat                 = gastAtParaList[3].ulParaValue;
    stPrefPlmn.usGsmCompactRatLen       = gastAtParaList[4].usParaLen;
    stPrefPlmn.usGsmCompactRat          = gastAtParaList[4].ulParaValue;
    stPrefPlmn.usUtrnLen                = gastAtParaList[5].usParaLen;
    stPrefPlmn.usUtrn                   = gastAtParaList[5].ulParaValue;

    /* LTE?????????????????? */
    stPrefPlmn.usEutrnLen                = gastAtParaList[6].usParaLen;
    stPrefPlmn.usEutrn                   = gastAtParaList[6].ulParaValue;

    if (0 < stPrefPlmn.usFormatLen)
    {
        pstNetCtx->ucCpolFormatType = (AT_COPS_FORMAT_TYPE)stPrefPlmn.usFormat;

        ulRst = AT_GetOperatorNameFromParam(&stPrefPlmn.usOperNameLen,
                                             stPrefPlmn.ucOperName,
                                             sizeof(stPrefPlmn.ucOperName),
                                             stPrefPlmn.usFormat);
        if ( AT_OK != ulRst )
        {
            return ulRst;
        }
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

    if (VOS_TRUE == TAF_MMA_SetCpolReq(WUEPS_PID_AT,
                                       gastAtClientTab[ucIndex].usClientId,
                                       0,
                                       &stPrefPlmn))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CPOL_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }

}
/*****************************************************************************
 ?? ?? ??  : At_SetCplsPara
 ????????  : AT+CPLS??????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??06??03??
    ??    ??   : s46746
    ????????   : ??????????
  2.??    ??   : 2011??10??05??
    ??    ??   : c00173809
    ????????   : AT????????????????????API??????????????????????
*****************************************************************************/
VOS_UINT32 At_SetCplsPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                           ulRst;
    MN_PH_PREF_PLMN_TYPE_ENUM_U8         enPrefPlmnType;

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (gucAtParaIndex != 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????? */
    if(0 != gastAtParaList[0].usParaLen)
    {
        enPrefPlmnType = (MN_PH_PREF_PLMN_TYPE_ENUM_U8)gastAtParaList[0].ulParaValue;
    }
    else
    {
        enPrefPlmnType = MN_PH_PREF_PLMN_UPLMN;
    }

    if (enPrefPlmnType > MN_PH_PREF_PLMN_HPLMN)
    {
        return AT_CME_OPERATION_NOT_SUPPORTED;
    }

    /* ???????? ID_TAF_MMA_PREF_PLMN_TYPE_SET_REQ ?? MMA ???? */
    ulRst = TAF_MMA_SetPrefPlmnTypeReq(WUEPS_PID_AT,
                                       gastAtClientTab[ucIndex].usClientId,
                                       gastAtClientTab[ucIndex].opId,
                                       &enPrefPlmnType); /*??????????????????????*/

    if (VOS_TRUE == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_MMA_SET_PREF_PLMN_TYPE;
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;

}
/*****************************************************************************
 ?? ?? ??  : At_SetpidPara
 ????????  : ^SetPid=<value>
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2009??07??30??
    ??    ??   : S62952
    ????????   : ??????????????????AT????:AT^SETPID
*****************************************************************************/
TAF_UINT32 At_SetpidPara(TAF_UINT8 ucIndex)
{
    TAF_UINT32           ulRslt;
    TAF_UINT8            diagValue;

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????????, ?????? 0/1 */
    if ((1 != gastAtParaList[0].ulParaValue) && (0 != gastAtParaList[0].ulParaValue))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    diagValue = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    ulRslt = (VOS_UINT32)(DRV_SET_PID(diagValue));
    if( VOS_OK != ulRslt )
    {
        AT_WARN_LOG("At_SetpidPara:Setpid fail.");
        return AT_ERROR;
    }

    return AT_OK;

  }

/*****************************************************************************
 ?? ?? ??  : AT_SetOpwordParaForApModem
 ????????  : AT^OPWORD??????????, AP_MODEM??????????????DIAG/SHELL??????
 ????????  : VOS_UINT8  ucIndex
 ????????  : VOS_UINT32
 ?? ?? ??  : VOS_OK  ????????????
             VOS_ERR ????????????
 ????????  :
 ????????  :
 ????????      :
  1.??    ??   : 2012??04??18??
    ??    ??   : y00213812
    ????????   : AP-Modem????????????????????

 *****************************************************************************/
VOS_UINT32 AT_SetOpwordParaForApModem ( VOS_UINT8  ucIndex )
{
    VOS_UINT32                              ulResult;
    DRV_AGENT_OPWORD_SET_REQ_STRU           stOpwordSetReq;

    /* ?????????????? */
    PS_MEM_SET(&stOpwordSetReq, 0x00, sizeof(DRV_AGENT_OPWORD_SET_REQ_STRU));

    /* ???????????????? */
    if (DRV_AGENT_PORT_PASSWORD_LEN != gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????????????????16????0??-??9??ASCII????,??????ASCII?????????????????? */
    ulResult = At_AsciiNum2Num(stOpwordSetReq.aucPortPassword,
                               gastAtParaList[0].aucPara,
                               DRV_AGENT_PORT_PASSWORD_LEN);
    if ( AT_FAILURE == ulResult)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????, ??????????????C??, ????????DIAG/SHELL?????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      DRV_AGENT_OPWORD_SET_REQ,
                                      &stOpwordSetReq,
                                      sizeof(DRV_AGENT_OPWORD_SET_REQ_STRU),
                                      I0_WUEPS_PID_DRV_AGENT);

    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetOpwordParaForApModem: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_OPWORD_SET;
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetOpwordPara
 ????????  : AT^OPWORD??????????, ????????DIAG/SHELL??????
 ????????  : VOS_UINT8  ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??9??8??
    ??    ??   : lijun 00171473
    ????????   : ??????????
  2.??    ??   : 2010??12??4??
    ??    ??   : lijun 00171473
    ????????   : DTS2010112600839,????NV??????DISLOG????(OPWORD????)
  3.??    ??   : 2010??12??28??
    ??    ??   : lijun 00171473
    ????????   : DTS2010120600056 OPWORD??????????????????NV??
  4.??    ??   : 2012??04??18??
    ??    ??   : y00213812
    ????????   : AP-Modem????????????????
*****************************************************************************/
VOS_UINT32 AT_SetOpwordPara ( VOS_UINT8  ucIndex )
{
    VOS_UINT32                              ulCheckRlst = VOS_FALSE;
    VOS_UINT8                              *pucSystemAppConfig;
    VOS_UINT32                              ulResult;

    /* ????NV???????????????? */
    pucSystemAppConfig = AT_GetSystemAppConfigAddr();

    /* ???????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_ERROR;
    }

    /* ????????????  ????????OK */
    if (AT_E5_RIGHT_FLAG_YES == g_enATE5RightFlag)
    {
        return AT_OK;
    }

    /* ??????????????????AP-MODEM */
    if ( SYSTEM_APP_ANDROID == *pucSystemAppConfig)
    {
        ulResult = AT_SetOpwordParaForApModem(ucIndex);
        return ulResult;
    }

    /* ???????????? */
    if ( gastAtParaList[0].usParaLen > AT_DISLOG_PWD_LEN )
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (0 == VOS_StrLen((VOS_CHAR *)g_acATOpwordPwd))
    {
        /* NV???????????????????????????????????? */
        ulCheckRlst = VOS_TRUE;
    }
    else
    {
        if (0 == VOS_StrCmp((VOS_CHAR*)g_acATOpwordPwd, (VOS_CHAR*)gastAtParaList[0].aucPara))
        {
            ulCheckRlst = VOS_TRUE;
        }
    }

    if ( VOS_FALSE == ulCheckRlst )
    {
        return AT_ERROR;
    }

    /* ????????????  ???????? */
    g_enATE5RightFlag = AT_E5_RIGHT_FLAG_YES;

    /* ??D25??????  ?????????????? */

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCpwordPara
 ????????  : AT^CPWORD??????????, ????????DIAG/SHELL??????
 ????????  : VOS_UINT8  ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??9??8??
    ??    ??   : lijun 00171473
    ????????   : ??????????
  2.??    ??   : 2010??12??28??
    ??    ??   : lijun 00171473
    ????????   : DTS2010120600056 OPWORD??????????????????NV??
*****************************************************************************/
VOS_UINT32 AT_SetCpwordPara ( VOS_UINT8  ucIndex )
{
    /*??????????????*/
    if (AT_E5_RIGHT_FLAG_NO == g_enATE5RightFlag )
    {
        return AT_OK;
    }

    /* ???????? */
    g_enATE5RightFlag = AT_E5_RIGHT_FLAG_NO;

    /* ??D25??????  ?????????????? */

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetDislogPara
 ????????  : AT^DISLOG??????????, ????DIAG??
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??9??8??
    ??    ??   : lijun 00171473
    ????????   : ??????????
  2.??    ??   : 2010??10??27??
    ??    ??   : lijun 00171473
    ????????   : DTS2010102601801,PCUI????????DIAG??????????????????????
  3.??    ??   : 2012??02??07??
    ??    ??   : f62575
    ????????   : B050 ????????PID??????????????????NV??????
                 ^DISLOG??????????NV??????????en_NV_Item_AT_DISLOG_PWD
                 ??????????????en_NV_Item_Huawei_Dynamic_PID_Type
  4.??    ??   : 2012??03??17??
    ??    ??   : f00179208
    ????????   : ??????:DTS2012031702256,HILINK??????HILINK????????????????????
  5.??    ??   : 2012??8??10??
    ??    ??   : L00171473
    ????????   : DTS2012082204471, TQE????
*****************************************************************************/
VOS_UINT32 AT_SetDislogPara ( VOS_UINT8 ucIndex )
{
    /* Added by f62575 for B050 Project, 2012-2-3, Begin   */
    VOS_UINT32                          ulRet;
    AT_PID_ENABLE_TYPE_STRU             stPidEnableType;
    /* Added by f62575 for B050 Project, 2012-2-3, end   */

    /* Add by w00199382 for V7????????, 2012-04-07, Begin   */
    VOS_UINT32                          ulRetDiag;
    VOS_UINT32                          ulRet3GDiag;
    VOS_UINT32                          ulRetGps;
    /* Add by w00199382 for V7????????, 2012-04-07, End   */


    stPidEnableType.ulPidEnabled = VOS_FALSE;


    /* ???????? */
    if ((0 == gastAtParaList[0].usParaLen) || (gucAtParaIndex > 1))
    {
        return AT_ERROR;
    }

    /* ????PCUI????DIAG???? */
    if ( AT_DISLOG_PCUI_TO_DIAG == gastAtParaList[0].ulParaValue )
    {
        /* ucIndex????????AT????????PCUI/UART???? */
        if ((AT_USB_COM_PORT_NO != gastAtClientTab[ucIndex].ucPortNo)
         && (AT_UART_PORT_NO != gastAtClientTab[ucIndex].ucPortNo))
        {
            return AT_ERROR;
        }

        /*????????????????DIAG??????????*/
        if(AT_SUCCESS == At_CheckDataState(AT_DIAG_DATA_MODE))
        {
            return AT_ERROR;
        }

        /*????AT/DIAG??????????????????*/
        gucOmDiagIndex = ucIndex;

        /* ????OAM??????DIAG??????OAM????????DIAG???????????? */
        if (AT_USB_COM_PORT_NO == gastAtClientTab[ucIndex].ucPortNo)
        {
            /*CBTCPM_NotifyChangePort(AT_PCUI_PORT, CPM_DIAG_COMM);*/
        }
        else
        {
            /*CBTCPM_NotifyChangePort(AT_UART_PORT, CPM_DIAG_COMM);*/
        }


        /*????????????????DIAG????*/
        At_SetMode(gucOmDiagIndex, AT_DATA_MODE, AT_DIAG_DATA_MODE);

        return AT_OK;
    }

    /* Added by f62575 for B050 Project, 2012-2-3, Begin   */
    /* ????PID????NV?? */
    if (NV_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_PID_Enable_Type,
                        &stPidEnableType,
                        sizeof(AT_PID_ENABLE_TYPE_STRU)))
    {
        AT_ERR_LOG("AT_SetDislogPara:Read NV failed!");
        return AT_ERROR;
    }

    /* NV??????????????PID????????????????????????AT_OK */
    if (VOS_TRUE != stPidEnableType.ulPidEnabled)
    {
        AT_WARN_LOG("AT_SetDislogPara:PID is not enabled");
        return AT_OK;
    }
    /* Added by f62575 for B050 Project, 2012-2-3, End   */

    /* Modify by w00199382 for V7????????, 2012-04-07, Begin   */

    /* Modified by f62575 for B050 Project, 2012-2-3, Begin   */
    /*  ????DIAG??*/
    if ( AT_DISLOG_DIAG_OPEN == gastAtParaList[0].ulParaValue )
    {
        ulRet3GDiag   = AT_OpenSpecificPort(AT_DEV_DIAG);
        ulRetDiag     = AT_OpenSpecificPort(AT_DEV_4G_DIAG);
        ulRetGps      = AT_OpenSpecificPort(AT_DEV_4G_GPS);

        if((AT_OK == ulRetDiag) && (AT_OK == ulRetGps) && (AT_OK == ulRet3GDiag))
        {
            ulRet = AT_OK;
        }
        else
        {
            ulRet = AT_ERROR;
        }
        return ulRet;
    }

    /* ????DIAG?? */
    if ( AT_DISLOG_DIAG_CLOSE == gastAtParaList[0].ulParaValue )
    {
        ulRet3GDiag = AT_CloseSpecificPort(AT_DEV_DIAG);
        ulRetDiag   = AT_CloseSpecificPort(AT_DEV_4G_DIAG);
        ulRetGps    = AT_CloseSpecificPort(AT_DEV_4G_GPS);

        if((AT_OK == ulRetDiag) && (AT_OK == ulRetGps) && (AT_OK == ulRet3GDiag))
        {
            ulRet = AT_OK;
        }
        else
        {
            ulRet = AT_ERROR;
        }

        return ulRet;
    }
    /* Modified by f62575 for B050 Project, 2012-2-3, End   */

    /* Modify by w00199382 for V7????????, 2012-04-07, End   */

    return AT_ERROR;

}
/*****************************************************************************
 ?? ?? ??  : AT_SetSpwordPara
 ????????  : AT^SPWORD??????????, ????????????SHELL??????????
 ????????  : VOS_UINT8  ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??02??21??
    ??    ??   : L60609
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetSpwordPara(VOS_UINT8 ucIndex)
{
    VOS_UINT8                           i;
    DRV_AGENT_SPWORD_SET_REQ_STRU       stSpwordSetReq;

    /* ????????????????????????????????????????????????????????Error */
    if (g_stSpWordCtx.ucErrTimes >= AT_SHELL_PWD_VERIFY_MAX_TIMES)
    {
        AT_WARN_LOG("AT_SetSpwordPara:WARNING: Verify Max Times!");
        return AT_ERROR;
    }

    /* ????AT^SPWORD??????????????????????????????????????AT^SPWORD??????????????????????ERROR */
    if (VOS_TRUE == g_stSpWordCtx.ucShellPwdCheckFlag)
    {
        AT_WARN_LOG("AT_SetSpwordPara:WARNING: Not need Verified!");
        return AT_ERROR;
    }

    /* ????????????????????????????8 */
    if ((gucAtParaIndex > 1)
     || (gastAtParaList[0].usParaLen != AT_SHELL_PWD_LEN))
    {
        AT_WARN_LOG("AT_SetSpwordPara:WARNING: Parameter error!");
        return AT_ERROR;
    }

    /* ??????????????0-9 */
    for (i = 0; i < AT_SHELL_PWD_LEN; i++)
    {
        if ((gastAtParaList[0].aucPara[i] < '0')
         || (gastAtParaList[0].aucPara[i] > '9'))
        {
            AT_WARN_LOG("AT_SetSpwordPara:WARNING: PWD NOT 0-9!");
            return AT_ERROR;
        }
    }

    /* ??????????????C?????? */
    VOS_MemCpy(stSpwordSetReq.acShellPwd, (VOS_CHAR *)gastAtParaList[0].aucPara, AT_SHELL_PWD_LEN);

    if (TAF_SUCCESS == AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                              gastAtClientTab[ucIndex].opId,
                                              DRV_AGENT_SPWORD_SET_REQ,
                                              &stSpwordSetReq,
                                              sizeof(stSpwordSetReq),
                                              I0_WUEPS_PID_DRV_AGENT))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SPWORD_SET;             /*???????????????? */
        return AT_WAIT_ASYNC_RETURN;                                            /* ???????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_SetShellPara
 ????????  : ????SHELL????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??9??9??
    ??    ??   : lijun 00171473
    ????????   : ??????????
  2.??    ??   : 2010??10??14??
    ??    ??   : lijun 00171473
    ????????   : DTS2010101500405, SHEEL????NV??0??SHELL??WIFI??????1????SHELL??
                 2????SHELL
  3.??    ??   : 2012??2??21??
    ??    ??   : l60609
    ????????   : B060 Prj:????shell
*****************************************************************************/
VOS_UINT32 AT_SetShellPara ( VOS_UINT8 ucIndex )
{
    AT_SHELL_OPEN_FLAG_ENUM_U32         enTmpOpenFlag;

    /* ???????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_ERROR;
    }

    /*  WIFI????SHELL?? */
    if (AT_SHELL_WIFI_USE == gastAtParaList[0].ulParaValue)
    {
        /* ????WIFI????SHELL??????NV?? */
        enTmpOpenFlag = AT_SHELL_OPEN_FLAG_WIFI;
        if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_AT_SHELL_OPEN_FLAG, &enTmpOpenFlag,
                              sizeof(enTmpOpenFlag)))
        {
            AT_WARN_LOG("AT_SetShellPara:WARNING:NV_WriteEx SHELL_OPEN_FLAG faild!");
            return AT_ERROR;
        }

        return AT_OK;
    }

    /*  ????SHELL?? */
    if (AT_SHELL_OPEN == gastAtParaList[0].ulParaValue )
    {
        /* ????CK???????????? */
        if (g_stSpWordCtx.ucShellPwdCheckFlag != VOS_TRUE)
        {
            AT_WARN_LOG("AT_SetShellPara:WARNING:NV_WriteEx SHELL_OPEN_FLAG faild!");

            return AT_ERROR;
        }

        /* ??????????????NV?? */
        enTmpOpenFlag = AT_SHELL_OPEN_FLAG_OPEN;
        if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_AT_SHELL_OPEN_FLAG, &enTmpOpenFlag,
                              sizeof(enTmpOpenFlag)))
        {
            AT_WARN_LOG("AT_SetShellPara:WARNING:NV_WriteEx SHELL_OPEN_FLAG faild!");

            return AT_ERROR;
        }

        return AT_OK;
    }

    /*????SHELL??*/
    if ( AT_SHELL_CLOSE == gastAtParaList[0].ulParaValue )
    {
        /* ????????SHELL??????????????NV?? */
        enTmpOpenFlag = AT_SHELL_OPEN_FLAG_CLOSE;
        if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_AT_SHELL_OPEN_FLAG, &enTmpOpenFlag,
                              sizeof(enTmpOpenFlag)))
        {
            AT_WARN_LOG("AT_SetShellPara:WARNING:NV_WriteEx SHELL_OPEN_FLAG faild!");
            return AT_ERROR;
        }

        return AT_OK;
    }

    return AT_ERROR;
}

/* Add by c00172979 for V7????????, 2012-04-07, Begin   */
/* Modify by c00172979 for V7????????, 2012-04-07, End   */

/*****************************************************************************
 ?? ?? ??  : AT_SetRsrpCfgPara
 ????????  : ??????????RSRP??????????????????????????
                           ????????????
                           ????????RSCP????5??????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??4??10??
    ??    ??   : w00182550
    ????????   : ??????????

*****************************************************************************/

VOS_UINT32 AT_SetRsrpCfgPara ( VOS_UINT8 ucIndex )
{

    NVIM_RSRP_CFG_STRU stRsrpCfg;
    VOS_UINT32 RsrpLevel =0;

    PS_MEM_SET(&stRsrpCfg, 0, sizeof(stRsrpCfg));

    /* ???????? */
    if ((0 == gastAtParaList[0].usParaLen)
        || (0 == gastAtParaList[1].usParaLen)
        || (gucAtParaIndex != 2))
    {
        return AT_ERROR;
    }

    if (NV_OK != NVM_Read(EN_NV_ID_RSRP_CFG, &stRsrpCfg,
                          sizeof(stRsrpCfg)))
    {
        (VOS_VOID)vos_printf("AT_SetRsrpCfgPara:WARNING:NV_ReadEx RSRP faild!\n");
        return AT_ERROR;
    }

    /* ??????????????NV?? */
    RsrpLevel = gastAtParaList[0].ulParaValue;
    /*DTS2012041102190 : h00135900 start in 2011-04-11 AT????????*/
    stRsrpCfg.ssLevel[RsrpLevel] = (VOS_INT16)(gastAtParaList[0].ulParaValue);
    stRsrpCfg.ssValue[RsrpLevel] = (VOS_INT16)(gastAtParaList[1].ulParaValue);
    /*DTS2012041102190 : h00135900 end in 2011-04-11 AT????????*/
    if(g_enATE5RightFlag == AT_E5_RIGHT_FLAG_YES)
    {
        if(NV_OK != NVM_Write(EN_NV_ID_RSRP_CFG, &stRsrpCfg,
                          sizeof(stRsrpCfg)))
        {
            (VOS_VOID)vos_printf("AT_SetRsrpCfgPara:WARNING:NV_WriteEx RSRP faild!\n");
            return AT_ERROR;
        }
    }
    else
    {
        return AT_ERROR; /* ????????????????????ERROR */
    }

    return AT_OK;
}

 /* Add by c00172979 for V7????????, 2012-04-07, Begin   */
 /* Modify by c00172979 for V7????????, 2012-04-07, End   */

/*****************************************************************************
 ?? ?? ??  : AT_SetRscpCfgPara
 ????????  : ??????????RSCP????????????????????RSCP??????
                           ??????????????????????????????????????????
                           ????????RSCP????5??????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??4??10??
    ??    ??   : w00182550
    ????????   : ??????????

*****************************************************************************/

VOS_UINT32 AT_SetRscpCfgPara ( VOS_UINT8 ucIndex )
{
    NVIM_RSCP_CFG_STRU stRscpCfg;
    VOS_UINT32 RscpLevel =0;

    PS_MEM_SET(&stRscpCfg, 0, sizeof(stRscpCfg));

    /* ???????? */
    if ((0 == gastAtParaList[0].usParaLen)
        || (0 == gastAtParaList[1].usParaLen)
        || (gucAtParaIndex != 2))
    {
            (VOS_VOID)vos_printf("RSCP????????????\n");
        return AT_ERROR;
    }

    if (NV_OK != NVM_Read(EN_NV_ID_RSCP_CFG, &stRscpCfg,
                          sizeof(stRscpCfg)))
    {
        (VOS_VOID)vos_printf("RSCP read error!\n");
        return AT_ERROR;
    }

    /* ??????????????NV?? */
    RscpLevel = gastAtParaList[0].ulParaValue;
    /*DTS2012041102190 : h00135900 start in 2011-04-11 AT????????*/
    stRscpCfg.ssLevel[RscpLevel] = (VOS_INT16)(gastAtParaList[0].ulParaValue);
    stRscpCfg.ssValue[RscpLevel] = (VOS_INT16)(gastAtParaList[1].ulParaValue);
    /*DTS2012041102190 : h00135900 end in 2011-04-11 AT????????*/
    if(g_enATE5RightFlag == AT_E5_RIGHT_FLAG_YES)
    {
        if (NV_OK != NVM_Write(EN_NV_ID_RSCP_CFG, &stRscpCfg,
                          sizeof(stRscpCfg)))
        {
            (VOS_VOID)vos_printf("????RSCP????????????NV \n");
            return AT_ERROR;
        }
    }
    else
    {
        (VOS_VOID)vos_printf("RSCP????????????\n");
        return AT_ERROR; /* ????????????????????ERROR */
    }

    return AT_OK;
}
 /* Add by c00172979 for V7????????, 2012-04-07, Begin   */
 /* Modify by c00172979 for V7????????, 2012-04-07, End   */

/*****************************************************************************
 ?? ?? ??  : AT_SetEcioCfgPara
 ????????  : ????ECIO????????????????????????????????????
                           ????????RSCP????5??????????????????

 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??4??10??
    ??    ??   : w00182550
    ????????   : ??????????

*****************************************************************************/

VOS_UINT32 AT_SetEcioCfgPara ( VOS_UINT8 ucIndex )
{
    NVIM_ECIO_CFG_STRU stEcioCfg;
    VOS_UINT32 EcioLevel =0;

    PS_MEM_SET(&stEcioCfg, 0, sizeof(stEcioCfg));

    /* ???????? */
    if ((0 == gastAtParaList[0].usParaLen)
        || (0 == gastAtParaList[1].usParaLen)
        || (gucAtParaIndex != 2))
    {
            (VOS_VOID)vos_printf("ECIO????????????\n");
        return AT_ERROR;
    }

    if (NV_OK != NVM_Read(EN_NV_ID_ECIO_CFG, &stEcioCfg,
                          sizeof(stEcioCfg)))
    {
            (VOS_VOID)vos_printf("ECIO read ????\n");
        return AT_ERROR;
    }

    /* ??????????????NV?? */
    EcioLevel = gastAtParaList[0].ulParaValue;
    /*DTS2012041102190 : h00135900 start in 2011-04-11 AT????????*/
    stEcioCfg.ssLevel[EcioLevel] = (VOS_INT16)(gastAtParaList[0].ulParaValue);
    stEcioCfg.ssValue[EcioLevel] = (VOS_INT16)(gastAtParaList[1].ulParaValue);
    /*DTS2012041102190 : h00135900 end in 2011-04-11 AT????????*/
    if(g_enATE5RightFlag == AT_E5_RIGHT_FLAG_YES)
    {
        if (NV_OK != NVM_Write(EN_NV_ID_ECIO_CFG, &stEcioCfg,
                          sizeof(stEcioCfg)))
        {
                (VOS_VOID)vos_printf("ECIO????????\n");
            return AT_ERROR;
        }
    }
    else
    {
        (VOS_VOID)vos_printf("ECIO??????????????\n");
        return AT_ERROR; /* ????????????????????ERROR */
    }

    return AT_OK;
}


/*****************************************************************************
 Prototype      : AT_SetPdprofmodPara
 Description    : ^PDPROFMOD=<cid>[,<PDP_type>[<APN>[,<passwd>[,<username>[,<Auth_type>]]]]]
                      ??????????????PDP profile??
                      PDP??????APN??????????????????????????????
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2012-03-12
    Author      : x00126983
    Modification: Created function
*****************************************************************************/
 /* Add by c00172979 for V7????????, 2012-04-07, Begin   */
 /* Modify by c00172979 for V7????????, 2012-04-07, End   */

VOS_UINT32 AT_SetPdprofmodPara(VOS_UINT8 ucIndex)
{
    TAF_PDP_PROFILE_EXT_STRU    stPdpProfInfo;

    PS_MEM_SET(&stPdpProfInfo, 0, sizeof(TAF_PDP_PROFILE_EXT_STRU));

    /* ????????????????????OK */
    if ( AT_CMD_OPT_SET_CMD_NO_PARA == g_stATParseCmd.ucCmdOptType )
    {
        return AT_OK;
    }

    /* ???????? */
    if ( 0 == gastAtParaList[0].usParaLen )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( gucAtParaIndex > 6 )
    {
        return AT_TOO_MANY_PARA;
    }

    stPdpProfInfo.ucCid                 = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ????????????<CID>, ???????????????? */
    if ( 1 == gucAtParaIndex )
    {
        stPdpProfInfo.ucDefined         = VOS_FALSE;
    }
    else
    {
        stPdpProfInfo.ucDefined         = VOS_TRUE;

        /* ????<PDP_type> */
        if ( 0 != gastAtParaList[1].usParaLen )
        {
            if ( gastAtParaList[1].ulParaValue < TAF_PDP_PPP )
            {
                stPdpProfInfo.bitOpPdpType   = VOS_TRUE;

                /* IP:1, IPV6:2, IPV4V6:3, PPP:4 */
                stPdpProfInfo.enPdpType  = (VOS_UINT8)(gastAtParaList[1].ulParaValue + 1);

            }
        }
        /* ??????????????????<PDP_type>??????""(????????)??,????????????????
           ??g_TafCidTab[ucCid].ucUsed???????????????????????????????????????? */

        /* ????<APN> */
        if ( gastAtParaList[2].usParaLen > TAF_MAX_APN_LEN )
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        if ( 0 != gastAtParaList[2].usParaLen )
        {
            /* ???? */
            if ( VOS_OK != AT_CheckApnFormat(gastAtParaList[2].aucPara,
                                             gastAtParaList[2].usParaLen) )
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }

            stPdpProfInfo.bitOpApn       = VOS_TRUE;
            PS_MEM_CPY((VOS_CHAR*)stPdpProfInfo.aucApn,
                       (VOS_CHAR*)gastAtParaList[2].aucPara,
                       gastAtParaList[2].usParaLen);
            stPdpProfInfo.aucApn[gastAtParaList[2].usParaLen] = 0;
        }

        /* ????<username> */
        if ( gastAtParaList[3].usParaLen > TAF_MAX_AUTHDATA_USERNAME_LEN )
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        if(0 != gastAtParaList[3].usParaLen)
        {
            stPdpProfInfo.bitOpUsername = VOS_TRUE;

            PS_MEM_CPY((VOS_CHAR*)stPdpProfInfo.aucUserName,
                       (VOS_CHAR*)gastAtParaList[3].aucPara,
                       gastAtParaList[3].usParaLen);
            stPdpProfInfo.aucUserName[gastAtParaList[3].usParaLen] = 0;
        }

        /* ????<passwd> */
        if ( gastAtParaList[4].usParaLen > TAF_MAX_AUTHDATA_PASSWORD_LEN )
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        if ( 0 != gastAtParaList[4].usParaLen )
        {
            stPdpProfInfo.bitOpPassword = VOS_TRUE;

            PS_MEM_CPY((VOS_CHAR*)stPdpProfInfo.aucPassWord,
                       (VOS_CHAR*)gastAtParaList[4].aucPara,
                       gastAtParaList[4].usParaLen);
            stPdpProfInfo.aucPassWord[gastAtParaList[4].usParaLen] = 0;
        }

        /* ????<Auth_type> */
        if ( 0 != gastAtParaList[5].usParaLen )
        {
            stPdpProfInfo.bitOpAuthType = VOS_TRUE;
            stPdpProfInfo.ucAuthType        = (VOS_UINT8)gastAtParaList[5].ulParaValue;
        }

    }

    /* ???????????? */
    if ( VOS_OK != TAF_PS_SetPdpProfInfo( WUEPS_PID_AT,
                                          AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                          0, &stPdpProfInfo))
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_PDPROFMOD_SET;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : At_SetPsProtectModePara
 ????????  : ????^PSPROTECTMODE??????
             ????????:^PSPROTECTMODE=<ps_protect_mode>

 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2014??3??24??
    ??    ??   : y00176023
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 At_SetPsProtectModePara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;
    AT_MTA_RRC_PROTECT_PS_REQ_STRU      stPsProtectSetPara;

    /* ?????????? */
    VOS_MemSet(&stPsProtectSetPara, 0, sizeof(AT_MTA_RRC_PROTECT_PS_REQ_STRU));

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_TOO_MANY_PARA;
    }

    /* ???????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    stPsProtectSetPara.enPsProtectFlg = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ??MTA????????????PS PROTECT */
    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   At_GetOpId(),
                                   ID_AT_MTA_RRC_PROTECT_PS_REQ,
                                   (VOS_VOID*)(&stPsProtectSetPara),
                                   sizeof(stPsProtectSetPara),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_PSPROTECTMODE_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }

}

/*****************************************************************************
 ?? ?? ??  : At_SetPhyInitPara
 ????????  : ????^PHYINIT??????
             ????????:^PHYINIT

 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2014??3??24??
    ??    ??   : y00176023
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 At_SetPhyInitPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;
    AT_MTA_PHY_INIT_REQ_STRU            stPhyInit;

    /* ?????????? */
    VOS_MemSet(&stPhyInit, 0, sizeof(AT_MTA_PHY_INIT_REQ_STRU));

    /* ???????? */
    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (gucAtParaIndex > 0)
    {
        return AT_TOO_MANY_PARA;
    }

    /* ??MTA???????????????????????? */
    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   At_GetOpId(),
                                   ID_AT_MTA_PHY_INIT_REQ,
                                   (VOS_VOID*)(&stPhyInit),
                                   sizeof(stPhyInit),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_PHYINIT_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }

}



/* Added by f62575 for SMALL IMAGE, 2012-1-3, begin   */
/*****************************************************************************
 ?? ?? ??  : AT_SetWifiGlobalMacPara
 ????????  : ????????MAC????,??????XX:XX:XX:XX:XX:XX
 ????????  : ucIndex - AT????????
 ????????  : ??
 ?? ?? ??  : AT_OK    - ????
             AT_ERROR - ????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??9??9??
    ??    ??   : z00161729
    ????????   : ??????????
  2.??    ??   : 2010??11??9??
    ??    ??   : s62952
    ????????   : ???????? :DTS2010110403564,MAC??????????E5mac??????
  3.??    ??   : 2011??11??15??
    ??    ??   : ??????/f62575
    ????????   : E5????????????????????
*****************************************************************************/
VOS_UINT32 AT_SetWifiGlobalMacPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRet;
    /* Added by ??????/f62575 for E5????????????????????, 2011/11/15, begin */
    VOS_UINT8                           aucE5GwMacAddr[AT_MAC_ADDR_LEN+1]; /* MAC????*/

    if (gucAtParaIndex != 1)
    {
        AT_NORM_LOG("AT_SetApMacPara: the number of parameters is error.");
        return AT_ERROR;
    }

    if (gastAtParaList[0].usParaLen > AT_MAC_ADDR_LEN )
    {
        return AT_ERROR;
    }

    PS_MEM_SET(aucE5GwMacAddr, 0x00, sizeof(aucE5GwMacAddr));

    /* ??MAC??????????NV */
    VOS_StrNCpy( (VOS_CHAR *)aucE5GwMacAddr, (VOS_CHAR *)gastAtParaList[0].aucPara,
                gastAtParaList[0].usParaLen );


    ulRet = NV_WriteEx(MODEM_ID_0, en_NV_Item_WIFI_MAC_ADDR, aucE5GwMacAddr, AT_MAC_ADDR_LEN);
    /* Added by ??????/f62575 for E5????????????????????, 2011/11/15, end */

    if (NV_OK != ulRet)
    {
        AT_WARN_LOG("AT_SetApMacPara: Fail to write nv.");
        return AT_ERROR;
    }

    return AT_OK;
}
/* Added by f62575 for SMALL IMAGE, 2012-1-3, end   */

/* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
/*****************************************************************************
 ?? ?? ??  : AT_SetDockPara
 ????????  : ????????????????????PCUI????????DOCK
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_INT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??9??10??
    ??    ??   : A00165503
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetDockPara (VOS_UINT8 ucIndex)
{
    VOS_UINT8                           ucClientIndex;
    VOS_UINT16                          usLength;

    usLength = 0;

    if (AT_APP_USER != gastAtClientTab[ucIndex].UserType )
    {
        return AT_FAILURE;
    }

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_FAILURE;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_FAILURE;
    }

    /* ???????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_FAILURE;
    }

    VOS_MemSet(gastAtParaList[0].aucPara + gastAtParaList[0].usParaLen,
               0x00,
               (VOS_SIZE_T)(AT_PARA_MAX_LEN - gastAtParaList[0].usParaLen));

    for (ucClientIndex = 0 ; ucClientIndex < AT_MAX_CLIENT_NUM; ucClientIndex++)
    {
        if (AT_USBCOM_USER == gastAtClientTab[ucClientIndex].UserType)
        {
            usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                        (VOS_CHAR *)pgucAtSndCodeAddr,
                                        (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                        "%s%s%s",
                                        gaucAtCrLf,
                                        gastAtParaList[0].aucPara,
                                        gaucAtCrLf);
            At_SendResultData(ucClientIndex, pgucAtSndCodeAddr, usLength);
            break;
        }
    }

    return AT_SUCCESS;
}
/* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, end */

/*****************************************************************************
 ?? ?? ??  : AT_SetCsqlvlPara
 ????????  : ????????????????(autochecker????????)??????RSCP ??????RSCP ????????
 ????????  : ??
 ????????  : ??
 ?? ?? ??  : VOS_VOID
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??11??06??
    ??    ??   : lijun 00171473
    ????????   : ??????????
  2.??    ??   : 2011??10??4??
    ??    ??   : f62575
    ????????   : AT Project  ??????????????????C????????????????????API????????????????

  3.??    ??   : 2015??3??28??
    ??    ??   : y00322978
    ????????   : csqlvl ????????????????????

  4.??    ??   : 2015??12??25??
    ??    ??   : n00355355
    ????????   : Chicago????????WCDMA??????AT????????MTA????????
*****************************************************************************/
VOS_UINT32 AT_SetCsqlvlPara( VOS_UINT8 ucIndex )
{
    VOS_UINT32                              ulResult;

    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_CSQLVL_QRY_REQ,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_UEPS_PID_MTA);
    if (AT_SUCCESS == ulResult)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CSQLVL_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        AT_WARN_LOG("AT_SetCsqlvlPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

}

/*****************************************************************************
 ?? ?? ??  : AT_SetCsqlvlExtPara
 ????????  : E5???????????????????????? ^CSQLVLEXT????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??2??14??
    ??    ??   : ??????/f62575
    ????????   : ??????????

  2.??    ??   : 2015??3??28??
    ??    ??   : y00322978
    ????????   : csqlvlext ????????????????????

  3.??    ??   : 2015??12??25??
    ??    ??   : n00355355
    ????????   : Chicago????????WCDMA??????AT????????MTA????????
*****************************************************************************/
VOS_UINT32  AT_SetCsqlvlExtPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                              ulResult;

    /* ???????? */
    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_CSQLVL_QRY_REQ,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_UEPS_PID_MTA);

    if (AT_SUCCESS == ulResult)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CSQLVLEXT_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        AT_WARN_LOG("AT_SetCsqlvlExtPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

}

/*****************************************************************************
 ?? ?? ??  : AT_SetApbatlvlPara
 ????????  : ??????????????????????
 ????????  : ??
 ????????  : ??
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??11??6??
    ??    ??   : lijun 00171473
    ????????   : ??????????
  2.??    ??   : 2011??10??17??
    ??    ??   : ??????/f62575
    ????????   : AT PROJECT
  3.??    ??   : 2012??03??13??
    ??    ??   : w00199382
    ????????   : DTS2012031301575
  4.??    ??   : 2012??04??11??
    ??    ??   : w00199382
    ????????   : v7AT????????
*****************************************************************************/
VOS_UINT32 AT_SetApbatlvlPara( VOS_UINT8 ucIndex )
{
    BATT_STATE_S                        stBatLvl;
    VOS_UINT32                          ucChargeState;


    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    if (BSP_MODULE_UNSUPPORT == mdrv_misc_support_check(BSP_MODULE_TYPE_CHARGE) )
    {
        return AT_ERROR;
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, end */

     /* Add by w00199382 for V7????????, 2012-04-07, Begin   */
    /*Arguments found, return error.*/
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        (VOS_VOID)vos_printf("AT^APBATLVL arguments found, return error!!\r\n ");
        return AT_CME_INCORRECT_PARAMETERS;
    }
    /* Add by w00199382 for V7????????, 2012-04-07, End   */

    /* ???????????????????? */
    if ( VOS_OK != mdrv_misc_get_battery_state( &stBatLvl ) )
    {
        return AT_ERROR;
    }

    /* ???????????????????? */
    if ( (stBatLvl.charging_state == CHARGING_UP)
      || (stBatLvl.charging_state == CHARGING_DOWN) )
    {
        ucChargeState = 1;
    }
    else if ( (stBatLvl.charging_state == NO_CHARGING_UP)
           || (stBatLvl.charging_state == NO_CHARGING_DOWN) )
    {
        ucChargeState = 0;
    }
    else
    {
        return AT_ERROR;
    }

    /* ?????????????????? */
    if ( (stBatLvl.battery_level < BATT_LOW_POWER)
       ||(stBatLvl.battery_level >= BATT_LEVEL_MAX))
    {
        return AT_ERROR;
    }

    gstAtSendData.usBufLen = (TAF_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                                    (TAF_CHAR*)pgucAtSndCodeAddr,
                                                    (TAF_CHAR*)pgucAtSndCodeAddr,
                                                    "%s:%d,%d",
                                                    g_stParseContext[ucIndex].pstCmdElement->pszCmdName,
                                                    ucChargeState,
                                                    stBatLvl.battery_level);

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetOpenportPara
 ????????  : OPENPORT??????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??12??25??
    ??    ??   : lijun 00171473
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetOpenportPara( VOS_UINT8 ucIndex )
{
    /* ????????????OPENPORT, ????????????????????????OPENPORT,????????OK
       ????????????????????, ??????????OK */
    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_CheckNdisIpv4AddrPara
 ????????  : ????NdisAddr????????????
 ????????  : VOS_UINT8* pData
             VOS_UINT16 usLen
 ????????  : AT_OK
             AT_ERROR
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??6??01??
    ??    ??   : s62952
    ????????   : ??????????
  1.??    ??   : 2010??10??28??
    ??    ??   : w00166186
    ????????   : VDF??????????????????????????????

*****************************************************************************/
VOS_UINT32  At_CheckNdisIpv4AddrPara(
    VOS_UINT8                          *pData,
    VOS_UINT16                          usLen)
{
    VOS_UINT32                          i;
    VOS_UINT32                          usTemp;
    VOS_UINT8                           ucDotNum;
    VOS_UINT8                           ucNNUM;

    usTemp      = 0;
    ucDotNum    = 0;
    ucNNUM      = 0;

    for (i = 0; i < usLen; i++)
    {
        if ('.' == pData[i])
        {
            if ((usTemp > 255) || (ucNNUM > 3) || (ucNNUM == 0))
            {
                return  AT_ERROR;
            }
            usTemp = 0;
            ucNNUM = 0;
            ucDotNum++;
        }
        else if ( (pData[i] >= '0') && (pData[i] <= '9') )
        {
            ucNNUM++;
            usTemp = (usTemp*10) + (pData[i]-'0');
        }
        else
        {
            return  AT_ERROR;
        }
    }

    if ((ucDotNum != 3) || (usTemp > 255) || (ucNNUM > 3) || (ucNNUM == 0))
    {
        return AT_ERROR;
    }

    return  AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_NdisIpv4AddParaProc
 ????????  : ????NdisAddr????????????
 ????????  : VOS_UINT8* pData
             VOS_UINT16 usLen
 ????????  : AT_OK
             AT_ERROR
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??6??01??
    ??    ??   : s62952
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32  At_NdisIpv4AddParaProc(
    VOS_UINT8                          *pData,
    VOS_UINT16                          usLen,
    VOS_UINT8                          *pDesData,
    VOS_UINT32                         *pulFlag
)
{
    if (0 == usLen)
    {
        AT_INFO_LOG("At_NdisIpv4AddParaProc: Address isn't present.");
        *pulFlag = VOS_FALSE;
        return AT_SUCCESS;
    }
    else
    {
         /*???????????????? */
        if(AT_ERROR == At_CheckNdisIpv4AddrPara(pData,usLen))
        {
            AT_WARN_LOG("At_NdisIpv4AddParaProc:the para is error.");
            return AT_CME_INCORRECT_PARAMETERS;
        }

        if (usLen > AT_NDIS_ADDR_PARA_LEN)
        {
            AT_WARN_LOG("At_NdisIpv4AddParaProc: length of IP_Address is beyond 15.");
            return AT_CME_INCORRECT_PARAMETERS;
        }
        PS_MEM_SET(pDesData, 0, (AT_NDIS_ADDR_PARA_LEN + 1));
        PS_MEM_CPY(pDesData, pData, usLen);
    }

    *pulFlag = VOS_TRUE;

    return AT_SUCCESS;
}

/*****************************************************************************
 ?? ?? ??  : At_SetDnsPrim
 ????????  : ????NDIS????DNS??????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??10??27??
    ??    ??   : ????/00166186
    ????????   : ??????????

  2.??    ??   : 2011??05??09??
    ??    ??   : ????/00180552
    ????????   : IPV6????????IPV6DNS????

  3.??    ??   : 2011??08??18??
    ??    ??   : A00165503
    ????????   : ????????: DTS2011081400480, ^DNSP??^DNSS????????HiLink????
  4.??    ??   : 2011??12??12??
    ??    ??   : L00171473
    ????????   : ????????: DTS2011110807367, ????PCUI??????NDIS????????(????????
                 ??PCUI??????NDIS????)
  5.??    ??   : 2012??03??20??
    ??    ??   : f00179208
    ????????   : ????????: DTS2012031400837, ????????????CMD????????ipconfig /all
                 ??????????DNS??????????????
  6.??    ??   : 2012??03??20??
    ??    ??   : f00179208
    ????????   : ????????: DTS2012040702217, ??????????????
*****************************************************************************/
VOS_UINT32  At_SetDnsPrim(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;
    AT_DIAL_PARAM_STRU                 *pstAppDialPara;

    pstAppDialPara                      = AT_APP_GetDailParaAddr();

    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    if (1 != gucAtParaIndex)
    {
        AT_WARN_LOG("At_SetDnsPrim: too many parameters.");
        return AT_ERROR;
    }

    if (AT_APP_USER == gastAtClientTab[ucIndex].UserType)
    {
        /* ????IPV4<Primary_DNS>???? */
        ulRst = At_NdisIpv4AddParaProc(gastAtParaList[0].aucPara,
                                       gastAtParaList[0].usParaLen,
                                       pstAppDialPara->aucPrimIPv4DNSAddr,
                                       &pstAppDialPara->ulPrimIPv4DNSValidFlag);
        if (AT_SUCCESS != ulRst)
        {
            pstAppDialPara->ulPrimIPv4DNSValidFlag  = VOS_FALSE;
            PS_MEM_SET(pstAppDialPara->aucPrimIPv4DNSAddr, 0x00, TAF_MAX_IPV4_ADDR_STR_LEN);
            AT_INFO_LOG("At_SetDnsPrim: IPV4 Primary_DNS isn't present.");
            return ulRst;
        }

        return AT_OK;
    }
    /* ????IPV4<Primary_DNS>???? */
    ulRst = At_NdisIpv4AddParaProc(gastAtParaList[0].aucPara,
                                   gastAtParaList[0].usParaLen,
                                   gstAtNdisAddParam.aucPrimIPv4DNSAddr,
                                   &gstAtNdisAddParam.ulPrimIPv4DNSValidFlag);
    if (AT_SUCCESS != ulRst)
    {
        gstAtNdisAddParam.ulPrimIPv4DNSValidFlag = 0;
        PS_MEM_SET(gstAtNdisAddParam.aucPrimIPv4DNSAddr, 0, (AT_NDIS_ADDR_PARA_LEN + 1));
        AT_INFO_LOG("At_SetDnsPrim: IPV4 Primary_DNS isn't present.");
        return ulRst;
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetDnsSnd
 ????????  : ????NDIS??DNS????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??10??27??
    ??    ??   : ????/00166186
    ????????   : ??????????

  2.??    ??   : 2011??05??09??
    ??    ??   : ????/00180552
    ????????   : IPV6????????IPV6DNS????

  3.??    ??   : 2011??08??18??
    ??    ??   : A00165503
    ????????   : ????????: DTS2011081400480, ^DNSP??^DNSS????????HiLink????
  4.??    ??   : 2012??03??20??
    ??    ??   : f00179208
    ????????   : ????????: DTS2012031400837, ????????????CMD????????ipconfig /all
                 ??????????DNS??????????????
  5.??    ??   : 2012??03??20??
    ??    ??   : f00179208
    ????????   : ????????: DTS2012040702217, ??????????????
*****************************************************************************/
VOS_UINT32  At_SetDnsSnd(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;
    AT_DIAL_PARAM_STRU                 *pstAppDialPara;

    pstAppDialPara                      = AT_APP_GetDailParaAddr();

    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    if (1 != gucAtParaIndex)
    {
        AT_WARN_LOG("At_SetDnsSnd: too many parameters.");
        return AT_ERROR;
    }

    if (AT_APP_USER == gastAtClientTab[ucIndex].UserType)
    {
        /* ????IPV4<Secondary_DNS>???? */
        ulRst = At_NdisIpv4AddParaProc(gastAtParaList[0].aucPara,
                                       gastAtParaList[0].usParaLen,
                                       pstAppDialPara->aucSndIPv4DNSAddr,
                                       &pstAppDialPara->ulSndIPv4DNSValidFlag);
        if (AT_SUCCESS != ulRst)
        {
            pstAppDialPara->ulSndIPv4DNSValidFlag   = VOS_FALSE;
            PS_MEM_SET(pstAppDialPara->aucSndIPv4DNSAddr, 0x00, TAF_MAX_IPV4_ADDR_STR_LEN);
            AT_INFO_LOG("At_SetDnsSnd: IPV4 Secondary_DNS isn't present.");
            return ulRst;
        }

        return AT_OK;
    }

    /* ????IPV4<Secondary_DNS>???? */
    ulRst = At_NdisIpv4AddParaProc(gastAtParaList[0].aucPara,
                               gastAtParaList[0].usParaLen,
                               gstAtNdisAddParam.aucSndIPv4DNSAddr,
                              &gstAtNdisAddParam.ulSndIPv4DNSValidFlag);
    if (AT_SUCCESS != ulRst)
    {
        gstAtNdisAddParam.ulSndIPv4DNSValidFlag = 0;
        PS_MEM_SET(gstAtNdisAddParam.aucSndIPv4DNSAddr, 0, (AT_NDIS_ADDR_PARA_LEN + 1));
        AT_INFO_LOG("At_SetDnsSnd: IPV4 Secondary_DNS isn't present.");
        return ulRst;
    }

    return AT_OK;
}


/*****************************************************************************
 ?? ?? ??  : AT_CheckIpv6Capability
 ????????  : ????????????????????PDP??????PDP????
 ????????  : ucPdpType - PDP????
 ????????  : VOS_ERR   - ??????PDP????????
             VOS_OK    - ??????PDP????????
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??6??10??
    ??    ??   : S62952
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_CheckIpv6Capability(
    VOS_UINT8                           ucPdpType
)
{
    switch (AT_GetIpv6Capability())
    {
        case AT_IPV6_CAPABILITY_IPV4_ONLY:
            /* IPv4 only????????IPv4??PDP???? */
            if (TAF_PDP_IPV4 != ucPdpType)
            {
                AT_ERR_LOG("AT_CheckIpv6Capablity: Only IPv4 is supported!");
                return VOS_ERR;
            }
            break;

        case AT_IPV6_CAPABILITY_IPV6_ONLY:
            /* IPv6 only????????IPv6??PDP???? */
            if (TAF_PDP_IPV6 != ucPdpType)
            {
                AT_ERR_LOG("AT_CheckIpv6Capablity: Only IPv6 is supported!");
                return VOS_ERR;
            }
            break;

        default:
            break;
    }

    return VOS_OK;
}


/*****************************************************************************
 ?? ?? ??  : At_SetNdisAddPara
 ????????  : ????NDIS??????????,????????????IPV4
 ????????  : VOS_UINT8 ucIndex
 ????????  : AT_OK
             AT_ERROR
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??6??01??
    ??    ??   : s62952
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32  At_SetNdisAddPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;

    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    if (gucAtParaIndex > 6)
    {
        AT_WARN_LOG("At_SetNdisAddPara: too many parameters.");
        return AT_TOO_MANY_PARA;
    }

    PS_MEM_SET(&gstAtNdisAddParam, 0, sizeof(AT_DIAL_PARAM_STRU));

    /* ????<IP_Type>???? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        AT_WARN_LOG("At_SetNdisAddPara: IP_Type isn't present.");
        return AT_CME_INCORRECT_PARAMETERS;
    }
    else
    {
        /*0:IPV4   1:IPV6??2:IPV4V6*/
        if (0 == gastAtParaList[0].ulParaValue)
        {
            gstAtNdisAddParam.enPdpType = TAF_PDP_IPV4;
        }
        else if (1 == gastAtParaList[0].ulParaValue)
        {
            gstAtNdisAddParam.enPdpType = TAF_PDP_IPV6;
        }
        else if (2 == gastAtParaList[0].ulParaValue )
        {
            gstAtNdisAddParam.enPdpType = TAF_PDP_IPV4V6;
        }
        else
        {
            AT_WARN_LOG("At_SetNdisAddPara: IP_Type isn't valid.");
            return AT_ERROR;
        }
    }

    gstAtNdisAddParam.ucPdpTypeValidFlag = VOS_TRUE;

    /* ????<IP_Address>???? */
    ulRst = At_NdisIpv4AddParaProc(gastAtParaList[1].aucPara,
                                   gastAtParaList[1].usParaLen,
                                   gstAtNdisAddParam.aucIPv4Addr,
                                   &gstAtNdisAddParam.ulIPv4ValidFlag);
    if (AT_SUCCESS != ulRst)
    {
        PS_MEM_SET(&gstAtNdisAddParam, 0, sizeof(AT_DIAL_PARAM_STRU));
        AT_INFO_LOG("At_SetNdisAddPara: IP_Address isn't present.");
        return ulRst;
    }


    /* ????<Primary_DNS>???? */
    ulRst = At_NdisIpv4AddParaProc(gastAtParaList[2].aucPara,
                                   gastAtParaList[2].usParaLen,
                                   gstAtNdisAddParam.aucPrimIPv4DNSAddr,
                                   &gstAtNdisAddParam.ulPrimIPv4DNSValidFlag);
    if (AT_SUCCESS != ulRst)
    {
        PS_MEM_SET(&gstAtNdisAddParam, 0, sizeof(AT_DIAL_PARAM_STRU));
        AT_INFO_LOG("At_SetNdisAddPara: Primary_DNS isn't present.");
        return ulRst;
    }


    /* ????<Secondary_DNS>???? */
    ulRst = At_NdisIpv4AddParaProc(gastAtParaList[3].aucPara,
                                   gastAtParaList[3].usParaLen,
                                   gstAtNdisAddParam.aucSndIPv4DNSAddr,
                                   &gstAtNdisAddParam.ulSndIPv4DNSValidFlag);
    if (AT_SUCCESS != ulRst)
    {
        PS_MEM_SET(&gstAtNdisAddParam, 0, sizeof(AT_DIAL_PARAM_STRU));
        AT_WARN_LOG("At_NdisConnProc: length of password is beyond 255.");
        return AT_CME_INCORRECT_PARAMETERS;
    }


    /* ????<Primary_NBNS>???? */
    ulRst = At_NdisIpv4AddParaProc(gastAtParaList[4].aucPara,
                                   gastAtParaList[4].usParaLen,
                                   gstAtNdisAddParam.aucPrimIPv4WINNSAddr,
                                   &gstAtNdisAddParam.ulPrimIPv4WINNSValidFlag);
    if (AT_SUCCESS != ulRst)
    {
        PS_MEM_SET(&gstAtNdisAddParam, 0, sizeof(AT_DIAL_PARAM_STRU));
        AT_INFO_LOG("At_SetNdisAddPara: Primary_NBNS isn't present.");
        return ulRst;
    }

    /* ????<Secondary_NBNS>???? */
    ulRst = At_NdisIpv4AddParaProc(gastAtParaList[5].aucPara,
                                   gastAtParaList[5].usParaLen,
                                   gstAtNdisAddParam.aucSndIPv4WINNSAddr,
                                   &gstAtNdisAddParam.ulSndIPv4WINNSValidFlag);
    if (AT_SUCCESS != ulRst)
    {
        PS_MEM_SET(&gstAtNdisAddParam, 0, sizeof(AT_DIAL_PARAM_STRU));
        AT_INFO_LOG("At_SetNdisAddPara: Secondary_NBNS isn't present.");
        return ulRst;
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_NidsCheckDialParam
 ????????  : ????NDIS????????
 ????????  : ??
 ????????  : ??
 ?? ?? ??  : VOS_OK
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??3??
    ??    ??   : S62952
    ????????   : ??????????
  2.??    ??   : 2012??4??5??
    ??    ??   : c00173809
    ????????   : DTS2012040105569??NDISDUP????????????????APN????????????CGDCONT????????????????????APN
  3.??    ??   : 2012??4??24??
    ??    ??   : s62952
    ????????   : DTS2012031401163,APN??????????????????????????

*****************************************************************************/
VOS_UINT32 AT_NidsCheckDialParam(VOS_VOID)
{
    if (gucAtParaIndex > 6)
    {
        AT_NORM_LOG1("At_NdisDupProc:gucAtParaIndex=%d.\n",gucAtParaIndex);
        return AT_TOO_MANY_PARA;
    }

    /* ????CID,CID????????*/
    if (0 == gastAtParaList[0].usParaLen)
    {
        AT_INFO_LOG("At_NdisDupProc:cid not ext");
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* CID??1~31*/
    if ( (gastAtParaList[0].ulParaValue > TAF_MAX_CID)
      || (gastAtParaList[0].ulParaValue < 1) )
    {
        AT_NORM_LOG1("At_NdisDupProc:gastAtParaList[0].ulParaValue=%d\n",gastAtParaList[0].ulParaValue);
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /*??????????????????????????????????????0??1??1??????????0????????????*/
    if (0 == gastAtParaList[1].usParaLen)
    {
        AT_INFO_LOG("At_NdisDupProc:dial unknow");
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /*AT^NDISDUP=1,1*/
    if ( (1 != gastAtParaList[1].ulParaValue)
      && (0 != gastAtParaList[1].ulParaValue) )
    {
        AT_INFO_LOG("At_NdisDupProc:dial unknow");
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* APN */
    if ( gastAtParaList[2].usParaLen  > TAF_MAX_APN_LEN )
    {
        AT_WARN_LOG("AT_CheckApn: WARNING: APN len is error.");
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ( 0 != gastAtParaList[2].usParaLen )
    {
        /* ???? */
        if ( VOS_OK != AT_CheckApnFormat(gastAtParaList[2].aucPara,
                                         gastAtParaList[2].usParaLen) )
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
    }

     /* User Name */
    if ( gastAtParaList[3].usParaLen > TAF_MAX_GW_AUTH_USERNAME_LEN )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

     /* Password */
    if ( gastAtParaList[4].usParaLen > TAF_MAX_GW_AUTH_PASSWORD_LEN )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    return AT_SUCCESS;
}

/*****************************************************************************
 ?? ?? ??  : AT_NdisFindCidForDialDown
 ????????  : ?????????????? ????????PDP
 ????????  : ??
 ????????  : ??
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??6??18??
    ??    ??   : S62952
    ????????   : ??????????

*****************************************************************************/
VOS_UINT8 AT_NdisFindCidForDialDown(VOS_VOID)
{
    /* IPv4v6 */
    if ( (AT_PDP_STATE_ACTING == g_stAtNdisDhcpPara.enIpv4v6State)
      || (AT_PDP_STATE_ACTED  == g_stAtNdisDhcpPara.enIpv4v6State) )
    {
        return g_stAtNdisDhcpPara.ucIpv4v6Cid;
    }
    else
    {
        /* IPv4 */
        if ( (AT_PDP_STATE_ACTING == g_stAtNdisDhcpPara.enIpv4State)
          || (AT_PDP_STATE_ACTED  == g_stAtNdisDhcpPara.enIpv4State) )
        {
            return g_stAtNdisDhcpPara.ucIpv4Cid;
        }

        /* IPv6 */
        if ( (AT_PDP_STATE_ACTING == g_stAtNdisDhcpPara.enIpv6State)
          || (AT_PDP_STATE_ACTED  == g_stAtNdisDhcpPara.enIpv6State) )
        {
            return g_stAtNdisDhcpPara.ucIpv6Cid;
        }
    }

    return TAF_INVALID_CID;
}

/*****************************************************************************
 ?? ?? ??  : AT_GetNdisDialParam
 ????????  : ????NDIS????????
 ????????  : ??
 ????????  : pstDialParaInfo            - ????????
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??10??18??
    ??    ??   : A00165503
    ????????   : AT Project: ????LTE????

  2.??    ??   : 2011??12??20??
    ??    ??   : c00173809
    ????????   : PS??????????IPV6????

  3.??    ??   : 2012??3??20??
    ??    ??   : A00165503
    ????????   : DTS2012031400773: WWAN????, ????????????????????, ????????
                 ????????????
  4.??    ??   : 2012??8??10??
    ??    ??   : L00171473
    ????????   : DTS2012082204471, TQE????

  5.??    ??   : 2012??12??21??
    ??    ??   : l60609
    ????????   : DSDA PhaseII
*****************************************************************************/
VOS_UINT32 AT_GetNdisDialParam(
    TAF_PS_DIAL_PARA_STRU              *pstDialParaInfo,
    VOS_UINT8                           ucIndex
)
{
    TAF_PDP_PRIM_CONTEXT_STRU                    stPdpCidInfo;
    VOS_UINT32                          ulRet;


    PS_MEM_SET(&stPdpCidInfo, 0x00, sizeof(stPdpCidInfo));


    pstDialParaInfo->ucCid      = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* Modified by l60609 for DSDA PhaseII, 2012-12-21, begin */
    ulRet = TAF_AGENT_GetPdpCidPara(&stPdpCidInfo, ucIndex, pstDialParaInfo->ucCid);
    /* Modified by l60609 for DSDA PhaseII, 2012-12-21, end */
    if (VOS_OK != ulRet)
    {
        return AT_FAILURE;
    }
    /* ????PDP???? */
    if (VOS_TRUE == gstAtNdisAddParam.ucPdpTypeValidFlag)
    {
        pstDialParaInfo->enPdpType      = gstAtNdisAddParam.enPdpType;
    }
    else if ((TAF_PDP_IPV4   == stPdpCidInfo.stPdpAddr.enPdpType)
     || (TAF_PDP_IPV6   == stPdpCidInfo.stPdpAddr.enPdpType)
     || (TAF_PDP_IPV4V6 == stPdpCidInfo.stPdpAddr.enPdpType))
    {
        pstDialParaInfo->enPdpType      = stPdpCidInfo.stPdpAddr.enPdpType;
    }
    else
    {
        /* ????????IPV4 */
        pstDialParaInfo->enPdpType      = TAF_PDP_IPV4;
    }

    if (VOS_ERR == AT_CheckIpv6Capability(pstDialParaInfo->enPdpType))
    {
        AT_INFO_LOG("AT_NidsGetDialParam:PDP type is error");
        return AT_FAILURE;
    }

    if ( 0 != gastAtParaList[2].usParaLen )
    {
        pstDialParaInfo->bitOpApn       = VOS_TRUE;

        PS_MEM_CPY((VOS_CHAR*)pstDialParaInfo->aucApn,
                   (VOS_CHAR*)gastAtParaList[2].aucPara,
                   gastAtParaList[2].usParaLen);
        pstDialParaInfo->aucApn[gastAtParaList[2].usParaLen] = 0;
    }

    if ( 0 != gastAtParaList[3].usParaLen )
    {
        pstDialParaInfo->bitOpUserName  = VOS_TRUE;

        PS_MEM_CPY((VOS_CHAR*)pstDialParaInfo->aucUserName,
                   (VOS_CHAR*)gastAtParaList[3].aucPara,
                   gastAtParaList[3].usParaLen);
        pstDialParaInfo->aucUserName[gastAtParaList[3].usParaLen] = 0;
    }

    if ( 0 != gastAtParaList[4].usParaLen )
    {
        pstDialParaInfo->bitOpPassWord  = VOS_TRUE;

        PS_MEM_CPY((VOS_CHAR*)pstDialParaInfo->aucPassWord,
                   (VOS_CHAR*)gastAtParaList[4].aucPara,
                   gastAtParaList[4].usParaLen);
        pstDialParaInfo->aucPassWord[gastAtParaList[4].usParaLen] = 0;
    }

    /* Auth Type */
    if ( gastAtParaList[5].usParaLen > 0 )
    {
        pstDialParaInfo->bitOpAuthType  = VOS_TRUE;
        pstDialParaInfo->enAuthType     = AT_CtrlGetPDPAuthType(gastAtParaList[5].ulParaValue,
                                                                gastAtParaList[5].usParaLen);
    }
    else
    {
        /* ??????????????????????????0, ????????????????, ??????????CHAP???? */
        if ( (0 != gastAtParaList[3].usParaLen)
          && (0 != gastAtParaList[4].usParaLen) )
        {
            pstDialParaInfo->bitOpAuthType = VOS_TRUE;
            pstDialParaInfo->enAuthType    = PPP_CHAP_AUTH_TYPE;
        }
    }

    return AT_SUCCESS;
}

/*****************************************************************************
 ?? ?? ??  : AT_NdisDialDownProc
 ????????  : NDIS??????????????
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : ????????
             ????????

 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??3??
    ??    ??   : S62952
    ????????   : ??????????

  2.??    ??   : 2011??07??08??
    ??    ??   : A00165503
    ????????   : AT Project: ??????????????PS CALL
  3.??    ??   : 2011??12??20??
    ??    ??   : c00173809
    ????????   : PS??????????IPV6????
  4.??    ??   : 2011??12??12??
    ??    ??   : L00171473
    ????????   : ????????: DTS2011110807367, ????PCUI??????NDIS????????(????????
                 ??PCUI??????NDIS????)
  5.??    ??   : 2012??03??06??
    ??    ??   : w00199382
    ????????   : ????????: DTS2012011304468, ????????????NDIS????????????????APS
                 ??????????????????
  6.??    ??   : 2012??3??26??
    ??    ??   : l60609
    ????????   : DTS2012032305214??????????cid????
  7.??    ??   : 2012??04??25??
    ??    ??   : s62952
    ????????   : ????????: DTS2012042101936,Ipv4v6????????????
  8.??    ??   : 2012??12??11??
    ??    ??   : l00167671
    ????????   : DTS2012121802573, TQE????

  9.??    ??   : 2013??1??14??
    ??    ??   : A00165503
    ????????   : DTS2012042104301: PCUI????????NDIS/APP????????????
*****************************************************************************/
VOS_UINT32 AT_NdisDialDownProc(
    VOS_UINT8                           ucIndex
)
{
    VOS_UINT32                          ulPdpFlag;

    ulPdpFlag = 0;

    /* ??????????PDP??????IDLE, ????OK; ??????????????DEACTING??????OK */
    if ( VOS_TRUE == AT_NdisCheckPdpIdleState() )
    {
        AT_WARN_LOG("AT_NdisDialDownProc: the state is already IDLE.");
        return AT_OK;
    }

    if ( (AT_PDP_STATE_ACTING == g_stAtNdisDhcpPara.enIpv4v6State)
          || (AT_PDP_STATE_ACTED  == g_stAtNdisDhcpPara.enIpv4v6State) )
    {
        /* AT^NDISDUP????????????????????cid????????????????ERROR */
        if (g_stAtNdisDhcpPara.ucIpv4v6Cid != gastAtParaList[0].ulParaValue)
        {
            return AT_ERROR;
        }

        ulPdpFlag = 1;

        if (VOS_OK != TAF_PS_CallEnd(WUEPS_PID_AT,
                                     AT_PS_BuildNdisExClientId(ucIndex, AT_NDIS_GET_CLIENT_ID()),
                                     0,
                                     g_stAtNdisDhcpPara.ucIpv4v6Cid))
        {
            AT_WARN_LOG("AT_NdisDialDownProc():TAF_PS_CallEnd fail");
        }

        AT_NdisSetState(TAF_PDP_IPV4V6, AT_PDP_STATE_DEACTING);
    }
    else
    {
        if ( (AT_PDP_STATE_ACTING == g_stAtNdisDhcpPara.enIpv4State)
          || (AT_PDP_STATE_ACTED  == g_stAtNdisDhcpPara.enIpv4State) )
        {
            /* AT^NDISDUP????????????????????cid????????????????ERROR */
            if (g_stAtNdisDhcpPara.ucIpv4Cid == gastAtParaList[0].ulParaValue)
            {
                ulPdpFlag = 1;
                if (VOS_OK != TAF_PS_CallEnd(WUEPS_PID_AT,
                                             AT_PS_BuildNdisExClientId(ucIndex, AT_NDIS_GET_CLIENT_ID()),
                                             0,
                                             g_stAtNdisDhcpPara.ucIpv4Cid))
                {
                    AT_WARN_LOG("AT_NdisDialDownProc():TAF_PS_CallEnd fail");
                }
                AT_NdisSetState(TAF_PDP_IPV4, AT_PDP_STATE_DEACTING);

                if ( (AT_PDP_STATE_ACTING == g_stAtNdisDhcpPara.enIpv6State)
                  || (AT_PDP_STATE_ACTED  == g_stAtNdisDhcpPara.enIpv6State) )
                {

                    if (VOS_OK != TAF_PS_CallEnd(WUEPS_PID_AT,
                                                 AT_PS_BuildNdisExClientId(ucIndex, AT_NDIS_GET_CLIENT_ID()),
                                                 0,
                                                 g_stAtNdisDhcpPara.ucIpv6Cid))
                    {
                        AT_WARN_LOG("AT_NdisDialDownProc():TAF_PS_CallEnd fail");
                    }
                    AT_NdisSetState(TAF_PDP_IPV6, AT_PDP_STATE_DEACTING);
                }
            }
        }

        if ( (AT_PDP_STATE_ACTING == g_stAtNdisDhcpPara.enIpv6State)
          || (AT_PDP_STATE_ACTED  == g_stAtNdisDhcpPara.enIpv6State) )
        {
            /* AT^NDISDUP????????????????????cid????????????????ERROR */
            if (g_stAtNdisDhcpPara.ucIpv6Cid == gastAtParaList[0].ulParaValue)
            {
                ulPdpFlag = 1;
                if (VOS_OK != TAF_PS_CallEnd(WUEPS_PID_AT,
                                             AT_PS_BuildNdisExClientId(ucIndex, AT_NDIS_GET_CLIENT_ID()),
                                             0,
                                             g_stAtNdisDhcpPara.ucIpv6Cid))
                {
                    AT_WARN_LOG("AT_NdisDialDownProc():TAF_PS_CallEnd fail");
                }
                AT_NdisSetState(TAF_PDP_IPV6, AT_PDP_STATE_DEACTING);

                if ( (AT_PDP_STATE_ACTING == g_stAtNdisDhcpPara.enIpv4State)
                  || (AT_PDP_STATE_ACTED  == g_stAtNdisDhcpPara.enIpv4State) )
                {

                    if (VOS_OK != TAF_PS_CallEnd(WUEPS_PID_AT,
                                                 AT_PS_BuildNdisExClientId(ucIndex, AT_NDIS_GET_CLIENT_ID()),
                                                 0,
                                                 g_stAtNdisDhcpPara.ucIpv4Cid))
                    {
                        AT_WARN_LOG("AT_NdisDialDownProc():TAF_PS_CallEnd fail");
                    }
                    AT_NdisSetState(TAF_PDP_IPV4, AT_PDP_STATE_DEACTING);
                }

            }
        }
    }

    if (0 == ulPdpFlag)
    {
        return AT_ERROR;
    }


    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_NDISCONN_SET;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_NdisCheckActingStateForDial
 ????????  : ????PDP????????????????
 ????????  : ??
 ????????  : ??
 ?? ?? ??  : VOS_OK
             VOS_ERR
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??6??13??
    ??    ??   : S62952
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_NdisCheckActingStateForDial(VOS_VOID )
{
    if ( (AT_PDP_STATE_IDLE == g_stAtNdisDhcpPara.enIpv4State )
      && (AT_PDP_STATE_IDLE == g_stAtNdisDhcpPara.enIpv6State )
      && (AT_PDP_STATE_IDLE == g_stAtNdisDhcpPara.enIpv4v6State ))
    {
        /* ????PDP????????, ????OK */
        return AT_OK;
    }
    else if ( (AT_PDP_STATE_ACTING == g_stAtNdisDhcpPara.enIpv4State )
           || (AT_PDP_STATE_ACTED == g_stAtNdisDhcpPara.enIpv4State )
           || (AT_PDP_STATE_ACTING == g_stAtNdisDhcpPara.enIpv6State )
           || (AT_PDP_STATE_ACTED == g_stAtNdisDhcpPara.enIpv6State )
           || (AT_PDP_STATE_ACTING == g_stAtNdisDhcpPara.enIpv4v6State )
           || (AT_PDP_STATE_ACTED == g_stAtNdisDhcpPara.enIpv4v6State ))
    {
        /* PDP????????????????, ????OK */
        return AT_SUCCESS;
    }
    else
    {
        /* PDP??????????????????, ????ERROR */
        return  AT_FAILURE;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_NdisDialUpProc
 ????????  : NDIS????????
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : ????????
             ????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??3??
    ??    ??   : S62952
    ????????   : ??????????

  2.??    ??   : 2014??5??16??
    ??    ??   : A00165503
    ????????   : DTS2014050703206: ????CID??????????????
*****************************************************************************/
VOS_UINT32 AT_NdisDialUpProc(VOS_UINT8 ucIndex)
{
    TAF_PS_DIAL_PARA_STRU               stDialParaInfo;
    AT_PS_USER_INFO_STRU                stUsrInfo;
    VOS_UINT32                          ulResult;

    /* ?????? */
    PS_MEM_SET(gstAtNdisAddParam.aucUsername, 0x00, TAF_MAX_GW_AUTH_USERNAME_LEN);
    PS_MEM_SET(gstAtNdisAddParam.aucPassword, 0x00, TAF_MAX_GW_AUTH_PASSWORD_LEN);
    PS_MEM_SET(&stDialParaInfo, 0x00, sizeof(TAF_PS_DIAL_PARA_STRU));
    PS_MEM_SET(&stUsrInfo, 0x00, sizeof(AT_PS_USER_INFO_STRU));

    /* ???????????? */
    AT_NDIS_ParseUsrInfo(ucIndex, &stUsrInfo);

    /*????????????????????????????????OK*/
    ulResult = AT_NdisCheckActingStateForDial();
    if (AT_SUCCESS == ulResult)
    {
        AT_INFO_LOG("AT_NdisDialUpProc: the state is already active or activing");
        return AT_OK;
    }

    /*????????????????????????*/
    if (AT_FAILURE == ulResult)
    {
        AT_INFO_LOG("AT_NdisDialUpProc: the state is error");
        AT_PS_SetPsCallErrCause(ucIndex, TAF_PS_CAUSE_UNKNOWN);
        return AT_ERROR;
    }

    /* ???????????? */
    ulResult = AT_GetNdisDialParam(&stDialParaInfo, ucIndex);
    if ( AT_SUCCESS != ulResult )
    {
        AT_ERR_LOG("AT_NdisDialUpProc: the PDP TYPE is not fit.");
        AT_PS_SetPsCallErrCause(ucIndex, TAF_PS_CAUSE_UNKNOWN);
        return AT_ERROR;
    }

    /* ??????????????????IPV6???? */
    gstAtNdisAddParam.usAuthType      = stDialParaInfo.enAuthType;
    gstAtNdisAddParam.ucCid           = stDialParaInfo.ucCid;
    gstAtNdisAddParam.enPdpType       = stDialParaInfo.enPdpType;

    /* ?????????? */
    gstAtNdisAddParam.usUsernameLen   = gastAtParaList[3].usParaLen;
    PS_MEM_CPY((VOS_CHAR*)gstAtNdisAddParam.aucUsername,
               (VOS_CHAR*)gastAtParaList[3].aucPara,
               gastAtParaList[3].usParaLen);

    /* ???????????? */
    gstAtNdisAddParam.usPasswordLen   = gastAtParaList[4].usParaLen;
    PS_MEM_CPY((VOS_CHAR*)gstAtNdisAddParam.aucPassword,
               (VOS_CHAR*)gastAtParaList[4].aucPara,
               gastAtParaList[4].usParaLen);

    /* APN */
    gstAtNdisAddParam.ucAPNLen        = (VOS_UINT8)gastAtParaList[2].usParaLen;
    PS_MEM_CPY((VOS_CHAR*)gstAtNdisAddParam.aucAPN,
               (VOS_CHAR*)gastAtParaList[2].aucPara,
               gastAtParaList[2].usParaLen);

    /* ???????? */
    if (VOS_OK == TAF_PS_CallOrig(WUEPS_PID_AT,
                                  AT_PS_BuildNdisExClientId(ucIndex, AT_NDIS_GET_CLIENT_ID()),
                                  0,
                                  &stDialParaInfo))
    {
        /* ???????????? */
        g_stAtNdisDhcpPara.stUsrInfo = stUsrInfo;

        if (TAF_PDP_IPV4 == stDialParaInfo.enPdpType)
        {
            g_stAtNdisDhcpPara.ucIpv4Cid = (VOS_UINT8)gastAtParaList[0].ulParaValue;
        }
        else if (TAF_PDP_IPV6 == stDialParaInfo.enPdpType)
        {
            g_stAtNdisDhcpPara.ucIpv6Cid = (VOS_UINT8)gastAtParaList[0].ulParaValue;
        }
        else
        {
            g_stAtNdisDhcpPara.ucIpv4v6Cid = (VOS_UINT8)gastAtParaList[0].ulParaValue;
        }

        g_enAtNdisActPdpType       = stDialParaInfo.enPdpType;
        g_enAtFirstNdisActPdpType  = stDialParaInfo.enPdpType;

        AT_NdisSetState(g_enAtNdisActPdpType, AT_PDP_STATE_ACTING);

        /* ????????pdpact???????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_NDISCONN_SET;

        /* ???????????????????? */
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;
}

/*****************************************************************************
 ?? ?? ??  : At_NdisDupProc
 ????????  : ????NDIS????
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : ????
             ????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??9??8??
    ??    ??   : S62952
    ????????   : ??????????

  2.??    ??   : 2012??03??27??
    ??    ??   : f00179208
    ????????   : ????????:DTS2012032107203, AT^NDISDUP????????????OK

  3.??    ??   : 2012??8??22??
    ??    ??   : A00165503
    ????????   : ????PS????????????????
*****************************************************************************/
VOS_UINT32 At_NdisDupProc(VOS_UINT8 ucIndex)
{
    VOS_UINT32                  ulRet;

    if (AT_CMD_OPT_SET_CMD_NO_PARA == g_stATParseCmd.ucCmdOptType)
    {
        AT_NORM_LOG1("At_NdisDupProc:g_stATParseCmd.ucCmdOptType=%d\n",g_stATParseCmd.ucCmdOptType);

        /* ????PS???????????? */
        /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
        AT_PS_SetPsCallErrCause(ucIndex, TAF_PS_CAUSE_INVALID_PARAMETER);
        /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

        return AT_CME_INCORRECT_PARAMETERS;
    }

    /*????????*/
    ulRet = AT_NidsCheckDialParam();
    if ( AT_SUCCESS != ulRet)
    {
        AT_NORM_LOG1("At_NdisDupProc:ulRet=%d\n",ulRet);

        /* ????PS???????????? */
        /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
        AT_PS_SetPsCallErrCause(ucIndex, TAF_PS_CAUSE_INVALID_PARAMETER);
        /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

        return ulRet;
    }

    /* ???????????????????????? */
    if (0 == gastAtParaList[1].ulParaValue)
    {
        return AT_NdisDialDownProc(ucIndex);
    }
    else
    {
        /* ????NDIS???????? */
        AT_SaveNdisConnDailPara(gastAtParaList);

        return AT_NdisDialUpProc(ucIndex);
    }

}
/* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, end */

/*****************************************************************************
 ?? ?? ??  : AT_AppCheckDialParam
 ????????  : ????APP????????
 ????????  : VOS_VOID
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??7??25??
    ??    ??   : A00165503
    ????????   : ??????????

  2.??    ??   : 2011??10??20??
    ??    ??   : A00165503
    ????????   : AT????????, ??????????AT_OK??AT_SUCCESS

  3.??    ??   : 2012??06??05??
    ??    ??   : Y00213812
    ????????   : DTS2012060403197,??????APN????????????????????????

  4.??    ??   : 2012??8??22??
    ??    ??   : A00165503
    ????????   : ????????????????????????

  5.??    ??   : 2012??9??28??
    ??    ??   : A00165503
    ????????   : DTS2012092700373: ^NDISDUP????????IP????????????
*****************************************************************************/
VOS_UINT32 AT_AppCheckDialParam(VOS_VOID)
{
    VOS_UINT8                           aucIpv4Addr[TAF_IPV4_ADDR_LEN];

    if (gucAtParaIndex > 7)
    {
        AT_NORM_LOG1("AT_AppCheckDialParam:gucAtParaIndex=%d.\n",gucAtParaIndex);
        return AT_TOO_MANY_PARA;
    }

    /* ????CID,CID????????*/
    if (0 == gastAtParaList[0].usParaLen)
    {
        AT_INFO_LOG("AT_AppCheckDialParam:cid not ext");
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* CID??1~31*/
    if ( (gastAtParaList[0].ulParaValue > TAF_MAX_CID)
      || (gastAtParaList[0].ulParaValue < 1) )
    {
        AT_NORM_LOG1("AT_AppCheckDialParam:gastAtParaList[0].ulParaValue=%d\n",gastAtParaList[0].ulParaValue);
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????????????????????????????????????0??1??1??????????0???????????? */
    if (0 == gastAtParaList[1].usParaLen)
    {
        AT_INFO_LOG("AT_AppCheckDialParam:dial unknow");
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* AT^NDISDUP=1,1 */
    if ( (1 != gastAtParaList[1].ulParaValue)
      && (0 != gastAtParaList[1].ulParaValue) )
    {
        AT_INFO_LOG("AT_AppCheckDialParam:dial unknow");
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* APN */
    if ( gastAtParaList[2].usParaLen  > TAF_MAX_APN_LEN )
    {
        AT_WARN_LOG("AT_CheckApn: WARNING: APN len is error.");
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ( 0 != gastAtParaList[2].usParaLen )
    {
        /* ???? */
        if ( VOS_OK != AT_CheckApnFormat(gastAtParaList[2].aucPara,
                                         gastAtParaList[2].usParaLen) )
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
    }

    /* User Name */
    if ( gastAtParaList[3].usParaLen > TAF_MAX_GW_AUTH_USERNAME_LEN )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

     /* Password */
    if ( gastAtParaList[4].usParaLen > TAF_MAX_GW_AUTH_PASSWORD_LEN )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /*IP???????????? 15*/
    if (gastAtParaList[6].usParaLen > (TAF_MAX_IPV4_ADDR_STR_LEN - 1))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }
    else
    {
        if (gastAtParaList[6].usParaLen > 0)
        {
            if (VOS_OK != AT_Ipv4AddrAtoi((VOS_CHAR *)gastAtParaList[6].aucPara, aucIpv4Addr))
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }
        }
    }


    return AT_SUCCESS;
}

/*****************************************************************************
 ?? ?? ??  : AT_AppCheckPdpStateForDial
 ????????  : ????PDP????????????????
 ????????  : VOS_VOID
 ????????  : ??
 ?? ?? ??  : AT_OK      - ????PDP????????, ????OK
             AT_SUCCESS - PDP????????????????, ????OK
             AT_FAILURE - PDP??????????????????, ????ERROR
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??7??25??
    ??    ??   : A00165503
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_AppCheckPdpStateForDial(VOS_VOID )
{
    AT_PDP_ENTITY_STRU                 *pstAppPdpEntity;

    pstAppPdpEntity                     = AT_APP_GetPdpEntInfoAddr();

    if ( (AT_PDP_STATE_IDLE == pstAppPdpEntity->enIpv4State )
      && (AT_PDP_STATE_IDLE == pstAppPdpEntity->enIpv6State )
      && (AT_PDP_STATE_IDLE == pstAppPdpEntity->enIpv4v6State ))
    {
        /* ????PDP????????, ????OK */
        return AT_OK;
    }
    else if ( (AT_PDP_STATE_ACTING == pstAppPdpEntity->enIpv4State)
           || (AT_PDP_STATE_ACTED  == pstAppPdpEntity->enIpv4State)
           || (AT_PDP_STATE_ACTING == pstAppPdpEntity->enIpv6State)
           || (AT_PDP_STATE_ACTED  == pstAppPdpEntity->enIpv6State)
           || (AT_PDP_STATE_ACTING == pstAppPdpEntity->enIpv4v6State)
           || (AT_PDP_STATE_ACTED  == pstAppPdpEntity->enIpv4v6State) )
    {
        /* PDP????????????????, ????OK */
        return AT_SUCCESS;
    }
    else
    {
        /* PDP??????????????????, ????ERROR */
        return  AT_FAILURE;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_AppFindCidForDialDown
 ????????  : ??????????????????PDP??CID
 ????????  : aucCid[] - CID????
 ????????  : ??
 ?? ?? ??  : VOS_VOID
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??7??23??
    ??    ??   : A00165503
    ????????   : ??????????
  2.??    ??   : 2011??12??20??
    ??    ??   : c00173809
    ????????   : PS??????????IPV6????

*****************************************************************************/
VOS_UINT8 AT_AppFindCidForDialDown(VOS_VOID)
{
    AT_PDP_ENTITY_STRU                 *pstAppPdpEntity;

    pstAppPdpEntity                     = AT_APP_GetPdpEntInfoAddr();

    /* IPv4v6 */
    if ( (AT_PDP_STATE_ACTING == pstAppPdpEntity->enIpv4v6State)
      || (AT_PDP_STATE_ACTED  == pstAppPdpEntity->enIpv4v6State) )
    {
        return pstAppPdpEntity->ucIpv4v6Cid;
    }
    else
    {
        /* IPv4 */
        if ( (AT_PDP_STATE_ACTING == pstAppPdpEntity->enIpv4State)
          || (AT_PDP_STATE_ACTED  == pstAppPdpEntity->enIpv4State) )
        {
            return pstAppPdpEntity->ucIpv4Cid;
        }

        /* IPv6 */
        if ( (AT_PDP_STATE_ACTING == pstAppPdpEntity->enIpv6State)
          || (AT_PDP_STATE_ACTED  == pstAppPdpEntity->enIpv6State) )
        {
            return pstAppPdpEntity->ucIpv6Cid;
        }
    }

    return TAF_INVALID_CID;
}

/*****************************************************************************
 ?? ?? ??  : AT_AppReportPdpActiveState
 ????????  : ????????????PDP????
 ????????  : VOS_VOID
 ????????  : ??
 ?? ?? ??  : VOS_VOID
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??8??2??
    ??    ??   : A00165503
    ????????   : ??????????
  2.??    ??   : 2012??8??1??
    ??    ??   : z60575
    ????????   : DTS2012072804442??????IPV6??????????????RA????????^DCONN

  3.??    ??   : 2013??1??14??
    ??    ??   : A00165503
    ????????   : DTS2012042104301: PCUI????????NDIS/APP????????????
*****************************************************************************/
VOS_VOID AT_AppReportPdpActiveState(
    VOS_UINT8                           ucIndex,
    AT_PDP_ENTITY_STRU                 *pstAppPdpEntity
)
{
    VOS_UINT16                          usLength;
    VOS_UINT8                           aucAtStrIpv4[] = "IPV4";
    VOS_UINT8                           aucAtStrIpv6[] = "IPV6";
    AT_IPV6_RA_INFO_STRU               *pstAppRaInfoAddr;

    pstAppRaInfoAddr = AT_APP_GetRaInfoAddr();

    usLength                            = 0;

    /* ??????????????????, ?????????????????? */
    if (AT_PDP_STATE_ACTED == pstAppPdpEntity->enIpv4v6State)
    {
        AT_NORM_LOG("AT_AppReportPdpActiveState:NORMAL: The state of IPv4v6 is ACTED!");

        /* ??????OK */
        At_FormatResultData(ucIndex, AT_OK);

        /* ??????^DCONN */
        usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN, (VOS_CHAR*)pgucAtSndCodeAddr, (VOS_CHAR*)pgucAtSndCodeAddr + usLength,
                                    "%s^DCONN:%d,\"%s\"%s",
                                    gaucAtCrLf,
                                    pstAppPdpEntity->ucIpv4v6Cid,
                                    aucAtStrIpv4,
                                    gaucAtCrLf);
        At_SendResultData(ucIndex, pgucAtSndCodeAddr, usLength);

        if (VOS_TRUE == pstAppRaInfoAddr->bitOpPrefixAddr)
        {
            usLength = 0;

            usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN, (VOS_CHAR*)pgucAtSndCodeAddr, (VOS_CHAR*)pgucAtSndCodeAddr + usLength,
                                    "%s^DCONN:%d,\"%s\"%s",
                                    gaucAtCrLf,
                                    pstAppPdpEntity->ucIpv4v6Cid,
                                    aucAtStrIpv6,
                                    gaucAtCrLf);

            At_SendResultData(ucIndex, pgucAtSndCodeAddr, usLength);
        }
    }
    else if ( (AT_PDP_STATE_ACTED == pstAppPdpEntity->enIpv4State)
           && (AT_PDP_STATE_ACTED == pstAppPdpEntity->enIpv6State) )
    {
        AT_NORM_LOG("AT_AppDialUpProc:NORMAL: The state of IPv4 and IPv6 is ACTED!");

        /* ??????OK */
        At_FormatResultData(ucIndex, AT_OK);

        /* ??????^DCONN */
        usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN, (VOS_CHAR*)pgucAtSndCodeAddr, (VOS_CHAR*)pgucAtSndCodeAddr + usLength,
                                    "%s^DCONN:%d,\"%s\"%s",
                                    gaucAtCrLf,
                                    pstAppPdpEntity->ucIpv4Cid,
                                    aucAtStrIpv4,
                                    gaucAtCrLf);

        At_SendResultData(ucIndex, pgucAtSndCodeAddr, usLength);

        if (VOS_TRUE == pstAppRaInfoAddr->bitOpPrefixAddr)
        {
            usLength = 0;

            usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN, (VOS_CHAR*)pgucAtSndCodeAddr, (VOS_CHAR*)pgucAtSndCodeAddr + usLength,
                                    "%s^DCONN:%d,\"%s\"%s",
                                    gaucAtCrLf,
                                    pstAppPdpEntity->ucIpv6Cid,
                                    aucAtStrIpv6,
                                    gaucAtCrLf);

            At_SendResultData(ucIndex, pgucAtSndCodeAddr, usLength);
        }
    }
    else if ( (AT_PDP_STATE_ACTED == pstAppPdpEntity->enIpv4State)
           && (AT_PDP_STATE_IDLE  == pstAppPdpEntity->enIpv6State) )
    {
        AT_NORM_LOG("AT_AppDialUpProc:NORMAL: The state of IPv4 is ACTED!");

        /* ??????OK */
        At_FormatResultData(ucIndex, AT_OK);

        /* ??????^DCONN */
        usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN, (VOS_CHAR*)pgucAtSndCodeAddr, (VOS_CHAR*)pgucAtSndCodeAddr + usLength,
                                    "%s^DCONN:%d,\"%s\"%s",
                                    gaucAtCrLf,
                                    pstAppPdpEntity->ucIpv4Cid,
                                    aucAtStrIpv4,
                                    gaucAtCrLf);

        At_SendResultData(ucIndex, pgucAtSndCodeAddr, usLength);
    }
    else if ( (AT_PDP_STATE_IDLE  == pstAppPdpEntity->enIpv4State)
           && (AT_PDP_STATE_ACTED == pstAppPdpEntity->enIpv6State) )
    {
        AT_NORM_LOG("AT_AppDialUpProc:NORMAL: The state of IPv6 is ACTED!");

        /* ??????OK */
        At_FormatResultData(ucIndex, AT_OK);

        if (VOS_TRUE == pstAppRaInfoAddr->bitOpPrefixAddr)
        {
            /* ??????^DCONN */
            usLength = 0;

            usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN, (VOS_CHAR*)pgucAtSndCodeAddr, (VOS_CHAR*)pgucAtSndCodeAddr + usLength,
                                    "%s^DCONN:%d,\"%s\"%s",
                                    gaucAtCrLf,
                                    pstAppPdpEntity->ucIpv6Cid,
                                    aucAtStrIpv6,
                                    gaucAtCrLf);

            At_SendResultData(ucIndex, pgucAtSndCodeAddr, usLength);
        }
    }
    else
    {
        /* ??????????, ????????OK */
        AT_NORM_LOG("AT_AppDialUpProc:NORMAL: No PDP is ACTED!");

        /* ??????OK */
        At_FormatResultData(ucIndex, AT_OK);
    }

    return;
}

/*****************************************************************************
 ?? ?? ??  : AT_GetAppDialParam
 ????????  : ????APP????????
 ????????  : ??
 ????????  : pstDialParaInfo            - ????????
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??10??18??
    ??    ??   : A00165503
    ????????   : ??????????

  2.??    ??   : 2011??12??20??
    ??    ??   : c00173809
    ????????   : PS??????????IPV6????,,??????????????

  3.??    ??   : 2012??4??19??
    ??    ??   : z60575
    ????????   : DTS2012041905175,APP????, ????????????????????, ????????
                 ????????????

  4.??    ??   : 2012??8??22??
    ??    ??   : A00165503
    ????????   : ??????????????????, ??????????????

  5.??    ??   : 2012??12??21??
    ??    ??   : l60609
    ????????   : DSDA PhaseII
*****************************************************************************/
VOS_UINT32 AT_GetAppDialParam(
    TAF_PS_DIAL_PARA_STRU              *pstDialParaInfo,
    VOS_UINT8                           ucIndex
)
{
    TAF_PDP_PRIM_CONTEXT_STRU                    stPdpCidInfo;
    VOS_UINT32                          ulRet;

    PS_MEM_SET(&stPdpCidInfo, 0x00, sizeof(TAF_PDP_PRIM_CONTEXT_STRU));
    PS_MEM_SET(pstDialParaInfo, 0x00, sizeof(TAF_PS_DIAL_PARA_STRU));

    /* ????CID */
    pstDialParaInfo->ucCid            = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* Modified by l60609 for DSDA PhaseII, 2012-12-21, begin */
    ulRet = TAF_AGENT_GetPdpCidPara(&stPdpCidInfo, ucIndex, pstDialParaInfo->ucCid);
    /* Modified by l60609 for DSDA PhaseII, 2012-12-21, end */
    if (VOS_OK != ulRet)
    {
        return AT_FAILURE;
    }

    if ((TAF_PDP_IPV4   == stPdpCidInfo.stPdpAddr.enPdpType)
     || (TAF_PDP_IPV6   == stPdpCidInfo.stPdpAddr.enPdpType)
     || (TAF_PDP_IPV4V6 == stPdpCidInfo.stPdpAddr.enPdpType))
    {
        pstDialParaInfo->enPdpType      = stPdpCidInfo.stPdpAddr.enPdpType;
    }
    else
    {
        /* ????????IPV4 */
        pstDialParaInfo->enPdpType      = TAF_PDP_IPV4;
    }

    if (VOS_ERR == AT_CheckIpv6Capability(pstDialParaInfo->enPdpType))
    {
        AT_INFO_LOG("AT_NidsGetDialParam:PDP type is error");
        return AT_FAILURE;
    }

    if ( 0 != gastAtParaList[2].usParaLen )
    {
        pstDialParaInfo->bitOpApn       = VOS_TRUE;

        PS_MEM_CPY((VOS_CHAR*)pstDialParaInfo->aucApn,
                   (VOS_CHAR*)gastAtParaList[2].aucPara,
                   gastAtParaList[2].usParaLen);
        pstDialParaInfo->aucApn[gastAtParaList[2].usParaLen] = 0;
    }

    if ( 0 != gastAtParaList[3].usParaLen )
    {
        pstDialParaInfo->bitOpUserName  = VOS_TRUE;

        PS_MEM_CPY((VOS_CHAR*)pstDialParaInfo->aucUserName,
                   (VOS_CHAR*)gastAtParaList[3].aucPara,
                   gastAtParaList[3].usParaLen);
        pstDialParaInfo->aucUserName[gastAtParaList[3].usParaLen] = 0;
    }

    if ( 0 != gastAtParaList[4].usParaLen )
    {
        pstDialParaInfo->bitOpPassWord  = VOS_TRUE;

        PS_MEM_CPY((VOS_CHAR*)pstDialParaInfo->aucPassWord,
                   (VOS_CHAR*)gastAtParaList[4].aucPara,
                   gastAtParaList[4].usParaLen);
        pstDialParaInfo->aucPassWord[gastAtParaList[4].usParaLen] = 0;
    }

    /* Auth Type */
    if ( gastAtParaList[5].usParaLen > 0 )
    {
        pstDialParaInfo->bitOpAuthType  = VOS_TRUE;
        pstDialParaInfo->enAuthType     = AT_CtrlGetPDPAuthType(gastAtParaList[5].ulParaValue,
                                                                gastAtParaList[5].usParaLen);
    }
    else
    {
        /* ??????????????????????????0, ????????????????, ??????????CHAP???? */
        if ( (0 != gastAtParaList[3].usParaLen)
          && (0 != gastAtParaList[4].usParaLen) )
        {
            pstDialParaInfo->bitOpAuthType = VOS_TRUE;
            pstDialParaInfo->enAuthType    = PPP_CHAP_AUTH_TYPE;
        }
    }

    /* ????<PDP_addr> */
    if ( gastAtParaList[6].usParaLen > 0 )
    {
        /* ??IP????????????????????, IP?????????????????????????? */
        if ( VOS_OK == AT_Ipv4AddrAtoi((VOS_CHAR*)gastAtParaList[6].aucPara,
                                       (VOS_UINT8*)pstDialParaInfo->stPdpAddr.aucIpv4Addr) )
        {
            pstDialParaInfo->bitOpIpAddr         = VOS_TRUE;
            pstDialParaInfo->stPdpAddr.enPdpType = TAF_PDP_IPV4;
        }
    }

    return AT_SUCCESS;
}

/*****************************************************************************
 ?? ?? ??  : AT_E5DialUpProc
 ????????  : APP????????
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : ????????
             ????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??9??8??
    ??    ??   : S62952
    ????????   : ??????????

  2.??    ??   : 2014??5??16??
    ??    ??   : A00165503
    ????????   : DTS2014050703206: ????CID??????????????
*****************************************************************************/
VOS_UINT32 AT_AppDialUpProc(VOS_UINT8 ucIndex)
{
    AT_DIAL_PARAM_STRU                 *pstAppDailPara;
    AT_PDP_ENTITY_STRU                 *pstAppPdpEntity;
    TAF_PS_DIAL_PARA_STRU               stDialParaInfo;
    AT_PS_USER_INFO_STRU                stUsrInfo;
    VOS_UINT32                          ulResult;

    /* ?????? */
    PS_MEM_SET(&stDialParaInfo, 0x00, sizeof(TAF_PS_DIAL_PARA_STRU));
    PS_MEM_SET(&stUsrInfo, 0x00, sizeof(AT_PS_USER_INFO_STRU));

    pstAppPdpEntity = AT_APP_GetPdpEntInfoAddr();
    pstAppDailPara  = AT_APP_GetDailParaAddr();

    PS_MEM_SET(pstAppDailPara->aucUsername, 0x00, TAF_MAX_GW_AUTH_USERNAME_LEN);
    PS_MEM_SET(pstAppDailPara->aucPassword, 0x00, TAF_MAX_GW_AUTH_PASSWORD_LEN);

    /* ???????????? */
    AT_APP_ParseUsrInfo(ucIndex, &stUsrInfo);

    /* ??????????????????????, ????????OK */
    ulResult = AT_AppCheckPdpStateForDial();
    if (AT_SUCCESS == ulResult)
    {
        AT_INFO_LOG("AT_AppDialUpProc: The state is already active or activing");
        AT_AppReportPdpActiveState(ucIndex, pstAppPdpEntity);
        return AT_SUCCESS;
    }

    /* ???????????????????????? */
    if (AT_FAILURE == ulResult)
    {
        AT_INFO_LOG("AT_AppDialUpProc: the state is error");
        AT_PS_SetPsCallErrCause(ucIndex, TAF_PS_CAUSE_UNKNOWN);
        return AT_ERROR;
    }

    /* ???????????? */
    ulResult = AT_GetAppDialParam(&stDialParaInfo, ucIndex);
    if ( AT_SUCCESS != ulResult )
    {
        /* ????PS???????????? */
        AT_PS_SetPsCallErrCause(ucIndex, TAF_PS_CAUSE_UNKNOWN);
        return AT_ERROR;
    }

    /* ??????????????????IPV6???? */
    pstAppDailPara->usAuthType      = stDialParaInfo.enAuthType;
    pstAppDailPara->ucCid           = stDialParaInfo.ucCid;
    pstAppDailPara->enPdpType       = stDialParaInfo.enPdpType;

    /* APN */
    pstAppDailPara->ucAPNLen        = (VOS_UINT8)gastAtParaList[2].usParaLen;
    PS_MEM_CPY((VOS_CHAR *)pstAppDailPara->aucAPN,
               (VOS_CHAR *)gastAtParaList[2].aucPara,
               gastAtParaList[2].usParaLen);

    /* ?????????? */
    pstAppDailPara->usUsernameLen   = gastAtParaList[3].usParaLen;
    PS_MEM_CPY((VOS_CHAR *)pstAppDailPara->aucUsername,
               (VOS_CHAR *)gastAtParaList[3].aucPara,
               gastAtParaList[3].usParaLen);

    /* ???????????? */
    pstAppDailPara->usPasswordLen   = gastAtParaList[4].usParaLen;
    PS_MEM_CPY((VOS_CHAR *)pstAppDailPara->aucPassword,
               (VOS_CHAR *)gastAtParaList[4].aucPara,
               gastAtParaList[4].usParaLen);

    /* PDP ADDR */
    pstAppDailPara->ulIPv4ValidFlag = stDialParaInfo.bitOpIpAddr;
    PS_MEM_CPY((VOS_CHAR *)pstAppDailPara->aucIPv4Addr,
               (VOS_CHAR *)gastAtParaList[6].aucPara,
               gastAtParaList[6].usParaLen);

    /* ???????? */
    if (VOS_OK == TAF_PS_CallOrig(WUEPS_PID_AT,
                                  AT_PS_BuildExClientId(AT_APP_GET_CLIENT_ID()),
                                  0,
                                  &stDialParaInfo))
    {
        /* ???????????? */
        pstAppPdpEntity->stUsrInfo = stUsrInfo;

        if (TAF_PDP_IPV4 == stDialParaInfo.enPdpType)
        {
            pstAppPdpEntity->ucIpv4Cid   = (VOS_UINT8)gastAtParaList[0].ulParaValue;
        }
        else if (TAF_PDP_IPV6 == stDialParaInfo.enPdpType)
        {
            pstAppPdpEntity->ucIpv6Cid   = (VOS_UINT8)gastAtParaList[0].ulParaValue;
        }
        else
        {
            pstAppPdpEntity->ucIpv4v6Cid = (VOS_UINT8)gastAtParaList[0].ulParaValue;
        }

        AT_APP_SetFirstActPdpType(stDialParaInfo.enPdpType);
        AT_APP_SetActPdpType(stDialParaInfo.enPdpType);
        AT_AppSetPdpState(stDialParaInfo.enPdpType, AT_PDP_STATE_ACTING);

        /* ????????pdpact???????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_NDISCONN_SET;

        /* ???????????????????? */
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;
}

/*****************************************************************************
 ?? ?? ??  : AT_E5DialDownProc
 ????????  : APP??????????????
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : ????????
             ????????

 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??9??7??
    ??    ??   : sunshaohua
    ????????   : ??????????

  2.??    ??   : 2011??07??08??
    ??    ??   : A00165503
    ????????   : AT Project: ??????????????PS CALL

  3.??    ??   : 2011??12??20??
    ??    ??   : c00173809
    ????????   : PS??????????IPV6????

  4.??    ??   : 2012??03??06??
    ??    ??   : w00199382
    ????????   : ????????: DTS2012011304468, ????????????NDIS????????????????APS
                 ??????????????????

  5.??    ??   : 2012??04??25??
    ??    ??   : s62952
    ????????   : ????????: DTS2012042101936,Ipv4v6????????????

  6.??    ??   : 2012??12??11??
    ??    ??   : l00167671
    ????????   : DTS2012121802573, TQE????

  7.??    ??   : 2013??1??14??
    ??    ??   : A00165503
    ????????   : DTS2012042104301: PCUI????????NDIS/APP????????????
*****************************************************************************/
VOS_UINT32 AT_AppDialDownProc(
    VOS_UINT8                           ucIndex
)
{
    AT_PDP_ENTITY_STRU                 *pstAppPdpEntity;
    VOS_UINT32                          ulPdpFlag;

    ulPdpFlag = 0;

    pstAppPdpEntity                     = AT_APP_GetPdpEntInfoAddr();

    /* ??????????PDP??????IDLE, ????OK; ??????????????DEACTING, ??????OK */
    if (VOS_TRUE == AT_AppCheckPdpIdleState())
    {
        AT_WARN_LOG("AT_AppDialDownProc: The state is already IDLE.");
        return AT_OK;
    }

    if ((AT_PDP_STATE_ACTING == pstAppPdpEntity->enIpv4v6State)
     || (AT_PDP_STATE_ACTED  == pstAppPdpEntity->enIpv4v6State) )
    {
         /* AT^NDISDUP????????????????????cid????????????????ERROR */
        if (pstAppPdpEntity->ucIpv4v6Cid != gastAtParaList[0].ulParaValue)
        {
            return AT_ERROR;
        }

        ulPdpFlag = 1;

        if (VOS_OK != TAF_PS_CallEnd(WUEPS_PID_AT,
                                     AT_PS_BuildExClientId(AT_APP_GET_CLIENT_ID()),
                                     0,
                                     g_stAtAppPdpEntity.ucIpv4v6Cid))
        {
            AT_WARN_LOG("AT_AppDialDownProc():TAF_PS_CallEnd fail");
        }

        AT_AppSetPdpState(TAF_PDP_IPV4V6, AT_PDP_STATE_DEACTING);
    }
    else
    {
        if ( (AT_PDP_STATE_ACTING == pstAppPdpEntity->enIpv4State)
          || (AT_PDP_STATE_ACTED  == pstAppPdpEntity->enIpv4State) )
        {
            /* AT^NDISDUP????????????????????cid????????????????ERROR */
            if (pstAppPdpEntity->ucIpv4Cid == gastAtParaList[0].ulParaValue)
            {
                ulPdpFlag = 1;
                if (VOS_OK != TAF_PS_CallEnd(WUEPS_PID_AT,
                                             AT_PS_BuildExClientId(AT_APP_GET_CLIENT_ID()),
                                             0,
                                             pstAppPdpEntity->ucIpv4Cid))
                {
                    AT_WARN_LOG("AT_AppDialDownProc():TAF_PS_CallEnd fail");
                }

                AT_AppSetPdpState(TAF_PDP_IPV4, AT_PDP_STATE_DEACTING);

                if ( (AT_PDP_STATE_ACTING == pstAppPdpEntity->enIpv6State)
                  || (AT_PDP_STATE_ACTED  == pstAppPdpEntity->enIpv6State) )
                {
                    if (VOS_OK != TAF_PS_CallEnd(WUEPS_PID_AT,
                                                 AT_PS_BuildExClientId(AT_APP_GET_CLIENT_ID()),
                                                 0,
                                                 pstAppPdpEntity->ucIpv6Cid))
                    {
                        AT_WARN_LOG("AT_AppDialDownProc():TAF_PS_CallEnd fail");
                    }

                    AT_AppSetPdpState(TAF_PDP_IPV6, AT_PDP_STATE_DEACTING);
                }
            }

        }

        if ( (AT_PDP_STATE_ACTING == pstAppPdpEntity->enIpv6State)
          || (AT_PDP_STATE_ACTED  == pstAppPdpEntity->enIpv6State) )
        {
            /* AT^NDISDUP????????????????????cid????????????????ERROR */
            if (pstAppPdpEntity->ucIpv6Cid == gastAtParaList[0].ulParaValue)
            {
                ulPdpFlag = 1;
                if (VOS_OK != TAF_PS_CallEnd(WUEPS_PID_AT,
                                             AT_PS_BuildExClientId(AT_APP_GET_CLIENT_ID()),
                                             0,
                                             pstAppPdpEntity->ucIpv6Cid))
                {
                    AT_WARN_LOG("AT_AppDialDownProc():TAF_PS_CallEnd fail");
                }

                AT_AppSetPdpState(TAF_PDP_IPV6, AT_PDP_STATE_DEACTING);

                if ( (AT_PDP_STATE_ACTING == pstAppPdpEntity->enIpv4State)
                  || (AT_PDP_STATE_ACTED  == pstAppPdpEntity->enIpv4State) )
                {
                    if (VOS_OK != TAF_PS_CallEnd(WUEPS_PID_AT,
                                                 AT_PS_BuildExClientId(AT_APP_GET_CLIENT_ID()),
                                                 0,
                                                 pstAppPdpEntity->ucIpv4Cid))
                    {
                        AT_WARN_LOG("AT_AppDialDownProc():TAF_PS_CallEnd fail");
                    }

                    AT_AppSetPdpState(TAF_PDP_IPV4, AT_PDP_STATE_DEACTING);
                }

            }

        }

    }

    if (0 == ulPdpFlag)
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_NDISCONN_SET;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;
}


/*****************************************************************************
 ?? ?? ??  : At_DialProc
 ????????  : ????phone??E5????
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : ????
             ????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??9??8??
    ??    ??   : S62952
    ????????   : ??????????
  2.??    ??   : 2012??03??27??
    ??    ??   : f00179208
    ????????   : ????????:DTS2012032107203, AT^NDISDUP????????????OK
  3.??    ??   : 2012??4??24??
    ??    ??   : s62952
    ????????   : DTS2012031401163,APN??????????????????????????
*****************************************************************************/
VOS_UINT32 AT_DialProc(
    VOS_UINT8                           ucIndex
)
{
    VOS_UINT32                          ulResult;

    /* ???????? */
    if (AT_CMD_OPT_SET_CMD_NO_PARA == g_stATParseCmd.ucCmdOptType)
    {
        AT_NORM_LOG1("AT_DialProc:g_stATParseCmd.ucCmdOptType=%d\n",g_stATParseCmd.ucCmdOptType);

        /* ????PS???????????? */
        /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
        AT_PS_SetPsCallErrCause(ucIndex, TAF_PS_CAUSE_INVALID_PARAMETER);
        /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    ulResult = AT_AppCheckDialParam();
    if (AT_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_DialProc:WARNING: Wrong parameter!");

        /* ????PS???????????? */
        /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
        AT_PS_SetPsCallErrCause(ucIndex, TAF_PS_CAUSE_INVALID_PARAMETER);
        /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

        return ulResult;
    }

    /* ???????????????????????? */
    if (0 == gastAtParaList[1].ulParaValue)
    {
        return AT_AppDialDownProc(ucIndex);
    }
    else
    {
        if (AT_HILINK_GATEWAY_MODE == g_enHiLinkMode)
        {
            /* ????PS???????????? */
            /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
            AT_PS_SetPsCallErrCause(ucIndex, TAF_PS_CAUSE_UNKNOWN);
            /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */

            return AT_ERROR;
        }

        return AT_AppDialUpProc(ucIndex);
    }
}

/*****************************************************************************
 Prototype      : AT_SetNdisdupPara
 Description    : ^NDISDUP = <pdpid>,<connect>[,<APN>[<username>[,<passwd> [,<authpref>]]]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2009-08-27
    Author      : L47619
    Modification: Created function
  2.??    ??   : 2011??04??28??
    ??    ??   : o00132663
    ????????   : DTS2011042800390,AT^NDISDUP????????ERROR
  3.??    ??   : 2011??12??1??
    ??    ??   : ??????/f62575
    ????????   : DTS2011113002867, ????PC UI??????NDIS??????????????NV
  4.??    ??   : 2012??9??3??
    ??    ??   : l60609
    ????????   : AP??????????V9????PCUI??????APP????

  5.??    ??   : 2013??1??14??
    ??    ??   : A00165503
    ????????   : DTS2012042104301: PCUI????????NDIS/APP????????????

  6.??    ??   : 2013??5??04??
    ??    ??   : l60609
    ????????   : V9R1 IPv6&TAF/SM Project

  7.??    ??   : 2015??5??27??
    ??    ??   : l00198894
    ????????   : TSTS
*****************************************************************************/
VOS_UINT32 AT_SetNdisdupPara (VOS_UINT8 ucIndex)
{
    VOS_UINT8                          *pucSystemAppConfig;

    pucSystemAppConfig                  = AT_GetSystemAppConfigAddr();

    /* ??????????????????:
       AT^NDISUP AT??????????????NDIS??????E5??????????????????????????????????
       ??????????????????AT??????????????????????????????API?????????? */

    /*????????: ??????APP??????NDIS??????????slice??*/
    g_ulRcvAppNdisdupSlice = VOS_GetSlice();

    if (AT_NDIS_USER == gastAtClientTab[ucIndex].UserType)
    {
        return At_NdisDupProc(ucIndex);
    }

    /* Modified by l60609 for V9R1 IPv6&TAF/SM Project, 2013-4-24, begin */
    if (AT_APP_USER == gastAtClientTab[ucIndex].UserType)
    {
        /* ????E5??????????E355???????????? */
        if (SYSTEM_APP_WEBUI == *pucSystemAppConfig)
        {
            return AT_DialProc(ucIndex);
        }
        /* ?????????????????? */
        else
        {
            return AT_PS_ProcDialCmd(ucIndex);
        }
    }

    /* ????AP_MODEM????????HISC?????????????? */
    if (VOS_TRUE == AT_CheckHsicUser(ucIndex))
    {
        return AT_PS_ProcDialCmd(ucIndex);
    }

    if (AT_USBCOM_USER == gastAtClientTab[ucIndex].UserType)
    {
        if (VOS_TRUE == AT_GetPcuiPsCallFlag())
        {
            return AT_PS_ProcDialCmd(ucIndex);
        }

        /* Modified by l60609 for AP???????? ??2012-09-03 Begin */
        if (SYSTEM_APP_WEBUI == *pucSystemAppConfig)
        /* Modified by l60609 for AP???????? ??2012-09-03 End */
        {
            return AT_DialProc(ucIndex);
        }
        else
        {
            return At_NdisDupProc(ucIndex);
        }
    }

    /* Modified by l60609 for V9R1 IPv6&TAF/SM Project, 2013-4-24, end */

    if (AT_CTR_USER == gastAtClientTab[ucIndex].UserType)
    {
        if (VOS_TRUE == AT_GetCtrlPsCallFlag())
        {
            return AT_PS_ProcDialCmd(ucIndex);
        }

        if (SYSTEM_APP_WEBUI != *pucSystemAppConfig)
        {
            return At_NdisDupProc(ucIndex);
        }
    }

    if (AT_PCUI2_USER == gastAtClientTab[ucIndex].UserType)
    {
        if (VOS_TRUE == AT_GetPcui2PsCallFlag())
        {
            return AT_PS_ProcDialCmd(ucIndex);
        }

        if (SYSTEM_APP_WEBUI != *pucSystemAppConfig)
        {
            return At_NdisDupProc(ucIndex);
        }
    }

    /*??V2??????????????????????????????????????OK*/
    return AT_OK;
}


/*****************************************************************************
 Prototype      : At_SetAuthdataPara
 Description    : ^AUTHDATA=<cid>[,<Auth_type>[<PLMN>[,<passwd>[,<username>]]]
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2009-08-27
    Author      : L47619
    Modification: Created function
*****************************************************************************/
TAF_UINT32 At_SetAuthdataPara (TAF_UINT8 ucIndex)
{
    TAF_AUTHDATA_EXT_STRU               stAuthDataInfo;

    PS_MEM_SET(&stAuthDataInfo, 0, sizeof(TAF_AUTHDATA_EXT_STRU));

    /* ????????????????????OK */
    if ( AT_CMD_OPT_SET_CMD_NO_PARA == g_stATParseCmd.ucCmdOptType )
    {
        return AT_OK;
    }

    /* ???????? */
    if ( 0 == gastAtParaList[0].usParaLen )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( gucAtParaIndex > 5 )
    {
        return AT_TOO_MANY_PARA;
    }

    stAuthDataInfo.ucCid                    = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ????????????<CID>, ???????????????? */
    if ( 1 == gucAtParaIndex )
    {
        stAuthDataInfo.ucDefined            = VOS_FALSE;
    }
    else
    {
        stAuthDataInfo.ucDefined            = VOS_TRUE;

        /* ????<Auth_type> */
        if ( 0 != gastAtParaList[1].usParaLen )
        {
            stAuthDataInfo.bitOpAuthType    = VOS_TRUE;
            stAuthDataInfo.enAuthType       = (VOS_UINT8)gastAtParaList[1].ulParaValue;
        }

        /* ????<PLMN> */
        if ( gastAtParaList[2].usParaLen > TAF_MAX_AUTHDATA_PLMN_LEN )
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        if ( 0 != gastAtParaList[2].usParaLen )
        {
            stAuthDataInfo.bitOpPlmn        = VOS_TRUE;

            PS_MEM_CPY((VOS_CHAR*)stAuthDataInfo.aucPlmn,
                       (VOS_CHAR*)gastAtParaList[2].aucPara,
                       gastAtParaList[2].usParaLen);
            stAuthDataInfo.aucPlmn[gastAtParaList[2].usParaLen] = 0;
        }

        /* ????<username> */
        if ( gastAtParaList[4].usParaLen > TAF_MAX_AUTHDATA_USERNAME_LEN )
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        if(0 != gastAtParaList[4].usParaLen)
        {
            stAuthDataInfo.bitOpUserName    = VOS_TRUE;

            PS_MEM_CPY((VOS_CHAR*)stAuthDataInfo.aucUserName,
                       (VOS_CHAR*)gastAtParaList[4].aucPara,
                       gastAtParaList[4].usParaLen);
            stAuthDataInfo.aucUserName[gastAtParaList[4].usParaLen] = 0;
        }

        /* ????<passwd> */
        if ( gastAtParaList[3].usParaLen > TAF_MAX_AUTHDATA_PASSWORD_LEN )
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        if ( 0 != gastAtParaList[3].usParaLen )
        {
            stAuthDataInfo.bitOpPassWord    = VOS_TRUE;

            PS_MEM_CPY((VOS_CHAR*)stAuthDataInfo.aucPassWord,
                       (VOS_CHAR*)gastAtParaList[3].aucPara,
                       gastAtParaList[3].usParaLen);
            stAuthDataInfo.aucPassWord[gastAtParaList[3].usParaLen] = 0;
        }

    }

    /* ???????????? */
    if ( VOS_OK != TAF_PS_SetAuthDataInfo(WUEPS_PID_AT,
                                          AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                          0,
                                          &stAuthDataInfo))
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_AUTHDATA_SET;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;
}


/*****************************************************************************
 Prototype      : At_SetCrpnPara
 Description    : ^crpn =<name_index>,<name>
 Input          : ucIndex --- ????????
 Output         :
 Return Value   : AT_XXX  --- ATC??????
 Calls          : ---
 Called By      : ---

 History        : ---
  1.Date        : 2009-09-01
    Author      : L47619
    Modification: Created function

  2.??    ??   : 2011??10??24??
    ??    ??   : o00132663
    ????????   : AT??????????MMA API????????????????????

  3.??    ??   : 2012??4??12??
    ??    ??   : l60609
    ????????   : DTS2012040105559:^CRPN????????????????????????????
  4.??    ??   : 2015??3??5??
    ??    ??   : b00269685
    ????????   : ????????????
*****************************************************************************/
TAF_UINT32 At_SetCrpnPara (TAF_UINT8 ucIndex)
{
    TAF_MMA_CRPN_QRY_PARA_STRU          stMnMmaCrpnQry;

    /* ?????????????? */
    if (AT_CMD_OPT_SET_CMD_NO_PARA == g_stATParseCmd.ucCmdOptType)
    {
        return AT_OK;
    }

    if (2 != gucAtParaIndex)
    {
        AT_WARN_LOG("At_SetCrpnPara: gucAtParaIndex != 2.");
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??<name_index>??<name>???????????????????? */
    if ((0 == gastAtParaList[0].usParaLen) || (0 == gastAtParaList[1].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<name>?????????????? */
    if (0 == gastAtParaList[0].ulParaValue)
    {
        if (gastAtParaList[1].usParaLen >= TAF_PH_OPER_NAME_LONG)
        {
            return AT_CME_TEXT_STRING_TOO_LONG;
        }
    }
    else if(1 == gastAtParaList[0].ulParaValue)
    {
        if (gastAtParaList[1].usParaLen >= TAF_PH_OPER_NAME_SHORT)
        {
            return AT_CME_TEXT_STRING_TOO_LONG;
        }
    }
    else
    {
        if ((gastAtParaList[1].usParaLen < 5) || (gastAtParaList[1].usParaLen > 6))
        {
            return AT_CME_TEXT_STRING_TOO_LONG;
        }
    }


    PS_MEM_SET(&stMnMmaCrpnQry, 0, sizeof(TAF_MMA_CRPN_QRY_PARA_STRU));

    /* ???????????????? */
    stMnMmaCrpnQry.ucCurrIndex   = 0;
    stMnMmaCrpnQry.ucQryNum      = TAF_PH_CRPN_PLMN_MAX_NUM;
    stMnMmaCrpnQry.ucPlmnType    = (VOS_UINT8)gastAtParaList[0].ulParaValue;
    stMnMmaCrpnQry.usPlmnNameLen = gastAtParaList[1].usParaLen;
    PS_MEM_CPY(stMnMmaCrpnQry.aucPlmnName, gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen);



    if (VOS_TRUE == TAF_MMA_QryCrpnReq( WUEPS_PID_AT,
                                        gastAtClientTab[ucIndex].usClientId,
                                        0,
                                        &stMnMmaCrpnQry))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CRPN_QUERY;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }

}

/*****************************************************************************
?? ?? ??  : AT_SetAlsPara
????????  : ????????????????
????????  : ucIndex --- ????????
????????  : ??
?? ?? ??  : AT_XXX  --- ATC??????
????????  :
????????  :

????????      :
 1.??    ??   : 2010??1??22??
   ??    ??   : ??????
   ????????   : ??????????
 2.??    ??   : 2011??10??24??
   ??    ??   : C00173809
   ????????   : AT??????????????MN_CALL_SetAlsLineNo??????????????????????????INDEX??????
 3.??    ??   : 2012??3??20??
   ??    ??   : C00173809
   ????????   : DTS2012031604757,AT^ALS=1????????.
 4.??    ??   : 2012??9??25??
   ??    ??   : A00165503
   ????????   : STK&DCM????: CS????????????
 5.??    ??   : 2013??2??20??
   ??    ??   : l60609
   ????????   : DSDA PHASE III
*****************************************************************************/
VOS_UINT32  AT_SetAlsPara( TAF_UINT8 ucIndex )
{
    VOS_UINT32                          ulRet;
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, Begin */
    AT_MODEM_SS_CTX_STRU               *pstSsCtx = VOS_NULL_PTR;

    pstSsCtx = AT_GetModemSsCtxAddrFromClientId(ucIndex);

    /* ???????? */
    if ( gucAtParaIndex > 2 )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /*????????????????*/
    if ( 0 == gastAtParaList[0].usParaLen )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ( 0 != gastAtParaList[1].usParaLen )
    {
        ulRet = MN_CALL_SetAlsLineNo(ucIndex,
                                     (MN_CALL_ALS_LINE_NO_ENUM_U8)gastAtParaList[1].ulParaValue);
        if (VOS_OK != ulRet)
        {
            return AT_ERROR;
        }

        pstSsCtx->ucSalsType = (TAF_UINT8)gastAtParaList[0].ulParaValue;

        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_APP_SET_ALS_REQ;

        return AT_WAIT_ASYNC_RETURN;
    }

    pstSsCtx->ucSalsType = (TAF_UINT8)gastAtParaList[0].ulParaValue;
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, End */

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_CheckRxDivCmdPara
 ????????  : ????????^RXDIV????????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??2??21??
    ??    ??   : l65478
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 At_CheckRxDivOrRxPriCmdPara(VOS_VOID)
{
    /* ???????? */
    if (gucAtParaIndex > 2)
    {
        return AT_CME_RX_DIV_OTHER_ERR;
    }
    /* ?????????????????????? */
    if (   (0 == gastAtParaList[0].usParaLen)
        || (0 == gastAtParaList[1].usParaLen)
        || (18 < gastAtParaList[1].usParaLen))
    {
        return AT_CME_RX_DIV_OTHER_ERR;
    }

    /* ????????WCDMA???????????????????????????? */
    if ('0' != gastAtParaList[0].aucPara[0])
    {
         return AT_CME_RX_DIV_OTHER_ERR;
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_GetUserSetRxDivParaNum
 ????????  : ??????????????????????????????????
 ????????  : VOS_UINT32      *pulSetDivLowBands
             VOS_UINT32      *pulSetDivHighBands
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??02??21??
    ??    ??   : l65478
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 At_GetUserSetRxDivOrRxPriParaNum(
                VOS_UINT32      *pulSetDivLowBands,
                VOS_UINT32      *pulSetDivHighBands
                )
{
    VOS_UINT32                      ulResult1;
    VOS_UINT32                      ulResult2;
    VOS_UINT8                       *pucInputPara;
    VOS_UINT16                      usInputLen;

    ulResult1 = AT_OK;
    ulResult2 = AT_OK;

    *pulSetDivLowBands  = 0;
    *pulSetDivHighBands = 0;

    /* ??????????????????????????????:??0x??????0x.
       ??????????0x??????0x?????????????????????????????? */
    pucInputPara = gastAtParaList[1].aucPara;
    usInputLen   = gastAtParaList[1].usParaLen;
    if (   ('0' == gastAtParaList[1].aucPara[0])
        && ('X' == gastAtParaList[1].aucPara[1]))
    {
        if (gastAtParaList[1].usParaLen < 3)
        {
            return AT_CME_RX_DIV_OTHER_ERR;
        }

        pucInputPara = &(gastAtParaList[1].aucPara[2]);
        usInputLen   = (VOS_UINT8)(gastAtParaList[1].usParaLen - 2);
    }

    if (usInputLen > 16)
    {
        return AT_CME_RX_DIV_OTHER_ERR;
    }

    /* AT??????????????????????ASCII?????????????????????? */
    if (usInputLen <= 8)
    {
        ulResult1 = At_String2Hex(pucInputPara,
                        usInputLen, pulSetDivLowBands);
    }
    else
    {
        ulResult1 = At_String2Hex(pucInputPara,
                            usInputLen-8,pulSetDivHighBands);
        ulResult2 = At_String2Hex(pucInputPara + (usInputLen - 8),
                            8,pulSetDivLowBands);
    }
    if ((AT_FAILURE == ulResult1) || (AT_FAILURE == ulResult2))
    {
        return AT_CME_RX_DIV_OTHER_ERR;
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_CovertUserSetRxDivParaToMsInternal
 ????????  : ??????????????????????????????????
 ????????  : VOS_UINT32 ulSetDivLowBands
             VOS_UINT32 ulSetDivHighBands
             VOS_UINT16 *pusSetDivBands
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??2??21??
    ??    ??   : l65478
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 At_CovertUserSetRxDivOrRxPriParaToMsInternal(
    VOS_UINT32 ulSetDivLowBands,
    VOS_UINT32 ulSetDivHighBands,
    VOS_UINT16 *pusSetDivBands
                )
{
    VOS_UINT32                      ulMsCapaDivLowBands;
    VOS_UINT32                      ulMsCapaDivHighBands;

    *pusSetDivBands      = 0;

    /*??????????????????????????:
        0x80000            GSM850
        0x300              GSM900
        0x80               DCS1800
        0x200000           PCS1900
        0x400000           WCDMA2100
        0x800000           WCDMA1900
        0x1000000          WCDMA1800
        0x2000000          WCDMA_AWS
        0x4000000          WCDMA850
        0x2000000000000    WCDMA900
        0x4000000000000    WCDMA1700
      ??MS??????????????????????:
        2100M/ bit1  1900M/bit2  1800M/bit3  1700M/bit4  1600M/bit5
        1500M/bit6   900M/bit7   850M/bit8   800M/bit9   450M/bit10
      ??????????????????????????????MS??????????
    */
    ulMsCapaDivLowBands  = TAF_PH_BAND_WCDMA_I_IMT_2100
                         | TAF_PH_BAND_WCDMA_II_PCS_1900
                         | TAF_PH_BAND_WCDMA_III_1800
                         | TAF_PH_BAND_WCDMA_V_850;
    ulMsCapaDivHighBands = TAF_PH_BAND_WCDMA_IX_1700
                         | TAF_PH_BAND_WCDMA_VIII_900;
    if (   (0 != (ulSetDivLowBands & (~ulMsCapaDivLowBands)))
        || (0 != (ulSetDivHighBands & (~ulMsCapaDivHighBands))))
    {
        return AT_CME_RX_DIV_NOT_SUPPORTED;
    }
    if (0 != (ulSetDivHighBands & TAF_PH_BAND_WCDMA_VIII_900))
    {
        *pusSetDivBands |= AT_MS_SUPPORT_RX_DIV_900;
    }
    if (0 != (ulSetDivHighBands & TAF_PH_BAND_WCDMA_IX_1700))
    {
        *pusSetDivBands |= AT_MS_SUPPORT_RX_DIV_IX_1700;
    }
    if (0 != (ulSetDivLowBands & TAF_PH_BAND_WCDMA_I_IMT_2100))
    {
        *pusSetDivBands |= AT_MS_SUPPORT_RX_DIV_2100;
    }
    if (0 != (ulSetDivLowBands & TAF_PH_BAND_WCDMA_II_PCS_1900))
    {
        *pusSetDivBands |= AT_MS_SUPPORT_RX_DIV_1900;
    }
    if (0 != (ulSetDivLowBands & TAF_PH_BAND_WCDMA_III_1800))
    {
        *pusSetDivBands |= AT_MS_SUPPORT_RX_DIV_1800;
    }
    if (0 != (ulSetDivLowBands & TAF_PH_BAND_WCDMA_V_850))
    {
        *pusSetDivBands |= AT_MS_SUPPORT_RX_DIV_850;
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SaveRxDivPara
 ????????  : ??????????????????????????????NV??
 ????????  : VOS_UINT16  usSetDivBands ??????????????????????
             VOS_UINT8   ucRxDivCfg    ??????????????????????????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??02??21??
    ??    ??   : l65478
    ????????   : ??????????
  2.??    ??   : 2011??10??19??
    ??    ??   : c00173809
    ????????   : AT ??????????NV??en_NV_Item_ANTENNA_CONFIG????en_NV_Item_W_RF_DIV_BAND????
  3.??    ??   : 2012??12??13??
    ??    ??   : L00171473
    ????????   : DTS2012121802573, TQE????
  4.??    ??   : 2013??05??20??
    ??    ??   : m00217266
    ????????   : nv??????
*****************************************************************************/
VOS_UINT32 At_SaveRxDivPara(
        VOS_UINT16                      usSetDivBands,
        VOS_UINT8                       ucRxDivCfg
        )
{
    TAF_AT_NVIM_RXDIV_CONFIG_STRU       stRxdivConfig;
    VOS_UINT32                          ulNvLength;

    PS_MEM_SET(&stRxdivConfig, 0x00, sizeof(TAF_AT_NVIM_RXDIV_CONFIG_STRU));
    ulNvLength = 0;

    stRxdivConfig.ucVaild = ucRxDivCfg;

    /*NV??en_NV_Item_ANTENNA_CONFIG??V3R2B060??????en_NV_Item_W_RF_DIV_BAND??
      ????NV????????????*/
    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_W_RF_DIV_BAND, &usSetDivBands, sizeof(VOS_UINT16)))
    {
        TAF_LOG(WUEPS_PID_AT, 0, PS_LOG_LEVEL_ERROR,
                "NV_WriteEx en_NV_Item_W_RF_DIV_BAND fail!\n");
        return AT_CME_RX_DIV_OTHER_ERR;
    }

    (VOS_VOID)NV_GetLength(en_NV_Item_RXDIV_CONFIG, &ulNvLength);
    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_RXDIV_CONFIG, &stRxdivConfig, ulNvLength))
    {
        TAF_LOG(WUEPS_PID_AT, 0, PS_LOG_LEVEL_ERROR,
                "NV_WriteEx en_NV_RXDIV_CONFIG fail!\n");
        return AT_CME_RX_DIV_OTHER_ERR;
    }

    return AT_OK;
}
/* Add by w00199382 for V7????????, 2012-04-07, Begin   */
VOS_UINT32 At_GetTmodeFromNV(VOS_VOID)
{
    VOS_UINT32                          ulTmodeRat;
    VOS_UINT32                          ulRet;


    ulTmodeRat = 0;

    ulRet = NVM_Read(EN_NV_ID_TMODE_RAT, &ulTmodeRat, sizeof(ulTmodeRat));
    (VOS_VOID)vos_printf("\n At_GetTmodeFromNV ulTmodeRat=0x%x \n",ulTmodeRat);
    if(ERR_MSP_SUCCESS != ulRet)
    {
        (VOS_VOID)vos_printf("\n At_GetTmodeFromNV return failed !!!\n");
        ulTmodeRat = 0xc0;

        g_stTmodeRat.ucWCDMAIsSet   =      ulTmodeRat & 0x00000001;
        g_stTmodeRat.ucCDMAIsSet    = (ulTmodeRat>>1) & 0x00000001;
        g_stTmodeRat.ucTDSCDMAIsSet = (ulTmodeRat>>2) & 0x00000001;
        g_stTmodeRat.ucGSMIsSet     = (ulTmodeRat>>3) & 0x00000001;
        g_stTmodeRat.ucEDGEIsSet    = (ulTmodeRat>>4) & 0x00000001;
        g_stTmodeRat.ucAWSIsSet     = (ulTmodeRat>>5) & 0x00000001;
        g_stTmodeRat.ucFDDLTEIsSet  = (ulTmodeRat>>6) & 0x00000001;
        g_stTmodeRat.ucTDDLTEIsSet  = (ulTmodeRat>>7) & 0x00000001;
        g_stTmodeRat.ucWIFIIsSet    = (ulTmodeRat>>8) & 0x00000001;

        return ulRet;
    }
    else
    {
        if(ulTmodeRat == 0)
        {
            return ERR_MSP_NV_DATA_INVALID;
        }
        else
        {
            g_stTmodeRat.ucWCDMAIsSet   =      ulTmodeRat & 0x00000001;
            g_stTmodeRat.ucCDMAIsSet    = (ulTmodeRat>>1) & 0x00000001;
            g_stTmodeRat.ucTDSCDMAIsSet = (ulTmodeRat>>2) & 0x00000001;
            g_stTmodeRat.ucGSMIsSet     = (ulTmodeRat>>3) & 0x00000001;
            g_stTmodeRat.ucEDGEIsSet    = (ulTmodeRat>>4) & 0x00000001;
            g_stTmodeRat.ucAWSIsSet     = (ulTmodeRat>>5) & 0x00000001;
            g_stTmodeRat.ucFDDLTEIsSet  = (ulTmodeRat>>6) & 0x00000001;
            g_stTmodeRat.ucTDDLTEIsSet  = (ulTmodeRat>>7) & 0x00000001;
            g_stTmodeRat.ucWIFIIsSet    = (ulTmodeRat>>8) & 0x00000001;

        }
    }
    return ERR_MSP_SUCCESS;

}

VOS_BOOL at_TmodeIsLteSingle(VOS_VOID)
{
    VOS_UINT32 ulLte = 0;
    VOS_UINT32 ulGu = 0;

    ulLte = g_stTmodeRat.ucTDSCDMAIsSet+g_stTmodeRat.ucFDDLTEIsSet+g_stTmodeRat.ucTDDLTEIsSet;
    ulGu = g_stTmodeRat.ucWCDMAIsSet+g_stTmodeRat.ucCDMAIsSet+g_stTmodeRat.ucGSMIsSet
              +g_stTmodeRat.ucEDGEIsSet +g_stTmodeRat.ucAWSIsSet+g_stTmodeRat.ucWIFIIsSet;

    if( ( ulLte >= 1 ) && ( ulGu == 0 ) )
    {
        return TRUE;
    }
    else
    {
        return FALSE;
    }
}

VOS_BOOL at_TmodeIsGuSingle(VOS_VOID)
{
    VOS_UINT32 ulLte = 0;
    VOS_UINT32 ulGu = 0;

    ulLte = g_stTmodeRat.ucTDSCDMAIsSet+g_stTmodeRat.ucFDDLTEIsSet+g_stTmodeRat.ucTDDLTEIsSet;
    ulGu = g_stTmodeRat.ucWCDMAIsSet+g_stTmodeRat.ucCDMAIsSet+g_stTmodeRat.ucGSMIsSet
              +g_stTmodeRat.ucEDGEIsSet +g_stTmodeRat.ucAWSIsSet+g_stTmodeRat.ucWIFIIsSet;

    if( ( ulLte == 0 )&& ( ulGu >= 1 ) )
    {
        return TRUE;
    }
    else
    {
        return FALSE;
    }
}

VOS_BOOL at_TmodeIsMultiMode(VOS_VOID)
{
    VOS_UINT32 ulLte = 0;
    VOS_UINT32 ulGu = 0;

    ulLte = g_stTmodeRat.ucTDSCDMAIsSet+g_stTmodeRat.ucFDDLTEIsSet+g_stTmodeRat.ucTDDLTEIsSet;
    ulGu = g_stTmodeRat.ucWCDMAIsSet+g_stTmodeRat.ucCDMAIsSet+g_stTmodeRat.ucGSMIsSet
              +g_stTmodeRat.ucEDGEIsSet +g_stTmodeRat.ucAWSIsSet+g_stTmodeRat.ucWIFIIsSet;

    if( ( ulLte >= 1 )&& ( ulGu >= 1 ) )
    {
        return TRUE;
    }
    else
    {
        return FALSE;
    }
}


TAF_VOID AtTmodShowDebug(VOS_VOID)
{
    (VOS_VOID)vos_printf("\n g_ulTmodeNum=0x%x \n",g_ulTmodeNum);
    (VOS_VOID)vos_printf("\n g_ulGuTmodeCnfNum=0x%x \n",g_ulGuTmodeCnfNum);
}

/* Add by w00199382 for V7????????, 2012-04-07, End   */

/*****************************************************************************
 ?? ?? ??  : At_SetTModePara
 ????????  : TMODE ????????????????
 ????????  : ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??6??9??
    ??    ??   : l00130025
    ????????   : ??????????
  2.??    ??   : 2011??06??09??
    ??    ??   : f00179208
    ????????   : ????????:DTS2011060304914,??E353s-2????AT 2011.6.2??????AT^TMODE=2/3????????????????OK
                 ??????????????????????E367u????OK????????????
  3.??    ??   : 2011??10??19??
    ??    ??   : w00181244
    ????????   : ???? LTE ????????????AT_TMODE_UPGRADE??????
  4.??    ??   : 2012??1??3??
    ??    ??   : f62575
    ????????   : SMALL IMAGE????????: ??????????????????????
  5.??    ??   : 2012??12??11??
    ??    ??   : l00167671
    ????????   : DTS2012121802573, TQE????
  6.??    ??   : 2013??9??3??
    ??    ??   : z60575,l00169177
    ????????   : DTS2013082901597, ????V7R2????
  7.??    ??   : 2014??2??14??
    ??    ??   : w00167002
    ????????   : L-C??????????:??????????????
*****************************************************************************/
TAF_UINT32  At_SetTModePara(TAF_UINT8 ucIndex )
{

    /* Modified by w00167002 for L-C??????????, 2014-2-14, begin */
    TAF_MMA_PHONE_MODE_PARA_STRU        stPhoneModePara;
    /* Modified by w00167002 for L-C??????????, 2014-2-14, end */
    VOS_UINT8                           ucUpdateFlag;


    /* Modified by w00167002 for L-C??????????, 2014-2-14, begin */
    PS_MEM_SET(&stPhoneModePara, 0x00, sizeof(stPhoneModePara));
    /* Modified by w00167002 for L-C??????????, 2014-2-14, end */


    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????TMODE */
    if (AT_TMODE_BUTT <= gastAtParaList[0].ulParaValue )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    switch (gastAtParaList[0].ulParaValue)
    {
        case AT_TMODE_NORMAL :

            /* Modified by w00167002 for L-C??????????, 2014-2-14, begin */
            stPhoneModePara.PhMode = TAF_PH_MODE_FULL;

            if (VOS_TRUE == TAF_MMA_PhoneModeSetReq(WUEPS_PID_AT, gastAtClientTab[ucIndex].usClientId, 0, &stPhoneModePara))
            {
                /* ???????????????? */
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SET_TMODE;
                PS_MEM_SET(&g_stAtDevCmdCtrl,0x00,sizeof(g_stAtDevCmdCtrl));
                g_stAtDevCmdCtrl.ucCurrentTMode = AT_TMODE_NORMAL;

                return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
            }
            /* Modified by w00167002 for L-C??????????, 2014-2-14, end */
            else
            {
                return AT_ERROR;
            }
        case AT_TMODE_FTM :

            if (AT_TMODE_UPGRADE == g_stAtDevCmdCtrl.ucCurrentTMode)
            {
                return AT_ERROR;
            }

            /* Modified by w00167002 for L-C??????????, 2014-2-14, begin */
            stPhoneModePara.PhMode = TAF_PH_MODE_FT;

            if (VOS_TRUE == TAF_MMA_PhoneModeSetReq(WUEPS_PID_AT, gastAtClientTab[ucIndex].usClientId, 0, &stPhoneModePara))
            {
                /* ???????????????? */
                g_stAtDevCmdCtrl.ucCurrentTMode = AT_TMODE_FTM;
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SET_TMODE;
                return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
            }
            /* Modified by w00167002 for L-C??????????, 2014-2-14, end */
            else
            {
                return AT_ERROR;
            }
        case AT_TMODE_UPGRADE :

            if (AT_TMODE_FTM == g_stAtDevCmdCtrl.ucCurrentTMode)
            {
                return AT_ERROR;
            }
            /* ???????? C ??????????????????????????????????????????????DRV_AGENT_TMODE_SET_REQ
               ????????AT_OK???????????????????? */
            ucUpdateFlag = VOS_TRUE;

            if (TAF_SUCCESS != AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   gastAtClientTab[ucIndex].opId,
                                   DRV_AGENT_TMODE_SET_REQ,
                                   &ucUpdateFlag,
                                   sizeof(ucUpdateFlag),
                                   I0_WUEPS_PID_DRV_AGENT))
            {
                AT_ERR_LOG("AT_SetPstandbyPara: AT_FillAndSndAppReqMsg fail.");
            }

            g_stAtDevCmdCtrl.ucCurrentTMode = AT_TMODE_UPGRADE;
            return AT_OK;
        case AT_TMODE_RESET :

            g_stAtDevCmdCtrl.ucCurrentTMode = AT_TMODE_RESET;

            /* ???????? */
            ucUpdateFlag = VOS_FALSE;

            if (TAF_SUCCESS != AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   gastAtClientTab[ucIndex].opId,
                                   DRV_AGENT_TMODE_SET_REQ,
                                   &ucUpdateFlag,
                                   sizeof(ucUpdateFlag),
                                   I0_WUEPS_PID_DRV_AGENT))
            {
                AT_ERR_LOG("AT_SetPstandbyPara: AT_FillAndSndAppReqMsg fail.");
            }

            return AT_OK;
           /* Added by f62575 for SMALL IMAGE, 2012-1-3, begin */
        case AT_TMODE_POWEROFF:
                return AT_SetTmodeAutoPowerOff(ucIndex);
           /* Added by f62575 for SMALL IMAGE, 2012-1-3, end   */

           /* ??????????????4->11??????1???????????? */
        case AT_TMODE_SIGNALING :
               if (AT_TMODE_UPGRADE == g_stAtDevCmdCtrl.ucCurrentTMode)
               {
                   return AT_ERROR;
               }

           /* Modified by w00167002 for L-C??????????, 2014-2-14, begin */
           stPhoneModePara.PhMode = TAF_PH_MODE_FT;

           if (VOS_TRUE == TAF_MMA_PhoneModeSetReq(WUEPS_PID_AT, gastAtClientTab[ucIndex].usClientId, 0, &stPhoneModePara))
           {
               /* ???????????????? */
               g_stAtDevCmdCtrl.ucCurrentTMode = AT_TMODE_SIGNALING;
               gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SET_TMODE;
               return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
           }
           /* Modified by w00167002 for L-C??????????, 2014-2-14, end */
           else
           {
               return AT_ERROR;
           }

           /* ??????????????5->12??????0???????????? */
        case AT_TMODE_OFFLINE :

           /* Modified by w00167002 for L-C??????????, 2014-2-14, begin */
           stPhoneModePara.PhMode = TAF_PH_MODE_FULL;

           if (VOS_TRUE == TAF_MMA_PhoneModeSetReq(WUEPS_PID_AT, gastAtClientTab[ucIndex].usClientId, 0, &stPhoneModePara))
           {
               /* ???????????????? */
               gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SET_TMODE;
               PS_MEM_SET(&g_stAtDevCmdCtrl,0x00,sizeof(g_stAtDevCmdCtrl));
               g_stAtDevCmdCtrl.ucCurrentTMode = AT_TMODE_OFFLINE;

               return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
           }
           /* Modified by w00167002 for L-C??????????, 2014-2-14, end */
           else
           {
               return AT_ERROR;
           }

        case AT_TMODE_F_NONESIGNAL:
        case AT_TMODE_SYN_NONESIGNAL:
        case AT_TMODE_SET_SLAVE:
        case AT_TMODE_GU_BT:
        case AT_TMODE_TDS_FAST_CT:
        case AT_TMODE_TDS_BT:
        case AT_TMODE_COMM_CT:
            if(atSetTmodePara(ucIndex, gastAtParaList[0].ulParaValue) == AT_OK)
            {
                gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SET_TMODE;
                g_stAtDevCmdCtrl.ucCurrentTMode        = (VOS_UINT8)gastAtParaList[0].ulParaValue;
                return AT_WAIT_ASYNC_RETURN;
            }
            else
            {
                return AT_ERROR;
            }

        default:
            break;
    }


    return AT_ERROR;
}


/*****************************************************************************
 ?? ?? ??  : At_GetDspLoadMode
 ????????  : ??????????????????????Load??DSP??????
 ????????  : VOS_UINT8 ucRatMode
 ????????  : ??
 ?? ?? ??  : TAF_UINT8
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??6??27??
    ??    ??   : l00130025
    ????????   : ??????????
  2.??    ??   : 2012??9??22??
    ??    ??   : f62575
    ????????   : DTS2012082900218 MT????????????????????G->W->L????????GAS????????????
  3.??    ??   : 2012??01??16??
    ??    ??   : m00217266
    ????????   : DSDA C??????????????(load mode????)

*****************************************************************************/
TAF_UINT8 At_GetDspLoadMode(VOS_UINT32 ulRatMode)
{
    if ((AT_RAT_MODE_WCDMA == ulRatMode)
     || (AT_RAT_MODE_AWS == ulRatMode))
    {
        return VOS_RATMODE_WCDMA;
    }
    else if ((AT_RAT_MODE_GSM == ulRatMode)
          || (AT_RAT_MODE_EDGE == ulRatMode))
    {
        return VOS_RATMODE_GSM;
    }
    else
    {
        return VOS_RATMODE_BUTT;
    }

}

/*****************************************************************************
 ?? ?? ??  : At_SendTxOnOffToGHPA
 ????????  : ??GDSP????????????????????????
 ????????  : VOS_UINT8                           ucIndex,
             VOS_UINT8                           ucSwitch
 ????????  : ??
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??6??27??
    ??    ??   : l00130025
    ????????   : ??????????
  2.??    ??   : 2011??7??7??
    ??    ??   : l60609
    ????????   : ????????:DTS2011060304931,????????AT????
  3.??    ??   : 2011??11??17??
    ??    ??   : f62575
    ????????   : ??????????????????
  4.??    ??   : 2012??12??21??
    ??    ??   : l00227485
    ????????   : DSDA PhaseII
*****************************************************************************/
VOS_UINT32  At_SendTxOnOffToGHPA(
    VOS_UINT8                           ucIndex,
    VOS_UINT8                           ucSwitch
)
{
    AT_GHPA_RF_TX_CFG_REQ_STRU          *pstTxMsg;
    VOS_UINT32                          ulLength;
    VOS_UINT16                          usMask;

    /* ????AT_GHPA_RF_TX_CFG_REQ_STRU???? */
    ulLength = sizeof(AT_GHPA_RF_TX_CFG_REQ_STRU) - VOS_MSG_HEAD_LENGTH;
    pstTxMsg = (AT_GHPA_RF_TX_CFG_REQ_STRU *)PS_ALLOC_MSG(WUEPS_PID_AT, ulLength);

    if (VOS_NULL_PTR == pstTxMsg)
    {
        AT_WARN_LOG("At_SendRfCfgReqToGHPA: alloc Tx msg fail!");
        return AT_FAILURE;
    }

    PS_MEM_SET(pstTxMsg,0x00,sizeof(AT_GHPA_RF_TX_CFG_REQ_STRU));

    /* Modified by L00171473 for DTS2012010901510 DSP PID????, 2012-01-07, begin */
    /* ?????????? */
    pstTxMsg->ulSenderCpuId   = VOS_LOCAL_CPUID;
    pstTxMsg->ulSenderPid     = WUEPS_PID_AT;
    pstTxMsg->ulReceiverCpuId = VOS_LOCAL_CPUID;
    pstTxMsg->ulReceiverPid   = AT_GetDestPid(ucIndex, I0_DSP_PID_GPHY);
    pstTxMsg->ulLength        = ulLength;
    /* Modified by L00171473 for DTS2012010901510 DSP PID????, 2012-01-07, end */

    /* Tx Cfg */

    /* ?????????? */
    pstTxMsg->usMsgID = ID_AT_GHPA_RF_TX_CFG_REQ;
    /* Added by ??????/f62575 for AT Project,??????????????????, 2011/11/15, begin */
    usMask            = G_RF_MASK_TX_AFC;

    /*AT^FDAC??????FDAC????AT^FWAVE??????power??????????????????????????????*/
    /* ??????????????
        0??GMSK????????,????????usTxVpa????????
        1??????????,????????usTxPower????????
        2??8PSK PaVbias????&DBB Atten&RF Atten??????
        usPAVbias??usRfAtten,sDbbAtten??????????????????*/
    if ( VOS_TRUE == g_stAtDevCmdCtrl.bFdacFlag )
    {
        pstTxMsg->enCtrlMode = AT_GHPA_RF_CTRLMODE_TYPE_GMSK;
        pstTxMsg->usTxVpa = g_stAtDevCmdCtrl.usFDAC;  /* DAC???? */
    }
    else
    {
        pstTxMsg->enCtrlMode = AT_GHPA_RF_CTRLMODE_TYPE_TXPOWER;
        pstTxMsg->usTxPower = g_stAtDevCmdCtrl.usPower;
    }
    /* Added by ??????/f62575 for AT Project,??????????????????, 2011/11/15, end */

    /* Tx Cfg */
    pstTxMsg->usMask = usMask;              /* ???????????????? */
    pstTxMsg->usAFC =  0;                   /* AFC */
    pstTxMsg->usFreqNum =
                (VOS_UINT16)((g_stAtDevCmdCtrl.stDspBandArfcn.usDspBand << 12) \
                            | g_stAtDevCmdCtrl.stDspBandArfcn.usUlArfcn);
                                            /* (Band << 12) | Arfcn */
    pstTxMsg->usTxMode = g_stAtDevCmdCtrl.usTxMode;    /* 0:burst????; 1:???????? */
    pstTxMsg->usModType = G_MOD_TYPE_GMSK;  /* ????????????:0????GMSK????;1????8PSK???????? */

    if (AT_DSP_RF_SWITCH_ON == ucSwitch)
    {
        pstTxMsg->usTxEnable = GDSP_CTRL_TX_ON;
    }
    else
    {
        pstTxMsg->usTxEnable = GDSP_CTRL_TX_OFF;
    }

    if ( VOS_OK != PS_SEND_MSG(WUEPS_PID_AT, pstTxMsg))
    {
        AT_WARN_LOG("At_SendTxOnOffToGHPA: Send msg fail!");
        return AT_FAILURE;
    }

    return AT_SUCCESS;
}

/*****************************************************************************
 ?? ?? ??  : At_SendRxOnOffToGHPA
 ????????  : ??GDSP????????????????????????
 ????????  : VOS_UINT8                           ucIndex,
             VOS_UINT8                           ucSwitch
                 ulRxSwitch - 0:????????????1:??????????
 ????????  : ??
 ?? ?? ??  : ??????????????AT_FAILURE:??????????AT_SUCCESS:????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??6??27??
    ??    ??   : l00130025
    ????????   : ??????????
  2.??    ??   : 2010??7??19??
    ??    ??   : z00161729
    ????????   : AT??????????????
  3.??    ??   : 2012??12??21??
    ??    ??   : l00227485
    ????????   : DSDA PhaseII
*****************************************************************************/
VOS_UINT32  At_SendRxOnOffToGHPA(
    VOS_UINT8                           ucIndex,
    VOS_UINT32                          ulRxSwitch
)
{
    AT_GHPA_RF_RX_CFG_REQ_STRU          *pstRxMsg;
    VOS_UINT32                          ulLength;
    VOS_UINT16                          usMask;

    /* ????AT_GHPA_RF_RX_CFG_REQ_STRU???? */
    ulLength = sizeof(AT_GHPA_RF_RX_CFG_REQ_STRU) - VOS_MSG_HEAD_LENGTH;
    pstRxMsg = (AT_GHPA_RF_RX_CFG_REQ_STRU *)PS_ALLOC_MSG(WUEPS_PID_AT, ulLength);

    if (VOS_NULL_PTR == pstRxMsg)
    {
        AT_WARN_LOG("At_SendRxOnOffToGHPA: alloc Rx msg fail!");
        return AT_FAILURE;
    }

    /* Modified by L00171473 for DTS2012010901510 DSP PID????, 2012-01-07, begin */
    /* Rx Cfg */
    pstRxMsg->ulReceiverPid   = AT_GetDestPid(ucIndex, I0_DSP_PID_GPHY);
    pstRxMsg->ulLength        = ulLength;
    pstRxMsg->usMsgID         = ID_AT_GHPA_RF_RX_CFG_REQ;
    pstRxMsg->usRsv           = 0;
    pstRxMsg->usRsv2          = 0;
    /* Modified by L00171473 for DTS2012010901510 DSP PID????, 2012-01-07, end */

    usMask = G_RF_MASK_RX_ARFCN | G_RF_MASK_RX_AGCMODE \
            | G_RF_MASK_RX_AGCGAIN | G_RF_MASK_RX_MODE;

    /* Reference MASK_CAL_RF_G_RX_* section */
    pstRxMsg->usMask = usMask;

    /* (Band << 12) | Arfcn */
    pstRxMsg->usFreqNum =
                    (VOS_UINT16)((g_stAtDevCmdCtrl.stDspBandArfcn.usDspBand << 12) \
                                | g_stAtDevCmdCtrl.stDspBandArfcn.usUlArfcn);

    /* 0:????; 1:????????; */
    if ( TRUE == ulRxSwitch )
    {
        pstRxMsg->usRxMode  = AT_GDSP_RX_MODE_CONTINOUS_BURST;
    }
    else
    {
        pstRxMsg->usRxMode  = AT_GDSP_RX_MODE_STOP;
    }

    /* 1:Fast AGC,0:Slow AGC */
    pstRxMsg->usAGCMode = AT_GDSP_RX_SLOW_AGC_MODE;

    /* AGC????????????,??????0-3*/
    pstRxMsg->usAgcGain = g_stAtDevCmdCtrl.ucLnaLevel;

    if ( VOS_OK != PS_SEND_MSG(WUEPS_PID_AT, pstRxMsg))
    {
        AT_WARN_LOG("At_SendRxOnOffToGHPA: Send msg fail!");
        return AT_FAILURE;
    }

    return AT_SUCCESS;
}

/*****************************************************************************
 ?? ?? ??  : At_SetFChanPara
 ????????  : FCHAN ????????????,????????????????????
 ????????  : ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??6??9??
    ??    ??   : l00130025
    ????????   : ??????????
  2.??    ??   : 2011??07??18??
    ??    ??   : l60609
    ????????   : DTS2011071802166:????WIFI????

  3.??    ??   : 2011??10??17??
    ??    ??   : ????/w00181244
    ????????   : ????????????????????API At_CheckFChanPara??SHPA_LoadPhy????????????C????????
  4.??    ??   : 2013??9??3??
    ??    ??   : z60575,l00169177
    ????????   : DTS2013082901597, ????V7R2????
*****************************************************************************/
TAF_UINT32  At_SetFChanPara(TAF_UINT8 ucIndex )
{
    DRV_AGENT_FCHAN_SET_REQ_STRU         stFchanSetReq;

    /* Modify by w00199382 for V7????????, 2012-04-07, Begin   */
    /* ???? LTE ???????????? */

    if ( (AT_RAT_MODE_FDD_LTE == gastAtParaList[0].ulParaValue)
       ||(AT_RAT_MODE_TDD_LTE == gastAtParaList[0].ulParaValue))
    {
        /*DTS2012041102190 : h00135900 start in 2011-04-11 AT????????*/

        g_stAtDevCmdCtrl.ucDeviceRatMode = (AT_DEVICE_CMD_RAT_MODE_ENUM_UINT8)(gastAtParaList[0].ulParaValue);

        /*DTS2012041102190 : h00135900 end in 2011-04-11 AT????????*/
        return atSetFCHANPara(ucIndex);
    }


    if(AT_RAT_MODE_TDSCDMA == gastAtParaList[0].ulParaValue)
    {
        g_stAtDevCmdCtrl.ucDeviceRatMode = (AT_DEVICE_CMD_RAT_MODE_ENUM_UINT8)(gastAtParaList[0].ulParaValue);
        return atSetFCHANPara(ucIndex);
    }

    /* Modify by w00199382 for V7????????, 2012-04-07, End   */

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_FCHAN_OTHER_ERR;
    }
        /* ?????????????? */
    if (gucAtParaIndex != 3)
    {
        return AT_FCHAN_OTHER_ERR;
    }

    /* WIFI??????????????????8??????????????????15*/
    if (((AT_RAT_MODE_WIFI == gastAtParaList[0].ulParaValue) && (AT_BAND_WIFI != gastAtParaList[1].ulParaValue))
      ||((AT_BAND_WIFI == gastAtParaList[1].ulParaValue)&&(AT_RAT_MODE_WIFI != gastAtParaList[0].ulParaValue)))
    {
        return AT_CHANNEL_NOT_SET;
    }

    /* WIFI ???? */
    if (BSP_MODULE_SUPPORT == mdrv_misc_support_check(BSP_MODULE_TYPE_WIFI))
    {
        if (AT_RAT_MODE_WIFI == gastAtParaList[0].ulParaValue)
        {
            /*WIFI??Enable????????????*/
            if(VOS_FALSE == (VOS_UINT32)WIFI_GET_STATUS())
            {
                return AT_FCHAN_OTHER_ERR;
            }

            g_stAtDevCmdCtrl.ucDeviceRatMode = AT_RAT_MODE_WIFI;

            return AT_OK;
        }
    }

    if (AT_TMODE_FTM != g_stAtDevCmdCtrl.ucCurrentTMode)
    {
        return AT_DEVICE_MODE_ERROR;
    }

    /* ????FCHAN ??????????????????*/
    if ((AT_RAT_MODE_GSM != gastAtParaList[0].ulParaValue)
     && (AT_RAT_MODE_EDGE != gastAtParaList[0].ulParaValue)
     && (AT_RAT_MODE_WCDMA != gastAtParaList[0].ulParaValue)
     && (AT_RAT_MODE_AWS != gastAtParaList[0].ulParaValue)
    )
    {
        return AT_DEVICE_MODE_ERROR;
    }

    if (AT_BAND_BUTT <= gastAtParaList[1].ulParaValue)
    {
        return AT_FCHAN_BAND_NOT_MATCH;
    }

    PS_MEM_SET(&stFchanSetReq, 0, sizeof(DRV_AGENT_FCHAN_SET_REQ_STRU));

    stFchanSetReq.ucLoadDspMode       = At_GetDspLoadMode (gastAtParaList[0].ulParaValue);
    stFchanSetReq.ucCurrentDspMode    = At_GetDspLoadMode (g_stAtDevCmdCtrl.ucDeviceRatMode);  /*???????????? */
    stFchanSetReq.bDspLoadFlag        = g_stAtDevCmdCtrl.bDspLoadFlag;
    stFchanSetReq.ucDeviceRatMode     = (VOS_UINT8)gastAtParaList[0].ulParaValue;
    stFchanSetReq.ucDeviceAtBand      = (VOS_UINT8)gastAtParaList[1].ulParaValue;
    stFchanSetReq.usChannelNo         = (VOS_UINT16)gastAtParaList[2].ulParaValue;

    if (TAF_SUCCESS == AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                              gastAtClientTab[ucIndex].opId,
                                              DRV_AGENT_FCHAN_SET_REQ,
                                              &stFchanSetReq,
                                              sizeof(stFchanSetReq),
                                              I0_WUEPS_PID_DRV_AGENT))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_FCHAN_SET;             /*???????????????? */
        return AT_WAIT_ASYNC_RETURN;                                           /* ???????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : At_SendTxOnToHPA
 ????????  : ??WDSP????????TxOn????????
 ????????  : ??
 ????????  : ??
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??6??27??
    ??    ??   : l00130025
    ????????   : ??????????
  2.??    ??   : 2011??7??7??
    ??    ??   : l60609
    ????????   : ????????:DTS2011060304931,????????AT????
  3.??    ??   : 2016??1??8??
    ??    ??   : n00355355
    ????????   : Chicago ModemI Support WCDMA????????
  4.??    ??   : 2016??3??16??
    ??    ??   : l00198894
    ????????   : DTS2016031602080 ????????UMTS????????
*****************************************************************************/
TAF_UINT32  At_SendTxOnOffToHPA(
    TAF_UINT8                           ucSwitch,
    TAF_UINT8                           ucIndex
)
{
    AT_HPA_RF_CFG_REQ_STRU              *pstMsg;
    VOS_UINT32                          ulLength;
    VOS_UINT16                          usMask;

    /* ????AT_HPA_RF_CFG_REQ_STRU???? */
    ulLength = sizeof(AT_HPA_RF_CFG_REQ_STRU) - VOS_MSG_HEAD_LENGTH;
    pstMsg = (AT_HPA_RF_CFG_REQ_STRU *)PS_ALLOC_MSG(WUEPS_PID_AT, ulLength);

    if (VOS_NULL_PTR == pstMsg)
    {
        AT_WARN_LOG("At_SendTxOnOffToHPA: alloc msg fail!");
        return AT_FAILURE;
    }

    PS_MEM_SET(pstMsg,0x00,sizeof(AT_HPA_RF_CFG_REQ_STRU));

    /* Modified by L00171473 for DTS2012010901510 DSP PID????, 2012-01-07, begin */
    /* ?????????? */
    pstMsg->ulSenderCpuId   = VOS_LOCAL_CPUID;
    pstMsg->ulSenderPid     = WUEPS_PID_AT;
    pstMsg->ulReceiverCpuId = VOS_LOCAL_CPUID;
    pstMsg->ulReceiverPid   = AT_GetDestPid(ucIndex, I0_DSP_PID_WPHY);
    pstMsg->ulLength        = ulLength;
    /* Modified by L00171473 for DTS2012010901510 DSP PID????, 2012-01-07, end */

    /* ?????????? */
    pstMsg->usMsgID = ID_AT_HPA_RF_CFG_REQ;

    /* Tx Cfg */
    usMask = W_RF_MASK_AFC | W_RF_MASK_TX_TXONOFF | W_RF_MASK_TX_PAMODE | W_RF_MASK_TX_POWDET;

    /*AT^FDAC??????FDAC????AT^FWAVE??????power??????????????????????????????*/
    if ( VOS_TRUE == g_stAtDevCmdCtrl.bFdacFlag )
    {
        usMask                      = usMask | W_RF_MASK_TX_AGC;
        pstMsg->stRfCfgPara.usTxAGC = g_stAtDevCmdCtrl.usFDAC;
    }
    else
    {
        usMask                       = usMask | W_RF_MASK_TX_POWER;
        pstMsg->stRfCfgPara.sTxPower = (VOS_INT16)g_stAtDevCmdCtrl.usPower;
    }

    /* Tx Cfg */
    pstMsg->stRfCfgPara.usMask      = usMask;                             /* ???????????????? */
    pstMsg->stRfCfgPara.usTxAFCInit = W_AFC_INIT_VALUE;              /* AFC */
    pstMsg->stRfCfgPara.usTxBand    = g_stAtDevCmdCtrl.stDspBandArfcn.usDspBand;    /* 1,2,3...,????????band????,????????BandId */
    pstMsg->stRfCfgPara.usTxFreqNum = g_stAtDevCmdCtrl.stDspBandArfcn.usUlArfcn; /* Arfcn */
    pstMsg->stRfCfgPara.usTxPAMode  = g_stAtDevCmdCtrl.ucPaLevel;

    if (AT_DSP_RF_SWITCH_OFF == ucSwitch)
    {
        pstMsg->stRfCfgPara.usTxEnable  = WDSP_CTRL_TX_OFF;                     /* ????????TX */
    }
    else
    {
        pstMsg->stRfCfgPara.usTxEnable  = WDSP_CTRL_TX_ON;                      /* ????????TX */
        pstMsg->stRfCfgPara.usMask      |= W_RF_MASK_TX_ARFCN;
    }

    if ( VOS_OK != PS_SEND_MSG(WUEPS_PID_AT, pstMsg))
    {
        AT_WARN_LOG("At_SendTxOnOffToHPA: Send msg fail!");
        return AT_FAILURE;
    }
    return AT_SUCCESS;
}


/*****************************************************************************
 ?? ?? ??  : At_SendRxOnOffToHPA
 ????????  : ????W??Rx??????????WDSP
 ????????  : ulRxSwitch - 0:????????????1:??????????
 ????????  : ??
 ?? ?? ??  : ??????????????AT_FAILURE:??????????AT_SUCCESS:????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??6??29??
    ??    ??   : l00130025
    ????????   : ??????????
  2.??    ??   : 2010??7??19??
    ??    ??   : z00161729
    ????????   : AT??????????????
  3.??    ??   : 2011??11??17??
    ??    ??   : f62575
    ????????   : ??????????????????
  4.??    ??   : 2012??04??06??
    ??    ??   : f62575
    ????????   : DTS2012040600347??????????????????????????????????????

  5.??    ??   : 2016??1??8??
    ??    ??   : n00355355
    ????????   : Chicago ModemI Support WCDMA????????
*****************************************************************************/
VOS_UINT32 At_SendRxOnOffToHPA(
    VOS_UINT32                          ulRxSwitch,
    VOS_UINT8                           ucIndex
)
{
    AT_HPA_RF_CFG_REQ_STRU              *pstMsg;
    VOS_UINT32                          ulLength;
    VOS_UINT16                          usMask;

    /* ????AT_HPA_RF_CFG_REQ_STRU???? */
    ulLength = sizeof(AT_HPA_RF_CFG_REQ_STRU) - VOS_MSG_HEAD_LENGTH;
    pstMsg   = (AT_HPA_RF_CFG_REQ_STRU *)PS_ALLOC_MSG(WUEPS_PID_AT, ulLength);

    if (VOS_NULL_PTR == pstMsg)
    {
        AT_WARN_LOG("At_SendRxOnOffToHPA: alloc msg fail!");
        return AT_FAILURE;
    }

    PS_MEM_SET(pstMsg, 0x00, sizeof(AT_HPA_RF_CFG_REQ_STRU));

    /* Modified by L00171473 for DTS2012010901510 DSP PID????, 2012-01-07, begin */
    /* ?????????? */
    pstMsg->ulSenderCpuId   = VOS_LOCAL_CPUID;
    pstMsg->ulSenderPid     = WUEPS_PID_AT;
    pstMsg->ulReceiverCpuId = VOS_LOCAL_CPUID;
    pstMsg->ulReceiverPid   = AT_GetDestPid(ucIndex, I0_DSP_PID_WPHY);
    pstMsg->ulLength        = ulLength;
    /* Modified by L00171473 for DTS2012010901510 DSP PID????, 2012-01-07, end */

    /* ?????????? */
    pstMsg->usMsgID = ID_AT_HPA_RF_CFG_REQ;

    /* Added by ??????/f62575 for AT Project,??????????????????, 2011/11/15, begin */
    usMask = W_RF_MASK_RX_ARFCN | W_RF_MASK_RX_ANTSEL \
             | W_RF_MASK_RX_RXONOFF;
    /* Added by ??????/f62575 for AT Project,??????????????????, 2011/11/15, end */

    /* ???????????????? */
    pstMsg->stRfCfgPara.usMask      = usMask;

    /* 1,2,3...,????????band???? */
    pstMsg->stRfCfgPara.usRxBand    = g_stAtDevCmdCtrl.stDspBandArfcn.usDspBand;
    pstMsg->stRfCfgPara.usRxFreqNum = g_stAtDevCmdCtrl.stDspBandArfcn.usDlArfcn;

    /* DSP????Band1-Band9??????????
       W Rf support
    -------------------------------------------------------------------------------
            bit8       bit7      bit6     bit5    bit4     bit3      bit2     bit1
    -------------------------------------------------------------------------------
    WCDMA   900(VIII)  2600(VII) 800(VI)  850(V)  1700(IV) 1800(III) 1900(II) 2100(I) oct1
            spare      spare     spare    spare   spare    spare     spare   J1700(IX)oct2
    */

    if (AT_RX_DIV_ON == g_stAtDevCmdCtrl.ucPriOrDiv)
    {
        pstMsg->stRfCfgPara.usRxAntSel = ANT_TWO;
    }
    else
    {
        pstMsg->stRfCfgPara.usRxAntSel = ANT_ONE;
    }

    /* LNA???????? */
    pstMsg->stRfCfgPara.usRxLNAGainMode = g_stAtDevCmdCtrl.ucLnaLevel;

    if (AT_DSP_RF_SWITCH_ON == ulRxSwitch)
    {
        if (ANT_TWO == pstMsg->stRfCfgPara.usRxAntSel)
        {
            /* CPU????????????????,????1??2 */
            pstMsg->stRfCfgPara.usRxEnable = DSP_CTRL_RX_ALL_ANT_ON;
        }
        else
        {
            /* CPU????????????????,????1 */
            pstMsg->stRfCfgPara.usRxEnable = DSP_CTRL_RX_ANT1_ON;
        }
    }
    else
    {
        /* ????????RX */
        pstMsg->stRfCfgPara.usRxEnable = DSP_CTRL_RX_OFF;
    }

    if (VOS_OK != PS_SEND_MSG(WUEPS_PID_AT, pstMsg))
    {
        AT_WARN_LOG("At_SendRxOnOffToHPA: Send msg fail!");
        return AT_FAILURE;
    }

    return AT_SUCCESS;
}


/*****************************************************************************
 ?? ?? ??  : At_SetFpaPara
 ????????  : ????????????PA????,????????:^FPA=< level >
 ????????  : ucIndex  - ????????
 ????????  : ??
 ?? ?? ??  : ????????????????????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??7??19??
    ??    ??   : z00161729
    ????????   : ??????????

  2.??    ??   : 2011??10??4??
    ??    ??   : w00181244
    ????????   : ????LTE????????????
*****************************************************************************/
VOS_UINT32 At_SetFpaPara(VOS_UINT8 ucIndex)
{
    /* ????LTE ???????????? */
    if ((AT_RAT_MODE_FDD_LTE == g_stAtDevCmdCtrl.ucDeviceRatMode)
      ||(AT_RAT_MODE_TDD_LTE == g_stAtDevCmdCtrl.ucDeviceRatMode))
    {
        return AT_CMD_NOT_SUPPORT;
    }
    if(AT_RAT_MODE_TDSCDMA == g_stAtDevCmdCtrl.ucDeviceRatMode)
    {
        return AT_CMD_NOT_SUPPORT;
    }
    /* ???????????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_FPA_OTHER_ERR;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_FPA_OTHER_ERR;
    }

    /* ?????????????????????????? */
    if (AT_TMODE_FTM != g_stAtDevCmdCtrl.ucCurrentTMode)
    {
        return AT_DEVICE_MODE_ERROR;
    }

    /* ??????????????????????????????,??^FCHAN?????????? */
    if (VOS_FALSE == g_stAtDevCmdCtrl.bDspLoadFlag)
    {
        return AT_CHANNEL_NOT_SET;
    }

    /* ???????????????????? */
    g_stAtDevCmdCtrl.ucPaLevel = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    return AT_OK;

}

/*****************************************************************************
 ?? ?? ??  : At_SetFlnaPara
 ????????  : ????????????LNA????,????????:^FLNA=< level >
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : ????????????????????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??7??19??
    ??    ??   : z00161729
    ????????   : ??????????
  2.??    ??   : 2011??10??4??
    ??    ??   : w00181244
    ????????   : ????LTE????????????
*****************************************************************************/
VOS_UINT32 At_SetFlnaPara(VOS_UINT8 ucIndex)
{

    /* ???? LTE ???????????? */
    if ((AT_RAT_MODE_FDD_LTE == g_stAtDevCmdCtrl.ucDeviceRatMode)
      ||(AT_RAT_MODE_TDD_LTE == g_stAtDevCmdCtrl.ucDeviceRatMode))
    {
        return atSetFLNAPara(ucIndex);
    }

    if(AT_RAT_MODE_TDSCDMA == g_stAtDevCmdCtrl.ucDeviceRatMode)
    {
        return atSetFLNAPara(ucIndex);
    }

    /* ???????????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_FLNA_OTHER_ERR;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_FLNA_OTHER_ERR;
    }

    /* ?????????????????????????? */
    if (AT_TMODE_FTM != g_stAtDevCmdCtrl.ucCurrentTMode)
    {
        return AT_DEVICE_MODE_ERROR;
    }

    /* ?????????????????????????????? */
    if (VOS_FALSE == g_stAtDevCmdCtrl.bDspLoadFlag)
    {
        return AT_CHANNEL_NOT_SET;
    }

    /* ????LNA???????????????? */
    if ((AT_RAT_MODE_WCDMA == g_stAtDevCmdCtrl.ucDeviceRatMode)
     || (AT_RAT_MODE_AWS == g_stAtDevCmdCtrl.ucDeviceRatMode))
    {
        /* WDSP LNA??????????0-2 */
        if (gastAtParaList[0].ulParaValue > DSP_LNA_HIGH_GAIN_MODE)
        {
            return AT_FLNA_OTHER_ERR;
        }
    }

    /* ???????????????????? */
    g_stAtDevCmdCtrl.ucLnaLevel = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    return AT_OK;

}

/*****************************************************************************
 ?? ?? ??  : At_SetFTxonPara
 ????????  : ^FTXON????????????
 ????????  : ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??6??9??
    ??    ??   : l00130025
    ????????   : ??????????

  2.??    ??   : 2011??10??3??
    ??    ??   : w00181244
    ????????   : ????LTE??????????????????

  3.??    ??   : 2011??10??3??
    ??    ??   : w00181244
    ????????   : SMALL IMAGE????????: ucSwitch??????????????????????????GU??????????GU??????LTE??????????

  4.??    ??   : 2012??12??21??
    ??    ??   : l00227485
    ????????   : DSDA PhaseII
*****************************************************************************/
TAF_UINT32  At_SetFTxonPara(TAF_UINT8 ucIndex )
{
    TAF_UINT8                           ucSwitch;

    /* ???? LTE ???????????? */
    if ((AT_RAT_MODE_FDD_LTE == g_stAtDevCmdCtrl.ucDeviceRatMode)
      ||(AT_RAT_MODE_TDD_LTE == g_stAtDevCmdCtrl.ucDeviceRatMode))
    {
        return atSetFTXONPara(ucIndex);
    }

    if(AT_RAT_MODE_TDSCDMA == g_stAtDevCmdCtrl.ucDeviceRatMode)
    {
        return atSetFTXONPara(ucIndex);
    }

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_FTXON_OTHER_ERR;
    }
    /* ?????????????? */
    if (1 != gucAtParaIndex)
    {
        return AT_FTXON_OTHER_ERR;
    }

    ucSwitch = (VOS_UINT8) gastAtParaList[0].ulParaValue;
    if (ucSwitch > AT_DSP_RF_SWITCH_ON)
    {
        return AT_FTXON_OTHER_ERR;
    }

    if (AT_TMODE_FTM != g_stAtDevCmdCtrl.ucCurrentTMode)
    {
        return AT_DEVICE_MODE_ERROR;
    }

    if (VOS_FALSE == g_stAtDevCmdCtrl.bDspLoadFlag)
    {
        return AT_CHANNEL_NOT_SET;
    }

    if ((AT_RAT_MODE_WCDMA == g_stAtDevCmdCtrl.ucDeviceRatMode)
     || (AT_RAT_MODE_AWS == g_stAtDevCmdCtrl.ucDeviceRatMode))
    {
        if (AT_FAILURE == At_SendTxOnOffToHPA(ucSwitch, ucIndex))
        {
            return AT_FTXON_SET_FAIL;
        }
    }
    else
    {
        if (AT_FAILURE == At_SendTxOnOffToGHPA(ucIndex, ucSwitch))
        {
            return AT_FTXON_SET_FAIL;
        }
    }
    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SET_FTXON;
    g_stAtDevCmdCtrl.ucIndex = ucIndex;

    return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */

}

/*****************************************************************************
 ?? ?? ??  : At_SetFRxonPara
 ????????  : ??????????,????????:^FRXON=< switch >
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : ????????????????????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??7??19??
    ??    ??   : z00161729
    ????????   : ??????????

  2.??    ??   : 2011??10??4??
    ??    ??   : w00181244
    ????????   : ????LTE????????????
  3.??    ??   : 2012??12??21??
    ??    ??   : l00227485
    ????????   : DSDA PhaseII
*****************************************************************************/
VOS_UINT32  At_SetFRxonPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                           ulSwitch;

     /* ???? LTE ???????????? */
    if ((AT_RAT_MODE_FDD_LTE == g_stAtDevCmdCtrl.ucDeviceRatMode)
      ||(AT_RAT_MODE_TDD_LTE == g_stAtDevCmdCtrl.ucDeviceRatMode))
    {
        return atSetFRXONPara(ucIndex);
    }

    if(AT_RAT_MODE_TDSCDMA == g_stAtDevCmdCtrl.ucDeviceRatMode)
    {
        return atSetFRXONPara(ucIndex);
    }


    /* ???????????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_FRXON_OTHER_ERR;
    }

    /* ?????????????? */
    if (gucAtParaIndex != 1)
    {
        return AT_FRXON_OTHER_ERR;
    }

    /* ??AT??????AT^TMODE=1???????????????? */
    if (AT_TMODE_FTM != g_stAtDevCmdCtrl.ucCurrentTMode)
    {
        return AT_DEVICE_MODE_ERROR;
    }

    /* ??AT??????????AT^FCHAN???????????????????????????????? */
    if (VOS_FALSE == g_stAtDevCmdCtrl.bDspLoadFlag)
    {
        return AT_CHANNEL_NOT_SET;
    }

    ulSwitch = gastAtParaList[0].ulParaValue;

    /* ????????????????????W?????? */
    if ((AT_RAT_MODE_WCDMA == g_stAtDevCmdCtrl.ucDeviceRatMode)
     || (AT_RAT_MODE_AWS   == g_stAtDevCmdCtrl.ucDeviceRatMode))
    {
        if (AT_FAILURE == At_SendRxOnOffToHPA(ulSwitch, ucIndex))
        {
            return AT_FRXON_SET_FAIL;
        }
    }
    else
    {
        /* ????????????????????G?????? */
        if (AT_FAILURE == At_SendRxOnOffToGHPA(ucIndex, ulSwitch))
        {
            return AT_FRXON_SET_FAIL;
        }
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SET_FRXON;
    g_stAtDevCmdCtrl.ucIndex               = ucIndex;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;

}

/*****************************************************************************
 ?? ?? ??  : AT_SetFDac
 ????????  : ^FDAC????????????DAC????G??????Tx Vba,W??????Tx AGC
 ????????  : ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??6??9??
    ??    ??   : l00130025
    ????????   : ??????????
  2.??    ??   : 2011??7??7??
    ??    ??   : l60609
    ????????   : ????????:DTS2011060304931,????????AT????

  3.??    ??   : 2011??10??15??
    ??    ??   : w00181244
    ????????   : ????LTE????????????

*****************************************************************************/
TAF_UINT32  AT_SetFDac(TAF_UINT8 ucIndex )
{

    TAF_UINT16                           usDAC;

    /*???? LTE ????????????*/
    if ((AT_RAT_MODE_FDD_LTE == g_stAtDevCmdCtrl.ucDeviceRatMode)
      ||(AT_RAT_MODE_TDD_LTE == g_stAtDevCmdCtrl.ucDeviceRatMode))
    {
        return AT_CMD_NOT_SUPPORT;
    }
    if(AT_RAT_MODE_TDSCDMA == g_stAtDevCmdCtrl.ucDeviceRatMode)
    {
        return AT_CMD_NOT_SUPPORT;
    }
    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_FDAC_SET_FAIL;
    }
    /* ?????????????? */
    if (gucAtParaIndex != 1)
    {
        return AT_FDAC_SET_FAIL;
    }
    if (AT_TMODE_FTM != g_stAtDevCmdCtrl.ucCurrentTMode)
    {
        return AT_DEVICE_MODE_ERROR;
    }

    if (VOS_FALSE == g_stAtDevCmdCtrl.bDspLoadFlag)
    {
        return AT_CHANNEL_NOT_SET;
    }

    usDAC = (VOS_UINT16)gastAtParaList[0].ulParaValue;

    if ((AT_RAT_MODE_WCDMA == g_stAtDevCmdCtrl.ucDeviceRatMode)
     || (AT_RAT_MODE_AWS == g_stAtDevCmdCtrl.ucDeviceRatMode))
    {
        if (usDAC > WDSP_MAX_TX_AGC)
        {
            return AT_FDAC_SET_FAIL;
        }
        else
        {
            g_stAtDevCmdCtrl.usFDAC = (VOS_UINT16)gastAtParaList[0].ulParaValue;
        }
    }
    else
    {
        if (usDAC > GDSP_MAX_TX_VPA)
        {
            return AT_FDAC_SET_FAIL;
        }
        else
        {
            g_stAtDevCmdCtrl.usFDAC = (VOS_UINT16)gastAtParaList[0].ulParaValue;
        }
    }

    /*AT^FDAC??????FDAC????AT^FWAVE??????power??????????????????????????????*/
    g_stAtDevCmdCtrl.bFdacFlag  = VOS_TRUE;
    g_stAtDevCmdCtrl.bPowerFlag = VOS_FALSE;

    return AT_OK;    /* ???????????????????? */

}

/* Add by c00172979 for V7????????, 2012-04-07, Begin   */
/*****************************************************************************
 ?? ?? ??  : if ( FEATURE_ON == FEATURE_LTE )
 ????????  : sfm????????
 ????????  : ??
 ?? ?? ??  : #
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??4??23??
    ??    ??   : w00199382
    ????????   : ??????????

*****************************************************************************/

VOS_UINT32 At_SetSfm(VOS_UINT8 ucIndex)
{
    VOS_UINT32  ulCustomVersion;

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_ERROR;
    }

    if(0 == gastAtParaList[0].usParaLen)
    {
        return AT_ERROR;
    }

    /* AT??????NV???????????????? */
    if(0 == gastAtParaList[0].ulParaValue)
    {
        ulCustomVersion = 1;    /* 1 ???????????? */
    }
    else
    {
        ulCustomVersion = 0;    /* 0 ???????????? */
    }

    /* ?????????????????? */
    if ( VOS_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_SW_VERSION_FLAG, &ulCustomVersion, sizeof(ulCustomVersion)) )
    {
        return AT_ERROR;
    }
    else
    {
        return AT_OK;
    }
}


/*****************************************************************************
 ?? ?? ??  : AT_SetFrStatus
 ????????  : ^FRSTATUS
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??06??03??
    ??    ??   : wx270776
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetFrStatus(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;
    AT_MTA_SET_FR_REQ_STRU              stAtMtaSetFrReq;
    PS_BOOL_ENUM_UINT8                  enActFrFlag;

    /* ?????????????? */
    ulRst                             = TAF_FAILURE;
    enActFrFlag                       = PS_BOOL_BUTT;
    PS_MEM_SET(&stAtMtaSetFrReq, 0, sizeof(AT_MTA_SET_FR_REQ_STRU));

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????????? */
    if (1 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* enActFrFlag??????????'0'~'1' */
    if ( (0 != (gastAtParaList[0].ulParaValue))
      && (1 != (gastAtParaList[0].ulParaValue)))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    enActFrFlag = (PS_BOOL_ENUM_UINT8)(gastAtParaList[0].ulParaValue);

    /* ?????????? */
    stAtMtaSetFrReq.enActFrFlag       = enActFrFlag;
    stAtMtaSetFrReq.aucRsv[0]         = 0;
    stAtMtaSetFrReq.aucRsv[1]         = 0;
    stAtMtaSetFrReq.aucRsv[2]         = 0;

    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   gastAtClientTab[ucIndex].opId,
                                   ID_AT_MTA_SET_FR_REQ,
                                   (VOS_VOID*)&stAtMtaSetFrReq,
                                   sizeof(AT_MTA_SET_FR_REQ_STRU),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_FRSTATUS_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}

/* Add by c00172979 for V7????????, 2012-04-07, End   */

/*****************************************************************************
 ?? ?? ??  : At_SetBsn
 ????????  : ??????????Bsn????
 ????????  : ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??6??9??
    ??    ??   : l00130025
    ????????   : ??????????
  2.??    ??   : 2011??06??29??
    ??    ??   : f00179208
    ????????   : ????????:DTS2011061400695,??V3C03B010????????AT??????????AT????????????????????????V1.1.4??????????
*****************************************************************************/

TAF_UINT32   At_SetBsn(TAF_UINT8 ucIndex)
{
    TAF_PH_SERIAL_NUM_STRU stSerialNum;

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_ERROR;
    }

    /* ????????????<imei>??????16?????????????? */
    if(TAF_SERIAL_NUM_LEN != gastAtParaList[0].usParaLen)
    {
        return AT_ERROR;
    }


    /*????<imei>????????????????,??????????????????*/
    if(AT_FAILURE == At_CheckNumCharString( gastAtParaList[0].aucPara,
                                        gastAtParaList[0].usParaLen))
    {
        return AT_ERROR;
    }

    PS_MEM_CPY(stSerialNum.aucSerialNum, gastAtParaList[0].aucPara, gastAtParaList[0].usParaLen);
    PS_MEM_SET(stSerialNum.aucSerialNum+TAF_SERIAL_NUM_LEN, 0, (VOS_SIZE_T)(4*sizeof(stSerialNum.aucSerialNum[0])));

    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_ManufactureInfo,
                           stSerialNum.aucSerialNum,
                           TAF_SERIAL_NUM_NV_LEN))
    {
        return AT_ERROR;
    }
    else
    {
       return AT_OK;
    }

}

/*****************************************************************************
 ?? ?? ??  : At_SetQosPara
 ????????  : ????????PDP??????????QoS??Traffic Class????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32:
             ????NV??????????AT_OK??
             ????????????????????AT_DATA_UNLOCK_ERROR??
             ??????????????AT_DEVICE_OTHER_ERROR
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??9??
    ??    ??   : w00167002
    ????????   : ??????????
  2.??    ??   : 2013??3??4??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
VOS_UINT32   At_SetQosPara(VOS_UINT8 ucIndex)
{
    VOS_UINT8                               ucQosPara;
    AT_TRAFFIC_CLASS_CUSTOMIZE_STRU         stATTrafficClass;
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, Begin */
    MODEM_ID_ENUM_UINT16                enModemId;
    VOS_UINT32                          ulRet;
    VOS_UINT32                          ulNvLength;

    enModemId = MODEM_ID_0;
    ulNvLength = 0;
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, End */

    /* ???????????????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_DEVICE_OTHER_ERROR;
    }

    /* ?????????????? */
    if (VOS_TRUE == g_bAtDataLocked)
    {
        return  AT_DATA_UNLOCK_ERROR;
    }

    /* ????????????1 */
    if (gucAtParaIndex != 1)
    {
        return AT_DEVICE_OTHER_ERROR;
    }

    /* ????????????1 */
    if (gastAtParaList[0].usParaLen != 1)
    {
        return AT_DEVICE_OTHER_ERROR;
    }

    ucQosPara = gastAtParaList[0].aucPara[0];

    /* ucQosPara??????????'0'~'4' */
    if (('0' <= ucQosPara) && ('4' >= ucQosPara))
    {
        ucQosPara = gastAtParaList[0].aucPara[0] - '0';
    }
    else
    {
        return AT_DEVICE_OTHER_ERROR;
    }

    /* ??NV??en_NV_Item_TRAFFIC_CLASS_Type??ucStatus??????????????1 */
    stATTrafficClass.ucStatus       = NV_ITEM_ACTIVE;

    /* ????????????????NV????ucTrafficClass???? */
    stATTrafficClass.ucTrafficClass = ucQosPara;

    /* Modified by l60609 for DSDA Phase III, 2013-3-4, Begin */
    ulRet = AT_GetModemIdFromClient(ucIndex, &enModemId);

    if (VOS_OK != ulRet)
    {
        AT_ERR_LOG("At_SetQosPara: Get modem id fail.");
        return AT_ERROR;
    }

    (VOS_VOID)NV_GetLength(en_NV_Item_TRAFFIC_CLASS_Type, &ulNvLength);
    if (NV_OK != NV_WriteEx(enModemId,
                            en_NV_Item_TRAFFIC_CLASS_Type,
                            &stATTrafficClass,
                            ulNvLength))
    {
        AT_WARN_LOG("At_SetQosPara:WARNING:NVIM Write en_NV_Item_TRAFFIC_CLASS_Type failed!");
        return AT_DEVICE_OTHER_ERROR;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, End */

    return  AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetSDomainPara
 ????????  : ??????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32:
             ????NV??????????AT_OK??
             ????????????????????AT_DATA_UNLOCK_ERROR??
             ??????????????AT_DEVICE_OTHER_ERROR
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??10??
    ??    ??   : w00167002
    ????????   : ??????????
  2.??    ??   : 2013??3??4??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  3.??    ??   : 2013??05??20??
    ??    ??   : m00217266
    ????????   : nv??????
  4.??    ??   : 2015??4??9??
    ??    ??   : h00313353
    ????????   : ????SrvDomain??????????
*****************************************************************************/
VOS_UINT32   At_SetSDomainPara(VOS_UINT8 ucIndex)
{
    TAF_MMA_SERVICE_DOMAIN_ENUM_UINT8   enSrvDomain;
    NAS_NVIM_MS_CLASS_STRU              stMsClass;
    VOS_UINT32                          ulNvLength;
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, Begin */
    MODEM_ID_ENUM_UINT16                enModemId;
    VOS_UINT32                          ulRet;

    enModemId = MODEM_ID_0;
    PS_MEM_SET(&stMsClass, 0x00, sizeof(NAS_NVIM_MS_CLASS_STRU));
    ulNvLength = 0;
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, End */

    /* ???????????????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_DEVICE_OTHER_ERROR;
    }

    /* ?????????????? */
    if (VOS_TRUE == g_bAtDataLocked)
    {
        return AT_DATA_UNLOCK_ERROR;
    }

    /* ????????????1 */
    if (gucAtParaIndex != 1)
    {
        return AT_DEVICE_OTHER_ERROR;
    }

    /* ????????????1 */
    if (gastAtParaList[0].usParaLen != 1)
    {
        return AT_DEVICE_OTHER_ERROR;
    }

    enSrvDomain = gastAtParaList[0].aucPara[0];

    /* ucSrvDomain??????????'0'~'3' */
    if (('0' <= enSrvDomain) && ('3' >= enSrvDomain))
    {
        /*????????????????????,??????0~3*/
        enSrvDomain = gastAtParaList[0].aucPara[0] - '0';
    }
    else
    {
        return AT_DEVICE_OTHER_ERROR;
    }

    /* ????????????????MsClass??????????3??????0*/
    if (TAF_MMA_SERVICE_DOMAIN_ANY == enSrvDomain)
    {
        enSrvDomain = TAF_MMA_SERVICE_DOMAIN_CS;
    }

    stMsClass.ucMsClass = enSrvDomain;
    /* ????????????????????NV??en_NV_Item_MMA_MsClass??MsClass???? */
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, Begin */
    ulRet = AT_GetModemIdFromClient(ucIndex, &enModemId);

    if (VOS_OK != ulRet)
    {
        AT_ERR_LOG("At_SetSDomainPara: Get modem id fail.");
        return AT_ERROR;
    }

    (VOS_VOID)NV_GetLength(en_NV_Item_MMA_MsClass, &ulNvLength);
    if (NV_OK != NV_WriteEx(enModemId,
                            en_NV_Item_MMA_MsClass,
                            &stMsClass,
                            ulNvLength))
    /* Modified by l60609 for DSDA Phase III, 2013-3-4, End */
    {
       AT_WARN_LOG("At_SetSDomainPara:WARNING:NVIM Write en_NV_Item_MMA_MsClass failed!");
       return AT_DEVICE_OTHER_ERROR;
    }
    return  AT_OK;
}


/*****************************************************************************
 ?? ?? ??  : At_WriteDpaCat
 ????????  : ??nv????dpa????????????
 ????????  : UINT8 ucDpaRate
 ????????  : ??
 ?? ?? ??  : VOS_OK  - ????????
             VOS_ERR - ????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??17??
    ??    ??   : w00167002
    ????????   : ??????????
  2.??    ??   : 2011??06??09??
    ??    ??   : h44270
    ????????  : ??????????DTS2011060304924,????????????AT^DPACAT=3/4
  3.??    ??   : 2011??06??14??
    ??    ??   : f00179208
    ????????  : ??????????DTS2011061304049,??V3R1C03B010??????????????????????AT??????????WasUeAccessCapa????????????
                ??AT^DPACAT=<VALUE>????????????????????AT^DPACAT???????????????WasUeAccessCapa??????????????????
  4.??    ??   : 2011??7??7??
    ??    ??   : l60609
    ????????   : ????????:DTS2011060304931,????????AT????
  5.??    ??   : 2012??5??18??
    ??    ??   : z60575
    ????????   : ????????:DTS2012051806821,W????????NV??????????
  6.??    ??   : 2012??8??10??
    ??    ??   : L00171473
    ????????   : DTS2012082204471, TQE????
*****************************************************************************/
VOS_UINT32 At_WriteDpaCatToNV(VOS_UINT8 ucDpaRate)
{
    AT_NVIM_UE_CAPA_STRU                stUECapa;
    AT_DPACAT_PARA_STRU                 astDhpaCategory[AT_DPACAT_CATEGORY_TYPE_BUTT] = {
                {PS_TRUE,   AT_HSDSCH_PHY_CATEGORY_6,  PS_FALSE, 0, PS_FALSE},                                                           /* ????????????3.6M  */
                {PS_TRUE,   AT_HSDSCH_PHY_CATEGORY_8,  PS_FALSE, 0, PS_FALSE},                                                           /* ????????????7.2M  */
                {PS_TRUE,   AT_HSDSCH_PHY_CATEGORY_11, PS_FALSE, 0, PS_FALSE},                                                           /* ????????????1.8M  */
                {PS_TRUE,   AT_HSDSCH_PHY_CATEGORY_10, PS_FALSE, 0, PS_FALSE},                                                          /*  ????????????14.4M */
                {PS_TRUE,   AT_HSDSCH_PHY_CATEGORY_10, PS_TRUE,  AT_HSDSCH_PHY_CATEGORY_14, PS_FALSE}};           /*  ????????????21M */


    PS_MEM_SET(&stUECapa, 0x00, sizeof(stUECapa));


    if (ucDpaRate >= AT_DPACAT_CATEGORY_TYPE_BUTT)
    {
        AT_WARN_LOG("At_WriteDpaCatToNV: WARNING:Input DPA rate index invalid!");
        return VOS_ERR;
    }

    if (NV_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_WAS_RadioAccess_Capa_New, &stUECapa, sizeof(AT_NVIM_UE_CAPA_STRU)))
    {
        AT_WARN_LOG("At_WriteDpaCatToNV: en_NV_Item_WAS_RadioAccess_Capa NV Read Fail!");
        return VOS_ERR;
    }

    /* ????????enHSDSCHSupport??????                */
    stUECapa.enHSDSCHSupport        = astDhpaCategory[ucDpaRate].enHSDSCHSupport;

    /* ????HS-DSCH????????????????                  */
    stUECapa.ucHSDSCHPhyCategory    = astDhpaCategory[ucDpaRate].ucHSDSCHPhyCategory;
    stUECapa.enMacEhsSupport        = astDhpaCategory[ucDpaRate].enMacEhsSupport;
    stUECapa.ucHSDSCHPhyCategoryExt = astDhpaCategory[ucDpaRate].ucHSDSCHPhyCategoryExt;

    /* ???????? Multi cell support,????????MultiCell,Ex2???? */
    stUECapa.enMultiCellSupport     = astDhpaCategory[ucDpaRate].enMultiCellSupport;

    /* ??????????????????????????????????????NV???? */
    stUECapa.ulHspaStatus           = NV_ITEM_ACTIVE;                /* ?????????????? */

    /* ??????????NV??????????????????????????????NV */
    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_WAS_RadioAccess_Capa_New, &stUECapa, sizeof(AT_NVIM_UE_CAPA_STRU)))
    {
        AT_WARN_LOG("At_WriteDpaCatToNV: en_NV_Item_WAS_RadioAccess_Capa NV Write Fail!");
        return VOS_ERR;
    }

    return VOS_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetDpaCat
 ????????  : ????????HSDPA??< rate >????????.????????????????????????????????
 ????????  : ucIndex    - ????????
 ????????  : ??
 ?? ?? ??  : ??????????????OK
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??7??23??
    ??    ??   : w00167002
    ????????   : ??????????
  2.??    ??   : 2012??4??1??
    ??    ??   : l60609
    ????????   : DTS2012032702034:????????????????ERROR
*****************************************************************************/

VOS_UINT32   At_SetDpaCat(VOS_UINT8 ucIndex)
{
    /*0     ??????????3.6M
     *1     ??????????7.2M
     *2     ??????????1.8M
     *3     ??????????14.4M
     *4     ??????????21M
    */
    VOS_UINT8                           ucDpaRate;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ????????1 */
    if (gucAtParaIndex != 1)
    {
        return AT_ERROR;
    }

    /* ??????????????1?? */
    if (gastAtParaList[0].usParaLen != 1)
    {
        return AT_ERROR;
    }

    ucDpaRate = gastAtParaList[0].aucPara[0];
    /* ucDpaRate??????????'0'~'4' */
    if (('0' <=ucDpaRate) && ('4' >= ucDpaRate))
    {
        ucDpaRate = gastAtParaList[0].aucPara[0] - '0';
    }
    else
    {
        return AT_ERROR;
    }

    if (VOS_TRUE == g_bAtDataLocked)
    {
        return  AT_ERROR;
    }

    /* ??????NV????????: At_WriteDpaCatToNV,???????????? */
    if (VOS_OK == At_WriteDpaCatToNV(ucDpaRate))
    {
        return  AT_OK;
    }
    else
    {
        AT_WARN_LOG("At_SetDpaCat:WARNING:WAS_MNTN_SetDpaCat failed!");
        return AT_ERROR;
    }

}

/*****************************************************************************
 ?? ?? ??  : AT_WriteRrcVerToNV
 ????????  : ??RrcVer????NV
 ????????  : VOS_UINT8 ucSrcWcdmaRRC
 ????????  : ??
 ?? ?? ??  : ??????????????OK
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??17??
    ??    ??   : w00167002
    ????????   : ??????????

  2.??    ??   : 2012??4??21??
    ??    ??   : l60609
    ????????   : DTS2012032304901:????????NV9008
*****************************************************************************/
VOS_UINT32 AT_WriteRrcVerToNV(VOS_UINT8 ucSrcWcdmaRRC)
{
    AT_NVIM_UE_CAPA_STRU                stUECapa;


    /* ??NV????????en_NV_Item_WAS_RadioAccess_Capa?? */
    if (NV_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_WAS_RadioAccess_Capa_New,
                         &stUECapa,
                         sizeof(AT_NVIM_UE_CAPA_STRU)))
    {
        AT_WARN_LOG("AT_WriteRrcVerToNV():en_NV_Item_WAS_RadioAccess_Capa_New NV Read Fail!");
        return VOS_ERR;
    }

    switch(ucSrcWcdmaRRC)
    {
        case AT_RRC_VERSION_WCDMA:
            stUECapa.enEDCHSupport    = VOS_FALSE;
            stUECapa.enHSDSCHSupport  = VOS_FALSE;
            break;

        case AT_RRC_VERSION_DPA:
            stUECapa.enEDCHSupport    = VOS_FALSE;
            stUECapa.enHSDSCHSupport  = VOS_TRUE;
            break;

        case AT_RRC_VERSION_DPA_AND_UPA:
            stUECapa.enAsRelIndicator = AT_PTL_VER_ENUM_R6;
            stUECapa.enEDCHSupport    = VOS_TRUE;
            stUECapa.enHSDSCHSupport  = VOS_TRUE;
            break;

        case AT_RRC_VERSION_HSPA_PLUNS:
            stUECapa.enAsRelIndicator = AT_PTL_VER_ENUM_R7;
            stUECapa.enEDCHSupport    = VOS_TRUE;
            stUECapa.enHSDSCHSupport  = VOS_TRUE;
            break;

        default:
            break;
    }

    /* ????????????????Balong NV ?????? */
    stUECapa.ulHspaStatus     = NV_ITEM_ACTIVE;


    /* ??????????NV??????????????????????????????NV */
    if(NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_WAS_RadioAccess_Capa_New,
                         &stUECapa,
                         sizeof(AT_NVIM_UE_CAPA_STRU)))
    {
        AT_WARN_LOG("AT_WriteRrcVerToNV():en_NV_Item_WAS_RadioAccess_Capa_New NV Write Fail!");
        return VOS_ERR;
    }

    return VOS_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetHspaSpt
 ????????  : ????RRC????????,????????????????????????????????.
 ????????  : ucIndex    - ????????
 ????????  : ??
 ?? ?? ??  : ??????????????OK
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??7??23??
    ??    ??   : w00167002
    ????????   : ??????????

*****************************************************************************/

VOS_UINT32   At_SetHspaSpt(VOS_UINT8 ucIndex)
{
    VOS_UINT8                           ucRRCVer;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_DPAUPA_ERROR;
    }

    /* ???????? */
    if (gucAtParaIndex != 1)
    {
        return AT_DPAUPA_ERROR;
    }

    /* ??????????????1?? */
    if (gastAtParaList[0].usParaLen != 1)
    {
        return AT_DPAUPA_ERROR;
    }

    ucRRCVer = gastAtParaList[0].aucPara[0];
    /* ucRRCVer??????????'0'~'2' */
    if (('0' <=ucRRCVer) && ('2' >= ucRRCVer))
    {
        ucRRCVer = gastAtParaList[0].aucPara[0] - '0';
    }
    else
    {
        return AT_DPAUPA_ERROR;
    }

    /* ????????????????????,????????????????????:ErrCode:0 */
    if (VOS_TRUE == g_bAtDataLocked)
    {
        return  AT_DATA_UNLOCK_ERROR;
    }

    /* ??????NV????????: AT_WriteRrcVerToNV,???????????? */
    if (VOS_OK == AT_WriteRrcVerToNV(ucRRCVer))
    {
        return  AT_OK;
    }
    else
    {
        AT_WARN_LOG("At_SetHspaSpt:WARNING:WAS_MNTN_SetHspaSpt failed!");
        return AT_DPAUPA_ERROR;
    }

}

/*****************************************************************************
 ?? ?? ??  : At_SetDataLock
 ????????  : ????????????????????
 ????????  : ucIndex-- ????????
 ????????  : ??
 ?? ?? ??  : AT_OK ????????;AT_ERROR ????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??7??24??
    ??    ??   : l00130025
    ????????   : ??????????

  2.??    ??   : 2011??10??15??
    ??    ??   : ????/w00181244
    ????????   : ??????API MMA_VerifyOperatorLockPwd????datalock????????????????????C????????
*****************************************************************************/
VOS_UINT32  At_SetDataLock(VOS_UINT8 ucIndex )
{
    DRV_AGENT_DATALOCK_SET_REQ_STRU     stDatalockInfo;

    /* ?????????????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_ERROR;
    }

    /* <unlock_code>????????????8???????????? */
    if ( TAF_PH_ME_PERSONALISATION_PWD_LEN_MAX != gastAtParaList[0].usParaLen)
    {
        return AT_ERROR;
    }

    if (AT_FAILURE == At_CheckNumString(gastAtParaList[0].aucPara,
                                        TAF_PH_ME_PERSONALISATION_PWD_LEN_MAX))
    {
        return AT_ERROR;
    }

    if (VOS_TRUE == g_bAtDataLocked)
    {
        /* ?????????????? */
        stDatalockInfo.aucPwd[TAF_PH_ME_PERSONALISATION_PWD_LEN_MAX] = '\0';
        PS_MEM_CPY(stDatalockInfo.aucPwd, gastAtParaList[0].aucPara, TAF_PH_ME_PERSONALISATION_PWD_LEN_MAX);

        /* ???????? C ?? ???? DATALOCK ???????? */
        if (TAF_SUCCESS == AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                                  gastAtClientTab[ucIndex].opId,
                                                  DRV_AGENT_DATALOCK_SET_REQ,
                                                  &stDatalockInfo,
                                                  sizeof(stDatalockInfo),
                                                  I0_WUEPS_PID_DRV_AGENT))
        {
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_DATALOCK_SET;           /*???????????????? */
            return AT_WAIT_ASYNC_RETURN;                                            /* ???????????????? */
        }
        else
        {
            return AT_ERROR;
        }
    }

    return AT_OK;

}

/* Add by w00199382 for V7????????, 2012-04-07, Begin   */
/* ????NV???? */
VOS_UINT32  At_SetInfoRRS(VOS_UINT8 ucIndex )
{
    VOS_UINT32                          ulRst;
/*DTS2012041102190 : h00135900 start in 2011-04-11 AT????????*/

    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????????? */
    if (gucAtParaIndex != 0)
    {
        return AT_ERROR;
    }

    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   DRV_AGENT_INFORRS_SET_REQ,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_WUEPS_PID_DRV_AGENT);
/*DTS2012041102190 : h00135900 end in 2011-04-11 AT????????*/
    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_INFORRS_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }

}
/* Add by w00199382 for V7????????, 2012-04-07, End   */

/*****************************************************************************
 ?? ?? ??  : At_SetInfoRBU
 ????????  : ??????NV????????????
 ????????  : ucIndex
 ????????  : ??
 ?? ?? ??  : AT_OK:????????;AT_ERROR:????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??7??24??
    ??    ??   : l00130025
    ????????   : ??????????
  2.??    ??   : 2011??6??24??
    ??    ??   : f00179208
    ????????   : ????????:DTS2011060304864,[E353s-2????AT????]????AT^INFORBU=1??????????ERROR????????????OK
  3.??    ??   : 2011??11??3??
    ??    ??   : ????/l60609
    ????????   : AT Project:NV_Backup??C??????
*****************************************************************************/
VOS_UINT32  At_SetInfoRBU(VOS_UINT8 ucIndex )
{
    VOS_UINT32                          ulRst;

    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????????? */
    if (gucAtParaIndex != 0)
    {
        return AT_ERROR;
    }
    /*DTS2012041102190 : h00135900 start in 2011-04-11 AT????????*/
    /*Modified by l60609 for At Project, 2011-11-3, Begin */
    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   DRV_AGENT_INFORBU_SET_REQ,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_WUEPS_PID_DRV_AGENT);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_INFORBU_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
    /*Modified by l60609 for At Project, 2011-11-3, End */
    /*DTS2012041102190 : h00135900 end in 2011-04-11 AT????????*/

}
/*****************************************************************************
 ?? ?? ??  : At_SetGPIOPL
 ????????  : ??????GPIO??????????
 ????????  : ucIndex--????????
 ????????  : ??
 ?? ?? ??  : AT_OK,????????;AT_ERROR,????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??7??26??
    ??    ??   : l00130025
    ????????   : ??????????

  2.??    ??   : 2011??10??15??
    ??    ??   : w00181244
    ????????   : API????DRV_GPIO_OPRT???????????????????????? C????????
*****************************************************************************/
VOS_UINT32 At_SetGPIOPL(VOS_UINT8 ucIndex)
{
    DRV_AGENT_GPIOPL_SET_REQ_STRU       stGpioplSet;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_ERROR;
    }

    /* ????????????GPIOPL????20??????,??:BCD?? > 20*2???????????????? */
    if (gastAtParaList[0].usParaLen > (AT_GPIOPL_MAX_LEN*2))
    {
        return AT_ERROR;
    }

    /*????GPIO????????16??????????,??????????????????;??????????16????????*/
    if (AT_FAILURE == At_AsciiNum2HexString(gastAtParaList[0].aucPara,
                                           &gastAtParaList[0].usParaLen))
    {
        return AT_ERROR;
    }

    PS_MEM_SET(stGpioplSet.aucGpiopl, 0, DRVAGENT_GPIOPL_MAX_LEN);

    PS_MEM_CPY(stGpioplSet.aucGpiopl, gastAtParaList[0].aucPara, gastAtParaList[0].usParaLen);

    /*????AT_FillAndSndAppReqMsg????????C??I0_WUEPS_PID_DRV_AGENT*/
    if (TAF_SUCCESS == AT_FillAndSndAppReqMsg( gastAtClientTab[ucIndex].usClientId,
                                              gastAtClientTab[ucIndex].opId,
                                              DRV_AGENT_GPIOPL_SET_REQ,
                                              &stGpioplSet,
                                              sizeof(stGpioplSet),
                                              I0_WUEPS_PID_DRV_AGENT))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_GPIOPL_SET;       /*???????????????? */
        return AT_WAIT_ASYNC_RETURN;                                      /* ???????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : At_ConvertSDErrToAtErrCode
 ????????  : ????????????????????????????AT??????????????????
 ????????  : ulSDOprtErr:????????????????????
 ????????  : ??
 ?? ?? ??  : AT??????????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??7??24??
    ??    ??   : l00130025
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32  At_ConvertSDErrToAtErrCode(VOS_UINT32 ulSDOprtErr)
{
    VOS_UINT32 ulAtSDErrCode;

    switch (ulSDOprtErr)
    {
        case AT_SD_ERR_CRAD_NOT_EXIST:
            ulAtSDErrCode = AT_SD_CARD_NOT_EXIST;
            break;

        case AT_SD_ERR_INIT_FAILED:
            ulAtSDErrCode = AT_SD_CARD_INIT_FAILED;
            break;

        case AT_SD_ERR_OPRT_NOT_ALLOWED:
            ulAtSDErrCode = AT_SD_CARD_OPRT_NOT_ALLOWED;
            break;

        case AT_SD_ERR_ADDR_ERR :
            ulAtSDErrCode = AT_SD_CARD_ADDR_ERR;
            break;

        default:
            ulAtSDErrCode = AT_SD_CARD_OTHER_ERR;
            break;

    }

    return ulAtSDErrCode;
}
/*****************************************************************************
 ?? ?? ??  : At_IsArrayContentValueEquToPara
 ????????  : ???????????????????? ucValue
 ????????  : VOS_UINT8 ucValue,
             VOS_UINT32 ulArrLen
             VOS_UINT8 aucContent[]
 ????????  : ??
 ?? ?? ??  : VOS_TRUE,????????????????ucValue?? VOS_FALSE ,????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??2??24??
    ??    ??   : l00130025
    ????????   : ??????????

*****************************************************************************/
VOS_BOOL At_IsArrayContentValueEquToPara(
    VOS_UINT8                           ucValue,
    VOS_UINT32                          ulArrLen,
    VOS_UINT8                           aucContent[]
 )
{
    VOS_UINT32                          i;

    for (i = 0; i < ulArrLen; i++)
    {
        if(ucValue != aucContent[i])
        {
            break;
        }
    }
    if (i != ulArrLen)
    {
        return VOS_FALSE;
    }
    else
    {
        return VOS_TRUE;
    }

}

/*****************************************************************************
 ?? ?? ??  : At_SDOprtRead
 ????????  : ??SD??????????
             < data >            ??????????????512BYTE??????????????????????????????
             0       ??????????0x00
             1       ??????????0x55
             2       ??????????0xAA
             3       ??????????0xFF
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : AT_OK,?????????????? ????????????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??7??26??
    ??    ??   : l00130025
    ????????   : ??????????

  2.??    ??   : 2011??10??24??
    ??    ??   : o00132663
    ????????   : AT????????????????????????????????
  3.??    ??   : 2012??02??13??
    ??    ??   : f62575
    ????????   : ????SD??????????????
*****************************************************************************/
VOS_UINT32 At_SDOprtRead(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulOprtErr;
    VOS_UINT32                          ulOprtRslt;
    VOS_UINT32                          ulAddr;
    VOS_UINT8                           *pucSdData;
    VOS_UINT16                          usLength;
    VOS_BOOL                            bSameContent;
    VOS_UINT8                           ucPrintData;

    if (2 != gucAtParaIndex)
    {
        return AT_SD_CARD_OTHER_ERR;
    }

    /* ??????????????????????????512????????????*/
    pucSdData = (VOS_UINT8* )PS_MEM_ALLOC(WUEPS_PID_AT, AT_SD_DATA_UNIT_LEN);

    if (VOS_NULL_PTR == pucSdData)
    {
        AT_ERR_LOG("At_SD_Read: Fail to Alloc memory.");
        return AT_SD_CARD_OTHER_ERR;
    }

    ulAddr = gastAtParaList[1].ulParaValue;

    ulOprtRslt = mdrv_sd_at_process(SD_MMC_OPRT_READ, ulAddr, 0, pucSdData, &ulOprtErr);

    ucPrintData = 0;

    if (VOS_OK == ulOprtRslt)
    {
        ulOprtErr = AT_DEVICE_ERROR_BEGIN;

        /* ??????????????512?????????????????? */
        bSameContent = At_IsArrayContentValueEquToPara(pucSdData[0],AT_SD_DATA_UNIT_LEN,pucSdData);

        if (VOS_TRUE == bSameContent)
        {
            switch(pucSdData[0])
            {
                case 0x00:
                    ucPrintData = 0;
                    break;
                case 0x55:
                    ucPrintData = 1;
                    break;
                case 0xAA:
                    ucPrintData = 2;
                    break;
                case 0xFF:
                    ucPrintData = 3;
                    break;
                 default:
                    ulOprtErr = AT_SD_CARD_OTHER_ERR;
                    break;

            }
        }
        else
        {
            ulOprtErr = AT_SD_CARD_OTHER_ERR;
        }

        PS_MEM_FREE(WUEPS_PID_AT, pucSdData);

        if  (AT_DEVICE_ERROR_BEGIN == ulOprtErr)
        {
            /* ???????????????????????????? */
            usLength = (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                              (VOS_CHAR *)pgucAtSndCodeAddr,
                                              (VOS_CHAR*)pgucAtSndCodeAddr,
                                              "%s:%d",
                                              g_stParseContext[ucIndex].pstCmdElement->pszCmdName,
                                              ucPrintData);

            gstAtSendData.usBufLen = usLength;
            return AT_OK;
        }
        else
        {
            /* ???????????????????? */
            return At_ConvertSDErrToAtErrCode(ulOprtErr);
        }

    }
    else
    {
        PS_MEM_FREE(WUEPS_PID_AT,pucSdData);
        return At_ConvertSDErrToAtErrCode(ulOprtErr);
    }

}
/*****************************************************************************
 ?? ?? ??  : At_SDOprtWrtEraseFmt
 ????????  : ??SD??????????????????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : AT_OK ????;????????????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??7??26??
    ??    ??   : l00130025
    ????????   : ??????????
  2.??    ??   : 2012??02??13??
    ??    ??   : f62575
    ????????   : ????SD??????????????
*****************************************************************************/
VOS_UINT32 At_SDOprtWrtEraseFmt(TAF_UINT8 ucIndex)
{
    VOS_UINT32                          ulOprtErr;
    VOS_UINT32                          ulOprtRslt;
    VOS_UINT32                          ulAddr;
    VOS_UINT32                          ulData;

    switch (gastAtParaList[0].ulParaValue)
    {
        case AT_SD_OPRT_FORMAT:
            /* ??SD???????????????? */
            ulOprtRslt = mdrv_sd_at_process(SD_MMC_OPRT_FORMAT,
                                            0, 0, VOS_NULL_PTR, &ulOprtErr);
            break;

        case AT_SD_OPRT_ERASE:
            /* ????????????????????????SD??; ??????????????????????????SD??????  */
            if (1 == gucAtParaIndex)
            {
                ulOprtRslt = mdrv_sd_at_process(SD_MMC_OPRT_ERASE_ALL,
                                                0, 0, VOS_NULL_PTR, &ulOprtErr);
            }
            else
            {
                ulAddr     = gastAtParaList[1].ulParaValue;
                ulOprtRslt = mdrv_sd_at_process(SD_MMC_OPRT_ERASE_SPEC_ADDR,
                                                ulAddr, 0, VOS_NULL_PTR, &ulOprtErr);
            }
            break;

        case AT_SD_OPRT_WRITE:
            /* ??SD?????????????????????? */
            if (3 == gucAtParaIndex)
            {
                ulAddr     = gastAtParaList[1].ulParaValue;
                ulData     = gastAtParaList[2].ulParaValue;
                ulOprtRslt = mdrv_sd_at_process(SD_MMC_OPRT_WRITE,
                                                ulAddr, ulData, VOS_NULL_PTR, &ulOprtErr);
            }
            else
            {
                return AT_SD_CARD_OTHER_ERR;
            }
            break;

        default:
            return AT_SD_CARD_OPRT_NOT_ALLOWED;
    }

    if (VOS_OK != ulOprtRslt)
    {
       return At_ConvertSDErrToAtErrCode(ulOprtErr);
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetSD
 ????????  : ??SD????????????????????????????????
 ????????  : ucIndex
 ????????  : ??
 ?? ?? ??  : ???????? AT_OK,????????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??7??24??
    ??    ??   : l00130025
    ????????   : ??????????
  2.??    ??   : 2011??06??30??
    ??    ??   : f00179208
    ????????   : ??????????DTS2011061301079,??????AT??????^sd????SD??????????????????????????????????V1.1.4????
  3.??    ??   : 2012??02??13??
    ??    ??   : f62575
    ????????   : ????SD??????????????
*****************************************************************************/
VOS_UINT32  At_SetSD(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulCurrentOprtStaus;
    VOS_INT32                           lCurrentSDStaus;

    /* ??????????????????AT^SD??????SD?????????? */
    if (AT_CMD_OPT_SET_CMD_NO_PARA == g_stATParseCmd.ucCmdOptType)
    {
        lCurrentSDStaus = DRV_SDMMC_GET_STATUS();
        if (AT_SD_STATUS_EXIST == lCurrentSDStaus)
        {
            return AT_OK;
        }
        else
        {
            return AT_ERROR;
        }
    }

    /* ???????? */
    if (gucAtParaIndex > 3)
    {
        return AT_SD_CARD_OTHER_ERR;
    }

    /* SD???????????????????????????????????????????????????????????????????????? */
    ulCurrentOprtStaus = mdrv_sd_get_opptstatus();

    /* ?????????????????? ?????????????? */
    if (AT_SD_OPRT_RSLT_NOT_FINISH == ulCurrentOprtStaus)
    {
        return AT_SD_CARD_OTHER_ERR;
    }

    /*  ???????????????????????????????????????????? */
    if (AT_SD_OPRT_READ == gastAtParaList[0].ulParaValue)
    {
        return At_SDOprtRead(ucIndex);
    }
    else
    {
        return At_SDOprtWrtEraseFmt(ucIndex);
    }


}

 /*****************************************************************************
  ?? ?? ??  : At_CheckRxDivOrRxPriCmdParaIfSupported
  ????????  : ??????????????????,??????????????????????????????
  ????????  : usBands - ????????????????????
  ????????  : pusSetBands - ??????????????????????
  ?? ?? ??  : ????????
  ????????  :
  ????????  :

  ????????      :
   1.??    ??   : 2010??07??30??
     ??    ??   : z00161729
     ????????   : ??????????
 *****************************************************************************/
 VOS_UINT32 At_CheckRxdivOrRxpriParaIfSupported(
     VOS_UINT16                         *pusSetBands,
     VOS_UINT16                         usBands
 )
 {
     VOS_UINT32                         ulResult;
     VOS_UINT32                         i;
     VOS_UINT32                         ulSetLowBands;
     VOS_UINT32                         ulSetHighBands;

     /* ???????????????????????????????????????? */
     ulResult = At_GetUserSetRxDivOrRxPriParaNum(&ulSetLowBands, &ulSetHighBands);
     if (AT_OK != ulResult)
     {
         return ulResult;
     }

     /* ??????????0X3FFFFFFF????????????????????????????????;
        ??????????????????????????????????????RX???????????????????? */
     if ((TAF_PH_BAND_ANY == ulSetLowBands) && (0 == ulSetHighBands))
     {
         *pusSetBands = usBands;
     }
     else
     {
         ulResult = At_CovertUserSetRxDivOrRxPriParaToMsInternal(ulSetLowBands,
                                           ulSetHighBands, pusSetBands);
         if (AT_OK != ulResult)
         {
             return ulResult;
         }
     }

     /* ??????????RX DIV????????:
          2100M/ bit1  1900M/bit2  1800M/bit3  1700M/bit4  1600M/bit5
          1500M/bit6   900M/bit7   850M/bit8   800M/bit9   450M/bit10
       ???????????????????????????????????????????? */
     for (i = 0; i < 16; i++)
     {
         if ((0 == ((usBands >> i) & 0x0001))
          && (0x0001 == ((*pusSetBands >> i) & 0x0001)))
         {
              return AT_CME_RX_DIV_NOT_SUPPORTED;
         }
     }

     return AT_OK;

 }

 /*****************************************************************************
 ?? ?? ??  : At_SetRxDiv
 ????????  : ??????????????????????
             ????????????????????????????????????????????????????????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??02??21??
    ??    ??   : l65478
    ????????   : ??????????
  2.??    ??   : 2011??10??5??
    ??    ??   : c00173809
    ????????   : AT??????????A??????????C????API????????????????
*****************************************************************************/
VOS_UINT32 At_SetRxDiv(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;
    AT_DRV_AGENT_RXDIV_SET_STRU         stRxdivSet;
    VOS_UINT32                          ulResult;

    ulResult = At_CheckRxDivOrRxPriCmdPara();
    if (AT_OK != ulResult)
    {
        return ulResult;
    }

    /* ???????????????????????????????????????? */
    ulResult = At_GetUserSetRxDivOrRxPriParaNum(&stRxdivSet.ulSetLowBands,
                                                &stRxdivSet.ulSetHighBands);
    if (AT_OK != ulResult)
    {
        return ulResult;
    }

    stRxdivSet.ucRxOnOff = g_stAtDevCmdCtrl.ucRxOnOff;
    stRxdivSet.usDspBand = g_stAtDevCmdCtrl.stDspBandArfcn.usDspBand;

    /* ????????DRV_AGENT_HARDWARE_QRY??AT AGENT?????????????????????? */
    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   At_GetOpId(),
                                   DRV_AGENT_RXDIV_SET_REQ,
                                   (VOS_VOID*)&stRxdivSet,
                                   sizeof(stRxdivSet),
                                   I0_WUEPS_PID_DRV_AGENT);

    if(AT_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_DRV_AGENT_RXDIV_SET_REQ;
        return AT_WAIT_ASYNC_RETURN;
    }
    return AT_ERROR;
}

/*****************************************************************************
 ?? ?? ??  : AT_ProcUus1WithParm
 ????????  : ????????UUIE??MSG??????
 ????????  : ucIndex  :AT????????
 ????????  : ??
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??7??28??
    ??    ??   : zhoujun /40661
    ????????   : ??????????
  2.??    ??   : 2011??10??8??
    ??    ??   : c00173809
    ????????   : AT??????????AT+CUUS1
  3.??    ??   : 2012??8??10??
    ??    ??   : y00213812
    ????????   : DTS2012082204471, TQE????????????if (MN_CALL_SET_UUS1_DEACT
                 == enSetType)????
  4.??    ??   : 2013??4??8??
    ??    ??   : s00217060
    ????????   : ????????AT??????????????C??
*****************************************************************************/
VOS_UINT32  AT_ProcUus1WithParm(
    VOS_UINT8                           ucIndex,
    MN_CALL_UUS1_PARAM_STRU            *pstUus1Group
)
{
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-8, begin */
    VOS_UINT32                          ulRet;
    VOS_UINT32                          ulMsgNum;
    VOS_UINT32                          i;
    VOS_UINT32                          ulRst;
    VOS_UINT32                          ulStrLength;

    /* ????<n>??<m>??,?????????????? */
    ulMsgNum   = gucAtParaIndex;

    /*modified by Y00213812 for DTS2012082204471 TQE????, 2012-08-10, begin*/

    if(0 == gastAtParaList[2].usParaLen)
    {
        pstUus1Group->ulActNum = 0;
    }
    else
    {
        /* ????message */
        for (i = 2 ; (i < ulMsgNum && i < (AT_MAX_PARA_NUMBER-1)); i++)
        {

            /* ??????????,????????????????????????,AT????????????4??????????????,
            ????????????????????,??????????????????????????????*/
            if (AT_SUCCESS != At_Auc2ul(gastAtParaList[i].aucPara,
                                        gastAtParaList[i].usParaLen,
                                       &gastAtParaList[i].ulParaValue))
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }

            pstUus1Group->stUus1Info[pstUus1Group->ulActNum].enMsgType = gastAtParaList[i].ulParaValue;
            i++;

            /*<UUIE>??????,???????????? */
            if ( 0 == gastAtParaList[i].usParaLen )
            {
                pstUus1Group->enSetType[pstUus1Group->ulActNum] = MN_CALL_SET_UUS1_DEACT;
            }
            else
            {
                pstUus1Group->enSetType[pstUus1Group->ulActNum] = MN_CALL_SET_UUS1_ACT;
                /* ????ASCII??????HEX */
                if (AT_FAILURE == At_AsciiNum2HexString(gastAtParaList[i].aucPara,
                                                      &gastAtParaList[i].usParaLen))
                {
                    return AT_CME_INCORRECT_PARAMETERS;
                }

                ulStrLength = sizeof(pstUus1Group->stUus1Info[pstUus1Group->ulActNum].aucUuie);
                if(ulStrLength < gastAtParaList[i].usParaLen)
                {
                    return AT_CME_INCORRECT_PARAMETERS;
                }
                PS_MEM_CPY(pstUus1Group->stUus1Info[pstUus1Group->ulActNum].aucUuie,
                            gastAtParaList[i].aucPara,
                            gastAtParaList[i].usParaLen);
            }

            ulRet = MN_CALL_CheckUus1ParmValid(pstUus1Group->enSetType[pstUus1Group->ulActNum],
                                              &(pstUus1Group->stUus1Info[pstUus1Group->ulActNum]));
            if ( MN_ERR_NO_ERROR != ulRet )
            {
                return AT_CME_INCORRECT_PARAMETERS;
            }

            pstUus1Group->ulActNum++;

            /* ??????????UUIE,???????????????????????????? */
            if (MN_CALL_SET_UUS1_DEACT == pstUus1Group->enSetType[pstUus1Group->ulActNum])
            {
                break;
            }
            /*modified by Y00213812 for DTS2012082204471 TQE????, 2012-08-10, end*/
        }
    }
    /* 1.??????????????Uus1Info??????????????????MN_CALL_APP_SET_UUSINFO??????????????
         MN_CALL_UUS1_PARAM_STRU????CS????????????*/
    ulRst = MN_CALL_SendAppRequest(MN_CALL_APP_SET_UUSINFO_REQ,
                                   gastAtClientTab[ucIndex].usClientId,
                                   gastAtClientTab[ucIndex].opId,
                                   0,
                                   (MN_CALL_APP_REQ_PARM_UNION*)pstUus1Group);
    if (AT_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_APP_SET_UUSINFO_REQ;
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-8, end */
}

/*****************************************************************************
 ?? ?? ??  : At_SetCuus1Para
 ????????  : ????UUS1????????,????????27007 7.26
 ????????  : ucIndex  :AT????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??7??28??
    ??    ??   : zhoujun /40661
    ????????   : ??????????
  2.??    ??   : 2013??2??20??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  3.??    ??   : 2013??4??8??
    ??    ??   : s00217060
    ????????   : ????????AT??????????????C??
*****************************************************************************/
VOS_UINT32 At_SetCuus1Para(
    VOS_UINT8                           ucIndex
)
{
    VOS_UINT32                          ulRet;
    MN_CALL_UUS1_PARAM_STRU             stUus1Group;
    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-3, begin */

    /*************************************************************
    27007????????????,????????????????????????,??????????????????????OK
    + CUUS1 =[<n>[,<m>[,<message>[,<UUIE> [,<message>[,<UUIE>[,...]]]]]]]
    ****************************************************************/

    /* ??????????????????OK */
    if ( 0 == gucAtParaIndex )
    {
        return AT_OK;
    }

    PS_MEM_SET(&stUus1Group,0x00,sizeof(stUus1Group));

    /* Modified by l60609 for DSDA Phase III, 2013-2-20, Begin */
    /* ????<n> */
    if(0 != gastAtParaList[0].usParaLen)
    {
        stUus1Group.enCuus1IFlg = (MN_CALL_CUUS1_FLG_ENUM_U32)gastAtParaList[0].ulParaValue;
    }
    else
    {
        /* <n>??????????????????????0????ERROR */
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<m> */
    if(0 != gastAtParaList[1].usParaLen)
    {
        stUus1Group.enCuus1UFlg = (MN_CALL_CUUS1_FLG_ENUM_U32)gastAtParaList[1].ulParaValue;
    }

    /* ????message */
    /* ????n??m??????????????MN?????? */
    ulRet = AT_ProcUus1WithParm(ucIndex, &stUus1Group);

    /* Modified by s00217060 for ????????AT??????????????C??, 2013-4-3, end */

    return ulRet;

}
/*****************************************************************************
 ?? ?? ??  : At_SetGlasterrPara
 ????????  : ??????????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : AT_OK
             AT_ERROR
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??5??18??
    ??    ??   : s62952
    ????????   : ??????????

  2.??    ??   : 2011??09??21??
    ??    ??   : A00165503
    ????????   : ????????: DTS2011092000535, HiLink??????????????????????
                 NV(50061)????

  3.??    ??   : 2012??5??4??
    ??    ??   : l60609
    ????????   : DTS2012050403306??AT^GLASTERR??????????????

  4.??    ??   : 2012??8??22??
    ??    ??   : A00165503
    ????????   : ????PS????????????????
*****************************************************************************/
VOS_UINT32  At_SetGlastErrPara(VOS_UINT8 ucIndex)
{
    VOS_UINT16                          usLength;
    TAF_PS_CAUSE_ENUM_UINT32            enPsCause;

    usLength                            = 0;

    /* ??????????????????????*/
    if (PPP_DIAL_ERR_CODE_DISABLE == gucPppDialErrCodeRpt)
    {
       return AT_ERROR;
    }

    /* ????????*/
    if (gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

     /* ????????*/
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????????*/
    if (1 != gastAtParaList[0].ulParaValue)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    gulErrType = gastAtParaList[0].ulParaValue;

    /* ??????????*/
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, Begin */
    enPsCause = AT_PS_GetPsCallErrCause(ucIndex);
    /* Modified by l60609 for DSDA Phase III, 2013-2-22, End */
    if (TAF_PS_CAUSE_SUCCESS == enPsCause)
    {
        return AT_ERROR;
    }

    /* ??????????????????*/
    usLength =  (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                       (VOS_CHAR *)pgucAtSndCodeAddr,
                                       (VOS_CHAR *)pgucAtSndCodeAddr,
                                       "%s: %d,%d",
                                       g_stParseContext[ucIndex].pstCmdElement->pszCmdName,
                                       gulErrType,
                                       AT_Get3gppSmCauseByPsCause(enPsCause));

    gstAtSendData.usBufLen = usLength;

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetMDatePara
 ????????  : ????????????
 ????????  : VOS_UINT8 ucIndex ????????
 ????????  : ??
 ?? ?? ??  : AT_OK --- ????
             AT_ERROR --- ????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??7??19??
    ??    ??   : ??????/f62575
    ????????   : ??????????
  2.??    ??   : 2013??05??17??
    ??    ??   : m00217266
    ????????   : nv??????
*****************************************************************************/
VOS_UINT32 AT_SetMDatePara(
    VOS_UINT8                           ucIndex
)
{
    VOS_UINT32                          ulRet;
    AT_DATE_STRU                        stDate;
    TAF_AT_NVIM_MANUFACTURE_DATE_STRU   stManufactrueDate;

    if (gucAtParaIndex != 1)
    {
        AT_NORM_LOG("AT_SetMDatePara: the number of parameters is error.");
        return AT_ERROR;
    }

    /* ????????1:??????????????*/
    ulRet = AT_CheckDateFormat(gastAtParaList[0].aucPara,
                               gastAtParaList[0].usParaLen);
    if (AT_OK != ulRet)
    {
        AT_NORM_LOG("AT_SetMDatePara: the format of parameters is error.");
        return AT_ERROR;
    }

    /* ????????2:??????????????????????????????????*/
    ulRet = AT_GetDate(gastAtParaList[0].aucPara,
                       gastAtParaList[0].usParaLen,
                       &stDate);
    if (AT_OK != ulRet)
    {
        AT_NORM_LOG("AT_SetMDatePara: Fail to get the date.");
        return AT_ERROR;
    }

    ulRet = AT_CheckDate(&stDate);
    if (AT_OK != ulRet)
    {
        AT_NORM_LOG("AT_SetMDatePara: the value of parameters is error.");
        return AT_ERROR;
    }

    /* ????????????NV */
    PS_MEM_CPY(stManufactrueDate.aucMDate, gastAtParaList[0].aucPara, (AT_MDATE_STRING_LENGTH - 1));
    stManufactrueDate.aucMDate[AT_MDATE_STRING_LENGTH - 1] = '\0';
    ulRet = NV_WriteEx(MODEM_ID_0, en_NV_Item_AT_MANUFACTURE_DATE,
                     stManufactrueDate.aucMDate,
                     AT_MDATE_STRING_LENGTH);
    if (NV_OK != ulRet)
    {
        AT_WARN_LOG("AT_SetMDatePara: Fail to write nv.");
        return AT_ERROR;
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetFacInfoPara
 ????????  : ????????????
 ????????  : TAF_UINT8 ucIndex ????????
 ????????  : ??
 ?? ?? ??  : AT_OK --- ????
             AT_ERROR --- ????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??7??19??
    ??    ??   : ??????/f62575
    ????????   : ??????????
  2.??    ??   : 2011??06??09??
    ??    ??   : ??????/f62575
    ????????  : ??????????DTS2011060304826,????????????????
  3.??    ??   : 2012??06??26??
    ??    ??   : f00179208
    ????????   : ??????:DTS2012062103969, ??????????????????????????????
*****************************************************************************/
VOS_UINT32 AT_SetFacInfoPara(
    VOS_UINT8                          ucIndex
)
{
    VOS_UINT32                          ulRet;
    VOS_UINT8                           *pucFacInfo = TAF_NULL_PTR;
    VOS_UINT32                          ulOffSet;

    if ((gucAtParaIndex != 2) || ((0 == gastAtParaList[1].usParaLen)))
    {
        AT_WARN_LOG("AT_SetFacInfoPara: the number of parameters is error.");
        return AT_ERROR;
    }

    /* ?????????????????????????????????????????? */
    if (0 == gastAtParaList[0].ulParaValue)
    {
        if (AT_FACINFO_INFO1_LENGTH != gastAtParaList[1].usParaLen)
        {
            AT_NORM_LOG("AT_SetFacInfoPara: Length of info1 is failure.");
            return AT_ERROR;
        }

        if (AT_FAILURE == At_CheckNumString(gastAtParaList[1].aucPara, AT_FACINFO_INFO1_LENGTH))
        {
            return AT_ERROR;
        }
    }
    else
    {
        if (AT_FACINFO_INFO2_LENGTH != gastAtParaList[1].usParaLen)
        {
            AT_NORM_LOG("AT_SetFacInfoPara: Length of info2 is failure.");
            return AT_ERROR;
        }

        if (AT_FAILURE == At_CheckNumString(gastAtParaList[1].aucPara, AT_FACINFO_INFO2_LENGTH))
        {
            return AT_ERROR;
        }
    }

    /* ????NV???????????????????? */
    pucFacInfo = (TAF_UINT8 *)PS_MEM_ALLOC(WUEPS_PID_AT, AT_FACINFO_STRING_LENGTH);
    if (TAF_NULL_PTR == pucFacInfo)
    {
        AT_WARN_LOG("AT_SetFacInfoPara: fail to alloc memory.");
        return AT_ERROR;
    }

    ulRet = NV_ReadEx(MODEM_ID_0, en_NV_Item_AT_FACTORY_INFO,
                    pucFacInfo,
                    AT_FACINFO_STRING_LENGTH);
    if (NV_OK != ulRet)
    {
        AT_WARN_LOG("AT_SetFacInfoPara: fail to read NVIM . ");
        PS_MEM_FREE(WUEPS_PID_AT, pucFacInfo);
        return AT_ERROR;
    }

    /*
       ??????????NV??en_NV_Item_AT_FACTORY_INFO??????????:
       ????????????????<INDEX>????????????,
       <INDEX>??0????????129????????????129??????????????
       <INDEX>??1????????129????????????129??????????????
    */
    ulOffSet = (AT_FACINFO_INFO1_LENGTH + 1) * gastAtParaList[0].ulParaValue;
    if ((ulOffSet + gastAtParaList[1].usParaLen) > ((AT_FACINFO_INFO1_LENGTH + 1) + AT_FACINFO_INFO2_LENGTH))
    {
        AT_WARN_LOG("AT_SetFacInfoPara: offset is error. ");
        PS_MEM_FREE(WUEPS_PID_AT, pucFacInfo);
        return AT_ERROR;
    }

    *((pucFacInfo + ulOffSet) + gastAtParaList[1].usParaLen) = '\0';

    PS_MEM_CPY((pucFacInfo + ulOffSet),
                gastAtParaList[1].aucPara,
                gastAtParaList[1].usParaLen);

    /* ??????????????????????????NV??en_NV_Item_AT_FACTORY_INFO */
    ulRet = NV_WriteEx(MODEM_ID_0, en_NV_Item_AT_FACTORY_INFO,
                     pucFacInfo,
                     AT_FACINFO_STRING_LENGTH);
    if (NV_OK != ulRet)
    {
        AT_WARN_LOG("AT_SetFacInfoPara: fail to write NVIM . ");
        PS_MEM_FREE(WUEPS_PID_AT, pucFacInfo);
        return AT_ERROR;
    }

    PS_MEM_FREE(WUEPS_PID_AT, pucFacInfo);
    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetCallSrvPara
 ????????  : ????????????????,????????^CALLSRV =<service>
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : AT_OK - ????
             AT_DEVICE_OTHER_ERROR?? AT_DATA_UNLOCK_ERROR - ????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??3??
    ??    ??   : z00161729
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 At_SetCallSrvPara(VOS_UINT8 ucIndex)
{
    NAS_NVIM_CUSTOMIZE_SERVICE_STRU              stCustSrv;

    /* ???????????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_DEVICE_OTHER_ERROR;
    }

    /* ???????????? */
    if (gucAtParaIndex != 1)
    {
        return AT_DEVICE_OTHER_ERROR;
    }

    /* ????????????????????,???????????????????? */
    if (VOS_TRUE == g_bAtDataLocked)
    {
        return  AT_DATA_UNLOCK_ERROR;
    }

    stCustSrv.ulCustomizeService = gastAtParaList[0].ulParaValue;
    stCustSrv.ulStatus           = NV_ITEM_ACTIVE;          /*NV????????????*/

    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_CustomizeService, &stCustSrv, sizeof(stCustSrv)))
    {
        AT_WARN_LOG("At_SetCallSrvPara():en_NV_Item_CustomizeService NV Write Fail!");
        return AT_DEVICE_OTHER_ERROR;
    }

    return AT_OK;

}

/* Modify by z60575 for multi_ssid, 2012-9-5 begin */
/* Add by w00199382 for V7????????, 2012-04-07, Begin   */
/*****************************************************************************
 ?? ?? ??  : At_WriteWifiNVToDefault
 ????????  : ????WIFI??????????????
 ????????  : enCustomizeItem - 0:??????????????????????????????????????
                               1:??????????????????????????????????????
             ????????????????????????????????????????????????????????????????????,
             ??????????????????????????????
 ????????  : ??
 ?? ?? ??  : VOS_OK  - ????????
             VOS_ERR - ????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??3??23??
    ??    ??   : c64416
    ????????   : ??????????
  2.??    ??   : 2012??9??17??
    ??    ??   : z60575
    ????????   : MULTI_SSID????
*****************************************************************************/
VOS_UINT32 At_WriteWifiNVToDefault(
    AT_CUSTOMIZE_ITEM_DFLT_ENUM_UINT8   enCustomizeItem
)
{
    TAF_AT_MULTI_WIFI_SEC_STRU              stWifiKey;
    TAF_AT_MULTI_WIFI_SSID_STRU             stWifiSsid;

    if (BSP_MODULE_UNSUPPORT == mdrv_misc_support_check(BSP_MODULE_TYPE_WIFI) )
    {
        return VOS_OK;
    }

    PS_MEM_SET(&stWifiKey, 0, sizeof(stWifiKey));
    PS_MEM_SET(&stWifiSsid, 0, sizeof(stWifiSsid));

    /* ????WIFI KEY??????NV?? */
    if (NV_OK!= NV_ReadEx(MODEM_ID_0, en_NV_Item_MULTI_WIFI_KEY, &stWifiKey, sizeof(TAF_AT_MULTI_WIFI_SEC_STRU)))
    {
        AT_WARN_LOG("At_WriteCustomizeSrvNVToDefault:READ NV ERROR");
        return VOS_ERR;
    }

    /* ????WIKEY???????? */
    PS_MEM_SET(stWifiKey.aucWifiWpapsk, 0x00, sizeof(stWifiKey.aucWifiWpapsk));

    /* ????WIWEP???????? */
    PS_MEM_SET(stWifiKey.aucWifiWepKey1, 0x00, sizeof(stWifiKey.aucWifiWepKey1));
    PS_MEM_SET(stWifiKey.aucWifiWepKey2, 0x00, sizeof(stWifiKey.aucWifiWepKey2));
    PS_MEM_SET(stWifiKey.aucWifiWepKey3, 0x00, sizeof(stWifiKey.aucWifiWepKey3));
    PS_MEM_SET(stWifiKey.aucWifiWepKey4, 0x00, sizeof(stWifiKey.aucWifiWepKey4));

    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_MULTI_WIFI_KEY, &stWifiKey, sizeof(TAF_AT_MULTI_WIFI_SEC_STRU)))
    {
        AT_WARN_LOG("At_WriteCustomizeSrvNVToDefault:WRITE NV ERROR");
        return VOS_ERR;
    }

    /*????SSID??????NV??*/
    if (VOS_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_MULTI_WIFI_STATUS_SSID, &stWifiSsid, sizeof(TAF_AT_MULTI_WIFI_SSID_STRU)))
    {
        AT_WARN_LOG("At_WriteCustomizeSrvNVToDefault:READ NV ERROR");
        return VOS_ERR;
    }

    /* ????SSID???????? */
    PS_MEM_SET(stWifiSsid.aucWifiSsid, 0x00, sizeof(stWifiSsid.aucWifiSsid));

    /*????WIFI SSID??????NV??*/
    if (VOS_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_MULTI_WIFI_STATUS_SSID, &stWifiSsid, sizeof(TAF_AT_MULTI_WIFI_SSID_STRU)))
    {
        AT_WARN_LOG("At_WriteCustomizeSrvNVToDefault:WRITE NV ERROR");
        return VOS_ERR;
    }

    return VOS_OK;
}
/* Add by w00199382 for V7????????, 2012-04-07, End   */
/* Modify by z60575 for multi_ssid, 2012-9-5 end */

/*****************************************************************************
 ?? ?? ??  : At_WriteSimLockNVToDefault
 ????????  : ????Sim Lock??????????????
 ????????  : enCustomizeItem - 0:??????????????????????????????????????
                               1:??????????????????????????????????????
             ????????????????????????????????????????????????????????????????????,??????
             ????????????????????????
 ????????  : ??
 ?? ?? ??  : VOS_OK  - ????????
             VOS_ERR - ????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??3??
    ??    ??   : z00161729
    ????????   : ??????????
  2.??    ??   : 2012??2??21??
    ??    ??   : w00199382
    ????????   : B060??????????simlockNv????????????????
*****************************************************************************/
VOS_UINT32 At_WriteSimLockNVToDefault(
    AT_CUSTOMIZE_ITEM_DFLT_ENUM_UINT8   enCustomizeItem
)
{
    TAF_CUSTOM_SIM_LOCK_PLMN_INFO_STRU  stSimLockPlmnInfo;
    TAF_CUSTOM_CARDLOCK_STATUS_STRU     stCardLockStatus;
    TAF_CUSTOM_SIM_LOCK_MAX_TIMES_STRU  stSimLockMaxTimes;
    VOS_UINT32                          i;

    VOS_UINT8                           aucRange[TAF_PH_SIMLOCK_PLMN_STR_LEN]
                                            = {AT_SIM_LOCK_PLMN_RANGE_DEFAULT_VAL,
                                               AT_SIM_LOCK_PLMN_RANGE_DEFAULT_VAL,
                                               AT_SIM_LOCK_PLMN_RANGE_DEFAULT_VAL,
                                               AT_SIM_LOCK_PLMN_RANGE_DEFAULT_VAL,
                                               AT_SIM_LOCK_PLMN_RANGE_DEFAULT_VAL,
                                               AT_SIM_LOCK_PLMN_RANGE_DEFAULT_VAL,
                                               AT_SIM_LOCK_PLMN_RANGE_DEFAULT_VAL,
                                               AT_SIM_LOCK_PLMN_RANGE_DEFAULT_VAL};


    /* ????????????????????????????????????????????????????????
       en_NV_Item_CustomizeSimLockPlmnInfo??ulStatus:??????????;
       mnc_num:??????2; range_begin??rang_end????????0xAA */
    stSimLockPlmnInfo.ulStatus = NV_ITEM_DEACTIVE;
    for (i = 0; i < TAF_MAX_SIM_LOCK_RANGE_NUM; i++)
    {
        stSimLockPlmnInfo.astSimLockPlmnRange[i].ucMncNum = AT_SIM_LOCK_MNC_NUM_DEFAULT_VAL;
        PS_MEM_CPY(stSimLockPlmnInfo.astSimLockPlmnRange[i].aucRangeBegin,
                   aucRange, sizeof(aucRange));
        PS_MEM_CPY(stSimLockPlmnInfo.astSimLockPlmnRange[i].aucRangeEnd,
                   aucRange, sizeof(aucRange));
    }

    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_CustomizeSimLockPlmnInfo,
                          &stSimLockPlmnInfo, sizeof(stSimLockPlmnInfo)))
    {
        AT_WARN_LOG("At_WriteSimLockNVToDefault():en_NV_Item_CustomizeSimLockPlmnInfo NV Write Fail!");
        return VOS_ERR;
    }

    /* ????????????????????????????????????????????????????????,
       en_NV_Item_CardlockStatus??ulStatus:????????????; CardlockStatus:????????2;
       RemainUnlockTimes:????????0 */
    stCardLockStatus.ulStatus            = NV_ITEM_DEACTIVE;
    stCardLockStatus.enCardlockStatus    = TAF_OPERATOR_LOCK_NONEED_UNLOCK_CODE;
    stCardLockStatus.ulRemainUnlockTimes = TAF_PH_CARDLOCK_DEFAULT_MAXTIME;
    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_CardlockStatus, &stCardLockStatus,
                          sizeof(stCardLockStatus)))

    {
        AT_WARN_LOG("At_WriteSimLockNVToDefault():en_NV_Item_CardlockStatus NV Write Fail!");
        return VOS_ERR;
    }

    /* Added by l60609 for B060 Project, 2012-2-20, Begin   */

    /*??C??????????????simlockNV*/
    if (TAF_SUCCESS != AT_FillAndSndAppReqMsg(0,
                                              0,
                                              DRV_AGENT_SIMLOCK_NV_SET_REQ,
                                              &stCardLockStatus,
                                              sizeof(stCardLockStatus),
                                              I0_WUEPS_PID_DRV_AGENT))
    {

        AT_WARN_LOG("At_WriteSimLockNVToDefault():DRV_AGENT_SIMLOCK_NV_SET_REQ NV Write Fail!");
        return VOS_ERR;
    }

    /* Added by l60609 for B060 Project, 2012-2-20, End   */

    /* ????????????????????????????????????????????????????????,
       en_NV_Item_CustomizeSimLockMaxTimes??ulStatus:??????????????
       LockMaxTimes:??????????????????10?? */
    stSimLockMaxTimes.ulStatus       = NV_ITEM_DEACTIVE;
    stSimLockMaxTimes.ulLockMaxTimes = TAF_PH_CARDLOCK_DEFAULT_MAXTIME;
    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_CustomizeSimLockMaxTimes, &stSimLockMaxTimes,
                          sizeof(stSimLockMaxTimes)))
    {
        AT_WARN_LOG("At_WriteSimLockNVToDefault():en_NV_Item_CustomizeSimLockMaxTimes NV Write Fail!");
        return VOS_ERR;
    }

    return VOS_OK;

}


/*****************************************************************************
 ?? ?? ??  : At_WriteCustomizeSrvNVToDefault
 ????????  : ????Call Enable??????????????
 ????????  : enCustomizeItem - 0:??????????????????????????????????????
                               1:??????????????????????????????????????
             ????????????????????????????????????????????????????????????????????,
             ??????????????????????????????
 ????????  : ??
 ?? ?? ??  : VOS_OK  - ????????
             VOS_ERR - ????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??3??
    ??    ??   : z00161729
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 At_WriteCustomizeSrvNVToDefault(
    AT_CUSTOMIZE_ITEM_DFLT_ENUM_UINT8   enCustomizeItem
)
{
    NAS_NVIM_CUSTOMIZE_SERVICE_STRU              stCustSrv;

    /* ????????????????????????????????????????????????????????,
       ulStatus:????????????;ulCustomizeService:???????????????????? */
    stCustSrv.ulCustomizeService = VOS_FALSE;
    stCustSrv.ulStatus           = NV_ITEM_DEACTIVE;

    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_CustomizeService, &stCustSrv, sizeof(stCustSrv)))
    {
        AT_WARN_LOG("At_WriteCustomizeSrvNVToDefault():en_NV_Item_CustomizeService NV Write Fail!");
        return VOS_ERR;
    }

    return VOS_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_WriteGprsActTimerLenNVToDefault
 ????????  : ????GPRS Active Timer??????????????
 ????????  : enCustomizeItem - 0:??????????????????????????????????????
                               1:??????????????????????????????????????
             ????????????????????????????????????????????????????????????????????,
             ??????????????????????????????
 ????????  : ??
 ?? ?? ??  : VOS_OK  - ????????
             VOS_ERR - ????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??3??
    ??    ??   : z00161729
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 At_WriteGprsActTimerNVToDefault(
    AT_CUSTOMIZE_ITEM_DFLT_ENUM_UINT8   enCustomizeItem
)
{
    VOS_UINT32                          ulGprsActiveTimerLen;

    /* ??????????????????????????????????????????????20?? */
    ulGprsActiveTimerLen = AT_GPRS_ACT_TIMER_LEN_DEFAULT_VAL;
    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_GPRS_ActiveTimerLength,
                          &ulGprsActiveTimerLen, sizeof(ulGprsActiveTimerLen)))
    {
        AT_WARN_LOG("At_WriteGprsActTimerNVToDefault():en_NV_Item_GPRS_ActiveTimerLength NV Write Fail!");
        return VOS_ERR;
    }

    return VOS_OK;

}

/*****************************************************************************
 ?? ?? ??  : At_SetCustomizeItemToDefaultVal
 ????????  : ??????????????????
 ????????  : enCustomizeItem - 0:??????????????????????????????????????
                               1:??????????????????????????????????????
 ????????  : ??
 ?? ?? ??  : VOS_OK  - ????
             VOS_ERR - ????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??3??
    ??    ??   : z00161729
    ????????   : ??????????

  2.??    ??   : 2012??2??28??
    ??    ??   : c64416
    ????????   : ????V7R1????
  3.??    ??   : 2012??5??18??
    ??    ??   : z60575
    ????????   : ????????:DTS2012051806821, ????????HSDPA State??HSUPA State??HSDPA Rate????????????NV??
  4.??    ??   : 2012??7??20??
    ??    ??   : f62575
    ????????   : ????????:DTS2012071402176, ????????50009,8271,8317,8233,9007,21
                 ??????NV??6267,6268,6269??50012,52000

*****************************************************************************/
VOS_UINT32 At_SetCustomizeItemToDefaultVal(
    AT_CUSTOMIZE_ITEM_DFLT_ENUM_UINT8   enCustomizeItem
)
{
    /* Add by w00199382 for V7????????, 2012-04-07, Begin   */

    /* ????WIFI????????????en_NV_Item_WIFI_KEY??
       en_NV_Item_WIFI_STATUS_SSID 2??NV?? */
    if (VOS_OK != At_WriteWifiNVToDefault(enCustomizeItem))
    {
        return VOS_ERR;
    }
    /* Add by w00199382 for V7????????, 2012-04-07, End   */

    /* ????SimLock????????????en_NV_Item_CustomizeSimLockPlmnInfo??
       en_NV_Item_CardlockStatus??en_NV_Item_CustomizeSimLockMaxTimes 3??NV?? */
    if (VOS_OK != At_WriteSimLockNVToDefault(enCustomizeItem))
    {
        return VOS_ERR;
    }

    return VOS_OK;

}

/*****************************************************************************
 ?? ?? ??  : At_SetCsdfltPara
 ????????  : ??????????????????,????????:^CSDFLT = <value_info>
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : AT_OK - ????
             AT_DEVICE_OTHER_ERROR?? AT_DATA_UNLOCK_ERROR - ????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??3??
    ??    ??   : z00161729
    ????????   : ??????????
  2.??    ??   : 2011??06??09??
    ??    ??   : f00179208
    ????????   : ????????:DTS2011060304946,??E353s-2????AT 2011.6.2??????AT??????V1.1.0??????V1.1.4??
                 ????????V1.1.0??????????AT????????????
  3.??    ??   : 2011??06??23??
    ??    ??   : f00179208
    ????????   : ????????:DTS2011061302503,[????AT????]^csdflt????????????????????????????????????????
  4.??    ??   : 2012??05??11??
    ??    ??   : z60575
    ????????   : ????????DTS2012042502262????????????c64416????
*****************************************************************************/
VOS_UINT32 At_SetCsdfltPara(VOS_UINT8 ucIndex)
{
    /* ???????????? */
    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????????? */
    if (gucAtParaIndex != 0)
    {
        return AT_ERROR;
    }

    /* ????????????????????,???????????????????? */
    if (VOS_TRUE == g_bAtDataLocked)
    {
        return  AT_ERROR;
    }

    /* ????????0 */
    if (VOS_OK != At_SetCustomizeItemToDefaultVal(AT_CUSTOMIZE_ITEM_DEFAULT_VALUE_FROM_CFGFILE))
    {
        return AT_ERROR;
    }

    /*  ??????????????????????????wifi???????? */
    if (BSP_MODULE_SUPPORT == mdrv_misc_support_check(BSP_MODULE_TYPE_WIFI) )
    {
        AT_PhSendRestoreFactParmNoReset();
    }

    return AT_OK;

}
/*****************************************************************************
 ?? ?? ??  : VOS_UINT32 At_GetParaCnt(
 ????????  : ????AT??????????????,????????????;???????? = ','????+1
 ????????  : ??
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??10??
    ??    ??   : l00130025
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32  At_GetParaCnt(
    VOS_UINT8                           *pucData,
    VOS_UINT16                          usLen
)
{
    VOS_UINT16                          i;
    VOS_UINT32                          ulCnt;

    ulCnt = 0;
    for ( i = 0; i < usLen ; i++ )
    {
        if (',' == pucData[i])
        {
            ++ ulCnt;
        }
    }

    /*???????? = ','????+1*/
    return (ulCnt + 1);
}
/*****************************************************************************
 ?? ?? ??  : At_AsciiNum2SimLockImsiStr
 ????????  : ?? Ascii ????????Simlock??????????????
             ????: "23002"-->{0x23,0x00,0x2F}
 ????????  : *pucDst  -- ????????
             *pucSrc  -- ??????,Ascii??
             usSrcLen -- ??Ascii????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??18??
    ??    ??   : l00130025
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 At_AsciiNum2SimLockImsiStr (
    VOS_UINT8                           *pucDst,
    VOS_UINT8                           *pucSrc,
    VOS_UINT16                          usSrcLen
)
{
    VOS_UINT16                          usChkLen;
    VOS_UINT8                           ucTmp;
    VOS_UINT8                           ucBcdCode;

    /* ????????????????16 */
    if (usSrcLen > (TAF_PH_SIMLOCK_PLMN_STR_LEN * 2))
    {
        return AT_FAILURE;
    }

    for (usChkLen = 0; usChkLen < usSrcLen; usChkLen++)
    {
        /* the number is 0-9 */
        if ((pucSrc[usChkLen] >= 0x30) && (pucSrc[usChkLen] <= 0x39))
        {
            ucBcdCode = pucSrc[usChkLen] - 0x30;
        }
        else
        {
            return AT_FAILURE;
        }

        ucTmp = usChkLen % 2;   /* ?????????? */
        if (0 == ucTmp)
        {
            pucDst[usChkLen/2] = (VOS_UINT8)((ucBcdCode << 4) & 0xF0); /* ???? */
        }
        else
        {
            pucDst[usChkLen/2] |= (VOS_UINT8)(ucBcdCode);   /* ???? */
        }
    }

    if(1 == (usSrcLen % 2))
    {
        pucDst[usSrcLen/2] |= 0x0F; /* ???? */
    }

    return AT_SUCCESS;
}

/*****************************************************************************
 ?? ?? ??  : At_CovertAtParaToSimlockPlmnInfo
 ????????  : ??At ???????????????? Simlock??PlmnInfo??????
 ????????  : ulParaCnt -- ??????????????
             pstParalist -- ????????????????
 ????????  : pstSimLockPlmnInfo -- NV???? simlock Plmn info??????
 ?? ?? ??  : AT_OK,??????????????????,????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??14??
    ??    ??   : l00130025
    ????????   : ??????????
  2.??    ??   : 2012??12??13??
    ??    ??   : L00171473
    ????????   : DTS2012121802573, TQE????
*****************************************************************************/
VOS_UINT32 At_CovertAtParaToSimlockPlmnInfo(
    VOS_UINT32                          ulParaCnt,
    AT_PARSE_PARA_TYPE_STRU             *pstParalist,
    TAF_CUSTOM_SIM_LOCK_PLMN_INFO_STRU  *pstSimLockPlmnInfo
)
{
    VOS_UINT8                           ucMncNum;
    VOS_UINT8                           aucImsiStr[TAF_PH_SIMLOCK_PLMN_STR_LEN];
    VOS_UINT8                           *pucPlmnRange;
    VOS_UINT32                          i;
    VOS_UINT32                          ulPlmnParaIdx;
    VOS_UINT32                          ulImsiStrLen;

    ulPlmnParaIdx = 0;
    ucMncNum      = 2;


    PS_MEM_SET(aucImsiStr, 0x00, sizeof(aucImsiStr));

    /* Plmn??????????????2??????????????3??????????????(MNClen,PlmnRangeBegin,PlmnRangeEnd) */
    for (i = 1; i < ulParaCnt; i++)
    {
        /* ??Plmninfo????index??3n+1??,????MNC?????? */
        if (1 == (i % 3))
        {
            if (1 != pstParalist[i].usParaLen)
            {
                return AT_SIMLOCK_PLMN_MNC_LEN_ERR;
            }
            else if (('2' != pstParalist[i].aucPara[0])
                  && ('3' != pstParalist[i].aucPara[0]))
            {
                return AT_SIMLOCK_PLMN_MNC_LEN_ERR;
            }
            else
            {
                ucMncNum = pstParalist[i].aucPara[0] - '0';
                pstSimLockPlmnInfo->astSimLockPlmnRange[ulPlmnParaIdx].ucMncNum = ucMncNum;
            }

        }
        else if (2 == (i % 3))
        {
            /* ??Plmninfo????index??3n+2 ??,????PlmnRangeBegin */
            if (AT_FAILURE == At_AsciiNum2SimLockImsiStr(aucImsiStr, pstParalist[i].aucPara,pstParalist[i].usParaLen))
            {
                return AT_ERROR;
            }
            else
            {
                ulImsiStrLen = (pstParalist[i].usParaLen + 1) / 2;
                pucPlmnRange = pstSimLockPlmnInfo->astSimLockPlmnRange[ulPlmnParaIdx].aucRangeBegin;
                PS_MEM_CPY(pucPlmnRange, aucImsiStr, (VOS_UINT16)ulImsiStrLen);
                PS_MEM_SET(pucPlmnRange + ulImsiStrLen, 0xFF,
                                (TAF_PH_SIMLOCK_PLMN_STR_LEN - ulImsiStrLen));
            }
        }
        else
        {
            /* ??Plmninfo????index??3n+2 ??,????PlmnRangeEnd */
            if (AT_FAILURE == At_AsciiNum2SimLockImsiStr(aucImsiStr, pstParalist[i].aucPara,pstParalist[i].usParaLen))
            {
                return AT_ERROR;
            }
            else
            {
                ulImsiStrLen = (pstParalist[i].usParaLen + 1) / 2;
                pucPlmnRange = pstSimLockPlmnInfo->astSimLockPlmnRange[ulPlmnParaIdx].aucRangeEnd;
                PS_MEM_CPY(pucPlmnRange, aucImsiStr, (VOS_UINT16)ulImsiStrLen);
                PS_MEM_SET(pucPlmnRange + ulImsiStrLen, 0xFF,
                                (TAF_PH_SIMLOCK_PLMN_STR_LEN - ulImsiStrLen));
            }
            ++ ulPlmnParaIdx;
        }

    }

    return AT_OK;

}

/*****************************************************************************
 ?? ?? ??  : At_SetSimLockPlmnInfo
 ????????  : ????AT^SIMLOCK????????
 ????????  : VOS_UINT8  ucIndex ????????
             ulParaCnt -- ??????????????
             pstParalist -- ????????????????
 ????????  : ??
 ?? ?? ??  : AT_OK --- ????
             AT_ERROR --- ????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??10??
    ??    ??   : l00130025
    ????????   : ??????????
  2.??    ??   : 2012??2??21??
    ??    ??   : w00199382
    ????????   : B060??????????simlockNv????????????????
  3.??    ??   : 2012??5??9??
    ??    ??   : l60609
    ????????   : DTS2012050903238:at^cardlock??????????????
  4.??    ??   : 2012??12??13??
    ??    ??   : L00171473
    ????????   : DTS2012121802573, TQE????
*****************************************************************************/
VOS_UINT32 At_SetSimLockPlmnInfo(
    VOS_UINT8                           ucIndex,
    VOS_UINT32                          ulParaCnt,
    AT_PARSE_PARA_TYPE_STRU             *pstParalist
)
{
    VOS_UINT32                          ulRslt;
    TAF_CUSTOM_SIM_LOCK_PLMN_INFO_STRU  stSimLockPlmnInfo;
    TAF_CUSTOM_CARDLOCK_STATUS_STRU     stCardLockStatus;
    VOS_UINT32                          i;
    VOS_UINT32                          ulPlmnInfoNum;
    /*TAF_CUSTOM_SIM_LOCK_PLMN_RANGE_STRU stDftPlmnInfoVal;*/

    if (VOS_TRUE == g_bAtDataLocked)
    {
        ulRslt = AT_DATA_UNLOCK_ERROR;
    }
    else if (ulParaCnt > ((TAF_MAX_SIM_LOCK_RANGE_NUM * 3) + 1))
    {
        ulRslt = AT_SIMLOCK_PLMN_NUM_ERR;
    }
    else if (((ulParaCnt - 1) % 3) != 0)
    {
        ulRslt = AT_ERROR;
    }
    else
    {
        ulRslt =  At_CovertAtParaToSimlockPlmnInfo(ulParaCnt, pstParalist, &stSimLockPlmnInfo);
    }

    if (AT_OK != ulRslt)
    {
        At_FormatResultData(ucIndex, ulRslt);
        return AT_ERROR;
    }

    /* ????PLMN ????(MNClen,PlmnRangeBegin,PlmnRangeEnd)?????? ????2????????????Plmn ???? */
    ulPlmnInfoNum = (ulParaCnt - 1) / 3;

    /* ????????PLMN???????????????? */
    for (i = ulPlmnInfoNum ; i < TAF_MAX_SIM_LOCK_RANGE_NUM; i++)
    {
        PS_MEM_SET(stSimLockPlmnInfo.astSimLockPlmnRange[i].aucRangeBegin,
                                        AT_SIM_LOCK_PLMN_RANGE_DEFAULT_VAL,
                                        TAF_PH_SIMLOCK_PLMN_STR_LEN);
        PS_MEM_SET(stSimLockPlmnInfo.astSimLockPlmnRange[i].aucRangeEnd,
                                        AT_SIM_LOCK_PLMN_RANGE_DEFAULT_VAL,
                                        TAF_PH_SIMLOCK_PLMN_STR_LEN);
        stSimLockPlmnInfo.astSimLockPlmnRange[i].ucMncNum = AT_SIM_LOCK_MNC_NUM_DEFAULT_VAL;
    }

    stSimLockPlmnInfo.ulStatus = NV_ITEM_ACTIVE;


    PS_MEM_SET(&stCardLockStatus, 0x00, sizeof(stCardLockStatus));

    /* ????????????????*/
    ulRslt = NV_ReadEx(MODEM_ID_0, en_NV_Item_CardlockStatus,
                      &stCardLockStatus,
                      sizeof(stCardLockStatus));

    if (NV_OK != ulRslt)
    {
        AT_WARN_LOG("At_SetSimLockPlmnInfo:read en_NV_Item_CardlockStatus Fail.");
        At_FormatResultData(ucIndex, AT_ERROR);
        return AT_ERROR;
    }

    /* ??????????????????????????????????ERROR */
    if ((NV_ITEM_ACTIVE == stCardLockStatus.ulStatus)
     && (TAF_OPERATOR_UNLOCK_TIMES_MIN == stCardLockStatus.ulRemainUnlockTimes)
     && (TAF_OPERATOR_LOCK_LOCKED == stCardLockStatus.enCardlockStatus))
    {
        AT_WARN_LOG("At_SetSimLockPlmnInfo: is locked, operation is not allowed.");
        At_FormatResultData(ucIndex, AT_ERROR);
        return AT_ERROR;

    }

    /* ??en_NV_Item_CardlockStatus????????????????CardStatus ????????????1,Remain Times???????? */
    stCardLockStatus.ulStatus            = NV_ITEM_ACTIVE;
    stCardLockStatus.enCardlockStatus    = TAF_OPERATOR_LOCK_NEED_UNLOCK_CODE;

    ulRslt = NV_WriteEx(MODEM_ID_0, en_NV_Item_CardlockStatus,
                        &stCardLockStatus,
                        sizeof(stCardLockStatus));
    if (NV_OK != ulRslt)
    {
        AT_WARN_LOG("At_SetSimLockPlmnInfo:write en_NV_Item_CardlockStatus Fail.");
        At_FormatResultData(ucIndex, AT_ERROR);
        return AT_ERROR;
    }

    /* Added by l60609 for B060 Project, 2012-2-20, Begin   */

    /*??C??????????????simlockNV*/
    if (TAF_SUCCESS != AT_FillAndSndAppReqMsg(0,
                                              0,
                                              DRV_AGENT_SIMLOCK_NV_SET_REQ,
                                              &stCardLockStatus,
                                              sizeof(stCardLockStatus),
                                              I0_WUEPS_PID_DRV_AGENT))
    {

        AT_WARN_LOG("At_SetSimLockPlmnInfo():DRV_AGENT_SIMLOCK_NV_SET_REQ NV Write Fail!");
        At_FormatResultData(ucIndex, AT_ERROR);
        return VOS_ERR;
    }

    /* Added by l60609 for B060 Project, 2012-2-20, End   */

    /* ??PLMN??????????NV??en_NV_Item_CustomizeSimLockPlmnInfo */

    ulRslt = NV_WriteEx(MODEM_ID_0, en_NV_Item_CustomizeSimLockPlmnInfo,
                        &stSimLockPlmnInfo,
                        sizeof(stSimLockPlmnInfo));
    if (NV_OK != ulRslt)
    {
        AT_WARN_LOG("At_SetSimLockPlmnInfo:write en_NV_Item_CustomizeSimLockPlmnInfo Fail.");
        At_FormatResultData(ucIndex, AT_ERROR);
        return AT_ERROR;
    }

    At_FormatResultData(ucIndex, AT_OK);
    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetMaxLockTimes
 ????????  : ????Simlock??????????????
 ????????  : ucIndex -- ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??8??14??
    ??    ??   : l00130025
    ????????   : ??????????

  2.??    ??   : 2012??2??21??
    ??    ??   : w00199382
    ????????   : B060??????????simlockNv????????????????
  3.??    ??   : 2012??03??19??
    ??    ??   : f00179208
    ????????   : ??????:DTS2012031403331,??????????????????SIMLOCK??AT??????
                 ??????????????????
*****************************************************************************/
VOS_UINT32 At_SetMaxLockTimes(VOS_UINT8 ucIndex)
{
    TAF_CUSTOM_SIM_LOCK_MAX_TIMES_STRU          stSimLockMaxTimes;

    /* ???????????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_DEVICE_OTHER_ERROR;
    }

    /* ???????????? */
    if (gucAtParaIndex != 1)
    {
        return AT_DEVICE_OTHER_ERROR;
    }

    /* ????????????????????,???????????????????? */
    if (VOS_TRUE == g_bAtDataLocked)
    {
        return  AT_DATA_UNLOCK_ERROR;
    }

    stSimLockMaxTimes.ulStatus       = NV_ITEM_ACTIVE;
    stSimLockMaxTimes.ulLockMaxTimes = gastAtParaList[0].ulParaValue;


    /* ??C??????????????SIMLOCK?????????? */
    if (TAF_SUCCESS != AT_FillAndSndAppReqMsg(0,
                                              0,
                                              DRV_AGENT_MAX_LOCK_TIMES_SET_REQ,
                                              &stSimLockMaxTimes,
                                              sizeof(stSimLockMaxTimes),
                                              I0_WUEPS_PID_DRV_AGENT))
    {

        AT_WARN_LOG("At_SetMaxLockTimes():DRV_AGENT_SIMLOCK_NV_SET_REQ NV Write Fail!");
        return AT_DEVICE_OTHER_ERROR;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_MAXLCKTMS_SET;
    return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */


}

/*****************************************************************************
 ?? ?? ??  : AT_SetVertime
 ????????  : ????????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??9??9??
    ??    ??   : lijun 00171473
    ????????   : ??????????

  2.??    ??   : 2011??10??15??
    ??    ??   : o00132663
    ????????   : AT??????????API????????????????

  3.??    ??   : 2012??4??7??
    ??    ??   : z60575
    ????????   : DTS2012040604473????
*****************************************************************************/
VOS_UINT32 AT_SetVertime ( VOS_UINT8 ucIndex )
{
    VOS_UINT32                          ulRst;

    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ????????DRV_AGENT_VERTIME_QRY_REQ??AT???????? */
    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   DRV_AGENT_VERTIME_QRY_REQ,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_WUEPS_PID_DRV_AGENT);

    if(AT_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_VERSIONTIME_READ;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}


/* Deleted by Y00213812 for VoLTE_PhaseI ????, 2013-07-08, begin */
/* Deleted by Y00213812 for VoLTE_PhaseI ????, 2013-07-08, end */

/* begin V7R1 PhaseI Modify */
/*****************************************************************************
 ?? ?? ??  : At_SetSystemInfoEx
 ????????  : ????^SYSINFOEX????,????TAF????SYSINFO??????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??4??7??
    ??    ??   : zhoujun /40661
    ????????   : ??????????
  2.??    ??   : 2012??03??31??
    ??    ??   : f00179208
    ????????   : DTS2012032903799:????????????AT^SYSINFOEX=1????????????????????
                  ????????????????????????AT^SYSINFOEX=????????????????
  3.??    ??   : 2015??3??28??
    ??    ??   : g00261581
    ????????   : ????????????

*****************************************************************************/
VOS_UINT32 At_SetSystemInfoEx(TAF_UINT8 ucIndex)
{
    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(VOS_TRUE == TAF_MMA_QrySystemInfoReq(WUEPS_PID_AT,
                                            gastAtClientTab[ucIndex].usClientId,
                                            0,
                                            VOS_TRUE))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SYSINFOEX_READ;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}
/* end V7R1 PhaseI Modify */

/*****************************************************************************
 ?? ?? ??  : AT_SetGodloadPara
 ????????  : ??????????????????
             <CR><LF>OK<CR><LF>
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_ERR??VOS_OK
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??2??19??
    ??    ??   : s62952
    ????????   : ??????????
  2.??    ??   : 2011??10??17??
    ??    ??   : ??????/f62575
    ????????   : AT PROJECT
*****************************************************************************/
VOS_UINT32 AT_SetGodloadPara( VOS_UINT8 ucIndex )
{
    /* Modified  by f62575 for AT Project, 2011-10-17, begin */
    VOS_UINT32                          ulRet;

    /* ???????? */
    if (0 != gucAtParaIndex)
    {
        AT_WARN_LOG("AT_SetGodloadPara: too many parameters.");
        return AT_ERROR;
    }

    /* ????????C???????????????????????? */
    ulRet = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   gastAtClientTab[ucIndex].opId,
                                   DRV_AGENT_GODLOAD_SET_REQ,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_WUEPS_PID_DRV_AGENT);
    if (TAF_SUCCESS != ulRet)
    {
        AT_WARN_LOG("AT_SetApbatlvlPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_GODLOAD_SET;
    return AT_WAIT_ASYNC_RETURN;
    /* Modified  by f62575 for AT Project, 2011-10-17, end */

}

/*****************************************************************************
 ?? ?? ??  : At_SetResetPara
 ????????  : ????????????
             <CR><LF>OK<CR><LF>
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_ERR??VOS_OK
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??2??19??
    ??    ??   : s62952
    ????????   : ??????????
  2.??    ??   : 2011??11??03??
    ??    ??   : ??????/f62575
    ????????   : AT PROJECT
  3.??    ??   : 2012??6??04??
    ??    ??   : ?????? z60575
    ????????   : DTS2012060404567????C??????????????10ms????
  4.??    ??   : 2012??7??06??
    ??    ??   : ?????? z60575
    ????????   : DTS2012060404567????C??????????????500ms????????????PC??????OK
*****************************************************************************/
VOS_UINT32 At_SetResetPara( VOS_UINT8 ucIndex  )
{
    VOS_UINT8                           ucUpdateFlag;
    VOS_UINT32                          ulRslt;

    /* Modified  by f62575 for AT Project, 2011-10-17, begin */
    if (0 != gucAtParaIndex)
    {
        AT_WARN_LOG("At_SetResetPara: too many parameters.");
        return AT_ERROR;
    }

    /* ??????OK */
    At_FormatResultData(ucIndex,AT_OK);

    /* B31????????????????????????AT^RESET??????????????OK??????PC????????????????????500ms */
    VOS_TaskDelay(500);

    /* ??????????C???????? */
    ucUpdateFlag = VOS_FALSE;

    /*modified by Y00213812 for DTS2012082204471 TQE????, 2012-08-10, begin*/
    ulRslt = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                    gastAtClientTab[ucIndex].opId,
                                    DRV_AGENT_TMODE_SET_REQ,
                                    &ucUpdateFlag,
                                    sizeof(ucUpdateFlag),
                                    I0_WUEPS_PID_DRV_AGENT);
    if (VOS_OK != ulRslt)
    {
        return VOS_ERR;
    }
    /*modified by Y00213812 for DTS2012082204471 TQE????, 2012-08-10, end*/

    return VOS_OK;
    /* Modified  by f62575 for AT Project, 2011-10-17, end */
}

/*****************************************************************************
 ?? ?? ??  : AT_SetNvBackUpPara
 ????????  : ??NV??????????????
            <CR><LF><result code><CR><LF >
            <CR><LF>OK<CR><LF>
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_ERR??VOS_OK
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??2??19??
    ??    ??   : s62952
    ????????   : ??????????

  2.??    ??   : 2011??11??4??
    ??    ??   : ????/l60609
    ????????   : AT Project:NV_BACKUP??C??????
*****************************************************************************/
VOS_UINT32 AT_SetNvBackUpPara( VOS_UINT8 ucIndex )
{
    VOS_UINT32                          ulRst;

    /*Modified by l60609 for At Project, 2011-11-4, Begin */
    if (0 != gucAtParaIndex)
    {
        AT_WARN_LOG("AT_SetNvBackUpPara: too many parameters.");
        return AT_ERROR;
    }

    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   DRV_AGENT_NVBACKUP_SET_REQ,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_WUEPS_PID_DRV_AGENT);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_NVBACKUP_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
    /*Modified by l60609 for At Project, 2011-11-4, End */
}

/* Added by d00212987 for BalongV9R1 NV????????????????&???? ???? 2013-10-24, begin */
/*****************************************************************************
 ?? ?? ??  : AT_SetNvManuFactureExtPara
 ????????  : ??????????????????????????

 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_ERR??VOS_OK
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??10??24??
    ??    ??   : d00212987
    ????????   : BalongV9R1 NV????????????????&????

*****************************************************************************/
VOS_UINT32 AT_SetNvManufactureExtPara( VOS_UINT8 ucIndex )
{
    VOS_UINT32                          ulRst;

    if (0 != gucAtParaIndex)
    {
        AT_WARN_LOG("AT_SetNvManufactureExtPara: too many parameters.");
        return AT_ERROR;
    }

    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   DRV_AGENT_NVMANUFACTUREEXT_SET_REQ,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_WUEPS_PID_DRV_AGENT);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_NVMANUFACTUREEXT_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}
/* Added by d00212987 for BalongV9R1 NV????????????????&???? ???? 2013-10-24, end */

/*****************************************************************************
 ?? ?? ??  : At_SetNvRestorePara
 ????????  : ????????NV????????????
             <CR><LF><result code><CR><LF >
             <CR><LF>OK<CR><LF>
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_ERR??VOS_OK
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??2??19??
    ??    ??   : s62952
    ????????   : ??????????
  2.??    ??   : 2011??11??03??
    ??    ??   : f00179208
    ????????   : AT??????????API????????????????
*****************************************************************************/
VOS_UINT32 At_SetNvRestorePara( VOS_UINT8 ucIndex )
{
    VOS_UINT32                 ulRst;

    if (0 != gucAtParaIndex)
    {
        AT_WARN_LOG("At_SetNvRestorePara: too many parameters.");
        return AT_ERROR;
    }

    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   DRV_AGENT_NVRESTORE_SET_REQ,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_WUEPS_PID_DRV_AGENT);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_NVRESTORE_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }

}

/*****************************************************************************
 ?? ?? ??  : AT_SetNvRststtsPara
 ????????  : ????????????NV??????????????
             <CR><LF><nv status><CR><LF>
             <CR><LF>OK<CR><LF>
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  :VOS_ERR??VOS_OK
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??2??19??
    ??    ??   : S62952
    ????????   : ??????????
  2.??    ??   : 2011??11??03??
    ??    ??   : f00179208
    ????????   : AT??????????API????????????????
*****************************************************************************/
VOS_UINT32  AT_SetNvRststtsPara( VOS_UINT8 ucIndex )
{
    VOS_UINT32                          ulRst;

    if (0 != gucAtParaIndex)
    {
        AT_WARN_LOG("AT_SetNvRststtsPara: too many parameters.");
        return AT_ERROR;
    }

    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   DRV_AGENT_NVRSTSTTS_QRY_REQ,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_WUEPS_PID_DRV_AGENT);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_NVRSTSTTS_READ;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}
/*****************************************************************************
 ?? ?? ??  : AT_SetWiFiEnable
 ????????  : ??????????WIFI
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??26??
    ??    ??   : ????
    ????????   : ??????????
  2.??    ??   : 2012??03??03??
    ??    ??   : s62952
    ????????   : BalongV300R002 Build????????  :????FEATURE_WIFI??
  3.??    ??   : 2012??04??11??
    ??    ??   : w00199382
    ????????   : v7AT????????

*****************************************************************************/
VOS_UINT32 AT_SetWiFiEnablePara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;

    ulRst = VOS_OK;

    /* ????????*/
    if (gucAtParaIndex > 1)
    {
        return  AT_TOO_MANY_PARA;
    }

    if (0 == gastAtParaList[0].ulParaValue )
    {
        /*????WIFI*/
        ulRst = (VOS_UINT32)WIFI_POWER_SHUTDOWN();
    }
    else if (1 == gastAtParaList[0].ulParaValue )
    {
        /* ??????API?????? */
    }
    else
    {

        VOS_TaskDelay(5500);    /* ??????????????5.5s?????? */


        if ( VOS_OK != WIFI_POWER_SHUTDOWN())
        {
            return AT_ERROR;
        }


        VOS_TaskDelay(1000);    /* ??????????????1?????? */


       /* Add by w00199382 for V7????????, 2012-04-07, End   */

        /*????????????WIFI*/
        ulRst = (VOS_UINT32)WIFI_POWER_START();
    }

    if (VOS_OK != ulRst)
    {
        return AT_ERROR;
    }

    return AT_OK;
}
/*****************************************************************************
 ?? ?? ??  : AT_SetWiFiModePara
 ????????  : ????Wifi??????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??26??
    ??    ??   : ????
    ????????   : ??????????
  2.??    ??   : 2011??7??29??
    ??    ??   : f00179208
    ????????   : ??????????DTS2011072900396,[????AT????]AT^WIMODE????CW????????????????????????
  3.??    ??   : 2011??9??19??
    ??    ??   : f00179208
    ????????   : ??????????DTS2011091900969,[????AT????]MT WIFI??????????AT????????????
  4.??    ??   : 2012??01??19??
    ??    ??   : l00171473
    ????????   : for DTS2012020106679, AT WT????
  5.??    ??   : 2012??04??11??
    ??    ??   : w00199382
    ????????   : v7AT????????
  6.??    ??   : 2012??5??3??
    ??    ??   : l60609
    ????????   : DTS2012050300123??b????wl????????????
*****************************************************************************/

VOS_UINT32 AT_SetWiFiModePara(VOS_UINT8 ucIndex)
{
    /* ????????*/
    if (gucAtParaIndex > 1)
    {
        return  AT_TOO_MANY_PARA;
    }

    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    if (BSP_MODULE_UNSUPPORT == mdrv_misc_support_check(BSP_MODULE_TYPE_WIFI) )
    {
        return AT_ERROR;
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */

    /* Modified by L00171473 for DTS2012020106679, AT WT???? 2012-01-17  Begin */
    WIFI_TEST_CMD("wl down");

    if (AT_WIFI_SUPPORT_MODE_B == gastAtParaList[0].ulParaValue)
    {
        WIFI_TEST_CMD("wl nmode 0");
        WIFI_TEST_CMD("wl gmode 0");
    }
    else if (AT_WIFI_SUPPORT_MODE_G == gastAtParaList[0].ulParaValue)
    {
        WIFI_TEST_CMD("wl nmode 0");
        WIFI_TEST_CMD("wl gmode 2");
    }
    else
    {
        WIFI_TEST_CMD("wl nmode 1");
        WIFI_TEST_CMD("wl gmode 1");
    }

    WIFI_TEST_CMD("wl up");
    /* Modified by L00171473 for DTS2012020106679, AT WT???? 2012-01-17  End */

    /*????????????????????????*/
    g_ulWifiMode = gastAtParaList[0].ulParaValue;

    return AT_OK;
}
/*****************************************************************************
 ?? ?? ??  : AT_SetWiFiBandPara
 ????????  : ????Wifi??????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??26??
    ??    ??   : ????
    ????????   : ??????????

*****************************************************************************/

VOS_UINT32 AT_SetWiFiBandPara(VOS_UINT8 ucIndex)
{

    /* ????????*/
    if (gucAtParaIndex > 1)
    {
        return  AT_TOO_MANY_PARA;
    }

    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    if (BSP_MODULE_UNSUPPORT == mdrv_misc_support_check(BSP_MODULE_TYPE_WIFI) )
    {
        return AT_ERROR;
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */


    /*????Wifi??????20M??40M????ERROR*/
    if(AT_WIFI_BAND_20M != gastAtParaList[0].ulParaValue)
    {
        return AT_ERROR;
    }

    return AT_OK;
}
/*****************************************************************************
 ?? ?? ??  : AT_SetWiFiFreqPara
 ????????  : ????Wifi??????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??26??
    ??    ??   : ????
    ????????   : ??????????
  2.??    ??   : 2012??01??19??
    ??    ??   : l00171473
    ????????   : for DTS2012020106679, AT WT????
*****************************************************************************/
VOS_UINT32 AT_SetWiFiFreqPara(VOS_UINT8 ucIndex)
{
    VOS_CHAR                            acCmd[200]={0};
    VOS_UINT32                          ulWifiFreq;
    VOS_UINT32                          i;
    VOS_UINT32                          aulChannel[] = {2412,2417,2422,2427,2432,
                                                        2437,2442,2447,2452,2457,
                                                        2462,2467,2472,2484};

    /* ????????*/
    if (gucAtParaIndex > 1)
    {
        return  AT_TOO_MANY_PARA;
    }

    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    if (BSP_MODULE_UNSUPPORT == mdrv_misc_support_check(BSP_MODULE_TYPE_WIFI) )
    {
        return AT_ERROR;
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */


    /* Modified by L00171473 for DTS2012020106679, AT WT???? 2012-01-17  Begin */
    /* ????????  */
    ulWifiFreq = 0;
    for (i=0; i<(sizeof(aulChannel)/sizeof(VOS_UINT32)); i++)
    {
        if (gastAtParaList[0].ulParaValue == aulChannel[i])
        {
            ulWifiFreq = (i+1);
            break;
        }
    }

    if (0 == ulWifiFreq)
    {
        AT_WARN_LOG("AT_SetWiFiFreqPara: freq ERROR");
        return AT_ERROR;
    }

    /* ???????????? */
    WIFI_TEST_CMD("wl down");

    VOS_sprintf(acCmd, "wl channel %d", ulWifiFreq);
    WIFI_TEST_CMD(acCmd);

    WIFI_TEST_CMD("wl up");
    /* Modified by L00171473 for DTS2012020106679, AT WT???? 2012-01-17  End */

    /* ???????????????????????? */
    g_ulWifiFreq = ulWifiFreq;

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_TransferWifiRate
 ????????  : ??AT??????????????????WIFI????????
 ????????  : VOS_UINT32                          ulInRate
             VOS_UINT32                         *pulOutRate
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??4??17??
    ??    ??   : l60609
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_TransferWifiRate(
    VOS_UINT32                          ulInRate,
    VOS_UINT32                         *pulOutRate
)
{
    VOS_UINT8                           ucIndex;
    /* WIFI n???? AT^WIDATARATE??????????????WL?????????????????? */
    VOS_UINT32                          aucAtWifiNRate_Table[AT_WIFI_N_RATE_NUM] = {650, 1300, 1950, 2600, 3900, 5200, 5850, 6500};

    for (ucIndex = 0; ucIndex < AT_WIFI_N_RATE_NUM; ucIndex++)
    {
        if (aucAtWifiNRate_Table[ucIndex] == ulInRate)
        {
            *pulOutRate = ucIndex;
            break;
        }
    }

    if (ucIndex >= AT_WIFI_N_RATE_NUM)
    {
        return VOS_ERR;
    }

    return VOS_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetWiFiRatePara
 ????????  : ????Wifi??????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??26??
    ??    ??   : ????
    ????????   : ??????????
  2.??    ??   : 2012??01??19??
    ??    ??   : l00171473
    ????????   : for DTS2012020106679, AT WT????
  3.??    ??   : 2012??4??17??
    ??    ??   : l60609
    ????????   : DTS2012041605870:N??????????????????
*****************************************************************************/
VOS_UINT32 AT_SetWiFiRatePara(VOS_UINT8 ucIndex)
{
    VOS_CHAR                            acCmd[200]={0};
    VOS_UINT32                          ulWifiRate;

    /* ????????*/
    if (gucAtParaIndex > 1)
    {
        return  AT_TOO_MANY_PARA;
    }

    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    if (BSP_MODULE_UNSUPPORT == mdrv_misc_support_check(BSP_MODULE_TYPE_WIFI) )
    {
        return AT_ERROR;
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */


    /* Modified by L00171473 for DTS2012020106679, AT WT???? 2012-01-17  Begin */
    ulWifiRate = gastAtParaList[0].ulParaValue/100;


    if (AT_WIFI_SUPPORT_MODE_N == g_ulWifiMode)         /*11 n*/
    {
        VOS_sprintf(acCmd, "wl nrate -m %d", 7);
    }
    else if (AT_WIFI_SUPPORT_MODE_G == g_ulWifiMode )    /*11 g*/
    {
        VOS_sprintf(acCmd, "wl bg_rate %d", ulWifiRate);
    }
    else if(AT_WIFI_SUPPORT_MODE_B == g_ulWifiMode)    /*11 b*/
    {
        VOS_sprintf(acCmd, "wl bg_rate %d", ulWifiRate);
    }
    else
    {
        AT_WARN_LOG("AT_SetWiFiRatePara: wifimode ERROR");
        return AT_ERROR;
    }
    /* Modify by w00199382 for V7????????, 2012-04-07, End   */

    WIFI_TEST_CMD(acCmd);


    /*????????????????????????*/
    g_ulWifiRate = gastAtParaList[0].ulParaValue;
    /* Modified by L00171473 for DTS2012020106679, AT WT???? 2012-01-17  End */

    return AT_OK;
}
/*****************************************************************************
 ?? ?? ??  : AT_SetWiFiPowerPara
 ????????  : ????Wifi??????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??26??
    ??    ??   : ????
    ????????   : ??????????
  2.??    ??   : 2012??01??19??
    ??    ??   : l00171473
    ????????   : for DTS2012020106679, AT WT????
*****************************************************************************/
VOS_UINT32 AT_SetWiFiPowerPara(VOS_UINT8 ucIndex)
{
    VOS_CHAR                            acCmd[200]={0};
    VOS_INT32                           lWifiPower;

    /* ????????*/
    if (gucAtParaIndex > 1)
    {
        return  AT_TOO_MANY_PARA;
    }

    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    if (BSP_MODULE_UNSUPPORT == mdrv_misc_support_check(BSP_MODULE_TYPE_WIFI) )
    {
        return AT_ERROR;
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */

    /* Modified by L00171473 for DTS2012020106679, AT WT???? 2012-01-17  Begin */
    g_lWifiPower = (VOS_INT32)gastAtParaList[0].ulParaValue;

    lWifiPower = g_lWifiPower/100;

    if (lWifiPower < AT_WIFI_POWER_MIN)
    {
        lWifiPower = AT_WIFI_POWER_MIN;
    }

    if (lWifiPower > AT_WIFI_POWER_MAX)
    {
        lWifiPower = AT_WIFI_POWER_MAX;
    }

    VOS_sprintf(acCmd, "wl txpwr1 -o -d %d", lWifiPower);

    /*????????????*/
    WIFI_TEST_CMD(acCmd);

    /* Modified by L00171473 for DTS2012020106679, AT WT???? 2012-01-17  End */

    return AT_OK;
}


/*****************************************************************************
 ?? ?? ??  : AT_SetWiFiTxPara
 ????????  : ??????????Wifi??????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??26??
    ??    ??   : ????
    ????????   : ??????????
  2.??    ??   : 2011??9??19??
    ??    ??   : f00179208
    ????????   : ??????????DTS2011091900969,[????AT????]MT WIFI??????????AT????????????
  3.??    ??   : 2012??01??19??
    ??    ??   : l00171473
    ????????   : for DTS2012020106679, AT WT????
  4.??    ??   : 2012??04??11??
    ??    ??   : w00199382
    ????????   : v7AT????????
  5.??    ??   : 2012??05??28??
    ??    ??   : c64416
    ????????   : DTS2012052805004
*****************************************************************************/
VOS_UINT32 AT_SetWiFiTxPara(VOS_UINT8 ucIndex)
{
    /* Add by w00199382 for V7????????, 2012-04-07, Begin   */
    VOS_CHAR                            acCmd[200]={0};
    /* Add by w00199382 for V7????????, 2012-04-07, End   */

    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    if (BSP_MODULE_UNSUPPORT == mdrv_misc_support_check(BSP_MODULE_TYPE_WIFI) )
    {
        return AT_ERROR;
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */


    /* ????????*/
    if (gucAtParaIndex > 1)
    {
        return  AT_TOO_MANY_PARA;
    }
    /* Add by w00199382 for V7????????, 2012-04-07, Begin   */
    if(g_ulWifiMode == AT_WIFI_SUPPORT_MODE_CW)
    {
        if (AT_WIFI_TX_OFF == gastAtParaList[0].ulParaValue)
        {
            /* WIFI_TEST_CMD("wl down"); */
            WIFI_TEST_CMD("wl fqacurcy 0");
            /* WIFI_TEST_CMD("wl up"); */
        }
        else
        {
            WIFI_TEST_CMD("wl up");
            WIFI_TEST_CMD("wl band b");
            WIFI_TEST_CMD("wl out");
            WIFI_TEST_CMD("wl phy_txpwrctrl 0");

            if(0 == g_ulWifiRF)
            {
                WIFI_TEST_CMD("wl phy_txpwrindex 0 127");
            }
            else
            {
                WIFI_TEST_CMD("wl phy_txpwrindex 127 0");
            }

            WIFI_TEST_CMD("wl phy_txpwrctrl 1");

            VOS_sprintf(acCmd, "wl fqacurcy %d", g_ulWifiFreq);

            WIFI_TEST_CMD(acCmd);

        }
    }
    else
    {
    /* Add by w00199382 for V7????????, 2012-04-07, End   */
    /* Modified by L00171473 for DTS2012020106679,AT WT???? 2012-01-17  Begin */
    /* ??????????????????????????1?????????? */
    if (AT_WIFI_TX_OFF == gastAtParaList[0].ulParaValue)
    {
         WIFI_TEST_CMD("wl pkteng_stop tx");
    }
    else
    {
        /* ???????????? */
        WIFI_TEST_CMD("wl down");

        WIFI_TEST_CMD("wl mpc 0");

        WIFI_TEST_CMD("wl country ALL");

        WIFI_TEST_CMD("wl frameburst 1");

        WIFI_TEST_CMD("wl scansuppress 1");

        WIFI_TEST_CMD("wl up");

        WIFI_TEST_CMD("wl pkteng_start 00:11:22:33:44:55 tx 100 1500 0");

        WIFI_TEST_CMD("wl phy_forcecal 1");
    }
    /* Modified by L00171473 for DTS2012020106679,AT WT???? 2012-01-17  End */
    /* Add by w00199382 for V7????????, 2012-04-07, Begin   */
    }
    /* Add by w00199382 for V7????????, 2012-04-07, End   */
    return AT_OK;
}
/*****************************************************************************
 ?? ?? ??  : AT_SetWiFiTxPara
 ????????  : ??????????Wifi??????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??26??
    ??    ??   : ????
    ????????   : ??????????
  2.??    ??   : 2012??01??19??
    ??    ??   : l00171473
    ????????   : for DTS2012020106679,AT WT????
*****************************************************************************/

VOS_UINT32 AT_SetWiFiRxPara(VOS_UINT8 ucIndex)
{
    VOS_CHAR                            acCmd[200]={0};

    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    if (BSP_MODULE_UNSUPPORT == mdrv_misc_support_check(BSP_MODULE_TYPE_WIFI) )
    {
        return AT_ERROR;
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */


    /* ????????*/
    if (gucAtParaIndex > 3)
    {
        return  AT_TOO_MANY_PARA;
    }

    /* Modified by L00171473 for DTS2012020106679,AT WT???? 2012-01-17  Begin */
    /*??????????????????????????1??????????*/
    if ( AT_WIFI_RX_OFF == gastAtParaList[0].ulParaValue)
    {
        /* ?????????????????? */
        WIFI_TEST_CMD("wl pkteng_stop rx");
    }
    else
    {
        WIFI_TEST_CMD("wl down");

        WIFI_TEST_CMD("wl mpc 0");

        WIFI_TEST_CMD("wl country ALL");

        WIFI_TEST_CMD("wl frameburst 1");

        WIFI_TEST_CMD("wl scansuppress 1");


        WIFI_TEST_CMD("wl up");

        VOS_sprintf(acCmd, "wl pkteng_start %c%c:%c%c:%c%c:%c%c:%c%c:%c%c rx async 0 0",
                    gastAtParaList[1].aucPara[0],gastAtParaList[1].aucPara[1],
                    gastAtParaList[1].aucPara[2],gastAtParaList[1].aucPara[3],
                    gastAtParaList[1].aucPara[4],gastAtParaList[1].aucPara[5],
                    gastAtParaList[1].aucPara[6],gastAtParaList[1].aucPara[7],
                    gastAtParaList[1].aucPara[8],gastAtParaList[1].aucPara[9],
                    gastAtParaList[1].aucPara[10],gastAtParaList[1].aucPara[11]);

        WIFI_TEST_CMD(acCmd);

        WIFI_GET_RX_PACKET_REPORT(&g_ulUcastWifiRxPkts,  &g_ulMcastWifiRxPkts);


    }
    /* Modified by L00171473 for DTS2012020106679,AT WT???? 2012-01-17  End */

    return AT_OK;
}
/*****************************************************************************
 ?? ?? ??  : AT_SetWiFiPacketPara
 ????????  : ????Wifi??????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??26??
    ??    ??   : ????
    ????????   : ??????????
  2.??    ??   : 2012??01??19??
    ??    ??   : l00171473
    ????????   : for DTS2012020106679,AT WT????
  3.??    ??   : 2012??03??22??
    ??    ??   : w00199382
    ????????   : DTS2012032103713,????????????
*****************************************************************************/
VOS_UINT32 AT_SetWiFiPacketPara(VOS_UINT8 ucIndex)
{
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    if (BSP_MODULE_UNSUPPORT == mdrv_misc_support_check(BSP_MODULE_TYPE_WIFI) )
    {
        return AT_ERROR;
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    /* ????????*/
    if (gucAtParaIndex > 1)
    {
        return  AT_TOO_MANY_PARA;
    }


    /*????????????*/
    if (1 != gastAtParaList[0].usParaLen)
    {
        return  AT_CME_INCORRECT_PARAMETERS;
    }
    /* Modified by L00171473 for DTS2012020106679,AT WT???? 2012-01-17  Begin */

    /* TODO: */
    /* ?????????????????? */
    WIFI_GET_RX_PACKET_REPORT(&g_ulUcastWifiRxPkts,  &g_ulMcastWifiRxPkts);

    /* Modified by L00171473 for DTS2012020106679,AT WT???? 2012-01-17  End */

    return AT_OK;
}

/* Modify by z60575 for multi_ssid, 2012-9-5 begin */
/* Modified by f62575 for AT Project, 2011-10-28, begin */
/*****************************************************************************
 ?? ?? ??  : AT_SetWiFiLogPara
 ????????  : ????Wifi??ssid,key
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??26??
    ??    ??   : ????
    ????????   : ??????????
  2.??    ??   : 2011??07??18??
    ??    ??   : l60609
    ????????   : DTS2011071802166:????wilog??????
  3.??    ??   : 2011??11??3??
    ??    ??   : ????/l60609
    ????????   : AT Project:A????????NV_WritePart
  4.??    ??   : 2012??4??18??
    ??    ??   : l60609
    ????????   : DTS201203307015:??????????????????
  5.??    ??   : 2012??9??17??
    ??    ??   : z60575
    ????????   : MULTI_SSID????
  6.??    ??   : 2013??5??17??
    ??    ??   : l00167671
    ????????   : NV??????????, ??NV??????????????????
*****************************************************************************/
VOS_UINT32 AT_SetWiFiLogPara(VOS_UINT8 ucIndex)
{
    TAF_AT_MULTI_WIFI_SSID_STRU               stWifiSsid;
    TAF_AT_MULTI_WIFI_SEC_STRU                stWifiKey;

    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    if (BSP_MODULE_UNSUPPORT == mdrv_misc_support_check(BSP_MODULE_TYPE_WIFI) )
    {
        return AT_ERROR;
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */


    /* ????????*/
    if (gucAtParaIndex > 2)
    {
        return  AT_TOO_MANY_PARA;
    }

    PS_MEM_SET(&stWifiKey, 0, sizeof(stWifiKey));
    PS_MEM_SET(&stWifiSsid, 0, sizeof(stWifiSsid));

    /*????WIFI SSID*/
    if (0 == gastAtParaList[0].ulParaValue)
    {
        /*????????????*/
        if (gastAtParaList[1].usParaLen >= AT_WIFI_SSID_LEN_MAX)
        {
            return  AT_CME_INCORRECT_PARAMETERS;
        }

        /*????WIFI KEY??????NV??*/
        if (VOS_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_MULTI_WIFI_STATUS_SSID, &stWifiSsid, sizeof(TAF_AT_MULTI_WIFI_SSID_STRU)))
        {
            AT_WARN_LOG("AT_SetWiFiSsidPara:READ NV ERROR");
            return AT_ERROR;
        }
        else
        {
            PS_MEM_SET(stWifiSsid.aucWifiSsid[0], 0x00, AT_WIFI_SSID_LEN_MAX);

            PS_MEM_CPY(stWifiSsid.aucWifiSsid[0], gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen);

            stWifiSsid.aucWifiSsid[0][gastAtParaList[1].usParaLen] = '\0';

            /*????WIFI SSID??????NV??*/
            if (VOS_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_MULTI_WIFI_STATUS_SSID, &stWifiSsid, sizeof(TAF_AT_MULTI_WIFI_SSID_STRU)))
            {
                AT_WARN_LOG("AT_SetWiFiSsidPara:WRITE NV ERROR");
                return AT_ERROR;
            }
        }
    }
    else
    {
        /*????WIFI KEY??????NV??*/
        if (VOS_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_MULTI_WIFI_KEY, &stWifiKey, sizeof(TAF_AT_MULTI_WIFI_SEC_STRU)))
        {
            AT_WARN_LOG("AT_SetWiFiKeyPara:READ NV ERROR");
            return AT_ERROR;
        }
        else
        {

            /*????????????*/
            if (gastAtParaList[1].usParaLen >= AT_WIFI_KEY_LEN_MAX)
            {
                return  AT_CME_INCORRECT_PARAMETERS;
            }

            /*????index??????????KEY*/
            switch(stWifiKey.ucWifiWepKeyIndex[0])
            {
                case 0:
                    VOS_MemCpy(stWifiKey.aucWifiWepKey1[0], gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen);
                    stWifiKey.aucWifiWepKey1[0][gastAtParaList[1].usParaLen] = '\0';
                    break;

                case 1:
                    VOS_MemCpy(stWifiKey.aucWifiWepKey2[0], gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen);
                    stWifiKey.aucWifiWepKey2[0][gastAtParaList[1].usParaLen] = '\0';
                    break;

                case 2:
                    VOS_MemCpy(stWifiKey.aucWifiWepKey3[0], gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen);
                    stWifiKey.aucWifiWepKey3[0][gastAtParaList[1].usParaLen] = '\0';
                    break;

                case 3:
                    VOS_MemCpy(stWifiKey.aucWifiWepKey4[0], gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen);
                    stWifiKey.aucWifiWepKey4[0][gastAtParaList[1].usParaLen] = '\0';
                    break;

                default:
                    break;
            }

            if (VOS_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_MULTI_WIFI_KEY, &stWifiKey, sizeof(TAF_AT_MULTI_WIFI_SEC_STRU)))
            {
                AT_WARN_LOG("AT_SetWiFiKeyPara:WRITE NV ERROR");
                return AT_ERROR;
            }
        }
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetWiFiSsidPara
 ????????  : ????Wifi??ssid
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??26??
    ??    ??   : ????
    ????????   : ??????????
  2.??    ??   : 2012??9??17??
    ??    ??   : z60575
    ????????   : MULTI_SSID????
  3.??    ??   : 2013??5??17??
    ??    ??   : l00167671
    ????????   : NV??????????, ??NV??????????????????
*****************************************************************************/
VOS_UINT32 AT_SetWiFiSsidPara(VOS_UINT8 ucIndex)
{
    TAF_AT_MULTI_WIFI_SSID_STRU         stWifiSsid;
    VOS_UINT8                           ucGroup;

    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    if (BSP_MODULE_UNSUPPORT == mdrv_misc_support_check(BSP_MODULE_TYPE_WIFI) )
    {
        return AT_ERROR;
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */


    /* ????????*/
    if (gucAtParaIndex > 2)
    {
        return  AT_TOO_MANY_PARA;
    }

    /*????????????*/
    if (gastAtParaList[1].usParaLen >= AT_WIFI_SSID_LEN_MAX)
    {
        return  AT_CME_INCORRECT_PARAMETERS;
    }

    /* SSID????4?? */
    if (gastAtParaList[0].ulParaValue >= AT_WIFI_MAX_SSID_NUM)
    {
        return  AT_CME_INCORRECT_PARAMETERS;
    }

    if (VOS_TRUE == g_bAtDataLocked)
    {
        return AT_ERROR;
    }

    PS_MEM_SET(&stWifiSsid, 0, sizeof(stWifiSsid));

    ucGroup = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /*????WIFI KEY??????NV??*/
    if (VOS_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_MULTI_WIFI_STATUS_SSID,&stWifiSsid, sizeof(TAF_AT_MULTI_WIFI_SSID_STRU)))
    {
        AT_WARN_LOG("AT_SetWiFiSsidPara:READ NV ERROR");
        return AT_ERROR;
    }
    else
    {
        PS_MEM_CPY(&(stWifiSsid.aucWifiSsid[ucGroup][0]), gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen);
        stWifiSsid.aucWifiSsid[ucGroup][gastAtParaList[1].usParaLen] = '\0';

        /*????WIFI SSID??????NV??*/
        if (VOS_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_MULTI_WIFI_STATUS_SSID,&stWifiSsid, sizeof(TAF_AT_MULTI_WIFI_SSID_STRU)))
        {
            AT_WARN_LOG("AT_SetWiFiSsidPara:WRITE NV ERROR");
            return AT_ERROR;
        }
    }

    return AT_OK;
}
/*****************************************************************************
 ?? ?? ??  : AT_SetWiFiKeyPara
 ????????  : ????Wifi??key
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??26??
    ??    ??   : ????
    ????????   : ??????????

  2.??    ??   : 2012??03??13??
    ??    ??   : w00199382
    ????????   : DTS2012030804030,wifikey aucWifiWpapsk
3.??    ??   : 2012??9??17??
    ??    ??   : z60575
    ????????   : MULTI_SSID????
  4.??    ??   : 2013??5??17??
    ??    ??   : l00167671
    ????????   : NV??????????, ??NV??????????????????
*****************************************************************************/
VOS_UINT32 AT_SetWiFiKeyPara(VOS_UINT8 ucIndex)
{
    TAF_AT_MULTI_WIFI_SEC_STRU          stWifiKey;
    VOS_UINT8                           ucGroup;

    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    if (BSP_MODULE_UNSUPPORT == mdrv_misc_support_check(BSP_MODULE_TYPE_WIFI) )
    {
        return AT_ERROR;
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */

    /* ???????? */
    if (gucAtParaIndex > 2)
    {
        return  AT_TOO_MANY_PARA;
    }

    /* ???????????? */
    if (gastAtParaList[1].usParaLen > AT_WIFI_WLWPAPSK_LEN)
    {
        return  AT_CME_INCORRECT_PARAMETERS;
    }

    if (VOS_TRUE == g_bAtDataLocked)
    {
        return AT_ERROR;
    }

    /* ????4??SSID */
    if (gastAtParaList[0].ulParaValue >= AT_WIFI_MAX_SSID_NUM)
    {
       return  AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_SET(&stWifiKey, 0, sizeof(stWifiKey));

    ucGroup = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ????WIFI KEY??????NV?? */
    if (NV_OK!= NV_ReadEx(MODEM_ID_0, en_NV_Item_MULTI_WIFI_KEY,&stWifiKey, sizeof(TAF_AT_MULTI_WIFI_SEC_STRU)))
    {
        AT_WARN_LOG("AT_SetWiFiKeyPara:READ NV ERROR");
        return AT_ERROR;
    }
    else
    {
        /* ????KEY */
        PS_MEM_CPY(&(stWifiKey.aucWifiWpapsk[ucGroup][0]), gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen);
        stWifiKey.aucWifiWpapsk[ucGroup][gastAtParaList[1].usParaLen] = '\0';


        if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_MULTI_WIFI_KEY, &stWifiKey, sizeof(TAF_AT_MULTI_WIFI_SEC_STRU)))
        {
            AT_WARN_LOG("AT_SetWiFiKeyPara:WRITE NV ERROR");
            return AT_ERROR;
        }
    }


    return AT_OK;
}
/* Modified by f62575 for AT Project, 2011-10-28, end */

/*****************************************************************************
 ?? ?? ??  : AT_PrintWifiChannelInfo
 ????????  : ????WIFI 802.11b/g/n????????????????
 ????????  : AT_WIFI_INFO_STRU         *pstWifiInfo
             VOS_UINT8                  ucIndex
 ????????  : ??
 ?? ?? ??  : ??
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??02??02??
    ??    ??   : l00198894
    ????????   : ??????????

*****************************************************************************/
VOS_VOID AT_PrintWifiChannelInfo(
    AT_WIFI_INFO_STRU                  *pstWifiInfo,
    VOS_UINT8                           ucIndex
)
{
    VOS_UINT8                           ucLoopIndex;
    VOS_UINT16                          usLength;

    /* ?????? */
    ucLoopIndex                         = 0;
    usLength                            = gstAtSendData.usBufLen;


    /* ????????802.11b????, ????802.11b???????????????? */
    if (VOS_TRUE == pstWifiInfo->bitOpbSupport)
    {
        usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                           (VOS_CHAR *)pgucAtSndCodeAddr,
                                           (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                           "%s:%s",
                                           g_stParseContext[ucIndex].pstCmdElement->pszCmdName,
                                           "b");
        for (ucLoopIndex = pstWifiInfo->usbLowChannel; ucLoopIndex <= pstWifiInfo->usbHighChannel; ucLoopIndex++)
        {
            usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                               (VOS_CHAR *)pgucAtSndCodeAddr,
                                               (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                               ",%d",
                                               ucLoopIndex);
        }
        if ( (VOS_TRUE == pstWifiInfo->bitOpgSupport)
          || (VOS_TRUE == pstWifiInfo->bitOpnSupport) )
        {
            usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                               (VOS_CHAR *)pgucAtSndCodeAddr,
                                               (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                               "%s",gaucAtCrLf);
        }
    }

    /* ????????802.11g????, ????802.11g???????????????? */
    if (VOS_TRUE == pstWifiInfo->bitOpgSupport)
    {
        usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                           (VOS_CHAR *)pgucAtSndCodeAddr,
                                           (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                           "%s:%s",
                                           g_stParseContext[ucIndex].pstCmdElement->pszCmdName,
                                           "g");
        for (ucLoopIndex = pstWifiInfo->usgLowChannel; ucLoopIndex <= pstWifiInfo->usgHighChannel; ucLoopIndex++)
        {
            usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                               (VOS_CHAR *)pgucAtSndCodeAddr,
                                               (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                               ",%d",
                                               ucLoopIndex);
        }
        if (VOS_TRUE == pstWifiInfo->bitOpnSupport)
        {
            usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                               (VOS_CHAR *)pgucAtSndCodeAddr,
                                               (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                               "%s",gaucAtCrLf);
        }
    }

    /* ????????802.11n????, ????802.11n???????????????? */
    if (VOS_TRUE == pstWifiInfo->bitOpnSupport)
    {
        usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                           (VOS_CHAR *)pgucAtSndCodeAddr,
                                           (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                           "%s:%s",
                                           g_stParseContext[ucIndex].pstCmdElement->pszCmdName,
                                           "n");
        for (ucLoopIndex = pstWifiInfo->usnLowChannel; ucLoopIndex <= pstWifiInfo->usnHighChannel; ucLoopIndex++)
        {
            usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                               (VOS_CHAR *)pgucAtSndCodeAddr,
                                               (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                               ",%d",
                                               ucLoopIndex);
        }
    }

    gstAtSendData.usBufLen += usLength;
    return;
}

/*****************************************************************************
 ?? ?? ??  : AT_PrintWifibPowerInfo
 ????????  : ????WIFI 802.11b??????????????
 ????????  : AT_WIFI_INFO_STRU *pstWifiInfo
             VOS_UINT8          ucWifiMode
             VOS_UINT8          ucIndex
 ????????  : ??
 ?? ?? ??  : ??
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??02??02??
    ??    ??   : l00198894
    ????????   : ??????????

*****************************************************************************/
VOS_VOID AT_PrintWifibPowerInfo(
    AT_WIFI_INFO_STRU                  *pstWifiInfo,
    VOS_UINT8                           ucWifiMode,
    VOS_UINT8                           ucIndex
)
{

    /* ????802.11b???????????? */
    gstAtSendData.usBufLen += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                       (VOS_CHAR *)pgucAtSndCodeAddr,
                                       (VOS_CHAR *)pgucAtSndCodeAddr + gstAtSendData.usBufLen,
                                       "%s:%s",
                                       g_stParseContext[ucIndex].pstCmdElement->pszCmdName,
                                       "b");
    if ( (AT_WIFI_MODE_ONLY_PA == ucWifiMode)
      || (AT_WIFI_MODE_PA_NOPA == ucWifiMode) )
    {
        gstAtSendData.usBufLen += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                           (VOS_CHAR *)pgucAtSndCodeAddr,
                                           (VOS_CHAR *)pgucAtSndCodeAddr + gstAtSendData.usBufLen,
                                           ",%d",
                                           pstWifiInfo->ausbPower[0]);
    }
    if ( (AT_WIFI_MODE_ONLY_NOPA == ucWifiMode)
      || (AT_WIFI_MODE_PA_NOPA == ucWifiMode) )
    {
        gstAtSendData.usBufLen += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                           (VOS_CHAR *)pgucAtSndCodeAddr,
                                           (VOS_CHAR *)pgucAtSndCodeAddr + gstAtSendData.usBufLen,
                                           ",%d",
                                           pstWifiInfo->ausbPower[1]);
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_PrintWifigPowerInfo
 ????????  : ????WIFI 802.11g??????????????
 ????????  : AT_WIFI_INFO_STRU *pstWifiInfo
             VOS_UINT8          ucWifiMode
             VOS_UINT8          ucIndex
 ????????  : ??
 ?? ?? ??  : ??
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??02??02??
    ??    ??   : l00198894
    ????????   : ??????????

*****************************************************************************/
VOS_VOID AT_PrintWifigPowerInfo(
    AT_WIFI_INFO_STRU                  *pstWifiInfo,
    VOS_UINT8                           ucWifiMode,
    VOS_UINT8                           ucIndex
)
{

    /* ????802.11g???????????? */
    gstAtSendData.usBufLen += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                       (VOS_CHAR *)pgucAtSndCodeAddr,
                                       (VOS_CHAR *)pgucAtSndCodeAddr + gstAtSendData.usBufLen,
                                       "%s:%s",
                                       g_stParseContext[ucIndex].pstCmdElement->pszCmdName,
                                       "g");
    if ( (AT_WIFI_MODE_ONLY_PA == ucWifiMode)
      || (AT_WIFI_MODE_PA_NOPA == ucWifiMode) )
    {
        gstAtSendData.usBufLen += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                           (VOS_CHAR *)pgucAtSndCodeAddr,
                                           (VOS_CHAR *)pgucAtSndCodeAddr + gstAtSendData.usBufLen,
                                           ",%d",
                                           pstWifiInfo->ausgPower[0]);
    }
    if ( (AT_WIFI_MODE_ONLY_NOPA == ucWifiMode)
      || (AT_WIFI_MODE_PA_NOPA == ucWifiMode) )
    {
        gstAtSendData.usBufLen += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                           (VOS_CHAR *)pgucAtSndCodeAddr,
                                           (VOS_CHAR *)pgucAtSndCodeAddr + gstAtSendData.usBufLen,
                                           ",%d",
                                           pstWifiInfo->ausgPower[1]);
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_PrintWifinPowerInfo
 ????????  : ????WIFI 802.11n??????????????
 ????????  : AT_WIFI_INFO_STRU *pstWifiInfo
             VOS_UINT8          ucWifiMode
             VOS_UINT8          ucIndex
 ????????  : ??
 ?? ?? ??  : ??
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??02??02??
    ??    ??   : l00198894
    ????????   : ??????????

*****************************************************************************/
VOS_VOID AT_PrintWifinPowerInfo(
    AT_WIFI_INFO_STRU                  *pstWifiInfo,
    VOS_UINT8                           ucWifiMode,
    VOS_UINT8                           ucIndex
)
{
    /* ????802.11n???????????? */
    gstAtSendData.usBufLen += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                       (VOS_CHAR *)pgucAtSndCodeAddr,
                                       (VOS_CHAR *)pgucAtSndCodeAddr + gstAtSendData.usBufLen,
                                       "%s:%s",
                                       g_stParseContext[ucIndex].pstCmdElement->pszCmdName,
                                       "n");
    if ( (AT_WIFI_MODE_ONLY_PA == ucWifiMode)
      || (AT_WIFI_MODE_PA_NOPA == ucWifiMode) )
    {
        gstAtSendData.usBufLen += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                           (VOS_CHAR *)pgucAtSndCodeAddr,
                                           (VOS_CHAR *)pgucAtSndCodeAddr + gstAtSendData.usBufLen,
                                           ",%d",
                                           pstWifiInfo->ausnPower[0]);
    }
    if ( (AT_WIFI_MODE_ONLY_NOPA == ucWifiMode)
      || (AT_WIFI_MODE_PA_NOPA == ucWifiMode) )
    {
        gstAtSendData.usBufLen += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                           (VOS_CHAR *)pgucAtSndCodeAddr,
                                           (VOS_CHAR *)pgucAtSndCodeAddr + gstAtSendData.usBufLen,
                                           ",%d",
                                           pstWifiInfo->ausnPower[1]);
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_PrintWifiPowerInfo
 ????????  : ????WIFI 802.11b/g/n??????????????
 ????????  : AT_WIFI_INFO_STRU         *pstWifiInfo
             VOS_UINT8                  ucIndex
 ????????  : ??
 ?? ?? ??  : ??
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??02??02??
    ??    ??   : l00198894
    ????????   : ??????????

*****************************************************************************/
VOS_VOID AT_PrintWifiPowerInfo(
    AT_WIFI_INFO_STRU                  *pstWifiInfo,
    VOS_UINT8                           ucIndex
)
{
    AT_WIFI_MODE_ENUM_UINT8             ucWifiMode;

    /* ?????? */
    ucWifiMode                          = (VOS_UINT8)WIFI_GET_PA_MODE();

    /* ????????802.11b????, ???????????? */
    if (VOS_TRUE == pstWifiInfo->bitOpbSupport)
    {
        AT_PrintWifibPowerInfo(pstWifiInfo, ucWifiMode, ucIndex);
        if ( (VOS_TRUE == pstWifiInfo->bitOpgSupport)
          || (VOS_TRUE == pstWifiInfo->bitOpnSupport) )
        {
            gstAtSendData.usBufLen += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                       (VOS_CHAR *)pgucAtSndCodeAddr,
                                       (VOS_CHAR *)pgucAtSndCodeAddr + gstAtSendData.usBufLen,
                                       "%s",gaucAtCrLf);
        }

    }

    /* ????????802.11g????, ???????????? */
    if (VOS_TRUE == pstWifiInfo->bitOpgSupport)
    {
        AT_PrintWifigPowerInfo(pstWifiInfo, ucWifiMode, ucIndex);
        if (VOS_TRUE == pstWifiInfo->bitOpnSupport)
        {
            gstAtSendData.usBufLen += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                       (VOS_CHAR *)pgucAtSndCodeAddr,
                                       (VOS_CHAR *)pgucAtSndCodeAddr + gstAtSendData.usBufLen,
                                       "%s",gaucAtCrLf);
        }
    }

    /* ????????802.11n????, ???????????? */
    if (VOS_TRUE == pstWifiInfo->bitOpnSupport)
    {
        AT_PrintWifinPowerInfo(pstWifiInfo, ucWifiMode, ucIndex);
    }

    return;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetWifiInfoPara
 ????????  : ????WIFI PA??????NO PA??????????????????????????
 ????????  : VOS_UINT8 ucIndex  ????????
 ????????  : ??
 ?? ?? ??  : AT_OK --- ????
             AT_ERROR --- ????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??02??02??
    ??    ??   : l00198894
    ????????   : ??????????
  2.??    ??   : 2012??03??22??
    ??    ??   : w00199382
    ????????   : DTS2012032103713,????????????
  3.??    ??   : 2012??05??07??
    ??    ??   : f00179208
    ????????   : DTS2012050307234,??????????????????????????????ERROR
  4.??    ??   : 2012??05??28??
    ??    ??   : c64416
    ????????   : DTS2012052805004
*****************************************************************************/
VOS_UINT32 AT_SetWifiInfoPara(VOS_UINT8 ucIndex)
{
    VOS_UINT16                          usLen;
    const VOS_CHAR * cString = "1,2,3,4,5,6,7,8,9,10,11,12,13";

    usLen = 0;

    if(gucAtParaIndex > 2)
    {
        return AT_ERROR;
    }

    if(0 == gastAtParaList[0].ulParaValue)
    {
        /* 0,0 */
        if(0 == gastAtParaList[1].ulParaValue)
        {
            usLen += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                        (TAF_CHAR *)pgucAtSndCodeAddr,
                        (TAF_CHAR *)pgucAtSndCodeAddr + usLen,
                        "^WIINFO:b,%s%s^WIINFO:g,%s%s^WIINFO:n,%s",
                        cString, gaucAtCrLf, cString, gaucAtCrLf, cString);
        }
        else    /* 0,1 */
        {
            usLen += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                        (TAF_CHAR *)pgucAtSndCodeAddr,
                        (TAF_CHAR *)pgucAtSndCodeAddr + usLen,
                        "^WIINFO:n,%s",
                        cString);
        }
    }
    else
    {
        /* 1,0 */
        if(0 == gastAtParaList[1].ulParaValue)
        {
            usLen += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                        (TAF_CHAR *)pgucAtSndCodeAddr,
                        (TAF_CHAR *)pgucAtSndCodeAddr + usLen,
                        "^WIINFO:b,130%s^WIINFO:g,80%s^WIINFO:n,80",
                        gaucAtCrLf, gaucAtCrLf);
        }
        else    /* 1,1 */
        {
            usLen += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                        (TAF_CHAR *)pgucAtSndCodeAddr,
                        (TAF_CHAR *)pgucAtSndCodeAddr + usLen,
                        "^WIINFO:n,80");
        }
    }
    gstAtSendData.usBufLen = usLen;

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetWifiPaRangePara
 ????????  : ????WIFI??????????PA??????NO PA????
 ????????  : VOS_UINT8 ucIndex  ????????
 ????????  : ??
 ?? ?? ??  : AT_OK --- ????
             AT_ERROR --- ????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??02??02??
    ??    ??   : l00198894
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetWifiPaRangePara (VOS_UINT8 ucIndex)
{
    AT_WIFI_MODE_ENUM_UINT8             ucWifiMode;

    /* ?????? */
    ucWifiMode                          = (VOS_UINT8)WIFI_GET_PA_MODE();

    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    if (BSP_MODULE_UNSUPPORT == mdrv_misc_support_check(BSP_MODULE_TYPE_WIFI) )
    {
        return AT_ERROR;
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */


    /*????????????*/
    if (1 != gastAtParaList[0].usParaLen)
    {
        return  AT_CME_INCORRECT_PARAMETERS;
    }

    /*????????*/
    if ('h' == gastAtParaList[0].aucPara[0])
    {
        if (AT_WIFI_MODE_ONLY_NOPA == ucWifiMode)
        {
            return AT_ERROR;
        }

        if (VOS_OK != WIFI_SET_PA_MODE(AT_WIFI_MODE_ONLY_PA))
        {
            return AT_ERROR;
        }
    }
    else if ('l' == gastAtParaList[0].aucPara[0])
    {
        if (AT_WIFI_MODE_ONLY_PA == ucWifiMode)
        {
            return AT_ERROR;
        }

        if (VOS_OK != WIFI_SET_PA_MODE(AT_WIFI_MODE_ONLY_NOPA))
        {
            return AT_ERROR;
        }
    }
    else
    {
        return  AT_CME_INCORRECT_PARAMETERS;
    }

    return AT_OK;
}


/*****************************************************************************
 ?? ?? ??  : AT_SetTmmiPara
 ????????  : ????MMI????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??26??
    ??    ??   : ????
    ????????   : ??????????
  2.??    ??   : 2012??2??20??
    ??    ??   : l60609
    ????????   : ??????????????????????NV
  3.??    ??   : 2012??03??03??
    ??    ??   : s62952
    ????????   : BalongV300R002 Build????????  :????FEATURE_E5??
*****************************************************************************/
VOS_UINT32 AT_SetTmmiPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulResult;
    VOS_UINT8                           aucFacInfo[AT_FACTORY_INFO_LEN];

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return  AT_TOO_MANY_PARA;
    }


    /*????????????*/
    if (1 != gastAtParaList[0].usParaLen)
    {
        return  AT_CME_INCORRECT_PARAMETERS;
    }
    VOS_MemSet(aucFacInfo, 0x00, AT_FACTORY_INFO_LEN);

    /* ????en_NV_Item_Factory_Info????????24????????????4???????????????????????? */
    ulResult = NV_ReadEx(MODEM_ID_0, en_NV_Item_Factory_Info, aucFacInfo, AT_FACTORY_INFO_LEN);

    if (NV_OK != ulResult)
    {
        AT_ERR_LOG("AT_SetTmmiPara: NV Read Fail!");
        return AT_ERROR;
    }

    /* ???? ????"ST P" */
    if (1 == gastAtParaList[0].ulParaValue)
    {
        VOS_MemCpy(&aucFacInfo[AT_MMI_TEST_FLAG_OFFSET], AT_MMI_TEST_FLAG_SUCC, AT_MMI_TEST_FLAG_LEN);
    }
    /* ???? ???? */
    else
    {
        VOS_MemCpy(&aucFacInfo[AT_MMI_TEST_FLAG_OFFSET], "0000", AT_MMI_TEST_FLAG_LEN);
    }

    ulResult = NV_WriteEx(MODEM_ID_0, en_NV_Item_Factory_Info, aucFacInfo, AT_FACTORY_INFO_LEN);

    if (NV_OK != ulResult)
    {
        return AT_ERROR;
    }
    else
    {
        return AT_OK;
    }
}
/*****************************************************************************
 ?? ?? ??  : AT_SetChrgEnablePara
 ????????  : ????????????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??26??
    ??    ??   : ????
    ????????   : ??????????
  2.??    ??   : 2012??03??22??
    ??    ??   : w00199382
    ????????   : DTS2012032103713,????????????
  3.??    ??   : 2012??4??21??
    ??    ??   : w00199382
    ????????   : V7????????: ????????????
*****************************************************************************/
VOS_UINT32 AT_SetChrgEnablePara(VOS_UINT8 ucIndex)
{
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, begin */
    VOS_UINT32                          ulRet;

    ulRet                               = mdrv_misc_support_check(BSP_MODULE_TYPE_CHARGE);

    if (BSP_MODULE_UNSUPPORT == ulRet)
    {
        return AT_ERROR;
    }
    /* Modified by s62952 for BalongV300R002 Build???????? 2012-02-28, end */


    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return  AT_TOO_MANY_PARA;
    }


    /*????????????*/
    if (1 != gastAtParaList[0].usParaLen)
    {
        return  AT_CME_INCORRECT_PARAMETERS;
    }

    /* Modify by w00199382 for V7????????, 2012-04-07, Begin   */
    if((0 == gastAtParaList[0].ulParaValue)
    || (1 == gastAtParaList[0].ulParaValue))
    {

        /* ???????????????????????????? */
        mdrv_misc_set_charge_state((unsigned long)gastAtParaList[0].ulParaValue);
    }
    else
    {

        /*????????????*/
        mdrv_misc_sply_battery();
    }

    /* Modify by w00199382 for V7????????, 2012-04-07, End   */

    return AT_OK;
}
/*****************************************************************************
 ?? ?? ??  : AT_SetTestScreenPara
 ????????  : ??????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??26??
    ??    ??   : ????
    ????????   : ??????????
  2.??    ??   : 2012??03??03??
    ??    ??   : s62952
    ????????   : BalongV300R002 Build????????  :????FEATURE_E5??
*****************************************************************************/
VOS_UINT32 AT_SetTestScreenPara(VOS_UINT8 ucIndex)
{
    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCdurPara
 ????????  : ????????????
 ????????  : VOS_UINT8 ucIndex ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32 ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??26??
    ??    ??   : ????
    ????????   : ??????????

  2.??    ??   : 2011??10??17??
    ??    ??   : ??????/f62575
    ????????   : AT PROJECT
*****************************************************************************/
VOS_UINT32 AT_SetCdurPara(VOS_UINT8 ucIndex)
{
    VOS_UINT8                           ucCallId;
    VOS_UINT32                          ulRet;

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return  AT_TOO_MANY_PARA;
    }

    if ((gucAtParaIndex != 1)
     || (0 == gastAtParaList[0].usParaLen)
     || (gastAtParaList[0].ulParaValue > AT_CALL_MAX_NUM))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ucCallId = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ????????C?????????????? */
    ulRet = MN_CALL_QryCdur(gastAtClientTab[ucIndex].usClientId,
                            gastAtClientTab[ucIndex].opId,
                            ucCallId);
    if (TAF_SUCCESS != ulRet)
    {
        AT_WARN_LOG("AT_SetCdurPara: MN_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CDUR_READ;
    return AT_WAIT_ASYNC_RETURN;
}
/*****************************************************************************
 ?? ?? ??  : AT_SetWebPwdPara
 ????????  : ????WEBUI????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??5??26??
    ??    ??   : ????
    ????????   : ??????????
  2.??    ??   : 2013??5??17??
    ??    ??   : l00167671
    ????????   : NV??????????, ??NV??????????????????
  3.??    ??   : 2014??5??30??
    ??    ??   : j00174725
    ????????   : TQE
*****************************************************************************/
VOS_UINT32 AT_SetWebPwdPara(VOS_UINT8 ucIndex)
{
    VOS_CHAR                                aucWebPwdTmp[AT_WEBUI_PWD_MAX + 1];
    TAF_AT_NVIM_WEB_ADMIN_PASSWORD_STRU     stWebPwd;

    PS_MEM_SET(&stWebPwd, 0x0, sizeof(stWebPwd));

    /* ???????? */
    if (gucAtParaIndex > 2)
    {
        return  AT_TOO_MANY_PARA;
    }

    /* ???????????? */
    if (gastAtParaList[1].usParaLen > AT_WEBUI_PWD_MAX)
    {
        return  AT_CME_INCORRECT_PARAMETERS;
    }
    /* ????WEBUI PWD */
    if (AT_WEBUI_PWD_VERIFY == gastAtParaList[0].ulParaValue)
    {
        if (VOS_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_WEB_ADMIN_PASSWORD,&stWebPwd, sizeof(stWebPwd)))
        {
            AT_WARN_LOG("AT_SetWebPwdPara:READ NV ERROR");
            return AT_ERROR;
        }

        PS_MEM_CPY(aucWebPwdTmp, &stWebPwd, sizeof(stWebPwd));

        /* ?????????? */
        if (0 != VOS_StrCmp(aucWebPwdTmp,(VOS_CHAR*)gastAtParaList[1].aucPara))
        {
            return AT_ERROR;
        }
    }
    else
    {
        /* ????WEBPWD??????NV?? */
        if (VOS_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_WEB_ADMIN_PASSWORD, gastAtParaList[1].aucPara, AT_WEBUI_PWD_MAX))
        {
            AT_WARN_LOG("AT_SetWebPwdPara:WRITE NV ERROR");
            return AT_ERROR;
        }
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetSdloadPara
 ????????  : SD??????????
 ????????  : ucIndex - AT????????
 ????????  : ??
 ?? ?? ??  : AT_OK    - ????
              AT_ERROR - ????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2010??10??27??
    ??    ??   : z00161729
    ????????  : ??????????
  2.??    ??   : 2011??10??13??
    ??    ??   : f62575
    ????????   : AT PROJECT
*****************************************************************************/
VOS_UINT32  AT_SetSdloadPara(VOS_UINT8 ucIndex)
{

    return AT_SetLteSdloadPara(ucIndex);
}

/*****************************************************************************
 ?? ?? ??  : AT_SetProdNamePara
 ????????  : ????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : OK
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??07??05??
    ??    ??   : l60609
    ????????   : ??????????
  2.??    ??   : 2011??08??08??
    ??    ??   : l60609
    ????????   : DTS2011080502346 ??NV50048????????????????30
  3.??    ??   : 2013??5??17??
    ??    ??   : l00167671
    ????????   : NV??????????, ??NV??????????????????
*****************************************************************************/
VOS_UINT32 AT_SetProdNamePara(VOS_UINT8 ucIndex)
{
    TAF_AT_PRODUCT_ID_STRU              stProductId;
    VOS_UINT32                          ulProductIdLen;
    VOS_UINT32                          ulRet;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_ERROR;
    }

    PS_MEM_SET(&stProductId,0,sizeof(TAF_AT_PRODUCT_ID_STRU));

    /* ??NV50048?????????????? */
    /* ????NV??en_NV_Item_PRODUCT_ID*/
    ulRet = NV_ReadEx(MODEM_ID_0, en_NV_Item_PRODUCT_ID,
                    &stProductId,
                    sizeof(stProductId.ulNvStatus) + sizeof(stProductId.aucProductId));

    if (NV_OK != ulRet)
    {
        AT_WARN_LOG("AT_SetProdNamePara: Fail to read en_NV_Item_PRODUCT_ID");
        return AT_ERROR;
    }


    /*????????????NV??????????????AT_PRODUCT_NAME_MAX_NUM 30??????????*/
    ulProductIdLen
        = (gastAtParaList[0].usParaLen > AT_PRODUCT_NAME_MAX_NUM) ? AT_PRODUCT_NAME_MAX_NUM:gastAtParaList[0].usParaLen;

    PS_MEM_SET(stProductId.aucProductId, 0, sizeof(stProductId.aucProductId));
    PS_MEM_CPY(stProductId.aucProductId, gastAtParaList[0].aucPara, (VOS_UINT16)ulProductIdLen);

    stProductId.ulNvStatus = VOS_TRUE;

    /* ????NV */
    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_PRODUCT_ID,
                        &stProductId,
                        sizeof(stProductId.ulNvStatus) + sizeof(stProductId.aucProductId)))
    {
        AT_ERR_LOG("AT_SetProdNamePara:Write NV fail");
        return AT_ERROR;
    }
    else
    {
        return AT_OK;
    }
}

/*****************************************************************************
 ?? ?? ??  : At_SendContinuesWaveOnToHPA
 ????????  : ??WDSP??????????????????????????
 ????????  : ??
 ????????  : ??
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??04??05??
    ??    ??   : f00179208
    ????????   : ??????????

  2.??    ??   : 2016??1??8??
    ??    ??   : n00355355
    ????????   : Chicago ModemI Support WCDMA????????
*****************************************************************************/
VOS_UINT32  At_SendContinuesWaveOnToHPA(
    VOS_UINT8                           ucCtrlType,
    VOS_UINT16                          usPower,
    VOS_UINT8                           ucIndex
)
{
    AT_HPA_RF_CFG_REQ_STRU              *pstMsg;
    VOS_UINT32                          ulLength;
    VOS_UINT16                          usMask;

    /* ????AT_HPA_RF_CFG_REQ_STRU???? */
    ulLength = sizeof(AT_HPA_RF_CFG_REQ_STRU) - VOS_MSG_HEAD_LENGTH;
    pstMsg = (AT_HPA_RF_CFG_REQ_STRU *)PS_ALLOC_MSG(WUEPS_PID_AT, ulLength);

    if (VOS_NULL_PTR == pstMsg)
    {
        AT_WARN_LOG("At_SendContinuesWaveOnToHPA: alloc msg fail!");
        return AT_FAILURE;
    }

    PS_MEM_SET(pstMsg,0x00,sizeof(AT_HPA_RF_CFG_REQ_STRU));

    /* ?????????? */
    pstMsg->ulSenderCpuId   = VOS_LOCAL_CPUID;
    pstMsg->ulSenderPid     = WUEPS_PID_AT;
    pstMsg->ulReceiverCpuId = VOS_LOCAL_CPUID;
    pstMsg->ulReceiverPid   = AT_GetDestPid(ucIndex, I0_DSP_PID_WPHY);
    pstMsg->ulLength        = ulLength;

    /* ?????????? */
    pstMsg->usMsgID = ID_AT_HPA_RF_CFG_REQ;

    /* Tx Cfg */
    usMask =  W_RF_MASK_TX_TXONOFF | W_RF_MASK_TX_POWER;
    pstMsg->stRfCfgPara.sTxPower = (VOS_INT16)usPower;

    /* ???????????????? */
    pstMsg->stRfCfgPara.usMask      = usMask;
    pstMsg->stRfCfgPara.usTxAFCInit = W_AFC_INIT_VALUE;

    /* ???????????? */
    pstMsg->stRfCfgPara.usTxEnable = ucCtrlType;

    if ( VOS_OK != PS_SEND_MSG(WUEPS_PID_AT, pstMsg))
    {
        AT_WARN_LOG("At_SendContinuesWaveOnToHPA: Send msg fail!");
        return AT_FAILURE;
    }
    return AT_SUCCESS;
}


/*****************************************************************************
 ?? ?? ??  : AT_SetFwavePara
 ????????  : ??????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : OK
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??07??05??
    ??    ??   : l60609
    ????????   : ??????????
  2.??    ??   : 2011??07??18??
    ??    ??   : l60609
    ????????   : DTS2011071802166:????WIFI????
  3.??    ??   : 2012??04??06??
    ??    ??   : f00179208
    ????????   : DTS2012040602735:????????????????????
*****************************************************************************/
VOS_UINT32 AT_SetFwavePara(VOS_UINT8 ucIndex)
{
    /* WIFI*/
    VOS_CHAR                        acCmd[200] = {0};

    if ((AT_RAT_MODE_FDD_LTE == g_stAtDevCmdCtrl.ucDeviceRatMode)
        || (AT_RAT_MODE_TDD_LTE == g_stAtDevCmdCtrl.ucDeviceRatMode))
    {
        return atSetFWAVEPara(ucIndex);
    }

    if (AT_RAT_MODE_TDSCDMA == g_stAtDevCmdCtrl.ucDeviceRatMode)
    {
        return atSetFWAVEPara(ucIndex);
    }

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ?????????????????????????????????????????? */
    if (gucAtParaIndex != 2)
    {
        return AT_ERROR;
    }

    /* ??????????????????????????*/
    if (gastAtParaList[0].ulParaValue > 7)
    {
        return AT_ERROR;
    }

    /* ?????????????????????????? */
    if (AT_TMODE_FTM != g_stAtDevCmdCtrl.ucCurrentTMode)
    {
        return AT_ERROR;
    }

    /* WIFI*/
    if (AT_RAT_MODE_WIFI == g_stAtDevCmdCtrl.ucDeviceRatMode)
    {
        /*WIFI??Enable????????????*/
        if(VOS_FALSE == (VOS_UINT32)WIFI_GET_STATUS())
        {
            return AT_ERROR;
        }

        /*??WIFI????????????????????*/
        VOS_sprintf(acCmd,"athtestcmd -ieth0 --tx sine --txpwr %d", gastAtParaList[1].ulParaValue/100);

        WIFI_TEST_CMD(acCmd);

        return AT_OK;
    }


    /* ????????????????????
       AT^FDAC??????FDAC????AT^FWAVE??????power??????????????????????????????
       ????????0.01????????????DSP????????10??????AT????????????????10*/
    g_stAtDevCmdCtrl.usPower    = (VOS_UINT16)(gastAtParaList[1].ulParaValue/10);
    g_stAtDevCmdCtrl.bPowerFlag = VOS_TRUE;
    g_stAtDevCmdCtrl.bFdacFlag  = VOS_FALSE;
    /* ??????type??????????????G????????????TxMode????????????????ID_AT_GHPA_RF_TX_CFG_REQ?????? */
    if (0 == gastAtParaList[0].ulParaValue)
    {
        g_stAtDevCmdCtrl.usTxMode = 8;
    }
    else
    {
        g_stAtDevCmdCtrl.usTxMode = (VOS_UINT16)gastAtParaList[0].ulParaValue;
    }


    /* WCDMA */
    if (AT_RAT_MODE_WCDMA == g_stAtDevCmdCtrl.ucDeviceRatMode)
    {
        /* ??WDSP?????????????????????????? */
        if (AT_FAILURE == At_SendContinuesWaveOnToHPA(WDSP_CTRL_TX_ONE_TONE, g_stAtDevCmdCtrl.usPower, ucIndex))
        {
            return AT_ERROR;
        }

        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SET_FWAVE;
        g_stAtDevCmdCtrl.ucIndex = ucIndex;

        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }


    return AT_OK;

}

/* Added by l60609 for XML, 2011-08-11 Begin */
/*****************************************************************************
 ?? ?? ??  : AT_SetApRptSrvUrlPara
 ????????  : ????XML Reporting??????URL
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : OK
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??08??11??
    ??    ??   : l60609
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetApRptSrvUrlPara(VOS_UINT8 ucIndex)
{
    VOS_UINT8                           aucApRptSrvUrl[AT_AP_XML_RPT_SRV_URL_LEN + 1];
    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (1 != gucAtParaIndex )
    {
        return AT_ERROR;
    }

    /* URL????????????????127*/
    if ((0 == gastAtParaList[0].usParaLen) || (gastAtParaList[0].usParaLen > AT_AP_XML_RPT_SRV_URL_LEN))
    {
        return AT_ERROR;
    }

    PS_MEM_SET(aucApRptSrvUrl, 0, (VOS_SIZE_T)(AT_AP_XML_RPT_SRV_URL_LEN + 1));
    PS_MEM_CPY(aucApRptSrvUrl, gastAtParaList[0].aucPara, gastAtParaList[0].usParaLen);

    /* ??NV:en_NV_Item_AP_RPT_SRV_URL*/
    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_AP_RPT_SRV_URL,
                        aucApRptSrvUrl,
                        AT_AP_XML_RPT_SRV_URL_LEN + 1))
    {
        AT_ERR_LOG("AT_SetApRptSrvUrlPara:Write NV fail");
        return AT_ERROR;
    }
    else
    {
        gstAtSendData.usBufLen = (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                                    (TAF_CHAR *)pgucAtSndCodeAddr,
                                                    (TAF_CHAR *)pgucAtSndCodeAddr,
                                                    "^APRPTSRVURLNTY");

        return AT_OK;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_SetApXmlInfoTypePara
 ????????  : ????XML Reporting????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : OK
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??08??11??
    ??    ??   : l60609
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetApXmlInfoTypePara(VOS_UINT8 ucIndex)
{
    VOS_UINT8                           aucApXmlInfoType[AT_AP_XML_RPT_INFO_TYPE_LEN + 1];

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (1 != gucAtParaIndex )
    {
        return AT_ERROR;
    }

    /* INFO TYPE????????????????127*/
    if ((0 == gastAtParaList[0].usParaLen) || (gastAtParaList[0].usParaLen > AT_AP_XML_RPT_INFO_TYPE_LEN))
    {
        return AT_ERROR;
    }

    PS_MEM_SET(aucApXmlInfoType, 0, (VOS_SIZE_T)(AT_AP_XML_RPT_INFO_TYPE_LEN + 1));
    PS_MEM_CPY(aucApXmlInfoType, gastAtParaList[0].aucPara, gastAtParaList[0].usParaLen);

    /* ??NV:en_NV_Item_AP_XML_INFO_TYPE*/
    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_AP_XML_INFO_TYPE,
                        aucApXmlInfoType,
                        AT_AP_XML_RPT_INFO_TYPE_LEN + 1))
    {
        AT_ERR_LOG("AT_SetApXmlInfoTypePara:Write NV fail");
        return AT_ERROR;
    }
    else
    {
        gstAtSendData.usBufLen = (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                                    (TAF_CHAR *)pgucAtSndCodeAddr,
                                                    (TAF_CHAR *)pgucAtSndCodeAddr,
                                                    "^APXMLINFOTYPENTY");

        return AT_OK;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_SetApXmlRptFlagPara
 ????????  : ????XML Reporting????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : OK
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??08??11??
    ??    ??   : l60609
    ????????   : ??????????
  2.??    ??   : 2013??5??17??
    ??    ??   : l00167671
    ????????   : NV??????????, ??NV??????????????????
*****************************************************************************/
VOS_UINT32 AT_SetApXmlRptFlagPara(VOS_UINT8 ucIndex)
{
    TAF_AT_NVIM_AP_XML_RPT_FLG_STRU     stApXmlRptFlg;
    VOS_UINT32                          ulNvLength;

    ulNvLength = 0;
    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (1 != gucAtParaIndex )
    {
        return AT_ERROR;
    }

    stApXmlRptFlg.ucApXmlRptFlg = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ??NV:en_NV_Item_AP_XML_RPT_FLAG*/
    (VOS_VOID)NV_GetLength(en_NV_Item_AP_XML_RPT_FLAG, &ulNvLength);
    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_AP_XML_RPT_FLAG,
                        &stApXmlRptFlg,
                        ulNvLength))
    {
       AT_ERR_LOG("AT_SetApXmlRptFlagPara:Write NV fail");
        return AT_ERROR;
    }
    else
    {
        return AT_OK;
    }
}

/* Added by l60609 for XML, 2011-08-11 End */

/* Added by h44270 for V7R1 phase III, 2011-10-18, begin */
/*****************************************************************************
 ?? ?? ??  : At_SetFastDormPara
 ????????  : ????FAST DORMANCY??????????????????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??10??19??
    ??    ??   : h44270
    ????????   : ??????????

  2.??    ??   : 2012??12??18??
    ??    ??   : l00198894
    ????????   : DTS2012122009380: L??????FAST DORM

*****************************************************************************/
VOS_UINT32 AT_SetFastDormPara(VOS_UINT8 ucIndex)
{
    AT_RABM_FASTDORM_PARA_STRU          stFastDormPara;
    VOS_UINT32                          ulRslt;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (gucAtParaIndex > 2)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????????????????????? */
    if (0 == gastAtParaList[1].usParaLen)
    {
        /* ??????????5S */
        gastAtParaList[1].ulParaValue = AT_FASTDORM_DEFAULT_TIME_LEN;
    }

    stFastDormPara.enFastDormOperationType = gastAtParaList[0].ulParaValue;
    stFastDormPara.ulTimeLen = gastAtParaList[1].ulParaValue;

    AT_SetLFastDormPara(ucIndex);

    /* ??AT??????????????????????????????????????????????????????????RABM */
    ulRslt = AT_SndSetFastDorm(gastAtClientTab[ucIndex].usClientId,
                               gastAtClientTab[ucIndex].opId,
                               &stFastDormPara);
    if (VOS_OK == ulRslt)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_FASTDORM_SET;
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;
}
/* Added by h44270 for V7R1 phase III, 2011-10-18, end */

/* Added by l00171473 for ????????, 2011-11-29 Begin */
/*****************************************************************************
 ?? ?? ??  : AT_SetMemInfoPara
 ????????  : ??????????????????????
             ????????          ??????
             ^MemQuery=<n>     <CR><LF>^ MemQuery: <result> <CR><LF>
                               <CR><LF>OK<CR><LF>
             <n>????:
             0??????VOS??????????????????????????, ??????C CPU??????????????A CPU??????
                ????????????????:????????m,{<PID1,????????1>??...<PIDm,????????m>}??
             1??????TTF??????????????????????????
                ????????????????:TTF??????????????
             ????:????????????error??

 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : AT_ERROR??AT_OK
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2011??11??29??
    ??    ??   : l00171473
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetMemInfoPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRet;

    /* ???????? */
    if( (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
     || (gucAtParaIndex > 1) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????C?????? MEMINFO ????, gastAtParaList[0].ulParaValue ?????????????? */
    ulRet = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   gastAtClientTab[ucIndex].opId,
                                   DRV_AGENT_MEMINFO_QRY_REQ,
                                   &(gastAtParaList[0].ulParaValue),
                                   sizeof(gastAtParaList[0].ulParaValue),
                                   I0_WUEPS_PID_DRV_AGENT);
    if (TAF_SUCCESS != ulRet)
    {
        AT_WARN_LOG("AT_QryMemInfoPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_MEMINFO_READ;
    return AT_WAIT_ASYNC_RETURN;

}
/* Added by l00171473 for ????????, 2011-11-29 End */

/* Added by w00167002 for ????L????RPLMN??????, 2011-12-30, begin */

/*****************************************************************************
 ?? ?? ??  : AT_SetDnsQueryPara
 ????????  : (AT^DNSQUERY)??????????PDP??????????????????????DNS????DNS????
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??02??18??
    ??    ??   : l00198894
    ????????   : ??????????

  2.??    ??   : 2013??07??08??
    ??    ??   : Y00213812
    ????????   : VoLTE_PhaseI ??????????????APS??????????????????????
*****************************************************************************/
VOS_UINT32 AT_SetDnsQueryPara(VOS_UINT8 ucIndex)
{

    /* ???????? */
    if ( AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( gucAtParaIndex > 1 )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( 0 == gastAtParaList[0].usParaLen )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* Modified by Y00213812 for VoLTE_PhaseI ????, 2013-07-08, begin */
    /* ??APS???????????????????????? */
    if ( VOS_OK != TAF_PS_GetDynamicDnsInfo(WUEPS_PID_AT,
                                            AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                            gastAtClientTab[ucIndex].opId,
                                            (VOS_UINT8)gastAtParaList[0].ulParaValue))
    {
        return AT_ERROR;
    }
    /* Modified by Y00213812 for VoLTE_PhaseI ????, 2013-07-08, end */

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_DNSQUERY_SET;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;

}

/*****************************************************************************
 ?? ?? ??  : AT_SetMemStatusPara
 ????????  : (AT^CSASM)????MODEM????????????????????
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??02??18??
    ??    ??   : l00198894
    ????????   : ??????????
  2.??    ??   : 2012??8??13??
    ??    ??   : l60609
    ????????   : MUX:????MUX??????????
  3.??    ??   : 2011??11??08??
    ??    ??   : ??????/f62575
    ????????   : DTS2012111201995??DCM????????????????
*****************************************************************************/
VOS_UINT32 AT_SetMemStatusPara(VOS_UINT8 ucIndex)
{
    MN_MSG_SET_MEMSTATUS_PARM_STRU      stMemStatus;

    /* ?????? */
    PS_MEM_SET(&stMemStatus, 0x00, sizeof(MN_MSG_SET_MEMSTATUS_PARM_STRU));

    /* ???????? */
    if ( AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( gucAtParaIndex > 1 )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( 0 == gastAtParaList[0].usParaLen )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (0 == gastAtParaList[0].ulParaValue)
    {
        stMemStatus.enMemFlag = MN_MSG_MEM_FULL_SET;
    }
    else
    {
        stMemStatus.enMemFlag = MN_MSG_MEM_FULL_UNSET;
    }

    /* ????MN????API??????????????MSG???? */
    if ( MN_ERR_NO_ERROR != MN_MSG_SetMemStatus(gastAtClientTab[ucIndex].usClientId,
                                                gastAtClientTab[ucIndex].opId,
                                                &stMemStatus))
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt  = AT_CMD_CSASM_SET;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCdmaMemStatusPara
 ????????  : (AT^CCSASM)????MODEM????????????????????
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??06??02??
    ??    ??   : C00299064
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetCdmaMemStatusPara(VOS_UINT8 ucIndex)
{
    TAF_XSMS_AP_MEM_FULL_ENUM_UINT8     enAPMemFullFlag = 0;

    /* ???????? */
    if ( AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( gucAtParaIndex > 1 )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( 0 == gastAtParaList[0].usParaLen )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (0 == gastAtParaList[0].ulParaValue)
    {
        enAPMemFullFlag = TAF_XSMS_AP_MEM_FULL;
    }
    else
    {
        enAPMemFullFlag = TAF_XSMS_AP_MEM_NOT_FULL;
    }

    /* ????MN????API??????????????MSG???? */
    if (AT_SUCCESS != TAF_XSMS_SetXsmsApMemFullReq(gastAtClientTab[ucIndex].usClientId,
                                                   gastAtClientTab[ucIndex].opId,
                                                   enAPMemFullFlag))
    {
        return AT_ERROR;
    }

    /* ????AT_OK */
    return AT_OK;
}


/*****************************************************************************
 ?? ?? ??  : AT_SetApRptPortSelectPara
 ????????  : (AT^APRPTPORTSEL)??????????????AT????
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??02??18??
    ??    ??   : l00198894
    ????????   : ??????????
  2.??    ??   : 2012??8??13??
    ??    ??   : l60609
    ????????   : MUX:????MUX??????????
  3.??    ??   : 2014??04??26??
    ??    ??   : f00179208
    ????????   : DTS2014042304605
*****************************************************************************/
VOS_UINT32 AT_SetApRptPortSelectPara(VOS_UINT8 ucIndex)
{
    AT_PORT_RPT_CFG_UNION               unRptCfg;
    AT_CLIENT_CONFIGURATION_STRU       *pstClientCfg;
    AT_CLIENT_CFG_MAP_TAB_STRU         *pstCfgMapTbl;
    VOS_UINT8                           i;

    unRptCfg.ulRptCfgBit64  = 0;

    /* ???????? */
    /* Modified by L60609 for MUX??2012-08-13,  Begin */
    if (VOS_FALSE == AT_IsApPort(ucIndex))
    /* Modified by L60609 for MUX??2012-08-13,  End */
    {
        return AT_ERROR;
    }

    /* ???????? */
    if ( AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( gucAtParaIndex > 2 )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( 0 == gastAtParaList[0].usParaLen )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ( 0 == gastAtParaList[1].usParaLen )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????????????? */
    /* AT??????????????32??????????????32bit???????????????????????????????????? */
    AT_String2Hex(gastAtParaList[0].aucPara, gastAtParaList[0].usParaLen, &unRptCfg.aulRptCfgBit32[0]);
    AT_String2Hex(gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen, &unRptCfg.aulRptCfgBit32[1]);

    for (i = 0; i < AT_GET_CLIENT_CFG_TAB_LEN(); i++)
    {
        pstCfgMapTbl = AT_GetClientCfgMapTbl(i);
        pstClientCfg = AT_GetClientConfig(pstCfgMapTbl->enClientId);

        pstClientCfg->ucReportFlg = (unRptCfg.ulRptCfgBit64 & pstCfgMapTbl->ulRptCfgBit64) ?
                                    VOS_TRUE : VOS_FALSE;
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetGpioPara
 ????????  : ^GPIO????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012-02-23
    ??    ??   : H59254
    ????????   : AP-MODEM IPC????????
  2.??    ??   : 2012-05-10
    ??    ??   : y00213812
    ????????   : DTS2012050700665??????????????????GPIO????????????????????
*****************************************************************************/
VOS_UINT32 At_SetGpioPara (VOS_UINT8 ucIndex)
{
    VOS_UINT8                           ucGroup;
    VOS_UINT8                           ucPin;
    VOS_UINT8                           ucValue;

    /* ??????????HSIC????????????GPIO???? */
    if (BSP_MODULE_SUPPORT != mdrv_misc_support_check(BSP_MODULE_TYPE_HSIC))
    {
        return AT_ERROR;
    }

    /* para too many */
    if (gucAtParaIndex > 3)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ucGroup = (VOS_UINT8)(gastAtParaList[0].ulParaValue / 100);
    ucPin   = (VOS_UINT8)(gastAtParaList[0].ulParaValue % 100);

    if (VOS_OK != DRV_GPIO_SET(ucGroup, ucPin, (VOS_UINT8)gastAtParaList[1].ulParaValue))
    {
        return AT_ERROR;
    }

    VOS_TaskDelay(gastAtParaList[2].ulParaValue);

    /* ????GPIO???????????????????????? */
    ucValue = (gastAtParaList[1].ulParaValue == DRV_GPIO_HIGH)?DRV_GPIO_LOW:DRV_GPIO_HIGH;


    if (VOS_OK != DRV_GPIO_SET(ucGroup, ucPin, ucValue))
    {
        return AT_ERROR;
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetUsbSwitchPara
 ????????  : USBSWITCH????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012-02-23
    ??    ??   : H59254
    ????????   : AP-MODEM IPC????????
  2.??    ??   : 2012??8??13??
    ??    ??   : l60609
    ????????   : MUX:????MUX??????????
  3.??    ??   : 2012??12??13??
    ??    ??   : L00171473
    ????????   : DTS2012121802573, TQE????
*****************************************************************************/
VOS_UINT32 At_SetUsbSwitchPara (VOS_UINT8 ucIndex)
{
    VOS_INT                          iResult;
    VOS_UINT8                        ucUsbStatus;

    /* ???????? */
    /* Modified by L60609 for MUX??2012-08-13,  Begin */
    if (VOS_FALSE == AT_IsApPort(ucIndex))
    /* Modified by L60609 for MUX??2012-08-13,  End */
    {
        return AT_ERROR;
    }

    /* para too many */
    if (gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }


    ucUsbStatus = USB_SWITCH_OFF;

    if (VOS_OK != DRV_USB_PHY_SWITCH_GET(&ucUsbStatus))
    {
        return AT_ERROR;
    }

    /* ????Modem??USB???? */
    if(AT_USB_SWITCH_SET_VBUS_VALID == gastAtParaList[0].ulParaValue)
    {
        if (USB_SWITCH_ON != ucUsbStatus)
        {
            iResult = DRV_USB_PHY_SWITCH_SET(USB_SWITCH_ON);
        }
        else
        {
            return AT_OK;
        }
    }
    else if(AT_USB_SWITCH_SET_VBUS_INVALID == gastAtParaList[0].ulParaValue)
    {
        if (USB_SWITCH_OFF != ucUsbStatus)
        {
            iResult = DRV_USB_PHY_SWITCH_SET(USB_SWITCH_OFF);
        }
        else
        {
            return AT_OK;
        }
    }
    else
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (iResult == VOS_OK)
    {
        return At_PortSwitchSndMsg(ucUsbStatus);
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : At_PortSwitchSndMsg
 ????????  : USBSWITCH????????OM????????????
 ????????  : TAF_UINT32 ulSwitchMode
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012-03-05
    ??    ??   : H59254
    ????????   : ????????????????
*****************************************************************************/
TAF_UINT32 At_PortSwitchSndMsg (TAF_UINT32 ulSwitchMode)
{
    OM_PORT_SWITCH_MSG_STRU             *pMsg;

    pMsg = (OM_PORT_SWITCH_MSG_STRU *)VOS_AllocMsg(WUEPS_PID_AT,
                                                   sizeof(OM_PORT_SWITCH_MSG_STRU) - VOS_MSG_HEAD_LENGTH);

    if (VOS_NULL_PTR == pMsg)
    {
        return AT_ERROR;
    }

    pMsg->ulReceiverPid = MSP_PID_DIAG_APP_AGENT;
    pMsg->ulMsgName     = (OM_AT_MSG_ENUM_UINT32)AT_OM_PORT_SWITCH;
    pMsg->ulSwitchMode  = (OM_PORT_SWITCH_MODE_ENUM_UINT32)ulSwitchMode;

    if(VOS_OK !=  VOS_SendMsg(WUEPS_PID_AT, pMsg))
    {
        return AT_ERROR;
    }

    return AT_OK;
}


/*****************************************************************************
 ?? ?? ??  : AT_SetSARReduction
 ????????  : ????????????????
 ????????  : VOS_UINT8 ucIndex ????????
 ????????  :
 ?? ?? ??  :   AT_ERROR
                    AT_CME_INCORRECT_PARAMETERS
                    AT_OK
 ????????      :
  1.??    ??   : 2012??2??21??
    ??    ??   : w00184875
    ????????   : ??????????
  2.??    ??   : 2012??12??13??
    ??    ??   : L00171473
    ????????   : DTS2012121802573, TQE????
  3.??    ??   : 2013??5??30??
    ??    ??   : z60575
    ????????   : DTS2013060307614??DSDA_SAR????
  3.??    ??   : 2013??8??2??
    ??    ??   : z60575
    ????????   : DTS2013073103769????C??????????????
  4.??    ??   : 2013??10??08??
    ??    ??   : j00174725
    ????????   : TQE
*****************************************************************************/
VOS_UINT32 AT_SetSARReduction(VOS_UINT8 ucIndex)
{
    VOS_UINT32                              ulResult;
    VOS_UINT16                              usUETestMode;

    VOS_UINT16                              usSarReduction;
    AT_MODEM_MT_INFO_CTX_STRU              *pstMtInfoCtx = VOS_NULL_PTR;
    MODEM_ID_ENUM_UINT16                    enModemId;
    VOS_UINT16                              usAntState;

    usUETestMode = 0;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        AT_ERR_LOG("AT_SetSARReduction: Cmd Opt Type is wrong.");
        return AT_ERROR;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????NV????????????????????????NV?????????? */
    ulResult = NV_ReadEx(MODEM_ID_0,
                         en_NV_Item_RF_SAR_BACKOFF_TESTMODE,
                         &usUETestMode,
                         sizeof(usUETestMode));

    if (NV_OK != ulResult)
    {
        AT_ERR_LOG("AT_SetSARReduction:Read NV fail");
        return AT_ERROR;
    }


    enModemId  = MODEM_ID_0;

    ulResult   = AT_GetModemIdFromClient(ucIndex, &enModemId);

    if (VOS_OK != ulResult)
    {
        AT_ERR_LOG("AT_SetSARReduction:Get modem id fail");

        return AT_ERROR;
    }

    pstMtInfoCtx = AT_GetModemMtInfoCtxAddrFromModemId(enModemId);

    ulResult = TAF_AGENT_GetAntState(ucIndex, &usAntState);
    if (VOS_OK != ulResult)
    {
        AT_ERR_LOG("AT_QrySARReduction:Get modem id fail");
        return AT_ERROR;
    }

    if ((AT_ANT_CONDUCTION_MODE == usAntState) && (VOS_TRUE != usUETestMode))
    {
        AT_ERR_LOG("AT_SetSARReduction: Test mode wrong");
        return AT_ERROR;
    }

    usSarReduction = (VOS_UINT16)gastAtParaList[0].ulParaValue;
    pstMtInfoCtx->usSarReduction = usSarReduction;

    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      0,
                                      DRV_AGENT_SARREDUCTION_SET_REQ,
                                      &usSarReduction,
                                      sizeof(usSarReduction),
                                      I0_WUEPS_PID_DRV_AGENT);

    if (TAF_SUCCESS != ulResult)
    {
        AT_ERR_LOG("AT_SetSARReduction: Send Msg Fail");

        return AT_ERROR;
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetScidPara
 ????????  : SCID??????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : TAF_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??4??24??
    ??    ??   : L60609
    ????????   : ??????????

*****************************************************************************/
TAF_UINT32 At_SetScidPara(TAF_UINT8 ucIndex)
{
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????????? */
    if(AT_SUCCESS == Taf_ParaQuery(gastAtClientTab[ucIndex].usClientId,0,TAF_PH_ICC_ID,TAF_NULL_PTR))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_ICCID_READ;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}



/*****************************************************************************
 ?? ?? ??  : ToBase64Char
 ????????  : BASE64????????
 ????????  : const VOS_UCHAR code6bit  ??????????
 ????????  : ??
 ?? ?? ??  : VOS_UCHAR
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??3??29??
    ??    ??   : c64416
    ????????   : ??????????

*****************************************************************************/
VOS_UCHAR ToBase64Char(const VOS_UCHAR code6bit)
{
    VOS_UCHAR                           ucValue;

    /* [ 0..25] => ['A'..'Z'] */
    if (code6bit<26)
    {
        ucValue = (VOS_UCHAR)(code6bit+'A');
        return ucValue;
    }

    /* [26..51] => ['a'..'z'] */
    else if (code6bit<52)
    {
        ucValue = (VOS_UCHAR)(code6bit+('a'-26));
        return ucValue;
    }

    /* [52..61] => ['0'..'9'] */
    else if (code6bit<62)
    {
        ucValue = (VOS_UCHAR)(code6bit-52+'0');
        return ucValue;
    }

    /* 62 => '+' */
    else if (code6bit==62)
    {
        ucValue = '+';
        return ucValue;
    }

    /* 63 => */
    else
    {
        ucValue = '/';
        return ucValue;
    }
}


/*****************************************************************************
 ?? ?? ??  : AtBase64Encode
 ????????  : BASE64????????
 ????????  : const VOS_VOID* pdata       ??????????
             const VOS_UINT32 data_size  ??????????????
             VOS_VOID* out_pcode         ????????????
 ????????  : ??
 ?? ?? ??  : VOS_VOID
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??3??29??
    ??    ??   : c64416
    ????????   : ??????????

*****************************************************************************/
VOS_VOID AtBase64Encode(const VOS_VOID* pdata,const VOS_UINT32 data_size,VOS_VOID* out_pcode)
{
    const VOS_UCHAR* input      =(const unsigned char*)pdata;
    const VOS_UCHAR* input_end  =&input[data_size];
    VOS_UCHAR*       output     =(unsigned char*)out_pcode;
    VOS_UINT32       bord_width = 0;

    for(; input+2 < input_end; input += 3, output += 4 )
    {
        output[0] = ToBase64Char(   input[0] >> 2 );
        output[1] = ToBase64Char( ((input[0] << 4) | (input[1] >> 4)) & 0x3F );
        output[2] = ToBase64Char( ((input[1] << 2) | (input[2] >> 6)) & 0x3F );
        output[3] = ToBase64Char(   input[2] & 0x3F);
    }

    if(input_end > input)
    {
        bord_width = (VOS_UINT32)(input_end-input);
        if ( bord_width == 1 )
        {
            output[0] = ToBase64Char(   input[0] >> 2 );
            output[1] = ToBase64Char(  (input[0] << 4) & 0x3F );
            output[2] = AT_BASE64_PADDING;
            output[3] = AT_BASE64_PADDING;
        }
        else if (bord_width==2)
        {
            output[0] = ToBase64Char(   input[0] >> 2 );
            output[1] = ToBase64Char( ((input[0] << 4) | (input[1] >> 4)) & 0x3F );
            output[2] = ToBase64Char(  (input[1] << 2) & 0x3F );
            output[3] = AT_BASE64_PADDING;
        }
        else
        {
        }
    }
}


/*****************************************************************************
 ?? ?? ??  : AtBase64Decode
 ????????  : Base64????????
 ????????  : const void* pcode                     ??????????
             const unsigned long code_size         ??????????????
             void* out_pdata                       ????????????
             const unsigned long data_size         ????????????????????
             unsigned long* out_pwrited_data_size  ????????????????
 ????????  : ??
 ?? ?? ??  : unsigned long
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??4??3??
    ??    ??   : c64416
    ????????   : ??????????

*****************************************************************************/
unsigned int AtBase64Decode(const void* pcode,const unsigned int code_size,void* out_pdata,
                            const unsigned int data_size,unsigned int* out_pwrited_data_size)
{
    const unsigned char DECODE_DATA_MAX = 64-1;
    const unsigned char DECODE_PADDING  = DECODE_DATA_MAX+2;
    const unsigned char DECODE_ERROR    = DECODE_DATA_MAX+3;
    static unsigned char BASE64_DECODE[256];
    static VOS_BOOL initialized=VOS_FALSE;
    unsigned int code0;
    unsigned int code1;
    unsigned int code2;
    unsigned int code3;
    unsigned int bord_width;
    const unsigned char* input_last_fast_node;
    unsigned int output_size;
    unsigned char* output;
    const unsigned char* input;
    unsigned int code_node;
    unsigned int i;

    if(!initialized)
    {
        for(i=0;i<256;++i)
        {
            BASE64_DECODE[i]=DECODE_ERROR;
        }
        for(i='A';i<='Z';++i)
        {
            BASE64_DECODE[i]=(unsigned char)(i-'A');
        }
        for(i='a';i<='z';++i)
        {
            BASE64_DECODE[i]=(unsigned char)(i-'a'+26);
        }
        for(i='0';i<='9';++i)
        {
            BASE64_DECODE[i]=(unsigned char)(i-'0'+26*2);
        }
        BASE64_DECODE['+']=26*2+10;
        BASE64_DECODE['/']=26*2+10+1;
        BASE64_DECODE['=']=DECODE_PADDING;
        initialized=VOS_TRUE;
    }
    *out_pwrited_data_size=0;
    code_node=code_size/4;
    if ((code_node*4)!=code_size)
    {
        return b64Result_CODE_SIZE_ERROR;
    }
    else if (code_node==0)
    {
        return b64Result_OK;
    }
    else
    {
    }

    /* code_node>0 */
    input=(const unsigned char*)pcode;
    output=(unsigned char*)out_pdata;
    output_size=code_node*3;

    if (input[code_size-2]==AT_BASE64_PADDING)
    {
        if (input[code_size-1]!=AT_BASE64_PADDING)
        {
            return b64Result_CODE_ERROR;
        }

        output_size-=2;
    }
    else if (input[code_size-1]==AT_BASE64_PADDING)
    {
        --output_size;
    }
    else
    {
    }

    if (output_size>data_size)
    {
        return b64Result_DATA_SIZE_SMALLNESS;
    }
    input_last_fast_node=&input[output_size/3UL * 4UL];

    for(;input<input_last_fast_node;input+=4,output+=3)
    {
        code0=BASE64_DECODE[input[0]];
        code1=BASE64_DECODE[input[1]];
        code2=BASE64_DECODE[input[2]];
        code3=BASE64_DECODE[input[3]];
        if ( ((code0|code1)|(code2|code3)) <= DECODE_DATA_MAX )
        {
            output[0]=(unsigned char)((code0<<2) + (code1>>4));
            output[1]=(unsigned char)((code1<<4) + (code2>>2));
            output[2]=(unsigned char)((code2<<6) + code3);
        }
        else
        {
            return b64Result_CODE_ERROR;
        }
    }
    bord_width=output_size%3;
    if (bord_width==1)
    {
        code0=BASE64_DECODE[input[0]];
        code1=BASE64_DECODE[input[1]];
        if ((code0|code1) <= DECODE_DATA_MAX)
        {
            output[0]=(unsigned char)((code0<<2) + (code1>>4));
        }
        else
        {
            return b64Result_CODE_ERROR;
        }
    }
    else if (bord_width==2)
    {
        code0=BASE64_DECODE[input[0]];
        code1=BASE64_DECODE[input[1]];
        code2=BASE64_DECODE[input[2]];
        if ((code0|code1|code2) <= DECODE_DATA_MAX)
        {
            output[0]=(unsigned char)((code0<<2) + (code1>>4));
            output[1]=(unsigned char)((code1<<4) + (code2>>2));
        }
        else
        {
            return b64Result_CODE_ERROR;
        }
    }
    else
    {
    }
    *out_pwrited_data_size=output_size;
    return b64Result_OK;
}





/*****************************************************************************
 ?? ?? ??  : AT_RsfrSimLockProc
 ????????  : ????SIMLOCK??????????^SIMLOCK?????????????????????:
                1??????????????????/r/n
                2??????????????"^SIMLOCK:",????????????"n,2,46000,46000"
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_VOID
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??3??31??
    ??    ??   : c64416
    ????????   : ??????????
  2.??    ??   : 2012??12??13??
    ??    ??   : L00171473
    ????????   : DTS2012121802573, TQE????
*****************************************************************************/
VOS_UINT32 AT_RsfrSimLockProc(VOS_UINT8* pgcSrcData, VOS_UINT16* pusLen)
{
    TAF_CUSTOM_SIM_LOCK_PLMN_INFO_STRU  stSimLockPlmnInfo;
    VOS_UINT32                          i;
    VOS_UINT16                          usLength;
    VOS_UINT8                           ucMncLen;
    VOS_UINT32                          ulPlmnIdx;
    VOS_UINT32                          ulRsltChkPlmnBegin;
    VOS_UINT32                          ulRsltChkPlmnEnd;
    VOS_UINT32                          ulTotalPlmnNum;
    VOS_BOOL                            abPlmnValidFlg[TAF_MAX_SIM_LOCK_RANGE_NUM] = {VOS_FALSE};
    VOS_UINT8                           aucAsciiNumBegin[(TAF_PH_SIMLOCK_PLMN_STR_LEN * 2) + 1];
    VOS_UINT8                           aucAsciiNumEnd[(TAF_PH_SIMLOCK_PLMN_STR_LEN * 2) + 1];


    PS_MEM_SET(&stSimLockPlmnInfo, 0x00, sizeof(stSimLockPlmnInfo));

    if (NV_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_CustomizeSimLockPlmnInfo,
                       &stSimLockPlmnInfo,
                       sizeof(stSimLockPlmnInfo)))
    {
        return AT_ERROR;
    }

    ulTotalPlmnNum = 0;

    if (NV_ITEM_DEACTIVE == stSimLockPlmnInfo.ulStatus)
    {
        /* ??????????????????Plmn??????0 */
        usLength = (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN, (VOS_CHAR *)pgcSrcData,
                                           (VOS_CHAR *)pgcSrcData, "%s%s:%d%s",
                                           gaucAtCrLf,"^SIMLOCK",ulTotalPlmnNum,gaucAtCrLf);

        *pusLen = usLength;
        return AT_OK;
    }

    /*  ????Plmn???????????? */
    for ( i = 0; i < TAF_MAX_SIM_LOCK_RANGE_NUM; i++ )
    {
        ucMncLen = stSimLockPlmnInfo.astSimLockPlmnRange[i].ucMncNum;

        ulRsltChkPlmnBegin = At_SimlockPlmnNumToAscii(stSimLockPlmnInfo.astSimLockPlmnRange[i].aucRangeBegin,
                                    TAF_PH_SIMLOCK_PLMN_STR_LEN,aucAsciiNumBegin);

        ulRsltChkPlmnEnd = At_SimlockPlmnNumToAscii(stSimLockPlmnInfo.astSimLockPlmnRange[i].aucRangeBegin,
                                    TAF_PH_SIMLOCK_PLMN_STR_LEN,aucAsciiNumEnd);

        if ((AT_SUCCESS == ulRsltChkPlmnBegin)
         && (AT_SUCCESS == ulRsltChkPlmnEnd)
         && ((ucMncLen <= 3) && (ucMncLen >= 2)))
        {
            abPlmnValidFlg[i] = VOS_TRUE;
            ++ ulTotalPlmnNum;
        }
    }

    usLength = (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN, (VOS_CHAR *)pgcSrcData,
                                       (VOS_CHAR *)pgcSrcData, "%s%s:%d%s",
                                       gaucAtCrLf,"^SIMLOCK",ulTotalPlmnNum,gaucAtCrLf);

    if (0 == ulTotalPlmnNum)
    {
        *pusLen = usLength;
        return AT_OK;
    }

    /* CustomInfoSetting ?????????????????? */
    usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN, (VOS_CHAR *)pgcSrcData,
                                (VOS_CHAR *)pgcSrcData + usLength,
                                "^SIMLOCK:");

    ulPlmnIdx = 0;
    for ( i = 0; i < TAF_MAX_SIM_LOCK_RANGE_NUM; i++ )
    {
        if (VOS_FALSE == abPlmnValidFlg[i])
        {
            continue;
        }

        ++ ulPlmnIdx;

        At_SimlockPlmnNumToAscii(stSimLockPlmnInfo.astSimLockPlmnRange[i].aucRangeBegin,
                                    TAF_PH_SIMLOCK_PLMN_STR_LEN,aucAsciiNumBegin);

        At_SimlockPlmnNumToAscii(stSimLockPlmnInfo.astSimLockPlmnRange[i].aucRangeEnd,
                                    TAF_PH_SIMLOCK_PLMN_STR_LEN,aucAsciiNumEnd);

        usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN, (VOS_CHAR *)pgcSrcData,
                                    (VOS_CHAR *)pgcSrcData + usLength,
                                    "%d,%d,%s,%s%s",
                                    ulPlmnIdx,
                                    stSimLockPlmnInfo.astSimLockPlmnRange[i].ucMncNum,
                                    aucAsciiNumBegin,
                                    aucAsciiNumEnd,
                                    gaucAtCrLf);
    }

    *pusLen = usLength;

    return AT_OK;
}



/*****************************************************************************
 ?? ?? ??  : AT_SetRsfrPara
 ????????  : ^RSFR????????(??????????????CustomInfoSetting ??????????????????)
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??3??29??
    ??    ??   : c64416
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetRsfrPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRet;
    VOS_UINT16                          usLength = 0;
    VOS_CHAR                            cName[AT_RSFR_RSFW_NAME_LEN + 1]       = {0};
    VOS_CHAR                            cSubName[AT_RSFR_RSFW_SUBNAME_LEN + 1] = {0};
    VOS_UINT8                          *pcRsfrSrcItem;
    VOS_CHAR                           *pcRsfrDstItem;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    if (gucAtParaIndex != 2)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????????? */
    if ((0 == gastAtParaList[0].usParaLen)
        || (gastAtParaList[0].usParaLen > AT_RSFR_RSFW_NAME_LEN))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_CPY(cName, gastAtParaList[0].aucPara, gastAtParaList[0].usParaLen);

    At_UpString((VOS_UINT8*)cName, gastAtParaList[0].usParaLen);

    if (gastAtParaList[1].usParaLen > AT_RSFR_RSFW_SUBNAME_LEN)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_CPY(cSubName, gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen);

    if(ERR_MSP_SUCCESS == AT_STRCMP(cName, "VERSION"))
    {
        if(TAF_SUCCESS == AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                                gastAtClientTab[ucIndex].opId,
                                                DRV_AGENT_VERSION_QRY_REQ,
                                                VOS_NULL_PTR,
                                                0,
                                                I0_WUEPS_PID_DRV_AGENT))
        {
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_RSFR_VERSION_QRY;
            return AT_WAIT_ASYNC_RETURN;
        }
        else
        {
            return AT_ERROR;
        }
    }
    else if(ERR_MSP_SUCCESS == AT_STRCMP(cName, "SIMLOCK"))
    {
        pcRsfrSrcItem = (VOS_UINT8*)PS_MEM_ALLOC(WUEPS_PID_AT, AT_RSFR_RSFW_MAX_LEN);
        if (VOS_NULL_PTR == pcRsfrSrcItem )
        {
            return AT_ERROR;
        }

        PS_MEM_SET(pcRsfrSrcItem, 0, AT_RSFR_RSFW_MAX_LEN);

        ulRet = AT_RsfrSimLockProc(pcRsfrSrcItem, &usLength);
        if(AT_OK != ulRet)
        {
            PS_MEM_FREE(WUEPS_PID_AT, pcRsfrSrcItem);
            return ulRet;
        }

        pcRsfrDstItem = (VOS_CHAR*)PS_MEM_ALLOC(WUEPS_PID_AT, AT_RSFR_RSFW_MAX_LEN);
        if (VOS_NULL_PTR == pcRsfrDstItem )
        {
            PS_MEM_FREE(WUEPS_PID_AT, pcRsfrSrcItem);
            return AT_ERROR;
        }

        PS_MEM_SET(pcRsfrDstItem, 0, AT_RSFR_RSFW_MAX_LEN);

        /* ????SIMLOCK?????????????????????????????????? */
        AtBase64Encode(pcRsfrSrcItem, usLength, pcRsfrDstItem);

        gstAtSendData.usBufLen = (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN, (VOS_CHAR *)pgucAtSndCodeAddr,
                                    (VOS_CHAR *)pgucAtSndCodeAddr,
                                    "^RSFR:\"%s\",\"%s\",123,1,1,%s",
                                    cName, cSubName, gaucAtCrLf);

        gstAtSendData.usBufLen += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN, (VOS_CHAR *)pgucAtSndCodeAddr,
                                    (VOS_CHAR *)pgucAtSndCodeAddr + gstAtSendData.usBufLen,
                                    "\"%s\"", pcRsfrDstItem);

        PS_MEM_FREE(WUEPS_PID_AT, pcRsfrSrcItem);
        PS_MEM_FREE(WUEPS_PID_AT, pcRsfrDstItem);

        return AT_OK;
    }
    else
    {
        return AT_ERROR;
    }
}


/*****************************************************************************
 ?? ?? ??  : AT_SetRsfrVersionCnf
 ????????  : ^RSFR????????VERSION????????????????
 ????????  : VOS_UINT8 ucData  pgucAtSndCodeAddr(??????????????????????)
             VOS_UINT32 ulLen  gstAtSendData.usBufLen
 ????????  : ??
 ?? ?? ??  : VOS_VOID
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??3??30??
    ??    ??   : c64416
    ????????   : ??????????

*****************************************************************************/
VOS_VOID AT_SetRsfrVersionCnf(VOS_UINT8 ucIndex, VOS_UINT8* pucData, VOS_UINT32 ulLen)
{
    VOS_UINT16 usLength;
    VOS_CHAR* pcRsfrItem = NULL;

    pcRsfrItem = (VOS_CHAR*)PS_MEM_ALLOC(WUEPS_PID_AT, AT_RSFR_RSFW_MAX_LEN);
    if (VOS_NULL_PTR == pcRsfrItem )
    {
        return ;
    }

    PS_MEM_SET(pcRsfrItem, 0, AT_RSFR_RSFW_MAX_LEN);

    /* ????SIMLOCK?????????????????????????????????? */
    AtBase64Encode(pucData, ulLen, pcRsfrItem);

    usLength = 0;
    usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN, (VOS_CHAR *)pgucAtSndCodeAddr,
                                (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                "^RSFR:\"VERSION\",\"111\",125,1,1,%s",
                                gaucAtCrLf);

    usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN, (VOS_CHAR *)pgucAtSndCodeAddr,
                                (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                "\"%s\"", pcRsfrItem);

    gstAtSendData.usBufLen = usLength;

    At_FormatResultData(ucIndex, AT_OK);

    PS_MEM_FREE(WUEPS_PID_AT, pcRsfrItem);

    return ;
}


/*****************************************************************************
 ?? ?? ??  : AT_RsfwSimLockProc
 ????????  : ????SIMLOCK????????????"AT"??":"->"="??"0"->"2"(CustomInfoSetting????)
 ????????  : VOS_UINT8 *pucData   ??????????????
             VOS_UINT16 usLen      ??????????????????
 ????????  : ??
 ?? ?? ??  : VOS_VOID
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??3??31??
    ??    ??   : c64416
    ????????   : ??????????

*****************************************************************************/
VOS_VOID AT_RsfwSimLockProc(VOS_UINT8 *pucData, VOS_UINT16 usLen)
{
    VOS_UINT16 i = 0;
    VOS_UINT32 usNum = 0;

    /* ????AT???????? */
    pucData[0] = 'A';
    pucData[1] = 'T';
    pucData[10] = '=';      /* ?????????????? */

    if(usLen < 13)
    {
        return ;
    }

    if(('1' == pucData[11]) && (',' == pucData[12]))
    {

        /* ??????????????????MNC??????????0??????????2??3 */
        for(i = 11; i < usLen; i++)
        {
            if(',' == pucData[i])
            {
                usNum++;
                if(i+8 >= usLen)
                {
                    return ;
                }

                /* ????????PLMN??????????????2????3 */
                if((1 == (usNum%3)) && ('0' == pucData[i+1]) && (',' == pucData[i+2]))
                {
                    if(',' == pucData[i+8])
                    {
                        pucData[i+1] = '2';
                    }
                    else
                    {
                        pucData[i+1] = '3';
                    }
                }
            }
        }
    }

    return ;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetRsfwPara
 ????????  : ^RSFW????????(??????????????CustomInfoSetting ??????????????????)
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??3??29??
    ??    ??   : c64416
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetRsfwPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32  ulRet;
    VOS_UINT32  ulLength = 0;
    VOS_CHAR    cName[AT_RSFR_RSFW_NAME_LEN + 1]   = {0};
    VOS_UINT8*  pucRsfw  = NULL;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    if (gucAtParaIndex != 6)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????????? */
    if ((0 == gastAtParaList[0].usParaLen)
        || (gastAtParaList[0].usParaLen > AT_RSFR_RSFW_NAME_LEN))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_CPY(cName, gastAtParaList[0].aucPara, gastAtParaList[0].usParaLen);

    At_UpString((VOS_UINT8*)cName, gastAtParaList[0].usParaLen);

    /* CustomInfoSetting ??????????????????<name>???????????????? */

    if(ERR_MSP_SUCCESS == AT_STRCMP(cName, "SIMLOCK"))
    {
        if(gastAtParaList[5].usParaLen > AT_PARA_MAX_LEN)
        {
            (VOS_VOID)vos_printf("[AT_SetRsfwPara] : param 5 is too long : %d.\n", gastAtParaList[5].usParaLen);

            return AT_ERROR;
        }

        pucRsfw = (TAF_UINT8*)PS_MEM_ALLOC(WUEPS_PID_AT, AT_RSFR_RSFW_MAX_LEN);
        if (VOS_NULL_PTR == pucRsfw )
        {
            return AT_ERROR;
        }

        PS_MEM_SET(pucRsfw, 0, AT_RSFR_RSFW_MAX_LEN);

        /* ??????????????????AT??????????^SIMLOCK?????????????????? */
        ulRet = AtBase64Decode(gastAtParaList[5].aucPara, gastAtParaList[5].usParaLen,
            &(pucRsfw[2]), (AT_RSFR_RSFW_MAX_LEN-2), &ulLength);
        if(b64Result_OK != ulRet)
        {
            PS_MEM_FREE(WUEPS_PID_AT, pucRsfw);
            return AT_ERROR;
        }

        /* ??????CustomInfoSetting?????????????? */
        AT_RsfwSimLockProc(pucRsfw, (VOS_UINT16)(ulLength + 2));

        ulRet = At_ProcSimLockPara(ucIndex, pucRsfw, (VOS_UINT16)(ulLength + 2));

        if(AT_SUCCESS != ulRet)
        {
            (VOS_VOID)vos_printf("[AT_SetRsfwPara] : At_ProcSimLockPara failed %d.\n", ulRet);
        }

        PS_MEM_FREE(WUEPS_PID_AT, pucRsfw);

        /* AT_ERROR AT_OK??At_ProcSimLockPara?????? */
        return AT_SUCCESS;
    }
    else if(VOS_OK == AT_STRCMP(cName, "VSIM"))
    {
        return At_DealRSFWVsim(ucIndex);
    }
    else
    {
        return AT_ERROR;
    }
}


/*****************************************************************************
 ?? ?? ??  : AT_SetHukPara
 ????????  : ^HUK????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??04??07??
    ??    ??   : l00198894
    ????????   : AP-Modem????????????????????
  2.??    ??   : 2012??8??13??
    ??    ??   : l60609
    ????????   : MUX:????MUX??????????
*****************************************************************************/
VOS_UINT32 AT_SetHukPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulResult;
    VOS_UINT16                          usLength;
    DRV_AGENT_HUK_SET_REQ_STRU          stHukSetReq;

    /* ?????????????? */
    ulResult = VOS_NULL;
    usLength = gastAtParaList[0].usParaLen;
    PS_MEM_SET(&stHukSetReq, 0x00, sizeof(DRV_AGENT_HUK_SET_REQ_STRU));

    /* ???????? */
    /* Modified by L60609 for MUX??2012-08-13,  Begin */
    if (VOS_FALSE == AT_IsApPort(ucIndex))
    /* Modified by L60609 for MUX??2012-08-13,  End */
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_TOO_MANY_PARA;
    }

    /* ???????????????? */
    if (AT_HUK_PARA_LEN != usLength)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????????????????? */
    ulResult = At_AsciiNum2HexString(gastAtParaList[0].aucPara, &usLength);
    if ( (AT_SUCCESS != ulResult) || (DRV_AGENT_HUK_LEN != usLength) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }
    PS_MEM_CPY(stHukSetReq.aucHUK, gastAtParaList[0].aucPara, DRV_AGENT_HUK_LEN);

    /* ????????, ??????????????C??, ????HUK */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      DRV_AGENT_HUK_SET_REQ,
                                      &stHukSetReq,
                                      sizeof(DRV_AGENT_HUK_SET_REQ_STRU),
                                      I0_WUEPS_PID_DRV_AGENT);
    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetHukPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_HUK_SET;
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_DecodeFacAuthPubkeyPara
 ????????  : ^FACAUTHPUBKEY????????????????
 ????????  : pstFacAuthPubKey
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??04??10??
    ??    ??   : l00198894
    ????????   : AP-Modem????????????????????

*****************************************************************************/
VOS_UINT32 AT_DecodeFacAuthPubkeyPara(AT_FACAUTHPUBKEY_SET_REQ_STRU *pstFacAuthPubKey)
{
    VOS_UINT32                          ulResult;
    VOS_UINT16                          usLength;

    /* ?????????????? */
    ulResult = VOS_NULL;
    usLength = AT_FACAUTHPUBKEY_PARA_LEN;

    ulResult = At_AsciiNum2HexString(pstFacAuthPubKey->aucPubKey, &usLength);
    if ( (AT_SUCCESS != ulResult) || (DRV_AGENT_PUBKEY_LEN != usLength) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    usLength = AT_FACAUTHPUBKEY_SIGN_PARA_LEN;

    ulResult = At_AsciiNum2HexString(pstFacAuthPubKey->aucPubKeySign, &usLength);
    if ( (AT_SUCCESS != ulResult) || (DRV_AGENT_PUBKEY_SIGNATURE_LEN != usLength) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    return AT_SUCCESS;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetFacAuthPubkeyPara
 ????????  : ^FACAUTHPUBKEY????????????????
 ????????  : VOS_UINT8 ucIndex
             AT_FACAUTHPUBKEY_SET_REQ_STRU      *pstFacAuthPubKey
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??04??10??
    ??    ??   : l00198894
    ????????   : AP-Modem????????????????????
  2.??    ??   : 2012??8??13??
    ??    ??   : l60609
    ????????   : MUX:????MUX??????????
*****************************************************************************/
VOS_UINT32 AT_SetFacAuthPubkeyPara(
    VOS_UINT8                           ucIndex,
    AT_FACAUTHPUBKEY_SET_REQ_STRU      *pstFacAuthPubKey
)
{
    VOS_UINT32                              ulResult;
    DRV_AGENT_FACAUTHPUBKEY_SET_REQ_STRU    stFacAuthPubkeySetReq;

    /* ?????????????? */
    PS_MEM_SET(&stFacAuthPubkeySetReq, 0x00, sizeof(DRV_AGENT_FACAUTHPUBKEY_SET_REQ_STRU));

    /* ???????? */
    /* Modified by L60609 for MUX??2012-08-13,  Begin */
    if (VOS_FALSE == AT_IsApPort(ucIndex))
    /* Modified by L60609 for MUX??2012-08-13,  End */
    {
        return AT_ERROR;
    }

    /* ?????????????????????? */
    ulResult = AT_DecodeFacAuthPubkeyPara(pstFacAuthPubKey);
    if (AT_SUCCESS != ulResult)
    {
        return ulResult;
    }
    PS_MEM_CPY(stFacAuthPubkeySetReq.aucPubKey,
               pstFacAuthPubKey->aucPubKey,
               DRV_AGENT_PUBKEY_LEN);
    PS_MEM_CPY(stFacAuthPubkeySetReq.aucPubKeySign,
               pstFacAuthPubKey->aucPubKeySign,
               DRV_AGENT_PUBKEY_SIGNATURE_LEN);

    /* ????????, ??????????????C??, ???????????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      DRV_AGENT_FACAUTHPUBKEY_SET_REQ,
                                      &stFacAuthPubkeySetReq,
                                      sizeof(DRV_AGENT_FACAUTHPUBKEY_SET_REQ_STRU),
                                      I0_WUEPS_PID_DRV_AGENT);
    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetFacAuthPubkeyPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????FACAUTHPUBKEY????????????????????????????*/
    if (AT_SUCCESS != At_StartTimer(AT_SET_PARA_TIME, ucIndex))
    {
        AT_WARN_LOG("AT_SetFacAuthPubkeyPara: At_StartTimer fail.");
        return AT_ERROR;
    }

    g_stParseContext[ucIndex].ucClientStatus = AT_FW_CLIENT_STATUS_PEND;

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_FACAUTHPUBKEY_SET;
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetIdentifyStartPara
 ????????  : ^IDENTIFYSTART????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??04??09??
    ??    ??   : l00198894
    ????????   : AP-Modem????????????????????
  2.??    ??   : 2012??8??13??
    ??    ??   : l60609
    ????????   : MUX:????MUX??????????
*****************************************************************************/
VOS_UINT32 AT_SetIdentifyStartPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulResult;

    /* ???????? */
    /* Modified by L60609 for MUX??2012-08-13,  Begin */
    if (VOS_FALSE == AT_IsApPort(ucIndex))
    /* Modified by L60609 for MUX??2012-08-13,  End */
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????????????C??, ???????????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      DRV_AGENT_IDENTIFYSTART_SET_REQ,
                                      VOS_NULL_PTR,
                                      0,
                                      I0_WUEPS_PID_DRV_AGENT);

    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetIdentifyStartPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_IDENTIFYSTART_SET;
    return AT_WAIT_ASYNC_RETURN;

}

/*****************************************************************************
 ?? ?? ??  : AT_SetIdentifyEndPara
 ????????  : ^IDENTIFYEND????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??04??09??
    ??    ??   : l00198894
    ????????   : AP-Modem????????????????????
  2.??    ??   : 2012??8??13??
    ??    ??   : l60609
    ????????   : MUX:????MUX??????????
*****************************************************************************/
VOS_UINT32 AT_SetIdentifyEndPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulResult;
    DRV_AGENT_IDENTIFYEND_SET_REQ_STRU  stIdentifyEndSetReq;
    VOS_UINT16                          usLength;

    /* ?????????????? */
    ulResult = VOS_NULL;
    usLength = gastAtParaList[0].usParaLen;
    PS_MEM_SET(&stIdentifyEndSetReq, 0x00, sizeof(DRV_AGENT_IDENTIFYEND_SET_REQ_STRU));

    /* ???????? */
    /* Modified by L60609 for MUX??2012-08-13,  Begin */
    if (VOS_FALSE == AT_IsApPort(ucIndex))
    /* Modified by L60609 for MUX??2012-08-13,  End */
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (1 < gucAtParaIndex)
    {
        return AT_TOO_MANY_PARA;
    }

    /* ???????????????? */
    if (AT_RSA_CIPHERTEXT_PARA_LEN != usLength)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????????????????? */
    ulResult = At_AsciiNum2HexString(gastAtParaList[0].aucPara, &usLength);
    if ( (AT_SUCCESS != ulResult) || (DRV_AGENT_RSA_CIPHERTEXT_LEN != usLength) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }
    PS_MEM_CPY(stIdentifyEndSetReq.aucRsaText,
               gastAtParaList[0].aucPara,
               DRV_AGENT_RSA_CIPHERTEXT_LEN);

    /* ??????????????C??, ???????????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      DRV_AGENT_IDENTIFYEND_SET_REQ,
                                      &stIdentifyEndSetReq,
                                      sizeof(DRV_AGENT_IDENTIFYEND_SET_REQ_STRU),
                                      I0_WUEPS_PID_DRV_AGENT);

    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetIdentifyEndPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_IDENTIFYEND_SET;
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetSimlockDataWritePara
 ????????  : ^SIMLOCKDATAWRITE????????????????
 ????????  : VOS_UINT8 ucIndex
             AT_SIMLOCKDATAWRITE_SET_REQ_STRU *pstSimlockDataWrite
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??04??09??
    ??    ??   : l00198894
    ????????   : AP-Modem????????????????????
  2.??    ??   : 2012??8??13??
    ??    ??   : l60609
    ????????   : MUX:????MUX??????????
*****************************************************************************/
VOS_UINT32 AT_SetSimlockDataWritePara(
    VOS_UINT8                           ucIndex,
    AT_SIMLOCKDATAWRITE_SET_REQ_STRU   *pstSimlockDataWrite
)
{
    VOS_UINT32                                  ulResult;
    VOS_UINT16                                  usLength;
    DRV_AGENT_SIMLOCKDATAWRITE_SET_REQ_STRU     stSimlockDataWriteSetReq;

    /* ?????????????? */
    ulResult = VOS_NULL;
    usLength = AT_SIMLOCKDATAWRITE_PARA_LEN;
    PS_MEM_SET(&stSimlockDataWriteSetReq,
               0x00,
               sizeof(DRV_AGENT_SIMLOCKDATAWRITE_SET_REQ_STRU));

    /* ???????? */
    /* Modified by L60609 for MUX??2012-08-13,  Begin */
    if (VOS_FALSE == AT_IsApPort(ucIndex))
    /* Modified by L60609 for MUX??2012-08-13,  End */
    {
        return AT_ERROR;
    }

    /* ?????????????????????? */
    ulResult = At_AsciiNum2HexString(pstSimlockDataWrite->aucCategoryData, &usLength);
    if ( (AT_SUCCESS != ulResult)
      || (DRV_AGENT_SIMLOCKDATAWRITE_STRU_LEN != usLength) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }
    PS_MEM_CPY(stSimlockDataWriteSetReq.aucCategoryData,
               pstSimlockDataWrite->aucCategoryData,
               DRV_AGENT_SIMLOCKDATAWRITE_STRU_LEN);

    /* ????????, ??????????????C??, ???????????????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      DRV_AGENT_SIMLOCKDATAWRITE_SET_REQ,
                                      &stSimlockDataWriteSetReq,
                                      sizeof(DRV_AGENT_SIMLOCKDATAWRITE_SET_REQ_STRU),
                                      I0_WUEPS_PID_DRV_AGENT);
    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetSimlockDataWritePara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????SIMLOCKDATAWRITE????????????????????????????*/
    if (AT_SUCCESS != At_StartTimer(AT_SET_PARA_TIME, ucIndex))
    {
        AT_WARN_LOG("AT_SetSimlockDataWritePara: At_StartTimer fail.");
        return AT_ERROR;
    }

    g_stParseContext[ucIndex].ucClientStatus = AT_FW_CLIENT_STATUS_PEND;

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SIMLOCKDATAWRITE_SET;
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_CheckPhonePhyNumPara
 ????????  : ^PHONEPHYNUM????????????????, ????????????????????????
 ????????  : ??
 ????????  : DRV_AGENT_PH_PHYNUM_TYPE_ENUM_UINT8 *penSetType ????????????????
 ?? ?? ??  : VOS_UINT32         ??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??04??09??
    ??    ??   : l00198894
    ????????   : AP-Modem????????????????????

*****************************************************************************/
VOS_UINT32 AT_CheckPhonePhyNumPara(DRV_AGENT_PH_PHYNUM_TYPE_ENUM_UINT8 *penSetType)
{
    /* <type>????????: ??????????????IMEI??SN??????, ?????????????????????? */
    /* ???????????????????? */
    if (AT_FAILURE == At_UpString(gastAtParaList[0].aucPara, gastAtParaList[0].usParaLen))
    {
        return AT_PERSONALIZATION_PH_PHYNUM_TYPE_ERROR;
    }

    if (0 == VOS_StrCmp((VOS_CHAR *)gastAtParaList[0].aucPara, "IMEI"))
    {
        *penSetType = DRV_AGENT_PH_PHYNUM_IMEI;
    }
    else if (0 == VOS_StrCmp((VOS_CHAR *)gastAtParaList[0].aucPara, "SN"))
    {
        *penSetType = DRV_AGENT_PH_PHYNUM_SN;
    }
    else
    {
        AT_NORM_LOG("AT_CheckPhonePhyNumPara: the type of physical is error.");
        return AT_PERSONALIZATION_PH_PHYNUM_TYPE_ERROR;
    }

    /* ???????????? */
    if (AT_RSA_CIPHERTEXT_PARA_LEN != gastAtParaList[1].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    return AT_SUCCESS;
}


/*****************************************************************************
 ?? ?? ??  : AT_SetPhonePhynumPara
 ????????  : ^PHONEPHYNUM????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??04??09??
    ??    ??   : l00198894
    ????????   : AP-Modem????????????????????
  2.??    ??   : 2012??8??13??
    ??    ??   : l60609
    ????????   : MUX:????MUX??????????
*****************************************************************************/
VOS_UINT32 AT_SetPhonePhynumPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulResult;
    VOS_UINT32                          ulCheckParaRst;
    DRV_AGENT_PHONEPHYNUM_SET_REQ_STRU  stPhonePhynumSetReq;
    VOS_UINT16                          usLength;

    /* ?????????????? */
    ulResult        = VOS_NULL;
    ulCheckParaRst  = VOS_NULL;
    usLength        = gastAtParaList[1].usParaLen;
    PS_MEM_SET(&stPhonePhynumSetReq, 0x00, sizeof(DRV_AGENT_PHONEPHYNUM_SET_REQ_STRU));

    /* ???????? */
    /* Modified by L60609 for MUX??2012-08-13,  Begin */
    if (VOS_FALSE == AT_IsApPort(ucIndex))
    /* Modified by L60609 for MUX??2012-08-13,  End */
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (2 < gucAtParaIndex)
    {
        return AT_TOO_MANY_PARA;
    }

    /* ???????????? */
    if (2 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ulCheckParaRst = AT_CheckPhonePhyNumPara(&(stPhonePhynumSetReq.enPhynumType));
    if (AT_SUCCESS != ulCheckParaRst)
    {
        return ulCheckParaRst;
    }

    /* ?????????????????????? */
    ulResult = At_AsciiNum2HexString(gastAtParaList[1].aucPara, &usLength);
    if ( (AT_SUCCESS != ulResult) || (DRV_AGENT_RSA_CIPHERTEXT_LEN != usLength) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }
    PS_MEM_CPY(stPhonePhynumSetReq.aucPhynumValue,
               gastAtParaList[1].aucPara,
               DRV_AGENT_RSA_CIPHERTEXT_LEN);

    /* ??????????????C??, ???????????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      DRV_AGENT_PHONEPHYNUM_SET_REQ,
                                      &stPhonePhynumSetReq,
                                      sizeof(DRV_AGENT_PHONEPHYNUM_SET_REQ_STRU),
                                      I0_WUEPS_PID_DRV_AGENT);

    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetPhonePhynumPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_PHONEPHYNUM_SET;
    return AT_WAIT_ASYNC_RETURN;

}


/*****************************************************************************
 ?? ?? ??  : AT_SetPortCtrlTmpPara
 ????????  : ^PORTCTRLTMP????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??04??10??
    ??    ??   : y00213812
    ????????   : AP-Modem????????????????????
  2.??    ??   : 2012??8??13??
    ??    ??   : l60609
    ????????   : MUX:????MUX??????????
*****************************************************************************/
VOS_UINT32 AT_SetPortCtrlTmpPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                              ulResult;
    DRV_AGENT_PORTCTRLTMP_SET_REQ_STRU      stPortCtrlTmpSetReq;
    VOS_UINT8                               aucPara[AT_PORTCTRLTMP_PARA_LEN];

    /* ?????????????? */
    PS_MEM_SET(&stPortCtrlTmpSetReq, 0x00, sizeof(DRV_AGENT_PORTCTRLTMP_SET_REQ_STRU));
    PS_MEM_SET(aucPara, 0x00, AT_PORTCTRLTMP_PARA_LEN);

    /* ???????? */
    /* Modified by L60609 for MUX??2012-08-13,  Begin */
    if (VOS_FALSE == AT_IsApPort(ucIndex))
    /* Modified by L60609 for MUX??2012-08-13,  End */
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

     /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_TOO_MANY_PARA;
    }

    /* ???????????????? */
    if (AT_PORTCTRLTMP_PARA_LEN != gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????????????????16????0??-??9??ASCII????,??????ASCII?????????????????? */
    ulResult = At_AsciiNum2Num(aucPara, gastAtParaList[0].aucPara, DRV_AGENT_PORT_PASSWORD_LEN);
    if ( AT_FAILURE == ulResult)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????, ??????????????C?? */
    PS_MEM_CPY(stPortCtrlTmpSetReq.aucPortPassword, aucPara, DRV_AGENT_PORT_PASSWORD_LEN);
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      DRV_AGENT_PORTCTRLTMP_SET_REQ,
                                      &stPortCtrlTmpSetReq,
                                      sizeof(DRV_AGENT_PORTCTRLTMP_SET_REQ_STRU),
                                      I0_WUEPS_PID_DRV_AGENT);
    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetPortCtrlTmpPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_PORTCTRLTMP_SET;
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetPortAttribSetPara
 ????????  : ^PORTATTRIBSET????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??04??10??
    ??    ??   : y00213812
    ????????   : AP-Modem????????????????????
  2.??    ??   : 2012??8??13??
    ??    ??   : l60609
    ????????   : MUX:????MUX??????????
*****************************************************************************/
VOS_UINT32 AT_SetPortAttribSetPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                              ulResult;
    VOS_UINT16                              usLength;
    DRV_AGENT_PORTATTRIBSET_SET_REQ_STRU    stPortAttribSetReq;

    /* ?????????????? */
    PS_MEM_SET(&stPortAttribSetReq, 0x00, sizeof(DRV_AGENT_PORTATTRIBSET_SET_REQ_STRU));

    /* ???????? */
    /* Modified by L60609 for MUX??2012-08-13,  Begin */
    if (VOS_FALSE == AT_IsApPort(ucIndex))
    /* Modified by L60609 for MUX??2012-08-13,  End */
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

     /* ???????? */
    if (gucAtParaIndex > 2)
    {
        return AT_TOO_MANY_PARA;
    }

    /* ???????????????? */
    if ( (AT_PORTATTRIBSET_PARA_ONOFF_LEN != gastAtParaList[0].usParaLen)
      || (AT_RSA_CIPHERTEXT_PARA_LEN      != gastAtParaList[1].usParaLen) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????????????? */
    if (0 == gastAtParaList[0].ulParaValue)
    {
        stPortAttribSetReq.enPortStatus = DRV_AGENT_PORT_STATUS_OFF;
    }
    else
    {
        stPortAttribSetReq.enPortStatus = DRV_AGENT_PORT_STATUS_ON;
    }

    /* ?????????????????????? */
    usLength = gastAtParaList[1].usParaLen;
    ulResult = At_AsciiNum2HexString(gastAtParaList[1].aucPara, &usLength);
    if ( (TAF_SUCCESS != ulResult) || (DRV_AGENT_RSA_CIPHERTEXT_LEN != usLength) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_CPY(stPortAttribSetReq.aucPortPassword,
               gastAtParaList[1].aucPara,
               DRV_AGENT_RSA_CIPHERTEXT_LEN);
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      DRV_AGENT_PORTATTRIBSET_SET_REQ,
                                      &stPortAttribSetReq,
                                      sizeof(DRV_AGENT_PORTATTRIBSET_SET_REQ_STRU),
                                      I0_WUEPS_PID_DRV_AGENT);

    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetPortAttribSetPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_PORTATTRIBSET_SET;
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetApSimStPara
 ????????  : (AT^APSIMST)????/??????(U)SIM??
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??06??18??
    ??    ??   : f00179208
    ????????   : ??????????
  2.??    ??   : 2012??8??13??
    ??    ??   : l60609
    ????????   : MUX:????MUX??????????
*****************************************************************************/
VOS_UINT32 AT_SetApSimStPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                              ulResult;
    DRV_AGENT_AP_SIMST_SET_REQ_STRU         stApSimStSetReq;

    /* ?????????????? */
    PS_MEM_SET(&stApSimStSetReq, 0x00, sizeof(DRV_AGENT_AP_SIMST_SET_REQ_STRU));

    /* ???????? */
    /* Modified by L60609 for MUX??2012-08-13,  Begin */
    if (VOS_FALSE == AT_IsApPort(ucIndex))
    /* Modified by L60609 for MUX??2012-08-13,  End */
    {
        return AT_ERROR;
    }

    /* ???????? */
    if ( AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType )
    {
        return AT_ERROR;
    }

     /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_ERROR;
    }

    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_ERROR;
    }

    /* ??????????1????????????????????????OK */
    if (1 == gastAtParaList[0].ulParaValue)
    {
        stApSimStSetReq.ulUsimState = DRV_AGENT_USIM_OPERATE_ACT;
    }
    else
    {
        stApSimStSetReq.ulUsimState = DRV_AGENT_USIM_OPERATE_DEACT;
    }

    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      DRV_AGENT_AP_SIMST_SET_REQ,
                                      &stApSimStSetReq,
                                      sizeof(DRV_AGENT_AP_SIMST_SET_REQ_STRU),
                                      I0_WUEPS_PID_DRV_AGENT);
    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetApSimStPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_APSIMST_SET;

    return AT_WAIT_ASYNC_RETURN;

}

/*****************************************************************************
 ?? ?? ??  : AT_ConvertMccToNasType
 ????????  : ????MCCd??????NAS????????????????
             ????:MCC??460
             pstPlmnId->Mcc = 0x000604      pstPlmnId->Mcc = 0x00000460
                                        <----
 ????????  : ulMcc BCD??????MCC
 ????????  : *pulMcc NAS????MCC
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??06??11??
    ??    ??   : w00166186
    ????????   : AT&T&DCM????????

*****************************************************************************/
VOS_VOID AT_ConvertMccToNasType(
    VOS_UINT32                          ulMcc,
    VOS_UINT32                         *pulNasMcc
)
{
    VOS_UINT32                          aulTmp[3];
    VOS_UINT32                          i;

    *pulNasMcc  = 0;

    for (i = 0; i < 3 ; i++ )
    {
        aulTmp[i]       = ulMcc & 0x0f;
        ulMcc         >>=  4;
    }

    *pulNasMcc  = aulTmp[2]
             |((VOS_UINT32)aulTmp[1] << 8)
             |((VOS_UINT32)aulTmp[0] << 16);

}

/*****************************************************************************
 ?? ?? ??  : AT_SetNvmEccNumPara
 ????????  : ^NVM????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??06??11??
    ??    ??   : w00166186
    ????????   : AT&T&DCM????????

  2.??    ??   : 2014??12??20??
    ??    ??   : l00198894
    ????????   : DTS2014110508255: ????????????????????????????????????

*****************************************************************************/
VOS_UINT32 AT_SetNvmEccNumPara(
    VOS_UINT8                           ucIndex
)
{
    MN_CALL_APP_CUSTOM_ECC_NUM_REQ_STRU stEccNumReq;
    VOS_UINT32                          ulRst;
    VOS_UINT32                          ulTemp;
    VOS_UINT32                          ulMcc;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        AT_ERR_LOG("AT_SetNvmEccNumSetPara: Cmd Opt Type is wrong.");
        return AT_ERROR;
    }

    /* ???????? */
    if ( (gucAtParaIndex < 6) || (gucAtParaIndex > 7) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????????????, index > total???????????? */
    if (gastAtParaList[0].ulParaValue > gastAtParaList[1].ulParaValue)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????? */
    VOS_MemSet(&stEccNumReq, 0, sizeof(MN_CALL_APP_CUSTOM_ECC_NUM_REQ_STRU));

    /* ??ECC NUM??????BCD?? */
    if (MN_ERR_NO_ERROR != AT_AsciiNumberToBcd((TAF_CHAR*)&gastAtParaList[2].aucPara[0],
                                                stEccNumReq.stEccNum.aucBcdNum,
                                                &stEccNumReq.stEccNum.ucNumLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ulTemp  = 0;
    ulTemp |= (gastAtParaList[5].ulParaValue % 10);
    ulTemp |= (((gastAtParaList[5].ulParaValue /10) % 10) << 4);
    ulTemp |= (((gastAtParaList[5].ulParaValue /100) % 10) << 8);

    /* ??MCC??????NAS???? */
    AT_ConvertMccToNasType(ulTemp, &ulMcc);

    stEccNumReq.ucIndex         = (VOS_UINT8)gastAtParaList[0].ulParaValue;
    stEccNumReq.ucTotal         = (VOS_UINT8)gastAtParaList[1].ulParaValue;
    stEccNumReq.ucCategory      = (VOS_UINT8)gastAtParaList[3].ulParaValue;
    stEccNumReq.ucSimPresent    = (VOS_UINT8)gastAtParaList[4].ulParaValue;
    stEccNumReq.ulMcc           = ulMcc;

    if (gucAtParaIndex == 7)
    {
        stEccNumReq.ucAbnormalServiceFlg    = (VOS_UINT8)gastAtParaList[6].ulParaValue;
    }
    else
    {
        /* ??????????????????????????????????????????????FALSE */
        stEccNumReq.ucAbnormalServiceFlg    = VOS_FALSE;
    }

    /* ???????? */
    ulRst = MN_CALL_SendAppRequest(MN_CALL_APP_CUSTOM_ECC_NUM_REQ,
                                   gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   0,
                                  (MN_CALL_APP_REQ_PARM_UNION*)&stEccNumReq);

    if (MN_ERR_NO_ERROR != ulRst)
    {
        AT_WARN_LOG("AT_SetNvmEccNumPara: MN_CALL_SendAppRequest fail.");
        return AT_ERROR;
    }

    /* ????????????????OK */
    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCposPara
 ????????  : +CPOS????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??06??27??
    ??    ??   : y00213812
    ????????   : V7R1C50 A-GPS????????????
  2.??    ??   : 2012??8??13??
    ??    ??   : l60609
    ????????   : MUX:????MUX??????????
  3.??    ??   : 2013??2??20??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
VOS_UINT32 AT_SetCposPara(VOS_UINT8 ucIndex)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, Begin */
    AT_MODEM_AGPS_CTX_STRU             *pstAgpsCtx = VOS_NULL_PTR;

    pstAgpsCtx = AT_GetModemAgpsCtxAddrFromClientId(ucIndex);
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, End */

    /* ???????? */
    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* Modified by l60609 for DSDA Phase III, 2013-2-20, Begin */
    /* ????????????XML???????????? */
    pstAgpsCtx->stXml.pcXmlTextHead = (VOS_CHAR *)PS_MEM_ALLOC(WUEPS_PID_AT, AT_XML_MAX_LEN);
    if (VOS_NULL_PTR == pstAgpsCtx->stXml.pcXmlTextHead)
    {
        AT_ERR_LOG("AT_SetCposPara: Memory malloc failed!");
        return AT_ERROR;
    }
    pstAgpsCtx->stXml.pcXmlTextCur  = pstAgpsCtx->stXml.pcXmlTextHead;
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, End */

    /* ??????AGPS XML???????????? */
    At_SetMode(ucIndex, AT_CMD_MODE, AT_XML_MODE);

    /* ????????XML???????????? */
    return AT_WAIT_XML_INPUT;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCposrPara
 ????????  : +CPOSR????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??06??27??
    ??    ??   : y00213812
    ????????   : V7R1C50 A-GPS????????????
  2.??    ??   : 2012??8??13??
    ??    ??   : l60609
    ????????   : MUX:????MUX??????????
  3.??    ??   : 2013??2??20??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
VOS_UINT32 AT_SetCposrPara(VOS_UINT8 ucIndex)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, Begin */
    AT_MODEM_AGPS_CTX_STRU             *pstAgpsCtx = VOS_NULL_PTR;

    pstAgpsCtx = AT_GetModemAgpsCtxAddrFromClientId(ucIndex);

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if (1 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    pstAgpsCtx->enCposrReport = (AT_CPOSR_FLG_ENUM_UNIT8)gastAtParaList[0].ulParaValue;
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, End */

    return AT_OK;
}


/*****************************************************************************
 ?? ?? ??  : AT_SetXcposrPara
 ????????  : ^XCPOSR????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??06??27??
    ??    ??   : y00213812
    ????????   : V7R1C50 A-GPS????????????
  2.??    ??   : 2012??8??13??
    ??    ??   : l60609
    ????????   : MUX:????MUX??????????
  3.??    ??   : 2013??2??20??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  4.??    ??   : 2016??03??08??
    ??    ??   : h00360002
    ????????   : ????????????????C??
*****************************************************************************/
VOS_UINT32 AT_SetXcposrPara(VOS_UINT8 ucIndex)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, Begin */
    VOS_UINT32                          ulResult;
    AT_MTA_SET_XCPOSR_REQ_STRU          stSetXcposr;


    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if( gucAtParaIndex != 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????? */
    PS_MEM_SET(&stSetXcposr, 0x00, sizeof(stSetXcposr));

    stSetXcposr.enXcposrEnableCfg = (AT_MTA_XCPOSR_CFG_ENUM_UNIT8)gastAtParaList[0].ulParaValue;

    /* ??????????????C??, ???????????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      ID_AT_MTA_XCPOSR_SET_REQ,
                                      &stSetXcposr,
                                      sizeof(stSetXcposr),
                                      I0_UEPS_PID_MTA);

    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetXcposrPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_XCPOSR_SET;

    return AT_WAIT_ASYNC_RETURN;
    /* Modified by l60609 for DSDA Phase III, 2013-2-20, End */
}

/*****************************************************************************
 ?? ?? ??  : AT_SetXcposrRptPara
 ????????  : ^XCPOSR????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2016??03??09??
    ??    ??   : h00360002
    ????????   : ????
*****************************************************************************/
VOS_UINT32 AT_SetXcposrRptPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulResult;
    AT_MTA_SET_XCPOSRRPT_REQ_STRU       stSetXcposrRpt;


    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if( gucAtParaIndex != 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????? */
    PS_MEM_SET(&stSetXcposrRpt, 0x00, sizeof(stSetXcposrRpt));

    stSetXcposrRpt.ucXcposrRptFlg = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ??????????????C??, ???????????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      ID_AT_MTA_XCPOSRRPT_SET_REQ,
                                      &stSetXcposrRpt,
                                      sizeof(stSetXcposrRpt),
                                      I0_UEPS_PID_MTA);

    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetXcposrRptPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_XCPOSRRPT_SET;

    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_SysModeToGpsRatMode
 ????????  : ????????????
 ????????  : TAF_SYS_MODE_ENUM_UINT8 enSysMode
 ????????  : ??
 ?? ?? ??  : gps_rat_mode_enum
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??11??17??
    ??    ??   : zwx247453
    ????????   : dallas gps????????????????????
*****************************************************************************/
gps_rat_mode_enum AT_SysModeToGpsRatMode(
    TAF_SYS_MODE_ENUM_UINT8             enSysMode
)
{
    gps_rat_mode_enum                   enRatMode;

    enRatMode = gps_rat_mode_butt;

    switch (enSysMode)
    {
        case TAF_PH_INFO_GSM_RAT:
            enRatMode = gps_rat_mode_gsm;
            break;

        case TAF_PH_INFO_CDMA_1X_RAT:
        case TAF_PH_INFO_HRPD_RAT:
        case TAF_PH_INFO_HYBRID_RAT:
            enRatMode = gps_rat_mode_cdma;
            break;

        case TAF_PH_INFO_WCDMA_RAT:
            enRatMode = gps_rat_mode_wcdma;
            break;

        case TAF_PH_INFO_TD_SCDMA_RAT:
            enRatMode = gps_rat_mode_tdscdma;
            break;

        case TAF_PH_INFO_LTE_RAT:
        case TAF_PH_INFO_SVLTE_SRLTE_RAT:
            enRatMode = gps_rat_mode_lte;
            break;

        default:
            enRatMode = gps_rat_mode_butt;
            break;
    }

    return enRatMode;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCgpsClockPara
 ????????  : ^CGPSCLOCK????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??06??27??
    ??    ??   : y00213812
    ????????   : V7R1C50 A-GPS????????????
  2.??    ??   : 2012??8??13??
    ??    ??   : l60609
    ????????   : MUX:????MUX??????????
  3.??    ??   : 2013??8??27??
    ??    ??   : z60575
    ????????   : DTS2013082603867,AGPS????
  4.??    ??   : 2014??7??11??
    ??    ??   : l00198894
    ????????   : DTS2014062703174: GPS????????????????????
  5.??    ??   : 2015??11??17??
    ??    ??   : zwx247453
    ????????   : dallas gps????????????????
*****************************************************************************/
VOS_UINT32 AT_SetCgpsClockPara(VOS_UINT8 ucIndex)
{
    MODEM_ID_ENUM_UINT16                enModemId;
    TAF_AGENT_SYS_MODE_STRU             stSysMode;

    gps_modem_id_enum                   enGpsModemId;
    gps_rat_mode_enum                   enRatMode;

    enModemId = MODEM_ID_BUTT;
    PS_MEM_SET(&stSysMode, 0, sizeof(stSysMode));

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if( gucAtParaIndex != 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }


    if (VOS_OK != AT_GetModemIdFromClient(gastAtClientTab[ucIndex].usClientId, &enModemId))
    {
        enModemId = MODEM_ID_0;
    }

    if (VOS_OK != TAF_AGENT_GetSysMode(gastAtClientTab[ucIndex].usClientId, &stSysMode))
    {
        stSysMode.enRatType     = TAF_PH_INFO_NONE_RAT;
        stSysMode.enSysSubMode  = TAF_SYS_SUBMODE_BUTT;
    }

    switch (enModemId)
    {
        case MODEM_ID_0:
            enGpsModemId = gps_modem_id_0;
            break;

        case MODEM_ID_1:
            enGpsModemId = gps_modem_id_1;
            break;

        case MODEM_ID_2:
            enGpsModemId = gps_modem_id_2;
            break;

        default:
            enGpsModemId = gps_modem_id_0;
            break;
    }

    enRatMode = AT_SysModeToGpsRatMode(stSysMode.enRatType);

    if (1 == gastAtParaList[0].ulParaValue)
    {
        if (VOS_OK != set_gps_ref_clk_enable(VOS_TRUE, enGpsModemId, enRatMode))
        {
            AT_ERR_LOG("AT_SetCgpsClockPara: set_gps_ref_clk_enable failed!");
            return AT_ERROR;
        }
    }
    else if (0 == gastAtParaList[0].ulParaValue)
    {
        if (VOS_OK != set_gps_ref_clk_enable(VOS_FALSE, enGpsModemId, enRatMode))
        {
            AT_ERR_LOG("AT_SetCgpsClockPara: set_gps_ref_clk_enable failed!");
            return AT_ERROR;
        }
    }
    else
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    return AT_OK;
}

/* Added by h59254 for V7R1C50 Log2.0 Begin */
/*****************************************************************************
 ?? ?? ??  : AT_SetGpsInfoPara
 ????????  : (AT^CGPSINFO)AP????GPS????
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  :
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??08??18??
    ??    ??   : H59254
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetGpsInfoPara(VOS_UINT8 ucIndex)
{
    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetLogCfgPara
 ????????  : (AT^LOGCFG)AP????A??SOCP????BUFFER??????????
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  :
 ????????      :
  1.??    ??   : 2014??09??10??
    ??    ??   : H59254
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetLogCfgPara(VOS_UINT8 ucIndex)
{
    /* add print by cuijunqiang, for socp timer set, 2016.01.21 */
    vos_printf("[socp set timer] logcfg : at port %d, param %d.\n",
        ucIndex, gastAtParaList[0].ulParaValue);

    if (VOS_TRUE == gastAtParaList[0].ulParaValue)
    {
        mdrv_socp_set_log_int_timeout();
    }
    else
    {
        mdrv_socp_set_log_int_default_timeout();
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetLogNvePara
 ????????  : (AT^LOGNVE)AP????LOG??????????NVE????
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  :
 ????????      :
  1.??    ??   : 2014??09??10??
    ??    ??   : H59254
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetLogNvePara(VOS_UINT8 ucIndex)
{
    VOS_INT32                           uResult;
    struct hisi_nve_info_user           stLogCfg;

    /* ???????????????????? */
    if (gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    VOS_MemSet(&stLogCfg, 0, sizeof(stLogCfg));


    stLogCfg.nv_number = 285;
    stLogCfg.valid_size = 2;

    stLogCfg.nv_operation = NVE_WRITE_OPERATE;

    if (VOS_TRUE == gastAtParaList[0].ulParaValue)
    {
        stLogCfg.nv_data[0] = 0x31;
    }
    else
    {
        stLogCfg.nv_data[0] = 0x30;
    }

    printk(KERN_ERR "\n AT_SetLogNvePara:start time %u\n", VOS_GetSlice());
    uResult = hisi_nve_direct_access(&stLogCfg);
    printk(KERN_ERR "\n AT_SetLogNvePara:end time %u\n", VOS_GetSlice());

    if (0 != uResult)
    {
        return AT_ERROR;
    }
    return AT_OK;
}


/*****************************************************************************
 ?? ?? ??  : AT_SetLogSavePara
 ????????  : (AT^LOGSAVE)AP??????A??SOCP????BUFFER??????????????????AP??
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  :
 ????????      :
  1.??    ??   : 2012??12??18??
    ??    ??   : H59254
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetLogSavePara(VOS_UINT8 ucIndex)
{
    /* ???????? */
    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    return AT_OK;
}
/* Added by h59254 for V7R1C50 Log2.0 End */

/*****************************************************************************
 ?? ?? ?? : AT_SetApSecPara
 ???????? : ^APSEC????????????????
 ???????? : VOS_UINT8 ucIndex - ????????
 ???????? : ??
 ?? ?? ?? : VOS_UINT32
 ???????? :
 ???????? :

 ????????     :
  1.??    ??  : 2012??08??28??
    ??    ??  : l00198894
    ????????  : ISDB ????????????????????

*****************************************************************************/
VOS_UINT32 AT_SetApSecPara(
    VOS_UINT8                           ucIndex,
    VOS_UINT8                          *pucCmdPara,
    VOS_UINT16                          usParaLen )
{
    VOS_UINT32                          ulResult;
    AT_MTA_APSEC_REQ_STRU               stApSecSetReq;

    /* ?????? */
    PS_MEM_SET(&stApSecSetReq, 0x00, sizeof(AT_MTA_APSEC_REQ_STRU));

    /* ?????????????????????? */
    ulResult = At_AsciiNum2HexString(pucCmdPara, &usParaLen);
    if (AT_SUCCESS != ulResult)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    stApSecSetReq.ulSPLen = (VOS_UINT32)usParaLen;
    PS_MEM_CPY(stApSecSetReq.aucSecPacket, pucCmdPara, stApSecSetReq.ulSPLen);

    /* ????????????ID_AT_MTA_APSEC_SET_REQ??C?? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      ID_AT_MTA_APSEC_SET_REQ,
                                      &stApSecSetReq,
                                      sizeof(AT_MTA_APSEC_REQ_STRU),
                                      I0_UEPS_PID_MTA);
    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetApSecPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_APSEC_SET;

    return AT_WAIT_ASYNC_RETURN;
}

/* Added by h59254 for V7R1C50 ISDB Project,  2012-8-27 begin */
/*****************************************************************************
 ?? ?? ??  : AT_SetIsdbSimAccessPara
 ????????  : (AT^CISA)ISDB????APDU??(U)SIM??
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ???????? :
 ???????? :

 ????????      :
  1.??    ??   : 2012??08??28??
    ??    ??   : H59254
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetCISAPara(
    VOS_UINT8                           ucIndex,
    VOS_UINT32                          ulLengthValue,
    VOS_UINT8                          *pucCommand,
    VOS_UINT16                          usCommandLength)
{
    SI_PIH_ISDB_ACCESS_COMMAND_STRU     stCommand;
    VOS_UINT16                          usCommandHexLen;

    /* ?????? */
    PS_MEM_SET(&stCommand, 0x00, sizeof(stCommand));

    /* ???????? */
    if ( (ulLengthValue > (SI_APDU_MAX_LEN * 2))
       ||(ulLengthValue != usCommandLength) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* <command>??ASCII????????????????HEX?????? */
    usCommandHexLen =   usCommandLength;
    if (AT_FAILURE == At_AsciiNum2HexString(pucCommand, &usCommandHexLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????<length> */
    stCommand.ulLen = usCommandHexLen;

    /* ????<command> */
    PS_MEM_CPY((TAF_VOID *)stCommand.aucCommand, (TAF_VOID *)pucCommand, (VOS_UINT16)stCommand.ulLen);

    /* ???????????? */
    if(AT_SUCCESS == SI_PIH_IsdbAccessReq(gastAtClientTab[ucIndex].usClientId, 0, &stCommand))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CISA_SET;

        /* ???????????????????? */
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        AT_WARN_LOG("AT_SetCISAPara: SI_PIH_IsdbAccessReq fail.");

        return AT_ERROR;
    }
}
/* Added by h59254 for V7R1C50 ISDB Project,  2012-8-27 end */

/*****************************************************************************
 ?? ?? ??  : AT_QryCmutPara
 ????????  : +CMUT=<n> ????????????
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??9??12??
    ??    ??   : A00165503
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetCmutPara(VOS_UINT8 ucIndex)
{
    APP_VC_MUTE_STATUS_ENUM_UINT8        enMuteStatus;

    /* ?????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????????? */
    if (1 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????, ???????????????????? */
    if (0 == gastAtParaList[0].ulParaValue)
    {
        enMuteStatus = APP_VC_MUTE_STATUS_UNMUTED;
    }
    else
    {
        enMuteStatus = APP_VC_MUTE_STATUS_MUTED;
    }

    /* ???????????? */
    if (VOS_OK != APP_VC_SetMuteStatus(gastAtClientTab[ucIndex].usClientId,
                                       0,
                                       enMuteStatus))
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CMUT_SET;

    /* ???????????????????? */
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetSimlockUnlockPara
 ????????  : ^SIMLOCKUNLOCK????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??9??19??
    ??    ??   : ??????/00198894
    ????????   : STK??????????DCM??????????????????????

*****************************************************************************/
VOS_UINT32  AT_SetSimlockUnlockPara( VOS_UINT8 ucIndex )
{
    VOS_UINT32                          ulResult;
    AT_MTA_SIMLOCKUNLOCK_REQ_STRU       stSimlockUnlockSetReq;

    /* ???????? */
    if (VOS_FALSE == AT_IsApPort(ucIndex))
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (2 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????????????? */
    if ( (0 == gastAtParaList[0].usParaLen)
      || (AT_SIMLOCKUNLOCK_PWD_PARA_LEN != gastAtParaList[1].usParaLen)
      || (gastAtParaList[0].ulParaValue > AT_MTA_PERS_CATEGORY_SERVICE_PROVIDER) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_SET(&stSimlockUnlockSetReq, 0, sizeof(AT_MTA_SIMLOCKUNLOCK_REQ_STRU));
    stSimlockUnlockSetReq.enCategory = (AT_MTA_PERS_CATEGORY_ENUM_UINT8)gastAtParaList[0].ulParaValue;

    /* ????????????????????????16????0??-??9??ASCII????,??????ASCII?????????????????? */
    ulResult = At_AsciiNum2Num(stSimlockUnlockSetReq.aucPassword,
                               gastAtParaList[1].aucPara,
                               gastAtParaList[1].usParaLen);
    if ( AT_SUCCESS != ulResult)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????????????C??, ???????????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      ID_AT_MTA_SIMLOCKUNLOCK_SET_REQ,
                                      &stSimlockUnlockSetReq,
                                      sizeof(AT_MTA_SIMLOCKUNLOCK_REQ_STRU),
                                      I0_UEPS_PID_MTA);

    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetSimlockUnlockPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SIMLOCKUNLOCK_SET;
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_FillApdsPara
 ????????  : ????^APDS??????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??09??18??
    ??    ??   : y00213812
    ????????   : STK&DCM ????????????
  2.??    ??   : 2012??12??03??
    ??    ??   : Y00213812
    ????????   : DTS2012120303885,????????????????????????
  3.??    ??   : 2013??2??21??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
  4.??    ??   : 2014??03??29??
    ??    ??   : n00269697
    ????????   : V3R3C60_eCall??????AT_FillCalledNumPara????????????????????????????????
*****************************************************************************/
VOS_UINT32 AT_FillApdsPara(
    VOS_UINT8                           ucIndex,
    MN_CALL_ORIG_PARAM_STRU            *pstOrigParam
)
{
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, Begin */
    AT_MODEM_SS_CTX_STRU               *pstSsCtx = VOS_NULL_PTR;

    pstSsCtx = AT_GetModemSsCtxAddrFromClientId(ucIndex);

    /* ??????????????CCA???????????? */
    pstOrigParam->enCallMode  = pstSsCtx->enCModType;
    pstOrigParam->stDataCfg   = pstSsCtx->stCbstDataCfg;
    pstOrigParam->enClirCfg   = pstSsCtx->ucClirType;
    pstOrigParam->stCugCfg    = pstSsCtx->stCcugCfg;
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, End */

    /* ????<dial_string> */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return VOS_ERR;
    }
    else
    {
        /* Modified by n00269697 for V3R3C60_eCall????, 2014-3-29, begin */
        if (VOS_OK !=  AT_FillCalledNumPara(gastAtParaList[0].aucPara,
                                            gastAtParaList[0].usParaLen,
                                            &pstOrigParam->stDialNumber))
        {
            return VOS_ERR;
        }
        /* Modified by n00269697 for V3R3C60_eCall????, 2014-3-29, end */
    }

    /* ???????????????????????? */
    if (gastAtParaList[1].usParaLen > MN_CALL_MAX_SUBADDR_INFO_LEN)
    {
        return VOS_ERR;
    }

    /* ????<sub_string> */
    if (0 != gastAtParaList[1].usParaLen)
    {
        pstOrigParam->stSubaddr.IsExist       = VOS_TRUE;

        /* ?????? = ???????????????? + Octet3??????*/
        pstOrigParam->stSubaddr.LastOctOffset = (VOS_UINT8)gastAtParaList[1].usParaLen + sizeof(pstOrigParam->stSubaddr.Octet3);
        pstOrigParam->stSubaddr.Octet3        = (0x80 | (MN_CALL_SUBADDR_NSAP << 4));
        PS_MEM_CPY(pstOrigParam->stSubaddr.SubAddrInfo,
                   gastAtParaList[1].aucPara,
                   gastAtParaList[1].usParaLen);
    }

    /* ????<I><G><call_type><voice_domain>???? */
    if (0 != gastAtParaList[2].usParaLen)
    {
        if (0 == gastAtParaList[2].ulParaValue)
        {
            pstOrigParam->enClirCfg = AT_CLIR_INVOKE;
        }
        else if (1 == gastAtParaList[2].ulParaValue)
        {
            pstOrigParam->enClirCfg = AT_CLIR_SUPPRESS;
        }
        else
        {
            return VOS_ERR;
        }
    }

    if (0 != gastAtParaList[3].usParaLen)
    {
        pstOrigParam->stCugCfg.bEnable    = gastAtParaList[3].ulParaValue;
    }

    if (0 != gastAtParaList[4].usParaLen)
    {
        pstOrigParam->enCallType          = (VOS_UINT8)gastAtParaList[4].ulParaValue;
    }

    if (0 != gastAtParaList[5].usParaLen)
    {
        pstOrigParam->enVoiceDomain       = (VOS_UINT8)gastAtParaList[5].ulParaValue;
    }

    return VOS_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetApdsPara
 ????????  : ^APDS=<dial_string>,<sub_string>,<I>,<G>,<call_type>????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??09??18??
    ??    ??   : y00213812
    ????????   : STK&DCM ????????????

  2.??    ??   : 2013??2??21??
    ??    ??   : l60609
    ????????   : DSDA PHASE III
*****************************************************************************/
VOS_UINT32 AT_SetApdsPara(VOS_UINT8 ucIndex)
{
    MN_CALL_ORIG_PARAM_STRU             stOrigParam;
    VOS_UINT32                          ulRelt;

    /* ?????? */
    PS_MEM_SET(&stOrigParam, 0x00, sizeof(MN_CALL_ORIG_PARAM_STRU));

    /* Modified by l60609 for DSDA Phase III, 2013-2-21, Begin */
    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        AT_SetCsCallErrCause(ucIndex, TAF_CS_CAUSE_INVALID_PARAMETER);
        return AT_CME_INCORRECT_PARAMETERS;
    }

     /* ???????? */
    if (gucAtParaIndex > 6)
    {
        AT_SetCsCallErrCause(ucIndex, TAF_CS_CAUSE_INVALID_PARAMETER);
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????????????? */
    ulRelt = AT_FillApdsPara(ucIndex, &stOrigParam);
    if (VOS_OK != ulRelt)
    {
        AT_SetCsCallErrCause(ucIndex, TAF_CS_CAUSE_INVALID_PARAMETER);
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if (AT_SUCCESS == MN_CALL_Orig(gastAtClientTab[ucIndex].usClientId,
                                  0,
                                  &gastAtClientTab[ucIndex].AtCallInfo.CallId,
                                  &stOrigParam))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_APDS_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        AT_SetCsCallErrCause(ucIndex, TAF_CS_CAUSE_UNKNOWN);
        return AT_ERROR;
    }
    /* Modified by l60609 for DSDA Phase III, 2013-2-21, End */
}

/*****************************************************************************
 ?? ?? ??  : AT_SetClprPara
 ????????  : ^CLPR=<call_id>????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??09??18??
    ??    ??   : y00213812
    ????????   : STK&DCM ????????????

*****************************************************************************/
VOS_UINT32 AT_SetClprPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulResult;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if (1 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????AT_CALL_CLPR_GET_REQ??C??,  */
    ulResult = MN_CALL_SendAppRequest(MN_CALL_APP_CLPR_GET_REQ,
                                      gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      (MN_CALL_ID_T)gastAtParaList[0].ulParaValue,
                                      VOS_NULL_PTR);

    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetClprPara: MN_CALL_SendAppRequest fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CLPR_SET;

    return AT_WAIT_ASYNC_RETURN;

}


/*****************************************************************************
 ?? ?? ??  : AT_SetCLteRoamAllowPara
 ????????  : ^CLTEROAMALLOW=<roam>????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??12??19??
    ??    ??   : l00171473
    ????????   : DTS2012121803877, ????AT????????LTE??????????????????

  2.??    ??   : 2013??5??17??
    ??    ??   : l00167671
    ????????   : NV??????????, ??NV??????????????????

  3.??    ??   : 2013??10??9??
    ??    ??   : z00234330
    ????????   : DTS201300600336,??????????????????????2????,??????????22????????????????
*****************************************************************************/
VOS_UINT32 AT_SetCLteRoamAllowPara(VOS_UINT8 ucIndex)
{
    NAS_MMC_NVIM_LTE_INTERNATIONAL_ROAM_CFG_STRU  stNvimLteRoamAllowedFlg;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (1 != gucAtParaIndex)
    {
        return AT_ERROR;
    }

    stNvimLteRoamAllowedFlg.ucLteRoamAllowedFlg = (VOS_UINT8)gastAtParaList[0].ulParaValue;
    stNvimLteRoamAllowedFlg.aucReserve[0]       = 0x00;

    /* ??NV:en_NV_Item_Lte_Internation_Roam_Config,
       ??NV???????? NAS_MMC_NVIM_LTE_INTERNATIONAL_ROAM_CFG_STRU, ??????1?????? */
    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_Lte_Internation_Roam_Config,
                          &(stNvimLteRoamAllowedFlg),
                          sizeof(VOS_UINT16)))
    {
        AT_ERR_LOG("AT_SetCLteRoamAllowPara:Write NV fail");
        return AT_ERROR;
    }
    else
    {
        return AT_OK;
    }

}


/*****************************************************************************
?? ?? ??  : At_SetWlthresholdcfgPara
????????  : ^WLTHRESHOLDCFG=<W_RSCP>,<W_ECN0>,<W_RSRP_OFFSET>,<W_RSRQ_OFFSET>,<L_RSRP>,<L_RSRQ>,<L_RSRP_OFFSETL>,<L_ECN0_OFFSET>????????????????
????????  : VOS_UINT8 ucIndex
????????  : ??
?? ?? ??  : VOS_UINT32
????????  :
????????  :

????????      :
1.??    ??   : 2012??12??10??
  ??    ??   : t00212959
  ????????   : DCM ??????????????

*****************************************************************************/
VOS_UINT32 At_SetWlthresholdcfgPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                                              ulResult;
    AT_MTA_RESEL_OFFSET_CFG_SET_NTF_STRU                    stReselOffsetCfgNtf;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if (1 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_SET(&stReselOffsetCfgNtf, 0, sizeof(stReselOffsetCfgNtf));

    stReselOffsetCfgNtf.ucOffsetFlg = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ????????AT_MTA_RESEL_OFFSET_CFG_SET_REQ_STRU*/
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      ID_AT_MTA_RESEL_OFFSET_CFG_SET_NTF,
                                      &stReselOffsetCfgNtf,
                                      sizeof(stReselOffsetCfgNtf),
                                      I0_UEPS_PID_MTA);

    /*L????????*/
    At_SetLWThresholdCfgPara(ucIndex);

    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("At_SetWlthresholdcfgPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    return AT_OK;

}


/*****************************************************************************
 ?? ?? ??  : At_SetSwverPara
 ????????  : ^SWVER,????????????????????
 ????????  : VOS_UINT8 ucIndex  ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32         ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??11??24??
    ??    ??   : S00190137
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 At_SetSwverPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRet;

    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ????????C???????????????????????? */
    ulRet = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   gastAtClientTab[ucIndex].opId,
                                   DRV_AGENT_SWVER_SET_REQ,
                                   VOS_NULL_PTR,
                                   0,
                                   I0_WUEPS_PID_DRV_AGENT);
    if (TAF_SUCCESS != ulRet)
    {
        AT_WARN_LOG("At_SetSwverPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SWVER_SET;
    return AT_WAIT_ASYNC_RETURN;

}

/*****************************************************************************
 ?? ?? ??  : AT_SetCbgPara
 ????????  : ^CBG????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2012??12??28??
    ??    ??   : ????/00214637
    ????????   : ????????????HIFI??????
                 ???? 0 :?????????????? 1 :????????
*****************************************************************************/
VOS_UINT32 AT_SetCbgPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulResult;
    APP_VC_MSG_ENUM_U16                 usMsgName;

    /* ???????? */
    if ( AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if (1 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????VC???????????? */
    if ( 0 == gastAtParaList[0].ulParaValue )
    {
        usMsgName = APP_VC_MSG_SET_FOREGROUND_REQ;
    }
    else
    {
        usMsgName = APP_VC_MSG_SET_BACKGROUND_REQ;
    }

    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      usMsgName,
                                      VOS_NULL_PTR,
                                      0,
                                      I0_WUEPS_PID_VC);

    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetCbgPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CBG_SET;

    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_SndMtaBodySarPara
 ????????  : ??Body SAR??????????MTA????
 ????????  : ucIndex            -- ????????
             enBodySarState     -- Body SAR????
             pstBodySarPara     -- Body SAR??????????????
 ????????  : ??
 ?? ?? ??  : VOS_OK     -- ????????????
             VOS_ERR    -- ????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??03??11??
    ??    ??   : l00198894
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SndMtaBodySarPara(
    VOS_UINT8                           ucIndex,
    AT_MTA_BODY_SAR_STATE_ENUM_UINT16   enBodySarState,
    MTA_BODY_SAR_PARA_STRU             *pstBodySarPara)
{
    VOS_UINT32                          ulResult;
    AT_MTA_BODY_SAR_SET_REQ_STRU        stBodySarSetReq;

    PS_MEM_SET(&stBodySarSetReq, 0, sizeof(stBodySarSetReq));

    /* ?????????????? */
    stBodySarSetReq.enState = enBodySarState;
    PS_MEM_CPY(&stBodySarSetReq.stBodySARPara, pstBodySarPara, sizeof(MTA_BODY_SAR_PARA_STRU));

    /* ????????AT_MTA_BODY_SAR_SET_REQ_STRU */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      ID_AT_MTA_BODY_SAR_SET_REQ,
                                      &stBodySarSetReq,
                                      sizeof(AT_MTA_BODY_SAR_SET_REQ_STRU),
                                      I0_UEPS_PID_MTA);

    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SndMtaBodySarPara: AT_FillAndSndAppReqMsg fail.");
        return VOS_ERR;
    }

    return VOS_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetBodySarOnPara
 ????????  : ^BODYSARON,??????????BODYSAR????
 ????????  : VOS_UINT8 ucIndex  ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32         AT??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??03??11??
    ??    ??   : z00214637
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetBodySarOnPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulResult;
    MTA_BODY_SAR_PARA_STRU              stBodySarPara;

    PS_MEM_SET(&stBodySarPara, 0, sizeof(stBodySarPara));

    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if (1 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????BODYSAR???????? */
    if (g_enAtBodySarState == gastAtParaList[0].ulParaValue)
    {
        return AT_OK;
    }

    /* ????BODYSAR NV?? */
    ulResult = NV_ReadEx(MODEM_ID_0,
                         en_NV_Item_BODY_SAR_PARA,
                         &stBodySarPara,
                         sizeof(MTA_BODY_SAR_PARA_STRU));

    if (NV_OK != ulResult)
    {
        AT_ERR_LOG("AT_SetBodySarOnPara: Read NV fail");
        return AT_ERROR;
    }

    /* ??????????MTA */
    ulResult = AT_SndMtaBodySarPara(ucIndex,
                                    (AT_MTA_BODY_SAR_STATE_ENUM_UINT16)gastAtParaList[0].ulParaValue,
                                    &stBodySarPara);
    if (VOS_OK != ulResult)
    {
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_BODYSARON_SET;
    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_CheckBodySarWcdmaPara
 ????????  : AT^BODYSARWCDMA????????????????????
 ????????  : pstBodySarWcdmaPara    -- ??????????????????????
 ????????  : ??
 ?? ?? ??  : AT_SUCCESS -- ????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??03??11??
    ??    ??   : l00198894
    ????????   : Body SAR????????

*****************************************************************************/
VOS_UINT32 AT_CheckBodySarWcdmaPara(
    AT_BODYSARWCDMA_SET_PARA_STRU      *pstBodySarWcdmaPara)
{
    AT_NV_WG_RF_MAIN_BAND_STRU          stWGBand;
    VOS_UINT8                           ucLoop;
    VOS_UINT32                          ulLen;

    PS_MEM_SET(&stWGBand, 0, sizeof(stWGBand));

    /* ???????????? */
    if ( (gucAtParaIndex < 1)
      || (gucAtParaIndex > AT_BODYSARWCDMA_MAX_PARA_NUM) )
    {
        AT_WARN_LOG1("AT_CheckBodySarWcdmaPara: Para Num Incorrect!", gucAtParaIndex);
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????1?????????????? */
    if (1 == gucAtParaIndex)
    {
        ulLen = VOS_StrLen(AT_RF_BAND_ANY_STR);
        PS_MEM_CPY(gastAtParaList[1].aucPara,
                   AT_RF_BAND_ANY_STR,
                   ulLen);
        gastAtParaList[1].aucPara[ulLen]    = '\0';
        gastAtParaList[1].usParaLen         = (VOS_UINT16)ulLen;
        gucAtParaIndex                      = 2;
    }

    /* ?????????????????? */
    if (0 != (gucAtParaIndex % 2))
    {
        AT_WARN_LOG1("AT_CheckBodySarWcdmaPara: Para Num is not Even!", gucAtParaIndex);
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????WCDMA Band?????? */
    if (NV_OK != NV_ReadEx(MODEM_ID_0,
                           en_NV_Item_WG_RF_MAIN_BAND,
                           &stWGBand,
                           sizeof(stWGBand)))
    {
        AT_ERR_LOG("AT_CheckBodySarWcdmaPara: Read NV fail!");
        return AT_ERROR;
    }

    /* ????????Band?????????????????????????????? */
    pstBodySarWcdmaPara->ucParaNum = 0;
    for (ucLoop = 0; ucLoop < (gucAtParaIndex / 2); ucLoop++)
    {
        /* ??????????????????????16???????????????????? */
        if (AT_SUCCESS != At_String2Hex(gastAtParaList[ucLoop * 2 + 1].aucPara,
                                        gastAtParaList[ucLoop * 2 + 1].usParaLen,
                                        &gastAtParaList[ucLoop * 2 + 1].ulParaValue))
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        /* ????????????????????Band????????????????????????Band?????? */
        if (AT_RF_BAND_ANY == gastAtParaList[ucLoop * 2 + 1].ulParaValue)
        {
            gastAtParaList[ucLoop * 2 + 1].ulParaValue = stWGBand.unWcdmaBand.ulBand;
        }

        /* ?????????????????????????????????????????????????????? */
        if (0 != (gastAtParaList[ucLoop * 2 + 1].ulParaValue & (~stWGBand.unWcdmaBand.ulBand)))
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        pstBodySarWcdmaPara->asPower[pstBodySarWcdmaPara->ucParaNum]    = (VOS_INT16)gastAtParaList[ucLoop * 2].ulParaValue;
        pstBodySarWcdmaPara->aulBand[pstBodySarWcdmaPara->ucParaNum]    = gastAtParaList[ucLoop * 2 + 1].ulParaValue;
        pstBodySarWcdmaPara->ucParaNum++;
    }

    return AT_SUCCESS;
}

/*****************************************************************************
 ?? ?? ??  : AT_FillBodySarWcdmaPara
 ????????  : AT^BODYSARWCDMA??????????????Body SAR??????????
 ????????  : pstBodySarWcdmaPara    -- ??????????????????????
 ????????  : pstBodySarPara         -- Body SAR??????????????
 ?? ?? ??  : VOS_OK     -- ????????????
             VOS_ERR    -- ????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??03??11??
    ??    ??   : l00198894
    ????????   : Body SAR????????

*****************************************************************************/
VOS_UINT32 AT_FillBodySarWcdmaPara(
    AT_BODYSARWCDMA_SET_PARA_STRU      *pstBodySarWcdmaPara,
    MTA_BODY_SAR_PARA_STRU             *pstBodySarPara)
{
    VOS_UINT8                           ucLoop1;
    MTA_WCDMA_BAND_ENUM_UINT16          enLoop2;
    VOS_UINT8                           ucLoop3;

    /* ?????????????????? */
    for (ucLoop1 = 0; ucLoop1 < pstBodySarWcdmaPara->ucParaNum; ucLoop1++)
    {
        /* ????WCDMA Band?????????? */
        for (enLoop2 = MTA_WCDMA_I_2100; enLoop2 < MTA_WCDMA_BAND_BUTT; enLoop2++)
        {
            if (0 == (pstBodySarWcdmaPara->aulBand[ucLoop1] & (0x00000001UL << (enLoop2 - 1))))
            {
                continue;
            }

            for (ucLoop3 = 0; ucLoop3 < pstBodySarPara->usWBandNum; ucLoop3++)
            {
                if (enLoop2 == pstBodySarPara->astWBandPara[ucLoop3].enBand)
                {
                    break;
                }
            }

            if (ucLoop3 == pstBodySarPara->usWBandNum)
            {
                /* ??????W Band???????????????????????? */
                if (MTA_BODY_SAR_WBAND_MAX_NUM <= pstBodySarPara->usWBandNum)
                {
                    AT_ERR_LOG("AT_FillBodySarWcdmaPara: Too Many W Band!");
                    return VOS_ERR;
                }

                pstBodySarPara->usWBandNum++;
            }

            pstBodySarPara->astWBandPara[ucLoop3].enBand = enLoop2;
            pstBodySarPara->astWBandPara[ucLoop3].sPower = pstBodySarWcdmaPara->asPower[ucLoop1];
        }
    }

    return VOS_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetBodySarWcdmaPara
 ????????  : AT^BODYSARWCDMA????????????????
 ????????  : VOS_UINT8 ucIndex  ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32         AT??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??03??11??
    ??    ??   : l00198894
    ????????   : Body SAR????????

*****************************************************************************/
VOS_UINT32 AT_SetBodySarWcdmaPara(VOS_UINT8 ucIndex)
{
    MTA_BODY_SAR_PARA_STRU              stBodySarPara;
    AT_BODYSARWCDMA_SET_PARA_STRU       stBodySarWcdmaPara;
    VOS_UINT32                          ulResult;

    PS_MEM_SET(&stBodySarPara, 0, sizeof(stBodySarPara));
    PS_MEM_SET(&stBodySarWcdmaPara, 0, sizeof(stBodySarWcdmaPara));

    /* ?????????????? */
    ulResult = AT_CheckBodySarWcdmaPara(&stBodySarWcdmaPara);
    if (AT_SUCCESS != ulResult)
    {
        return ulResult;
    }

    /* ??NV????????Body SAR?????????? */
    if (NV_OK != NV_ReadEx(MODEM_ID_0,
                           en_NV_Item_BODY_SAR_PARA,
                           &stBodySarPara,
                           sizeof(stBodySarPara)))
    {
        AT_ERR_LOG("AT_SetBodysarWcdmaPara: Read NV fail!");
        return AT_ERROR;
    }

    /* ??WCDMA????????????????Body SAR???????????? */
    if (VOS_OK != AT_FillBodySarWcdmaPara(&stBodySarWcdmaPara, &stBodySarPara))
    {
        return AT_ERROR;
    }

    /* ??Body SAR????????????????NV */
    if (NV_OK != NV_WriteEx(MODEM_ID_0,
                            en_NV_Item_BODY_SAR_PARA,
                            &(stBodySarPara),
                            sizeof(stBodySarPara)))
    {
        AT_ERR_LOG("AT_SetBodysarWcdmaPara: Write NV fail!");
        return AT_ERROR;
    }

    /* ??????????????Body SAR??????????????????????Body SAR???? */
    if (AT_MTA_BODY_SAR_ON == g_enAtBodySarState)
    {
        if (VOS_OK != AT_SndMtaBodySarPara(ucIndex,
                                           g_enAtBodySarState,
                                           &stBodySarPara))
        {
            AT_WARN_LOG("AT_SetBodySarWcdmaPara: AT_SndMtaBodySarPara fail!");
        }
    }

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_GetGsmBandCapa
 ????????  : ????GSM??????????
 ????????  : ??
 ????????  : pulGBand   -- GSM??????????????
 ?? ?? ??  : VOS_OK     -- ????????????
             VOS_ERR    -- ????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??03??11??
    ??    ??   : l00198894
    ????????   : Body SAR????????

*****************************************************************************/
VOS_UINT32 AT_GetGsmBandCapa(VOS_UINT32 *pulGBand)
{
    AT_NV_WG_RF_MAIN_BAND_STRU          stWGBand;

    PS_MEM_SET(&stWGBand, 0, sizeof(stWGBand));
    *pulGBand = 0;

    /* ??NV?????????????????????? */
    if (NV_OK != NV_ReadEx(MODEM_ID_0,
                           en_NV_Item_WG_RF_MAIN_BAND,
                           &stWGBand,
                           sizeof(stWGBand)))
    {
        AT_ERR_LOG("AT_GetGsmBandCapa: Read NV fail!");
        return VOS_ERR;
    }

    if (VOS_TRUE == stWGBand.unGsmBand.BitBand.BandGsm850)
    {
        *pulGBand |= AT_BODY_SAR_GBAND_GPRS_850_MASK;
        *pulGBand |= AT_BODY_SAR_GBAND_EDGE_850_MASK;
    }

    if ( (VOS_TRUE == stWGBand.unGsmBand.BitBand.BandGsmP900)
      || (VOS_TRUE == stWGBand.unGsmBand.BitBand.BandGsmR900)
      || (VOS_TRUE == stWGBand.unGsmBand.BitBand.BandGsmE900) )
    {
        *pulGBand |= AT_BODY_SAR_GBAND_GPRS_900_MASK;
        *pulGBand |= AT_BODY_SAR_GBAND_EDGE_900_MASK;
    }

    if (VOS_TRUE == stWGBand.unGsmBand.BitBand.BandGsm1800)
    {
        *pulGBand |= AT_BODY_SAR_GBAND_GPRS_1800_MASK;
        *pulGBand |= AT_BODY_SAR_GBAND_EDGE_1800_MASK;
    }

    if (VOS_TRUE == stWGBand.unGsmBand.BitBand.BandGsm1900)
    {
        *pulGBand |= AT_BODY_SAR_GBAND_GPRS_1900_MASK;
        *pulGBand |= AT_BODY_SAR_GBAND_EDGE_1900_MASK;
    }

    return VOS_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_CheckBodySarGsmPara
 ????????  : AT^BODYSARGSM????????????????????
 ????????  : pstBodySarGsmPara    -- ??????????????????????
 ????????  : ??
 ?? ?? ??  : AT_SUCCESS -- ????????????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??03??11??
    ??    ??   : l00198894
    ????????   : Body SAR????????

*****************************************************************************/
VOS_UINT32 AT_CheckBodySarGsmPara(
    AT_BODYSARGSM_SET_PARA_STRU        *pstBodySarGsmPara)
{
    VOS_UINT32                          ulGBand;
    VOS_UINT8                           ucLoop;
    VOS_UINT32                          ulLen;

    ulGBand         = 0;

    /* ???????????? */
    if ( (gucAtParaIndex < 1)
      || (gucAtParaIndex > AT_BODYSARGSM_MAX_PARA_NUM) )
    {
        AT_WARN_LOG1("AT_CheckBodySarGsmPara: Para Num Incorrect!", gucAtParaIndex);
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????1?????????????? */
    if (1 == gucAtParaIndex)
    {
        ulLen = VOS_StrLen(AT_RF_BAND_ANY_STR);
        PS_MEM_CPY(gastAtParaList[1].aucPara,
                   AT_RF_BAND_ANY_STR,
                   ulLen);
        gastAtParaList[1].aucPara[ulLen]    = '\0';
        gastAtParaList[1].usParaLen         = (VOS_UINT16)ulLen;
        gucAtParaIndex                      = 2;
    }

    /* ?????????????????? */
    if (0 != (gucAtParaIndex % 2))
    {
        AT_WARN_LOG1("AT_CheckBodySarGsmPara: Para Num is not Even!", gucAtParaIndex);
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????GSM Band?????? */
    if (VOS_OK != AT_GetGsmBandCapa(&ulGBand))
    {
        return AT_ERROR;
    }

    /* ????????Band?????????????????????????????? */
    pstBodySarGsmPara->ucParaNum = 0;
    for (ucLoop = 0; ucLoop < (gucAtParaIndex / 2); ucLoop++)
    {
        /* ??????????????????????16???????????????????? */
        if (AT_SUCCESS != At_String2Hex(gastAtParaList[ucLoop * 2 + 1].aucPara,
                                        gastAtParaList[ucLoop * 2 + 1].usParaLen,
                                        &gastAtParaList[ucLoop * 2 + 1].ulParaValue))
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        /* ????????????????????Band????????????????????????Band?????? */
        if (AT_RF_BAND_ANY == gastAtParaList[ucLoop * 2 + 1].ulParaValue)
        {
            gastAtParaList[ucLoop * 2 + 1].ulParaValue = ulGBand;
        }

        /* ?????????????????????????????????????????????????????? */
        if (0 != (gastAtParaList[ucLoop * 2 + 1].ulParaValue & (~ulGBand)))
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        pstBodySarGsmPara->asPower[pstBodySarGsmPara->ucParaNum]    = (VOS_INT16)gastAtParaList[ucLoop * 2].ulParaValue;
        pstBodySarGsmPara->aulBand[pstBodySarGsmPara->ucParaNum]    = gastAtParaList[ucLoop * 2 + 1].ulParaValue;
        pstBodySarGsmPara->ucParaNum++;
    }

    return AT_SUCCESS;
}

/*****************************************************************************
 ?? ?? ??  : AT_FillBodySarGsmPara
 ????????  : AT^BODYSARGSM??????????????Body SAR??????????
 ????????  : pstBodySarGsmPara      -- ??????????????????????
 ????????  : pstBodySarPara         -- Body SAR??????????????
 ?? ?? ??  : ??
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??03??11??
    ??    ??   : l00198894
    ????????   : Body SAR????????

*****************************************************************************/
VOS_VOID AT_FillBodySarGsmPara(
    AT_BODYSARGSM_SET_PARA_STRU        *pstBodySarGsmPara,
    MTA_BODY_SAR_PARA_STRU             *pstBodySarPara)
{
    VOS_UINT8                           ucLoop;

    /* ?????????????????? */
    for (ucLoop = 0; ucLoop < pstBodySarGsmPara->ucParaNum; ucLoop++)
    {
        if (0 != (AT_BODY_SAR_GBAND_GPRS_850_MASK & pstBodySarGsmPara->aulBand[ucLoop]))
        {
            pstBodySarPara->ulGBandMask |= AT_BODY_SAR_GBAND_GPRS_850_MASK;
            pstBodySarPara->astGBandPara[AT_GSM_850].sGPRSPower = pstBodySarGsmPara->asPower[ucLoop];
        }

        if (0 != (AT_BODY_SAR_GBAND_EDGE_850_MASK & pstBodySarGsmPara->aulBand[ucLoop]))
        {
            pstBodySarPara->ulGBandMask |= AT_BODY_SAR_GBAND_EDGE_850_MASK;
            pstBodySarPara->astGBandPara[AT_GSM_850].sEDGEPower = pstBodySarGsmPara->asPower[ucLoop];
        }

        if (0 != (AT_BODY_SAR_GBAND_GPRS_900_MASK & pstBodySarGsmPara->aulBand[ucLoop]))
        {
            pstBodySarPara->ulGBandMask |= AT_BODY_SAR_GBAND_GPRS_900_MASK;
            pstBodySarPara->astGBandPara[AT_GSM_900].sGPRSPower = pstBodySarGsmPara->asPower[ucLoop];
        }

        if (0 != (AT_BODY_SAR_GBAND_EDGE_900_MASK & pstBodySarGsmPara->aulBand[ucLoop]))
        {
            pstBodySarPara->ulGBandMask |= AT_BODY_SAR_GBAND_EDGE_900_MASK;
            pstBodySarPara->astGBandPara[AT_GSM_900].sEDGEPower = pstBodySarGsmPara->asPower[ucLoop];
        }

        if (0 != (AT_BODY_SAR_GBAND_GPRS_1800_MASK & pstBodySarGsmPara->aulBand[ucLoop]))
        {
            pstBodySarPara->ulGBandMask |= AT_BODY_SAR_GBAND_GPRS_1800_MASK;
            pstBodySarPara->astGBandPara[AT_GSM_1800].sGPRSPower = pstBodySarGsmPara->asPower[ucLoop];
        }

        if (0 != (AT_BODY_SAR_GBAND_EDGE_1800_MASK & pstBodySarGsmPara->aulBand[ucLoop]))
        {
            pstBodySarPara->ulGBandMask |= AT_BODY_SAR_GBAND_EDGE_1800_MASK;
            pstBodySarPara->astGBandPara[AT_GSM_1800].sEDGEPower = pstBodySarGsmPara->asPower[ucLoop];
        }

        if (0 != (AT_BODY_SAR_GBAND_GPRS_1900_MASK & pstBodySarGsmPara->aulBand[ucLoop]))
        {
            pstBodySarPara->ulGBandMask |= AT_BODY_SAR_GBAND_GPRS_1900_MASK;
            pstBodySarPara->astGBandPara[AT_GSM_1900].sGPRSPower = pstBodySarGsmPara->asPower[ucLoop];
        }

        if (0 != (AT_BODY_SAR_GBAND_EDGE_1900_MASK & pstBodySarGsmPara->aulBand[ucLoop]))
        {
            pstBodySarPara->ulGBandMask |= AT_BODY_SAR_GBAND_EDGE_1900_MASK;
            pstBodySarPara->astGBandPara[AT_GSM_1900].sEDGEPower = pstBodySarGsmPara->asPower[ucLoop];
        }
    }

    return;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetBodySarGsmPara
 ????????  : AT^BODYSARGSM????????????????
 ????????  : VOS_UINT8 ucIndex  ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32         AT??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??03??11??
    ??    ??   : l00198894
    ????????   : Body SAR????????

*****************************************************************************/
VOS_UINT32 AT_SetBodySarGsmPara(VOS_UINT8 ucIndex)
{
    MTA_BODY_SAR_PARA_STRU              stBodySarPara;
    AT_BODYSARGSM_SET_PARA_STRU         stBodySarGsmPara;
    VOS_UINT32                          ulResult;

    PS_MEM_SET(&stBodySarPara, 0, sizeof(stBodySarPara));
    PS_MEM_SET(&stBodySarGsmPara, 0, sizeof(stBodySarGsmPara));

    /* ?????????????? */
    ulResult = AT_CheckBodySarGsmPara(&stBodySarGsmPara);
    if (AT_SUCCESS != ulResult)
    {
        return ulResult;
    }

    /* ??NV????????Body SAR?????????? */
    if (NV_OK != NV_ReadEx(MODEM_ID_0,
                           en_NV_Item_BODY_SAR_PARA,
                           &stBodySarPara,
                           sizeof(stBodySarPara)))
    {
        AT_ERR_LOG("AT_SetBodySarGsmPara: Read NV fail!");
        return AT_ERROR;
    }

    /* ??GSM????????????????Body SAR???????????? */
    AT_FillBodySarGsmPara(&stBodySarGsmPara, &stBodySarPara);

    /* ??Body SAR????????????????NV */
    if (NV_OK != NV_WriteEx(MODEM_ID_0,
                            en_NV_Item_BODY_SAR_PARA,
                            &(stBodySarPara),
                            sizeof(stBodySarPara)))
    {
        AT_ERR_LOG("AT_SetBodySarGsmPara: Write NV fail!");
        return AT_ERROR;
    }

    /* ??????????????Body SAR??????????????????????Body SAR???? */
    if (AT_MTA_BODY_SAR_ON == g_enAtBodySarState)
    {
        if (VOS_OK != AT_SndMtaBodySarPara(ucIndex,
                                           g_enAtBodySarState,
                                           &stBodySarPara))
        {
            AT_WARN_LOG("AT_SetBodySarGsmPara: AT_SndMtaBodySarPara fail!");
        }
    }

    return AT_OK;
}

/* Added by f62575 for SS FDN&Call Control, 2013-05-06, begin */
/*****************************************************************************
 ?? ?? ??  : AT_SetCopnPara
 ????????  : +COPN????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??05??06??
    ??    ??   : f62575
    ????????   : SS FDN&Call Control??????????+COPN????
  2.??    ??   : 2015??03??24??
    ??    ??   : K00902809
    ????????   : Added seperate function TAF_MMA_QryCopnInfoReq to send message to MMA
*****************************************************************************/
VOS_UINT32 AT_SetCopnPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRet;
    VOS_UINT16                          usFromIndex = 0;

    /* Modified by k902809 for Iteration 11, 2015-3-24, begin */
    /* ???????? */
    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }
    ulRet = TAF_MMA_QryCopnInfoReq(WUEPS_PID_AT,
                                   gastAtClientTab[ucIndex].usClientId,
                                   usFromIndex,
                                   0);
    if (VOS_TRUE != ulRet)
    {
        return AT_ERROR;
    }
    /* Modified by k902809 for Iteration 11, Iteration 11 2015-3-24, end */

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_COPN_QRY;

    return AT_WAIT_ASYNC_RETURN;

}
/* Added by f62575 for SS FDN&Call Control, 2013-05-06, end */
/*****************************************************************************
 ?? ?? ??  : AT_SetHistoryFreqPara
 ????????  : ^CHISFREQ????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2016??02??04??
    ??    ??   : y00358807
    ????????   : for CSG:????^CHISFREQ????????
*****************************************************************************/
VOS_UINT32 AT_SetHistoryFreqPara(VOS_UINT8 ucIndex)
{
    AT_MTA_CLEAR_HISTORY_FREQ_REQ_STRU                      stAtCmd;
    VOS_UINT32                                              ulResult;

    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (gucAtParaIndex > 1)
    {
        return AT_TOO_MANY_PARA;
    }

    if (0 == gastAtParaList[0].usParaLen)
    {
        AT_WARN_LOG("AT_SetHistoryFreqPara: WARNING:Input Len invalid!");
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_SET(&stAtCmd, 0x00, sizeof(stAtCmd));
    stAtCmd.enMode    = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ??MTA????^CHISFREQ???????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_CLEAR_HISTORY_FREQ_REQ,
                                   &stAtCmd,
                                   sizeof(AT_MTA_CLEAR_HISTORY_FREQ_REQ_STRU),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS != ulResult)
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CLEAR_HISTORY_FREQ;

    return AT_WAIT_ASYNC_RETURN;

}

/*****************************************************************************
 ?? ?? ??  : AT_SetNCellMonitorPara
 ????????  : ^NCELLMONITOR????????????????,1:??????????????????0:????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??05??31??
    ??    ??   : s00217060
    ????????   : for V9R1_SVLTE:????^NCELLMONITOR????????
*****************************************************************************/
VOS_UINT32 AT_SetNCellMonitorPara(VOS_UINT8 ucIndex)
{
    AT_MTA_NCELL_MONITOR_SET_REQ_STRU                       stAtCmd;
    VOS_UINT32                                              ulResult;

    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (gucAtParaIndex > 1)
    {
        return AT_TOO_MANY_PARA;
    }

    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_SET(&stAtCmd, 0x00, sizeof(stAtCmd));
    stAtCmd.ucSwitch    = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ??MTA????^NCELLMONITOR???????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_NCELL_MONITOR_SET_REQ,
                                   &stAtCmd,
                                   sizeof(AT_MTA_NCELL_MONITOR_SET_REQ_STRU),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS != ulResult)
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_NCELL_MONITOR_SET;

    return AT_WAIT_ASYNC_RETURN;

}


/*****************************************************************************
 ?? ?? ??  : At_SetSimInsertPara
 ????????  : ????SIM????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??7??4??
    ??    ??   : s00190137
    ????????   : ??????????

  2.??    ??   : 2015??3??24??
    ??    ??   : K00902809
    ????????   : Added function TAF_MMA_SimInsertReq

*****************************************************************************/
VOS_UINT32 At_SetSimInsertPara(VOS_UINT8 ucIndex)
{
    TAF_SIM_INSERT_STATE_ENUM_UINT32    enSimInsertState;
    VOS_UINT32                          ulResult;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (1 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (gastAtParaList[0].ulParaValue > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    enSimInsertState = (TAF_SIM_INSERT_STATE_ENUM_UINT32)gastAtParaList[0].ulParaValue;

    /* Modified by k902809 for Iteration 11, 2015-3-24, begin */

    ulResult = TAF_MMA_SimInsertReq(WUEPS_PID_AT,
                                    gastAtClientTab[ucIndex].usClientId,
                                    gastAtClientTab[ucIndex].opId,
                                    enSimInsertState);
    if (VOS_TRUE == ulResult)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SIMINSERT_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
    /* Modified by k902809 for Iteration 11, Iteration 11 2015-3-24, end */

}

/*****************************************************************************
 ?? ?? ??  : At_SetModemLoopPara
 ????????  : ????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??7??5??
    ??    ??   : s00190137
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 At_SetModemLoopPara(VOS_UINT8 ucIndex)
{

    VOS_UINT32                          ulResult;
    VOS_UINT8                           ucModemLoop;

    /* ???????? */
    if ( AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if (1 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ucModemLoop = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    ulResult = APP_VC_SetModemLoop(gastAtClientTab[ucIndex].usClientId,
                                   gastAtClientTab[ucIndex].opId,
                                   ucModemLoop);
    if (TAF_SUCCESS == ulResult)
    {
        return AT_OK;    /* ????????????????C????????????????OK */
    }
    else
    {
        return AT_ERROR;
    }

}

/*****************************************************************************
 ?? ?? ??  : At_SetReleaseRrc
 ????????  : ????????rrc????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??7??11??
    ??    ??   : M00217266
    ????????  : Optimize RIL:

*****************************************************************************/
VOS_UINT32 At_SetReleaseRrc(VOS_UINT8 ucIndex)
{
    VOS_UINT8                              *pucSystemAppConfig;

    /* ????NV???????????????? */
    pucSystemAppConfig = AT_GetSystemAppConfigAddr();

    /* ??ANDROID?????????? */
    if ( SYSTEM_APP_ANDROID != *pucSystemAppConfig)
    {
        return AT_CMD_NOT_SUPPORT;
    }

    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (VOS_OK == At_SndReleaseRrcReq(gastAtClientTab[ucIndex].usClientId,
                                          gastAtClientTab[ucIndex].opId))
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_RELEASE_RRC_SET;

        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_SetRefclkfreqPara
 ????????  : ????GPS????????????????????AT^REFCLKFREQ????????????
 ????????  : ucIndex    -- AT????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??07??22??
    ??    ??   : l00198894
    ????????   : V9R1 AGPS
*****************************************************************************/
VOS_UINT32 AT_SetRefclkfreqPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulResult;
    AT_MTA_REFCLKFREQ_SET_REQ_STRU      stRefClockReq;

    /* ???????? */
    if (VOS_FALSE == AT_IsApPort(ucIndex))
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (1 != gucAtParaIndex)
    {
        return AT_ERROR;
    }

    /* ?????? */
    PS_MEM_SET(&stRefClockReq, 0, sizeof(stRefClockReq));

    stRefClockReq.enRptFlg = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ??????????????C??, ????GPS???????????????????????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      ID_AT_MTA_REFCLKFREQ_SET_REQ,
                                      &stRefClockReq,
                                      sizeof(stRefClockReq),
                                      I0_UEPS_PID_MTA);

    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetRefclkfreqPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_REFCLKFREQ_SET;

    return AT_WAIT_ASYNC_RETURN;
}


/* Added by d0212987 for OM output log , 2013-6-4, begin */
/*****************************************************************************
 ?? ?? ??  : At_SetPullomlogrrcPara
 ????????  : ^PULLOMLOG????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??07??27??
    ??    ??   : d00212987
    ????????   : ????????
*****************************************************************************/
VOS_UINT32 At_SetPullomlogrrcPara(VOS_UINT8 ucIndex)
{
    /* Added by wx270776 for OM????, 2015-7-25, begin */
    (VOS_VOID)DIAG_LogShowToFile((VOS_BOOL)VOS_TRUE);
    /* Added by wx270776 for OM????, 2015-7-25, end */

    return AT_OK;
}
/* Added by d0212987 for OM output log, 2013-6-4, end */

/* Added by d0212987 for read die id and chip id, 2013-6-4, begin */
/*****************************************************************************
 ?? ?? ??  : At_SetDieSNPara
 ????????  : ^DIESN ???????????? DIE SN 20??????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??07??27??
    ??    ??   : d00212987
    ????????   : ????????
*****************************************************************************/
VOS_UINT32 At_SetDieSNPara(VOS_UINT8 ucIndex)
{
    VOS_UINT8                           aucDieSN[AT_DIE_SN_LEN];
    VOS_INT32                           i;
    VOS_UINT16                          usLength;

    PS_MEM_SET(aucDieSN, 0, sizeof(aucDieSN));

    /* ???????? */
    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ????DIE SN */
    if (VOS_OK != mdrv_efuse_get_dieid(aucDieSN, AT_DIE_SN_LEN))
    {
        return AT_ERROR;
    }

    /* ??????,??4 BIT??0 */
    aucDieSN[AT_DIE_SN_LEN -1] = (aucDieSN[AT_DIE_SN_LEN -1] & 0x0F);

    /* ?????????????????? */
    usLength = (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                      (VOS_CHAR *)pgucAtSndCodeAddr,
                                      (VOS_CHAR *)pgucAtSndCodeAddr,
                                      "%s: 0x",
                                      g_stParseContext[ucIndex].pstCmdElement->pszCmdName);

    for (i = (AT_DIE_SN_LEN-1); i>=0; i--)
    {
        usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                      (VOS_CHAR *)pgucAtSndCodeAddr,
                                      (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                      "%02x",
                                      aucDieSN[i]);
    }

    gstAtSendData.usBufLen = usLength;

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_SetChipSNPara
 ????????  : ^CHIPSN ????????????,CHIP SN 8??????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??07??27??
    ??    ??   : d00212987
    ????????   : ????????
  2.??    ??   : 2015??4??2??
    ??    ??   : w00316404
    ????????   : clean coverity
*****************************************************************************/
VOS_UINT32 At_SetChipSNPara(VOS_UINT8 ucIndex)
{
    VOS_UINT8                           aucChipSN[AT_CHIP_SN_LEN];
    VOS_INT32                           i;
    VOS_UINT16                          usLength;

    PS_MEM_SET(aucChipSN, 0, sizeof(aucChipSN));

    /* ???????? */
    if (AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ????CHIP SN */
    if (VOS_OK != mdrv_efuse_get_chipid(aucChipSN, AT_CHIP_SN_LEN))
    {
        return AT_ERROR;
    }

    /* ?????????????????? */
    usLength = (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                      (VOS_CHAR *)pgucAtSndCodeAddr,
                                      (VOS_CHAR *)pgucAtSndCodeAddr,
                                      "%s: 0x",
                                      g_stParseContext[ucIndex].pstCmdElement->pszCmdName);

    for (i = (AT_CHIP_SN_LEN-1); i>=0; i--)
    {

        usLength += (VOS_UINT16)At_sprintf(AT_CMD_MAX_LEN,
                                      (VOS_CHAR *)pgucAtSndCodeAddr,
                                      (VOS_CHAR *)pgucAtSndCodeAddr + usLength,
                                      "%02x",
                                      aucChipSN[i]);
    }

    gstAtSendData.usBufLen = usLength;

    return AT_OK;
}
/* Added by d0212987 for read die id and chip id, 2013-6-4, end */
/*****************************************************************************
 ?? ?? ??  : At_SetHandleDect
 ????????  : ??ap????????????????????????cp??
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??8??8??
    ??    ??   : M00217266
    ????????   : AP Sensor:

*****************************************************************************/
VOS_UINT32 At_SetHandleDect(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;
    VOS_UINT8                           ucHandleType;
    VOS_UINT8                          *pucSystemAppConfig;

    /* ????NV???????????????? */
    pucSystemAppConfig = AT_GetSystemAppConfigAddr();

    /* ??????????????phone??pad????cp??????????????ANDROID?????????? */
    if ( SYSTEM_APP_ANDROID != *pucSystemAppConfig )
    {
        return AT_CMD_NOT_SUPPORT;
    }

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_TOO_MANY_PARA;
    }

    /* ???????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_ERROR;
    }

    /* handletype ???????? */
    if (gastAtParaList[0].ulParaValue > AT_MTA_HANDLEDECT_MAX_TYPE)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ucHandleType = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ???????? ID_AT_MTA_HANDLEDECT_SET_REQ ??MTA??????????????????(VOS_UINT8)gastAtParaList[0].ulParaValue */
    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   At_GetOpId(),
                                   ID_AT_MTA_HANDLEDECT_SET_REQ,
                                   (VOS_VOID*)&ucHandleType,
                                   sizeof(ucHandleType),
                                   I0_UEPS_PID_MTA);

    if (AT_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_HANDLEDECT_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCiregPara
 ????????  : +CIREG=<n>????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??09??18??
    ??    ??   : Y00213812
    ????????   : ????????

*****************************************************************************/
TAF_UINT32 AT_SetCiregPara(TAF_UINT8 ucIndex)
{

    AT_IMSA_CIREG_SET_REQ_STRU          stCireg;
    VOS_UINT32                          ulResult;

    PS_MEM_SET(&stCireg, 0x00, sizeof(AT_IMSA_CIREG_SET_REQ_STRU));

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????? */
    if(0 != gastAtParaList[0].usParaLen)
    {
        stCireg.enCireg = gastAtParaList[0].ulParaValue;

    }
    else
    {
        /* ?????????????????????????????????? */
        stCireg.enCireg = AT_IMSA_IMS_REG_STATE_DISABLE_REPORT;
    }


    /* ??IMSA????+CIREG???????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                     0,
                                     ID_AT_IMSA_CIREG_SET_REQ,
                                     &stCireg.enCireg,
                                     sizeof(AT_IMSA_IMS_REG_STATE_REPORT_ENUM_UINT32),
                                     PS_PID_IMSA);

    if (TAF_SUCCESS != ulResult)
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CIREG_SET;

    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCirepPara
 ????????  : +CIREP=<reporting>????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??09??18??
    ??    ??   : Y00213812
    ????????   : ????????

*****************************************************************************/
TAF_UINT32 AT_SetCirepPara(TAF_UINT8 ucIndex)
{

    AT_IMSA_CIREP_SET_REQ_STRU          stCirep;
    VOS_UINT32                          ulResult;

    PS_MEM_SET(&stCirep, 0x00, sizeof(AT_IMSA_CIREP_SET_REQ_STRU));

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????? */
    if(0 != gastAtParaList[0].usParaLen)
    {
        stCirep.enReport = gastAtParaList[0].ulParaValue;

    }
    else
    {
        /* ?????????????????????????????????? */
        stCirep.enReport = AT_IMSA_CIREP_REPORT_DISENABLE;
    }


    /* ??IMSA????+CIREG???????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                     0,
                                     ID_AT_IMSA_CIREP_SET_REQ,
                                     &stCirep.enReport,
                                     sizeof(AT_IMSA_CIREP_REPORT_ENUM_UINT32),
                                     PS_PID_IMSA);

    if (TAF_SUCCESS != ulResult)
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CIREP_SET;

    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetVolteimpuPara
 ????????  : ^VOLTEIMPU????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2014??01??07??
    ??    ??   : c64416
    ????????   : ????????

*****************************************************************************/
TAF_UINT32 AT_SetVolteimpuPara(TAF_UINT8 ucIndex)
{
    AT_IMSA_VOLTEIMPU_QRY_REQ_STRU      stImpu;
    VOS_UINT32                          ulResult;

    PS_MEM_SET(&stImpu, 0x00, sizeof(AT_IMSA_VOLTEIMPU_QRY_REQ_STRU));

    /* ???????? */
    if(AT_CMD_OPT_SET_CMD_NO_PARA != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??IMSA????^VOLTEIMPU???????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                     0,
                                     ID_AT_IMSA_VOLTEIMPU_QRY_REQ,
                                     stImpu.aucContent,
                                     sizeof(stImpu.aucContent),
                                     PS_PID_IMSA);

    if (TAF_SUCCESS != ulResult)
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_IMPU_SET;

    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCacmimsPara
 ????????  : ^CACMIMS=<total_callnum>,<isEConference >,<call_address1>[, call_address2,[...]]????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2014??02??13??
    ??    ??   : Y00213812
    ????????   : ????????
  2.??    ??   : 2014??11??28??
    ??    ??   : f00179208
    ????????   : ??????????????????????
*****************************************************************************/
TAF_UINT32 AT_SetCacmimsPara(TAF_UINT8 ucIndex)
{
    VOS_UINT32                          i;
    VOS_UINT32                          ulCallNum;
    MN_CALL_ORIG_PARAM_STRU             stOrigParam;
    TAF_CALL_ECONF_DIAL_REQ_STRU        stDialReq;
    AT_MODEM_SS_CTX_STRU               *pstSsCtx    = VOS_NULL_PTR;
    VOS_UINT32                          ulResult;
    VOS_UINT32                          ulIndex;

    /* ?????? */
    PS_MEM_SET(&stOrigParam, 0x00, sizeof(MN_CALL_ORIG_PARAM_STRU));
    PS_MEM_SET(&stDialReq,   0x00, sizeof(TAF_CALL_ECONF_DIAL_REQ_STRU));

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        AT_SetCsCallErrCause(ucIndex, TAF_CS_CAUSE_INVALID_PARAMETER);
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    /* ????????????????total_callnum+2 */
    if ((gastAtParaList[0].ulParaValue + 2) != gucAtParaIndex)
    {
        AT_SetCsCallErrCause(ucIndex, TAF_CS_CAUSE_INVALID_PARAMETER);
        return AT_CME_INCORRECT_PARAMETERS;
    }

    pstSsCtx = AT_GetModemSsCtxAddrFromClientId(ucIndex);

    /* ???????????????? */
    if (0 == gastAtParaList[1].ulParaValue)
    {
        /* ???????????????????????????? */
        if (gastAtParaList[0].ulParaValue != 1)
        {
            AT_SetCsCallErrCause(ucIndex, TAF_CS_CAUSE_INVALID_PARAMETER);
            return AT_CME_INCORRECT_PARAMETERS;
        }

        /* ????<dial_string> */
        if (VOS_OK !=  AT_FillCalledNumPara(gastAtParaList[2].aucPara,
                                            gastAtParaList[2].usParaLen,
                                            &stOrigParam.stDialNumber))
        {
            AT_SetCsCallErrCause(ucIndex, TAF_CS_CAUSE_INVALID_PARAMETER);
            return AT_CME_INCORRECT_PARAMETERS;
        }

        stOrigParam.enCallType              = MN_CALL_TYPE_VOICE;
        stOrigParam.enCallMode              = pstSsCtx->enCModType;
        stOrigParam.stDataCfg               = pstSsCtx->stCbstDataCfg;
        stOrigParam.ucImsInvitePtptFlag     = VOS_TRUE;

        stOrigParam.enVoiceDomain           = TAF_CALL_VOICE_DOMAIN_AUTO;

        if(VOS_OK == MN_CALL_Orig(gastAtClientTab[ucIndex].usClientId,
                                  0,
                                  &gastAtClientTab[ucIndex].AtCallInfo.CallId,
                                  &stOrigParam))
        {
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CACMIMS_SET;
            return AT_WAIT_ASYNC_RETURN;
        }
        else
        {
            AT_SetCsCallErrCause(ucIndex, TAF_CS_CAUSE_UNKNOWN);
            return AT_ERROR;
        }
    }
    /* ?????????????????? */
    else
    {
        ulCallNum = gastAtParaList[0].ulParaValue;

        /* ??????????????CCA???????????? */
        stDialReq.enCallMode  = pstSsCtx->enCModType;
        stDialReq.stDataCfg   = pstSsCtx->stCbstDataCfg;
        stDialReq.enClirCfg   = pstSsCtx->ucClirType;
        stDialReq.stCugCfg    = pstSsCtx->stCcugCfg;

        for (i = 0; i < ulCallNum; i++)
        {
            ulIndex = 2 + i;

            if (0 == gastAtParaList[ulIndex].usParaLen)
            {
                AT_SetCsCallErrCause(ucIndex, TAF_CS_CAUSE_INVALID_PARAMETER);
                return AT_CME_INCORRECT_PARAMETERS;
            }

            if (VOS_OK != AT_FillCalledNumPara(gastAtParaList[ulIndex].aucPara,
                                               gastAtParaList[ulIndex].usParaLen,
                                               &stDialReq.stEconfCalllist.astDialNumber[i]))
            {
                AT_SetCsCallErrCause(ucIndex, TAF_CS_CAUSE_INVALID_PARAMETER);
                return AT_CME_INCORRECT_PARAMETERS;
            }
        }

        stDialReq.stEconfCalllist.ulCallNum = ulCallNum;

        stDialReq.enCallType            = MN_CALL_TYPE_VOICE;
        stDialReq.enVoiceDomain         = TAF_CALL_VOICE_DOMAIN_IMS;
        stDialReq.ucImsInvitePtptFlag   = VOS_TRUE;

        ulResult = MN_CALL_SendAppRequest(TAF_CALL_APP_ECONF_DIAL_REQ,
                                          gastAtClientTab[ucIndex].usClientId,
                                          gastAtClientTab[ucIndex].opId,
                                          0,
                                          (MN_CALL_APP_REQ_PARM_UNION *)&stDialReq);
        if (VOS_OK == ulResult)
        {
            gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CACMIMS_SET;
            return AT_WAIT_ASYNC_RETURN;
        }
        else
        {
            AT_SetCsCallErrCause(ucIndex, TAF_CS_CAUSE_UNKNOWN);
            return AT_ERROR;
        }

    }
}

/*****************************************************************************
 ?? ?? ??  : At_MapInputValueToCcwaiMode
 ????????  : ??AT??????????????????CcwaiMode
 ????????  : ulValue
 ????????  : penMode
 ?? ?? ??  : ??
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2016??03??16??
    ??    ??   : n00269697
    ????????   : ??????????
*****************************************************************************/
VOS_VOID At_MapInputValueToCcwaiMode(
    VOS_UINT32                          ulValue,
    TAF_CALL_CCWAI_MODE_ENUM_UINT8     *penMode
)
{
    switch (ulValue)
    {
        case 0:
            *penMode = TAF_CALL_CCWAI_MODE_DISABLE;
            break;

        case 1:
            *penMode = TAF_CALL_CCWAI_MODE_ENABLE;
            break;

        default:
            *penMode = TAF_CALL_CCWAI_MODE_BUTT;
            break;
    }

    return;
}

/*****************************************************************************
 ?? ?? ??  : At_MapInputValueToCcwaiSrvClass
 ????????  : ??AT??????????????????CcwaiSrvClass
 ????????  : ulValue
 ????????  : penMode
 ?? ?? ??  : ??
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2016??03??16??
    ??    ??   : n00269697
    ????????   : ??????????
*****************************************************************************/
VOS_VOID At_MapInputValueToCcwaiSrvClass(
    VOS_UINT32                                              ulValue,
    TAF_CALL_CCWAI_SRV_CLASS_ENUM_UINT8                    *penSrvClass
)
{
    switch (ulValue)
    {
        case 1:
            *penSrvClass = TAF_CALL_CCWAI_SRV_CLASS_VOICE;
            break;

        case 2:
            *penSrvClass = TAF_CALL_CCWAI_SRV_CLASS_VIDEO;
            break;

        case 3:
            *penSrvClass = TAF_CALL_CCWAI_SRV_CLASS_SET_NW;
            break;

        default:
            *penSrvClass = TAF_CALL_CCWAI_SRV_CLASS_BUTT;
            break;
    }

    return;
}
/*****************************************************************************
 ?? ?? ??  : AT_SetCcwaiPara
 ????????  : ^CCWAI????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2014??03??13??
    ??    ??   : z00212940
    ????????   : ????????
  2.??    ??   : 2016??02??16??
    ??    ??   : n00269697
    ????????   : DTS2016021506132??ccwai??????call??????call??ims??????????????
*****************************************************************************/
TAF_UINT32 AT_SetCcwaiPara(TAF_UINT8 ucIndex)
{
    TAF_CALL_CCWAI_SET_REQ_STRU     stCcwaiReq;
    VOS_UINT32                      ulResult;

    /* ???????? */
    if(gucAtParaIndex > 2)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if((0 == gastAtParaList[0].usParaLen) || (0 == gastAtParaList[1].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_SET(&stCcwaiReq, 0, sizeof(stCcwaiReq));

    /* ?????????????? */
    At_MapInputValueToCcwaiMode(gastAtParaList[0].ulParaValue, &stCcwaiReq.enMode);
    At_MapInputValueToCcwaiSrvClass(gastAtParaList[1].ulParaValue, &stCcwaiReq.enSrvClass);

    if ((TAF_CALL_CCWAI_MODE_BUTT == stCcwaiReq.enMode)
     || (TAF_CALL_CCWAI_SRV_CLASS_BUTT == stCcwaiReq.enSrvClass))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }


    /* ??CALL????^CCWAI???????? */
    ulResult = MN_CALL_SendAppRequest(TAF_CALL_APP_CCWAI_SET_REQ,
                                      gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      0,
                                      (MN_CALL_APP_REQ_PARM_UNION *)&stCcwaiReq);
    if (VOS_OK == ulResult)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CCWAI_SET;
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetUiccAuthPara
 ????????  : ^UICCAUTH=<auth_mode>,<rand>,<auth>
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  - ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2014??3??18??
    ??    ??   : zhuli
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetUiccAuthPara(VOS_UINT8 ucIndex)
{
    SI_PIH_UICCAUTH_STRU        stAuthData;

    if ((gucAtParaIndex != 3)
        ||(0 == gastAtParaList[1].usParaLen)
        ||(0 == gastAtParaList[2].usParaLen))
    {
        AT_ERR_LOG("AT_SetUiccAuthPara: para check fail.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(AT_FAILURE == At_AsciiNum2HexString(gastAtParaList[1].aucPara,
                                            &gastAtParaList[1].usParaLen))
    {
        AT_ERR_LOG("AT_SetUiccAuthPara: At_AsciiNum2HexString para1 fail.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(AT_FAILURE == At_AsciiNum2HexString(gastAtParaList[2].aucPara,
                                            &gastAtParaList[2].usParaLen))
    {
        AT_ERR_LOG("AT_SetUiccAuthPara: At_AsciiNum2HexString para2 fail.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ((gastAtParaList[1].usParaLen > SI_AUTH_DATA_MAX)
        ||(gastAtParaList[2].usParaLen > SI_AUTH_DATA_MAX))
    {
        AT_ERR_LOG("AT_SetUiccAuthPara: String Len fail.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (SI_PIH_ATUICCAUTH_USIMAKA == gastAtParaList[0].ulParaValue)
    {
        stAuthData.enAuthType   = SI_PIH_UICCAUTH_AKA;
        stAuthData.enAppType    = SI_PIH_UICCAPP_USIM;
    }
    else if (SI_PIH_ATUICCAUTH_ISIMAKA == gastAtParaList[0].ulParaValue)
    {
        stAuthData.enAuthType   = SI_PIH_UICCAUTH_AKA;
        stAuthData.enAppType    = SI_PIH_UICCAPP_ISIM;
    }
    else if (SI_PIH_ATUICCAUTH_USIMGBA == gastAtParaList[0].ulParaValue)
    {
        stAuthData.enAuthType   = SI_PIH_UICCAUTH_GBA;
        stAuthData.enAppType    = SI_PIH_UICCAPP_USIM;
    }
    else if (SI_PIH_ATUICCAUTH_ISIMGBA == gastAtParaList[0].ulParaValue)
    {
        stAuthData.enAuthType   = SI_PIH_UICCAUTH_GBA;
        stAuthData.enAppType    = SI_PIH_UICCAPP_ISIM;
    }
    else
    {
        AT_ERR_LOG("AT_SetUiccAuthPara: Para 1 value fail.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    stAuthData.uAuthData.stAka.ulRandLen = gastAtParaList[1].usParaLen;

    stAuthData.uAuthData.stAka.ulAuthLen = gastAtParaList[2].usParaLen;

    /* GBA??AKA???????????????????? */
    VOS_MemCpy(stAuthData.uAuthData.stAka.aucRand, gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen);

    VOS_MemCpy(stAuthData.uAuthData.stAka.aucAuth, gastAtParaList[2].aucPara, gastAtParaList[2].usParaLen);

    if(AT_SUCCESS == SI_PIH_UiccAuthReq(gastAtClientTab[ucIndex].usClientId,
                                        0,
                                        &stAuthData))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_UICCAUTH_SET;

        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
       AT_ERR_LOG("AT_SetUiccAuthPara: SI_PIH_UiccAuthReq fail.");

       return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_SetURSMPara
 ????????  : ^UICCAUTH=<app_type>,<command>,<fileid>,<reocrd_num>[,<data>,<pathid>]]
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  - ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2014??3??18??
    ??    ??   : zhuli
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetURSMPara(VOS_UINT8 ucIndex)
{
    SI_PIH_ACCESSFILE_STRU              stCommand;
    VOS_UINT16                          usFileID;

    /* ???????? */
    if ((gucAtParaIndex > 6)
        ||(gucAtParaIndex < 4))
    {
        AT_ERR_LOG("AT_SetURSMPara: too many para");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ((SI_PIH_ACCESS_WRITE == gastAtParaList[1].ulParaValue)
        &&(0 == gastAtParaList[4].usParaLen))
    {
        AT_ERR_LOG("AT_SetURSMPara: Write para wrong");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ((SI_PIH_ACCESS_READ == gastAtParaList[1].ulParaValue)
        &&(0 != gastAtParaList[4].usParaLen))
    {
        AT_ERR_LOG("AT_SetURSMPara: Read para wrong");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????ID?????? */
    usFileID   = (gastAtParaList[2].ulParaValue >> 8) & (0x00FF);

    /* ??????????ID??????EF????????????????????3F/5F/7F */
    if ((MFLAB == usFileID)
       || (DFUNDERMFLAB == usFileID)
       || (DFUNDERDFLAB == usFileID))
    {
        AT_ERR_LOG("AT_SetURSMPara: File Id error.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (0 != gastAtParaList[4].usParaLen)
    {
        if(AT_FAILURE == At_AsciiNum2HexString(gastAtParaList[4].aucPara,
                                                &gastAtParaList[4].usParaLen))
        {
            AT_ERR_LOG("AT_SetURSMPara: At_AsciiNum2HexString para4 fail.");

            return AT_CME_INCORRECT_PARAMETERS;
        }
    }

    if (0 != gastAtParaList[5].usParaLen)
    {
        if(AT_FAILURE == At_AsciiNum2HexString(gastAtParaList[5].aucPara,
                                                &gastAtParaList[5].usParaLen))
        {
            AT_ERR_LOG("AT_SetURSMPara: At_AsciiNum2HexString para5 fail.");

            return AT_CME_INCORRECT_PARAMETERS;
        }
    }

    if ((USIMM_T0_APDU_MAX_LEN < gastAtParaList[4].usParaLen)
        ||(USIMM_MAX_PATH_LEN < gastAtParaList[5].usParaLen)
        ||(SI_PIH_UICCAPP_BUTT <= gastAtParaList[0].ulParaValue))
    {
        AT_ERR_LOG("AT_SetURSMPara: AT para 4 or 5 is fail.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    stCommand.usEfId        = (VOS_UINT16)gastAtParaList[2].ulParaValue;
    stCommand.enAppType     = gastAtParaList[0].ulParaValue;
    stCommand.enCmdType     = (VOS_UINT8)gastAtParaList[1].ulParaValue;
    stCommand.ucRecordNum   = (VOS_UINT8)gastAtParaList[3].ulParaValue;
    stCommand.ulDataLen     = gastAtParaList[4].usParaLen;
    stCommand.usPathLen     = gastAtParaList[5].usParaLen;

    VOS_MemCpy(stCommand.aucCommand, gastAtParaList[4].aucPara, gastAtParaList[4].usParaLen);
    VOS_MemCpy(stCommand.ausPath, gastAtParaList[5].aucPara, gastAtParaList[5].usParaLen);

    /* ???????????? */
    if(AT_SUCCESS == SI_PIH_AccessUICCFileReq(gastAtClientTab[ucIndex].usClientId,
                                                0,
                                                &stCommand))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CURSM_SET;

        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        AT_ERR_LOG("AT_SetURSMPara: SI_PIH_AccessUICCFileReq error.");

        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_SetKsNafAuthPara
 ????????  : ^KSNAFAUTH=<app_type>,<naf_id>,<impi>
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  - ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2014??1??18??
    ??    ??   : zhuli
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetKsNafAuthPara(VOS_UINT8 ucIndex)
{
    SI_PIH_UICCAUTH_STRU        stAuthData;

    if ((gucAtParaIndex != 3)
        ||(0 == gastAtParaList[1].usParaLen)
        ||(0 == gastAtParaList[2].usParaLen))
    {
        AT_ERR_LOG("AT_SetKsNafAuthPara: check para fail.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(AT_FAILURE == At_AsciiNum2HexString(gastAtParaList[1].aucPara, &gastAtParaList[1].usParaLen))
    {
        AT_ERR_LOG("AT_SetKsNafAuthPara: At_AsciiNum2HexString para1 fail.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(AT_FAILURE == At_AsciiNum2HexString(gastAtParaList[2].aucPara, &gastAtParaList[2].usParaLen))
    {
        AT_ERR_LOG("AT_SetKsNafAuthPara: At_AsciiNum2HexString para2 fail.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ((gastAtParaList[1].usParaLen > SI_AUTH_DATA_MAX)
        ||(gastAtParaList[2].usParaLen > SI_AUTH_DATA_MAX))
    {
        AT_ERR_LOG("AT_SetKsNafAuthPara: Str Len check fail.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (SI_PIH_ATKSNAFAUTH_USIM == gastAtParaList[0].ulParaValue)
    {
        stAuthData.enAuthType   = SI_PIH_UICCAUTH_NAF;
        stAuthData.enAppType    = SI_PIH_UICCAPP_USIM;
    }
    else if (SI_PIH_ATKSNAFAUTH_ISIM == gastAtParaList[0].ulParaValue)
    {
        stAuthData.enAuthType   = SI_PIH_UICCAUTH_NAF;
        stAuthData.enAppType    = SI_PIH_UICCAPP_ISIM;
    }
    else
    {
        AT_ERR_LOG("AT_SetKsNafAuthPara: Auth type fail.");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    stAuthData.uAuthData.stKsNAF.ulNAFIDLen = gastAtParaList[1].usParaLen;

    stAuthData.uAuthData.stKsNAF.ulIMPILen  = gastAtParaList[2].usParaLen;

    VOS_MemCpy(stAuthData.uAuthData.stKsNAF.aucNAFID, gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen);

    VOS_MemCpy(stAuthData.uAuthData.stKsNAF.aucIMPI, gastAtParaList[2].aucPara, gastAtParaList[2].usParaLen);

    if(AT_SUCCESS == SI_PIH_UiccAuthReq(gastAtClientTab[ucIndex].usClientId, 0, &stAuthData))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_KSNAFAUTH_SET;

        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        AT_ERR_LOG("AT_SetKsNafAuthPara: SI_PIH_UiccAuthReq fail.");

        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_SetRoamImsServicePara
 ????????  : ^ROAMIMSSERVICE????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2016??01??15??
    ??    ??   : w00316404
    ????????   : ????
*****************************************************************************/
VOS_UINT32 AT_SetRoamImsServicePara(VOS_UINT8 ucIndex)
{
    TAF_MMA_ROAM_IMS_SUPPORT_ENUM_UINT32    enRoamImsSupport;

    enRoamImsSupport = TAF_MMA_ROAM_IMS_BUTT;

    /* ???????? */
    if ( AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if ((1 != gastAtParaList[0].usParaLen) || (1 != gucAtParaIndex))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (0 == gastAtParaList[0].ulParaValue)
    {
        enRoamImsSupport    = TAF_MMA_ROAM_IMS_UNSUPPORT;
    }
    else
    {
        enRoamImsSupport    = TAF_MMA_ROAM_IMS_SUPPORT;
    }


    if (VOS_TRUE == TAF_MMA_SetRoamImsSupportReq(WUEPS_PID_AT, gastAtClientTab[ucIndex].usClientId, 0, enRoamImsSupport))
    {
        /* ????AT???????????????????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_ROAM_IMS_SET;

        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        AT_WARN_LOG("AT_SetRoamImsServicePara: TAF_MMA_SetRoamImsSupportReq fail.");

        return AT_ERROR;
    }
}


/*****************************************************************************
 ?? ?? ??  : AT_SetEOPlmnParaCheck
 ????????  : ^EOPLMN??????????????????
 ????????  : ??
 ????????  :
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??11??26??
    ??    ??   : s00190137
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetEOPlmnParaCheck(VOS_VOID)
{

    /*??????????????*/
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????TAF_AT_EOPLMN_PARA_NUM??????AT_CME_INCORRECT_PARAMETERS*/
    if ( TAF_AT_EOPLMN_PARA_NUM != gucAtParaIndex )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??1??????????,version????????????TAF_MAX_USER_CFG_OPLMN_VERSION_LEN */
    if (TAF_MAX_USER_CFG_OPLMN_VERSION_LEN <= gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??2??????????????Index??????????5 */
    if (TAF_MAX_USER_CFG_OPLMN_GROUP_INDEX < gastAtParaList[1].ulParaValue)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??3????????????pduLen??????????500 */
    if (TAF_AT_PLMN_WITH_RAT_LEN * TAF_MAX_GROUP_CFG_OPLMN_NUM < gastAtParaList[2].ulParaValue)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??3????????????pduLen????????TAF_AT_PLMN_WITH_RAT_LEN???????? */
    if (0 != (gastAtParaList[2].ulParaValue % TAF_AT_PLMN_WITH_RAT_LEN))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??????????????256????????????????6??(index=5)????????????????6??OPLMN */
    if ((gastAtParaList[2].ulParaValue > 6 * TAF_AT_PLMN_WITH_RAT_LEN)
     && (TAF_MAX_USER_CFG_OPLMN_GROUP_INDEX == gastAtParaList[1].ulParaValue))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??4????????????PDU??????????????????????pdulen???? */
    if (gastAtParaList[3].usParaLen != gastAtParaList[2].ulParaValue)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??4????????????PDU????????????????16?????????????? */
    if (AT_SUCCESS != At_AsciiNum2HexString(gastAtParaList[3].aucPara, &gastAtParaList[3].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    return AT_SUCCESS;
}


/*****************************************************************************
 ?? ?? ??  : AT_SetUserCfgOPlmnPara
 ????????  : ????^EOPLMN??????
             ????????:^EOPLMN=<version>,<index>,<pduLen>,<PDU>

 ????????  : ucIndex - ????????
            *pstEOPlmnSet - AT????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??10??15??
    ??    ??   : s00190137
    ????????   : ??????????
  2.??    ??   : 2013??11??26??
    ??    ??   : s00190137
    ????????   : ??????????????????????????????????????50??OPLMN??
                 ????????????256??
  3.??    ??   : 2015??03??24??
    ??    ??   : K00902809
    ????????   : Added new function TAF_MMA_SetEOPlmnReq.
*****************************************************************************/
VOS_UINT32 AT_SetUserCfgOPlmnPara(VOS_UINT8 ucIndex)
{
    TAF_MMA_SET_EOPLMN_LIST_STRU        stEOPlmnSetPara;
    VOS_UINT32                          ulRst;

    PS_MEM_SET(&stEOPlmnSetPara, 0, sizeof(TAF_MMA_SET_EOPLMN_LIST_STRU));


    /* ????????????????????,?????????????????? */
    ulRst = AT_SetEOPlmnParaCheck();
    if (AT_SUCCESS != ulRst)
    {
        return ulRst;
    }

    /* ????????AT??????????TAF_MMA_SET_EOPLMN_LIST_STRU?????? */
    PS_MEM_CPY(stEOPlmnSetPara.aucVersion,
               gastAtParaList[0].aucPara,
               TAF_MAX_USER_CFG_OPLMN_VERSION_LEN);

    if (TAF_MAX_GROUP_CFG_OPLMN_DATA_LEN < gastAtParaList[3].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_CPY(stEOPlmnSetPara.aucOPlmnWithRat,
               gastAtParaList[3].aucPara,
               gastAtParaList[3].usParaLen);

    stEOPlmnSetPara.ucIndex      = (VOS_UINT8)gastAtParaList[1].ulParaValue;
    stEOPlmnSetPara.ucOPlmnCount = (VOS_UINT8)(gastAtParaList[2].ulParaValue / TAF_AT_PLMN_WITH_RAT_LEN);

    /* ??MMA???????????????????????????????????????????????????? */
    /* Modified by k902809 for Iteration 11, 2015-3-24, begin */
    ulRst = TAF_MMA_SetEOPlmnReq(WUEPS_PID_AT,
                                 gastAtClientTab[ucIndex].usClientId,
                                 0,
                                 &stEOPlmnSetPara);
    if (VOS_TRUE == ulRst)
    {
        /* ???????????????????????????????????? */
        g_stParseContext[ucIndex].ucClientStatus = AT_FW_CLIENT_STATUS_PEND;
        gastAtClientTab[ucIndex].CmdCurrentOpt   = AT_CMD_EOPLMN_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
    /* Modified by k902809 for Iteration 11, Iteration 11 2015-3-24, end */
}


/* Added by l00198894 for ????+ECID????, 2013-12-09, begin */
/*****************************************************************************
 ?? ?? ??  : AT_SetEcidPara
 ????????  : ??????????????AT+ECID????????????????
 ????????  : ucIndex    -- AT????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??12??10??
    ??    ??   : l00198894
    ????????   : ????+ECID????
*****************************************************************************/
VOS_UINT32 AT_SetEcidPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulResult;
    AT_MTA_ECID_SET_REQ_STRU            stEcidSetReq;

    /* ???????? */
    if (1 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????? */
    PS_MEM_SET(&stEcidSetReq, 0, sizeof(stEcidSetReq));

    stEcidSetReq.ulVersion = gastAtParaList[0].ulParaValue;

    /* ??????????????C??, ????GPS???????????????????????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      ID_AT_MTA_ECID_SET_REQ,
                                      &stEcidSetReq,
                                      sizeof(stEcidSetReq),
                                      I0_UEPS_PID_MTA);

    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetEcidPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_ECID_SET;

    return AT_WAIT_ASYNC_RETURN;
}
/* Added by l00198894 for ????+ECID????, 2013-12-09, end */

/*****************************************************************************
 ?? ?? ??  : At_SetAntSwitchPara
 ????????  : ????^ANTSWITCH??????
             ????????:^ANTSWITCH=<ant_status>

 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2013??11??11??
    ??    ??   : y00258578
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 At_SetAntSwitchPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;
    DRV_AGENT_ANTSWITCH_SET_STRU        stAntSwitchSetPara;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_TOO_MANY_PARA;
    }

    /* ???????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(gastAtParaList[0].ulParaValue > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    stAntSwitchSetPara.ulState = gastAtParaList[0].ulParaValue;
    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   At_GetOpId(),
                                   DRV_AGENT_ANTSWITCH_SET_REQ,
                                   (VOS_VOID*)(&stAntSwitchSetPara),
                                   sizeof(stAntSwitchSetPara),
                                   I0_WUEPS_PID_DRV_AGENT);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_ANTSWITCH_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_SetRATCombinePara
 ????????  : ^RATCOMBINTPRIO=<pri>
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  - ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2014??1??18??
    ??    ??   : zhuli
    ????????   : ??????????

  2.??    ??   : 2014??2??14??
    ??    ??   : j00174725
    ????????   : TQE
*****************************************************************************/
VOS_UINT32 AT_SetRATCombinePara(VOS_UINT8 ucIndex)
{
    TAF_NV_LC_CTRL_PARA_STRU        stCtrlData;
    MODEM_ID_ENUM_UINT16                enModemId;

    /* ???????? */
    if (gucAtParaIndex != 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    PS_MEM_SET(&stCtrlData, 0x0, sizeof(stCtrlData));

    if (VOS_OK != AT_GetModemIdFromClient(ucIndex, &enModemId))
    {
        AT_ERR_LOG("AT_SetRATCombinePara: Get modem id fail.");

        return AT_ERROR;
    }

    if (NV_OK != NV_ReadEx(enModemId, en_NV_Item_LC_Ctrl_PARA, &stCtrlData, sizeof(TAF_NV_LC_CTRL_PARA_STRU)))
    {
        AT_ERR_LOG("AT_SetRATCombinePara: Get en_NV_Item_LC_Ctrl_PARA fail.");

        return AT_ERROR;
    }

    if (VOS_TRUE != stCtrlData.ucLCEnableFlg)
    {
        return AT_CME_OPERATION_NOT_ALLOWED;
    }

    if (0 == gastAtParaList[0].ulParaValue)
    {
        stCtrlData.enRatCombined = TAF_NVIM_LC_RAT_COMBINED_CL;
    }
    else
    {
        stCtrlData.enRatCombined = TAF_NVIM_LC_RAT_COMBINED_GUL;
    }

    if (NV_OK != NV_WriteEx(enModemId, en_NV_Item_LC_Ctrl_PARA, &stCtrlData, sizeof(TAF_NV_LC_CTRL_PARA_STRU)))
    {
        return AT_ERROR;
    }
    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCallModifyInitPara
 ????????  : ^CALLMODIFY=<idx>,<curr_call_type>,<dest_call_type>
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2014??06??16??
    ??    ??   : f00179208
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetCallModifyInitPara(VOS_UINT8 ucIndex)
{
    MN_CALL_MODIFY_REQ_STRU             stModifyReq;
    VOS_UINT32                          ulResult;

    PS_MEM_SET(&stModifyReq, 0x00, sizeof(MN_CALL_MODIFY_REQ_STRU));

    /* ???????? */
    if(3 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ((0 == gastAtParaList[0].usParaLen)
     || (0 == gastAtParaList[1].usParaLen)
     || (0 == gastAtParaList[2].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    stModifyReq.enCurrCallType      = (MN_CALL_TYPE_ENUM_U8)gastAtParaList[1].ulParaValue;
    stModifyReq.enExpectCallType    = (MN_CALL_TYPE_ENUM_U8)gastAtParaList[2].ulParaValue;

    ulResult = MN_CALL_SendAppRequest(MN_CALL_APP_CALL_MODIFY_REQ,
                                      gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      (MN_CALL_ID_T)gastAtParaList[0].ulParaValue,
                                      (MN_CALL_APP_REQ_PARM_UNION *)&stModifyReq);
    if (VOS_OK == ulResult)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CALL_MODIFY_INIT_SET;
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCallModifyAnsPara
 ????????  : ^CALLMODIFYANS=<idx>,<curr_call_type>,<dest_call_type>
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2014??06??16??
    ??    ??   : f00179208
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetCallModifyAnsPara(VOS_UINT8 ucIndex)
{
    MN_CALL_MODIFY_REQ_STRU             stModifyReq;
    VOS_UINT32                          ulResult;

    PS_MEM_SET(&stModifyReq, 0x00, sizeof(MN_CALL_MODIFY_REQ_STRU));

    /* ???????? */
    if(3 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ((0 == gastAtParaList[0].usParaLen)
     || (0 == gastAtParaList[1].usParaLen)
     || (0 == gastAtParaList[2].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    stModifyReq.enCurrCallType      = (MN_CALL_TYPE_ENUM_U8)gastAtParaList[1].ulParaValue;
    stModifyReq.enExpectCallType    = (MN_CALL_TYPE_ENUM_U8)gastAtParaList[2].ulParaValue;

    ulResult = MN_CALL_SendAppRequest(MN_CALL_APP_CALL_ANSWER_REMOTE_MODIFY_REQ,
                                      gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      (MN_CALL_ID_T)gastAtParaList[0].ulParaValue,
                                      (MN_CALL_APP_REQ_PARM_UNION *)&stModifyReq);
    if (VOS_OK == ulResult)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CALL_MODIFY_ANS_SET;
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;
}

/*****************************************************************************
 ?? ?? ??  : AT_FillEconfDialPara
 ????????  : ????^ECONFDIAL??????????????
 ????????  : ucIndex       - ????????
             pstDialParam  - ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2014??11??28??
    ??    ??   : f00179208
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_FillEconfDialPara(
    VOS_UINT8                           ucIndex,
    TAF_CALL_ECONF_DIAL_REQ_STRU       *pstDialParam
)
{
    AT_MODEM_SS_CTX_STRU               *pstSsCtx = VOS_NULL_PTR;
    VOS_UINT32                          ulCallNum;
    VOS_UINT32                          i;
    VOS_UINT32                          ulIndex;

    pstSsCtx = AT_GetModemSsCtxAddrFromClientId(ucIndex);

    /* ??????????????CCA???????????? */
    pstDialParam->enCallMode  = pstSsCtx->enCModType;
    pstDialParam->stDataCfg   = pstSsCtx->stCbstDataCfg;
    pstDialParam->enClirCfg   = pstSsCtx->ucClirType;
    pstDialParam->stCugCfg    = pstSsCtx->stCcugCfg;

    /* ???????????????????????????????????? */
    if ((0 == gastAtParaList[0].usParaLen)
     || (0 == gastAtParaList[2].usParaLen)
     || (0 == gastAtParaList[3].usParaLen)
     || (0 == gastAtParaList[4].usParaLen)
     || (0 == gastAtParaList[5].usParaLen))
    {
        return VOS_ERR;
    }
    else
    {
        /* ????7???????????????????????????????????????????????? */
        ulCallNum = gastAtParaList[0].ulParaValue;

        for (i = 0; i < ulCallNum; i++)
        {
            ulIndex = 6 + i;

            if (0 == gastAtParaList[ulIndex].usParaLen)
            {
                return VOS_ERR;
            }

            if (VOS_OK !=  AT_FillCalledNumPara(gastAtParaList[ulIndex].aucPara,
                                                gastAtParaList[ulIndex].usParaLen,
                                                &pstDialParam->stEconfCalllist.astDialNumber[i]))
            {
                return VOS_ERR;
            }
        }

        pstDialParam->stEconfCalllist.ulCallNum = ulCallNum;
    }

    /* ????<I>???? */
    if (0 == gastAtParaList[2].ulParaValue)
    {
        pstDialParam->enClirCfg = AT_CLIR_INVOKE;
    }
    else if (1 == gastAtParaList[2].ulParaValue)
    {
        pstDialParam->enClirCfg = AT_CLIR_SUPPRESS;
    }
    else
    {
        return VOS_ERR;
    }

    pstDialParam->enCallType            = (MN_CALL_TYPE_ENUM_U8)gastAtParaList[3].ulParaValue;
    pstDialParam->enVoiceDomain         = (TAF_CALL_VOICE_DOMAIN_ENUM_UINT8)gastAtParaList[4].ulParaValue;
    pstDialParam->ucImsInvitePtptFlag   = VOS_FALSE;

    return VOS_OK;

}

/*****************************************************************************
 ?? ?? ??  : AT_SetEconfDialPara
 ????????  : ??????????????????
             AT^ECONFDIAL=<dial_count>,<conf_cent_string>,<I>,<call_type>,
                          <callDomain>,<isEconf>,<dial_string>,[,<dial_string>...]
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2014??11??28??
    ??    ??   : f00179208
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetEconfDialPara(VOS_UINT8 ucIndex)
{
    TAF_CALL_ECONF_DIAL_REQ_STRU        stDialReq;
    VOS_UINT32                          ulResult;

    PS_MEM_SET(&stDialReq, 0x00, sizeof(TAF_CALL_ECONF_DIAL_REQ_STRU));

    /* ???????? */
    if ((gucAtParaIndex < AT_CMD_ECONF_DIAL_MIN_PARA_NUM)
     || (gucAtParaIndex > AT_CMD_ECONF_DIAL_MAX_PARA_NUM))
    {
        AT_SetCsCallErrCause(ucIndex, TAF_CS_CAUSE_INVALID_PARAMETER);
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    /* ????????????????total_callnum+6 */
    if ((gastAtParaList[0].ulParaValue + 6) != gucAtParaIndex)
    {
        AT_SetCsCallErrCause(ucIndex, TAF_CS_CAUSE_INVALID_PARAMETER);
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????????????? */
    ulResult = AT_FillEconfDialPara(ucIndex, &stDialReq);
    if (VOS_OK != ulResult)
    {
        AT_SetCsCallErrCause(ucIndex, TAF_CS_CAUSE_INVALID_PARAMETER);
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ulResult = MN_CALL_SendAppRequest(TAF_CALL_APP_ECONF_DIAL_REQ,
                                      gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      0,
                                      (MN_CALL_APP_REQ_PARM_UNION *)&stDialReq);
    if (VOS_OK == ulResult)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_ECONF_DIAL_SET;
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetLteImsSwitchPara
 ????????  : ????IMS ??????????
             AT^LTEIMSSWITCH=<value>
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??02??02??
    ??    ??   : zwx247453
    ????????   : ??????????

  2.??    ??   : 2016??7??19??
    ??    ??   : l00198894
    ????????   : VoWiFi????????????????????
*****************************************************************************/
VOS_UINT32 AT_SetLteImsSwitchPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;
    TAF_MMA_IMS_SWITCH_SET_ENUM_UINT8   enImsSwitch;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if (1 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    enImsSwitch = (TAF_MMA_IMS_SWITCH_SET_ENUM_UINT8)gastAtParaList[0].ulParaValue;

    ulRst = TAF_MMA_SetImsSwitchReq(WUEPS_PID_AT,
                                    gastAtClientTab[ucIndex].usClientId,
                                    0,
                                    enImsSwitch);
    if (VOS_TRUE != ulRst)
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_LTE_IMS_SWITCH_SET;

    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_InputValueTransToVoiceDomain
 ????????  : ??AT????????????????????modem????????voice domain??
 ????????  : ulValue
 ????????  : penVoiceDomain
 ?? ?? ??  : VOS_TRUE
             VOS_FALSE
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??02??04??
    ??    ??   : zwx247453
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_InputValueTransToVoiceDomain(
    VOS_UINT32                          ulValue,
    TAF_MMA_VOICE_DOMAIN_ENUM_UINT32   *penVoiceDomain
)
{
    VOS_UINT32                          ulRst;

    ulRst = VOS_TRUE;

    switch (ulValue)
    {
        case AT_VOICE_DOMAIN_TYPE_CS_ONLY:
            *penVoiceDomain = TAF_MMA_VOICE_DOMAIN_CS_ONLY;
            break;

        case AT_VOICE_DOMAIN_TYPE_CS_PREFERRED:
            *penVoiceDomain = TAF_MMA_VOICE_DOMAIN_CS_PREFERRED;
            break;

        case AT_VOICE_DOMAIN_TYPE_IMS_PS_PREFERRED:
            *penVoiceDomain = TAF_MMA_VOICE_DOMAIN_IMS_PS_PREFERRED;
            break;

       case AT_VOICE_DOMAIN_TYPE_IMS_PS_ONLY:
            *penVoiceDomain = TAF_MMA_VOICE_DOMAIN_IMS_PS_ONLY;
            break;

        default:
            *penVoiceDomain = TAF_MMA_VOICE_DOMAIN_BUTT;
            ulRst = VOS_FALSE;
            break;
    }

    return ulRst;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCevdpPara
 ????????  : ??????????????
             AT+CEVDP=[<setting>] (1:cs only 2:cs prefer 3:ps prefer 4:ps only)
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??02??02??
    ??    ??   : zwx247453
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetCevdpPara(VOS_UINT8 ucIndex)
{
    TAF_MMA_VOICE_DOMAIN_ENUM_UINT32    enVoiceDomain;
    VOS_UINT32                          ulRst;

    ulRst         = VOS_FALSE;
    enVoiceDomain = TAF_MMA_VOICE_DOMAIN_BUTT;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if (gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????????????????????????????????????????CS ONLY */
    if (0 == gastAtParaList[0].usParaLen)
    {
        enVoiceDomain = TAF_MMA_VOICE_DOMAIN_CS_ONLY;
    }
    else
    {
        if (VOS_TRUE != AT_InputValueTransToVoiceDomain(gastAtParaList[0].ulParaValue, &enVoiceDomain))
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }
    }

    ulRst = TAF_MMA_SetVoiceDomainReq(WUEPS_PID_AT,
                                      gastAtClientTab[ucIndex].usClientId,
                                      0,
                                      enVoiceDomain);
    if (VOS_TRUE != ulRst)
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_VOICE_DOMAIN_SET;

    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetImsctrlmsgPara
 ????????  : ????MAPCON??IMSA??????
             AT^IMSCTRLMSG=<msg_id>,<msg_len>,<msg_context>
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??10??28??
    ??    ??   : n00269697
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetImsctrlmsgPara(VOS_UINT8 ucIndex)
{
    AT_IMS_CTRL_MSG_STRU               *pstAtImsaMsgPara = VOS_NULL_PTR;
    VOS_UINT8                          *pucMsg           = VOS_NULL_PTR;
    VOS_UINT32                          ulAtImsaMsgParaLen;
    VOS_UINT32                          ulMsgSubStrCount;
    VOS_UINT32                          i;
    VOS_UINT32                          ulIndex;
    VOS_UINT16                          usMsgStrLen;
    VOS_UINT16                          usLength;
    VOS_UINT32                          ulResult;

    /* ???????? */
    if (gucAtParaIndex < 3)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ((0 == gastAtParaList[0].usParaLen)
     || (0 == gastAtParaList[1].usParaLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ulMsgSubStrCount = gucAtParaIndex - 2;
    usMsgStrLen = 0;

    for (i = 0; i < ulMsgSubStrCount; i++)
    {
        ulIndex = i + 2;

        if (0 == gastAtParaList[ulIndex].usParaLen)
        {
            return AT_CME_INCORRECT_PARAMETERS;
        }

        usMsgStrLen += gastAtParaList[ulIndex].usParaLen;
    }

    pucMsg = (VOS_UINT8 *)PS_MEM_ALLOC(WUEPS_PID_AT, usMsgStrLen + 1);
    if (VOS_NULL_PTR == pucMsg)
    {
        AT_ERR_LOG("AT_SetImsctrlmsgPara: Memory malloc failed!");
        return AT_ERROR;
    }

    usLength = 0;
    for (i = 0; i < ulMsgSubStrCount; i++)
    {
        ulIndex = i + 2;

        usLength += (VOS_UINT16)At_sprintf(usMsgStrLen + 1,
                                           (VOS_CHAR *)pucMsg,
                                           (VOS_CHAR *)pucMsg + usLength,
                                           "%s",
                                           gastAtParaList[ulIndex].aucPara);
    }

    /* ?????????????????????? */
    ulResult = At_AsciiNum2HexString(pucMsg, &usLength);

    if ((AT_SUCCESS != ulResult)
     || (gastAtParaList[1].ulParaValue != usLength))
    {
        PS_MEM_FREE(WUEPS_PID_AT, pucMsg);
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????????????Mapcon??IMSA???????????????? */
    ulAtImsaMsgParaLen = sizeof(VOS_UINT32) + gastAtParaList[1].ulParaValue;
    pstAtImsaMsgPara   = (AT_IMS_CTRL_MSG_STRU *)PS_MEM_ALLOC(WUEPS_PID_AT, ulAtImsaMsgParaLen);

    if (VOS_NULL_PTR == pstAtImsaMsgPara)
    {
        AT_ERR_LOG("AT_SetImsctrlmsgPara: Memory malloc failed!");
        PS_MEM_FREE(WUEPS_PID_AT, pucMsg);

        return AT_ERROR;
    }

    PS_MEM_SET(pstAtImsaMsgPara, 0, ulAtImsaMsgParaLen);

    /* ????AT_IMSA_IMS_CTRL_MSG_STRU */
    pstAtImsaMsgPara->ulMsgLen = gastAtParaList[1].ulParaValue;
    PS_MEM_CPY(pstAtImsaMsgPara->ucMsgContext, pucMsg, pstAtImsaMsgPara->ulMsgLen);

    /* ????MAPCON??IMSA?????? */
    ulResult = AT_SndImsaImsCtrlMsg(gastAtClientTab[ucIndex].usClientId, 0, pstAtImsaMsgPara);

    PS_MEM_FREE(WUEPS_PID_AT, pucMsg);
    PS_MEM_FREE(WUEPS_PID_AT, pstAtImsaMsgPara);

    if (VOS_OK != ulResult)
    {
        return AT_ERROR;
    }

    return AT_OK;
}
/*****************************************************************************
 ?? ?? ??  : AT_SetImsDomainCfgPara
 ????????  : AT^IMSDOMAINCFG=<domain_cfg>
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : VOS_INT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??10??23??
    ??    ??   : h00360002
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetImsDomainCfgPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                                   ulRst;
    TAF_MMA_IMS_DOMAIN_CFG_TYPE_ENUM_UINT32      enImsDomainCfg;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (1 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

     /* ???????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    enImsDomainCfg = (TAF_MMA_IMS_DOMAIN_CFG_TYPE_ENUM_UINT32)gastAtParaList[0].ulParaValue;

    /* ???????????? */
    ulRst = TAF_MMA_SetImsDomainCfgReq(WUEPS_PID_AT,
                                       gastAtClientTab[ucIndex].usClientId,
                                       0,
                                       enImsDomainCfg);

    if (VOS_TRUE == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_IMSDOMAINCFG_SET;
        return AT_WAIT_ASYNC_RETURN;    /* ???????????????????? */
    }
    else
    {
        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCallEncryptPara
 ????????  : ????IMS????????????
             AT^CALLENCRYPT=<value>
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??11??04??
    ??    ??   : f00179208
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetCallEncryptPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulResult;
    AT_IMSA_CALL_ENCRYPT_SET_REQ_STRU   stCallEncrypt;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if (1 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    stCallEncrypt.ucEncrypt = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ??IMSA????^CALLENCRYPT???????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      0,
                                      ID_AT_IMSA_CALL_ENCRYPT_SET_REQ,
                                      &stCallEncrypt.ucEncrypt,
                                      sizeof(VOS_UINT8),
                                      PS_PID_IMSA);

    if (TAF_SUCCESS != ulResult)
    {
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CALLENCRYPT_SET;

    return AT_WAIT_ASYNC_RETURN;
}


/*****************************************************************************
 ?? ?? ??  : AT_SetCclkPara
 ????????  : +Cclk
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  - ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2014??11??19??
    ??    ??   : j00174725
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetCclkPara(VOS_UINT8 ucIndex)
{
    return AT_CME_OPERATION_NOT_SUPPORTED;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetVoicePreferPara
 ????????  : ????VoicePrefer????????????
 ????????  : TAF_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2014??12??26??
    ??    ??   : s00273135
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetVoicePreferPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32      ulVoicePreferAct;
    VOS_UINT32      ulRslt;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????????? */
    if (0 == gastAtParaList[0].usParaLen)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ulVoicePreferAct = gastAtParaList[0].ulParaValue;

    ulRslt = AT_SndSetVoicePrefer(gastAtClientTab[ucIndex].usClientId,
                               gastAtClientTab[ucIndex].opId,
                               ulVoicePreferAct);
    if (VOS_OK == ulRslt)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_VOICEPREFER_SET;
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCrmPara
 ????????  : ????AT+CRM??AT????
 ????????  : VOS_UINT8                           ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2014??10??22??
    ??    ??   : g00261581
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetCrmPara(VOS_UINT8 ucIndex)
{

    return AT_ERROR;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCqosPriPara
 ????????  : ????AT^CQOSPRI??AT????
 ????????  : VOS_UINT8                           ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2014??10??22??
    ??    ??   : g00261581
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetCqosPriPara(VOS_UINT8 ucIndex)
{
    TAF_PS_CDATA_1X_QOS_NON_ASSURED_PRI_ENUM_UINT8          enQosPri;

    /* ???????? */
    if (1 != gucAtParaIndex )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    enQosPri = (TAF_PS_CDATA_1X_QOS_NON_ASSURED_PRI_ENUM_UINT8)gastAtParaList[0].ulParaValue;

    /* ???????????? */
    if ( VOS_OK != TAF_PS_SetCqosPriInfo(WUEPS_PID_AT,
                                         AT_PS_BuildExClientId(gastAtClientTab[ucIndex].usClientId),
                                         enQosPri))
    {
        return AT_ERROR;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CQOSPRI_SET;

    /* ???????????????? */
    return AT_WAIT_ASYNC_RETURN;
}
/*****************************************************************************
 ?? ?? ??  : AT_SetCcmgsPara
 ????????  : (AT^CCMGS)CDMA ????????????
 ????????  : ucIndex - ????????
             ulLengthValue - ??????????????
             pucCommand - ????????????????
             usCommandLength - ????????????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ???????? :
 ???????? :

 ????????      :
  1.??    ??   : 2014??10??31??
    ??    ??   : h00300778
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetCcmgsPara(
    VOS_UINT8                           ucIndex,
    VOS_UINT32                          ulLengthValue,
    VOS_UINT8                          *pucCommand,
    VOS_UINT16                          usCommandLength)
{
    TAF_XSMS_MESSAGE_STRU              stSmsPdu;
    VOS_UINT16                          usCommandHexLen;
    TAF_UINT8                           ucSmSFormat;

    ucSmSFormat = AT_GetModemSmsCtxAddrFromClientId(ucIndex)->enCmgfMsgFormat;

    if (AT_CMGF_MSG_FORMAT_PDU != ucSmSFormat)
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ?????? */
    PS_MEM_SET(&stSmsPdu, 0x00, sizeof(stSmsPdu));

    /* ???????? */
    if ((ulLengthValue > (2*sizeof(TAF_XSMS_MESSAGE_STRU)))
       || (ulLengthValue != usCommandLength)
       || (VOS_NULL != (ulLengthValue%2)))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* <PDU>??ASCII????????????????HEX?????? */
    usCommandHexLen = usCommandLength;
    if (AT_FAILURE == At_AsciiNum2HexString(pucCommand, &usCommandHexLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??PDU???????????????????? */
    VOS_MemCpy(&stSmsPdu, pucCommand, usCommandHexLen);

    /* ???????????? */
    if (AT_SUCCESS == TAF_XSMS_SendSmsReq(gastAtClientTab[ucIndex].usClientId,
                                          0,
                                          TAF_XSMS_SEND_OPTION_SINGLE,
                                          (VOS_UINT8 *)&stSmsPdu))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CCMGS_SET;

        /* ???????????????????? */
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        AT_WARN_LOG("AT_SetCcmgsPara: CNAS_XSMS_SendSmsReq fail.");

        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCcmgwPara
 ????????  : (AT^CCMGW)CDMA ????????????
 ????????  : ucIndex - ????????
             ulLengthValue - ??????????????
             ulStatValue - ??????????????
             pucCommand - ????????????????
             usCommandLength - ????????????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ???????? :
 ???????? :

 ????????      :
  1.??    ??   : 2014??10??31??
    ??    ??   : h00300778
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetCcmgwPara(
    VOS_UINT8                           ucIndex,
    VOS_UINT32                          ulLengthValue,
    VOS_UINT32                          ulStatValue,
    VOS_UINT8                          *pucCommand,
    VOS_UINT16                          usCommandLength)
{
    TAF_XSMS_MESSAGE_STRU              stSmsPdu;
    VOS_UINT16                          usCommandHexLen;
    TAF_UINT8                           ucSmSFormat;

    ucSmSFormat = AT_GetModemSmsCtxAddrFromClientId(ucIndex)->enCmgfMsgFormat;

    if (AT_CMGF_MSG_FORMAT_PDU != ucSmSFormat)
    {
        return AT_CMS_OPERATION_NOT_ALLOWED;
    }

    /* ?????? */
    PS_MEM_SET(&stSmsPdu, 0x00, sizeof(stSmsPdu));

    /* ???????? */
    if ((ulLengthValue > (2*sizeof(TAF_XSMS_MESSAGE_STRU)))
       || (ulLengthValue != usCommandLength)
       || (VOS_NULL != (ulLengthValue % 2)))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????2?????????? */
    if (TAF_XSMS_STATUS_STO_SEND < ulStatValue)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* <PDU>??ASCII????????????????HEX?????? */
    usCommandHexLen = usCommandLength;
    if (AT_FAILURE == At_AsciiNum2HexString(pucCommand, &usCommandHexLen))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ??PDU???????????????????? */
    VOS_MemCpy(&stSmsPdu, pucCommand, usCommandHexLen);

    /* ???????????? */
    if (AT_SUCCESS == TAF_XSMS_WriteSmsReq(gastAtClientTab[ucIndex].usClientId,
                                           0,
                                           (VOS_UINT8)ulStatValue,
                                           (VOS_UINT8 *)&stSmsPdu))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CCMGW_SET;

        /* ???????????????????? */
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        AT_WARN_LOG("AT_SetCcmgwPara: CNAS_XSMS_WriteSmsReq fail.");

        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCcmgdPara
 ????????  : (AT^CCMGD)CDMA????????
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  :
 ????????      :
  1.??    ??   : 2014??10??31??
    ??    ??   : h00300778
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetCcmgdPara(VOS_UINT8 ucIndex)
{
    VOS_UINT8                           ucSmsIndex;

    /* ???????????????????? */
    if (gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    ucSmsIndex = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ????????????????0??????UIM????????????1???? */
    if (ucSmsIndex >= g_ucXsmsRecNum)
    {
        return AT_CME_INVALID_INDEX;
    }

    /* ???????????? */
    if (AT_SUCCESS == TAF_XSMS_DeleteSmsReq(gastAtClientTab[ucIndex].usClientId,
                                            0,
                                            ucSmsIndex))
    {
        /* ???????????????? */
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_CCMGD_SET;

        /* ???????????????????? */
        return AT_WAIT_ASYNC_RETURN;
    }

    return AT_ERROR;

}

/*****************************************************************************
 ?? ?? ??  : AT_CheckCFreqLockEnablePara
 ????????  : ????????enble????????????????????
 ????????  :
 ????????  :
 ?? ?? ??  : ????????VOS_TRUE,??????????VOS_FALSE
 ????????      :
  1.??    ??   : 2014??12??29??
    ??    ??   : y00307564
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_CheckCFreqLockEnablePara(VOS_VOID)
{
    VOS_UINT8                    ucLoop;

    for (ucLoop = 1; ucLoop < AT_CFREQLOCK_PARA_NUM_MAX; ucLoop++)
    {
        if (0 == gastAtParaList[ucLoop].usParaLen)
        {
            return VOS_FALSE;
        }
    }

    return VOS_TRUE;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetCFreqLockPara
 ????????  : (AT^CFREQLOCK)CDMA????????????
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  :
 ????????      :
  1.??    ??   : 2014??12??29??
    ??    ??   : y00307564
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetCFreqLockPara(VOS_UINT8 ucIndex)
{

    return AT_ERROR;

}
/*****************************************************************************
 ?? ?? ??  : AT_SetCdmaCsqPara
 ????????  : ????AT^CDMACSQ??AT????
 ????????  : VOS_UINT8                           ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2014??12??25??
    ??    ??   : m00312079
    ????????   : ??????????
  2.??    ??   : 2015??10??16??
    ??    ??   : m00312079
    ????????   : DTS2015101505057:????ec/Io??????????

*****************************************************************************/
VOS_UINT32 AT_SetCdmaCsqPara(VOS_UINT8 ucIndex)
{
    return AT_ERROR;

}


/*****************************************************************************
 ?? ?? ??  : AT_SetTTYModePara
 ????????  : ^TTYMODE????????????????
 ????????  : VOS_UINT8 ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??02??07??
    ??    ??   : w00316404
    ????????   : ????
*****************************************************************************/
VOS_UINT32 AT_SetTTYModePara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulResult;
    APP_VC_SET_TTYMODE_REQ_STRU         stSetTTYMode;

    PS_MEM_SET(&stSetTTYMode, 0x00, sizeof(APP_VC_SET_TTYMODE_REQ_STRU));

    /* ???????? */
    if ( AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if ((1 != gastAtParaList[0].usParaLen) || (1 != gucAtParaIndex))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    stSetTTYMode.enTTYMode = (TAF_VC_TTYMODE_ENUM_UINT8)gastAtParaList[0].ulParaValue;

    /* ????????VC???????????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      APP_VC_MSG_SET_TTYMODE_REQ,
                                      &stSetTTYMode,
                                      sizeof(APP_VC_SET_TTYMODE_REQ_STRU),
                                      I0_WUEPS_PID_VC);

    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetTTYModePara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_TTYMODE_SET;

    return AT_WAIT_ASYNC_RETURN;
}


/*****************************************************************************
 ?? ?? ??  : At_SetCustomDial
 ????????  : ????AT^CUSTOMDIAL??AT????
 ????????  : VOS_UINT8                           ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??4??8??
    ??    ??   : w00242748
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 At_SetCustomDial(VOS_UINT8 ucIndex)
{
    return AT_ERROR;
}


/*****************************************************************************
 ?? ?? ??  : AT_IsPlatformSupportHrpdMode
 ????????  : ????????????????????HRPD
 ????????  : PLATAFORM_RAT_CAPABILITY_STRU      *pstPlatform
 ????????  : ??
 ?? ?? ??  : VOS_UINT32 ????VOS_TRUE ????????HRPD

 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??4??8??
    ??    ??   : w00242748
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_IsPlatformSupportHrpdMode(
    PLATAFORM_RAT_CAPABILITY_STRU      *pstPlatform
)
{
    VOS_UINT16                          i;

    for (i = 0; i < pstPlatform->usRatNum; i++)
    {
        if (PLATFORM_RAT_HRPD == pstPlatform->aenRatList[i])
        {
            return VOS_TRUE;
        }
    }

    return VOS_FALSE;
}

/*****************************************************************************
 ?? ?? ??  : AT_IsPlatformSupport1XMode
 ????????  : ????????????????????1X
 ????????  : PLATAFORM_RAT_CAPABILITY_STRU      *pstPlatform
 ????????  : ??
 ?? ?? ??  : VOS_UINT32 ????VOS_TRUE ????????1X

 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??4??8??
    ??    ??   : w00242748
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_IsPlatformSupport1XMode(
    PLATAFORM_RAT_CAPABILITY_STRU      *pstPlatform
)
{
    VOS_UINT16                          i;

    for (i = 0; i < pstPlatform->usRatNum; i++)
    {
        if (PLATFORM_RAT_1X == pstPlatform->aenRatList[i])
        {
            return VOS_TRUE;
        }
    }

    return VOS_FALSE;
}

/*****************************************************************************
 ?? ?? ??  : AT_AddSpecRatIntoPlatform
 ????????  : ????????????????????????????????????
 ????????  : PLATFORM_RAT_TYPE_ENUM_UINT16       enRatType
             PLATAFORM_RAT_CAPABILITY_STRU      *pstPlatform
 ????????  : ??
 ?? ?? ??  : VOS_UINT32 ????VOS_TRUE  ????????
                            VOS_FALSE ????????

 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??4??8??
    ??    ??   : w00242748
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_AddSpecRatIntoPlatform(
    PLATFORM_RAT_TYPE_ENUM_UINT16       enRatType,
    PLATAFORM_RAT_CAPABILITY_STRU      *pstPlatform
)
{
    if (pstPlatform->usRatNum >= PLATFORM_MAX_RAT_NUM)
    {
        return VOS_FALSE;
    }

    pstPlatform->aenRatList[pstPlatform->usRatNum] = enRatType;
    pstPlatform->usRatNum++;

    return VOS_TRUE;
}

/*****************************************************************************
 ?? ?? ??  : AT_RemoveSpecRatFromPlatform
 ????????  : ????????????????????????????????????
 ????????  : PLATFORM_RAT_TYPE_ENUM_UINT16       enRatType
             PLATAFORM_RAT_CAPABILITY_STRU      *pstPlatform
 ????????  : ??
 ?? ?? ??  : VOS_UINT32 ????VOS_TRUE  ????????
                            VOS_FALSE ????????

 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??4??8??
    ??    ??   : w00242748
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_RemoveSpecRatFromPlatform(
    PLATFORM_RAT_TYPE_ENUM_UINT16       enRatType,
    PLATAFORM_RAT_CAPABILITY_STRU      *pstPlatform
)
{
    VOS_UINT16                          i;
    VOS_UINT16                          usRatNum;

    usRatNum = 0;

    for (i = 0; i < pstPlatform->usRatNum; i++)
    {
        if (enRatType != pstPlatform->aenRatList[i])
        {
            pstPlatform->aenRatList[usRatNum++] = pstPlatform->aenRatList[i];
        }
    }

    pstPlatform->usRatNum = usRatNum;

    return VOS_TRUE;
}

/*****************************************************************************
 ?? ?? ??  : AT_TransferCModeToModem0
 ????????  : ??C????????modem0??(??????????)
 ????????  : PLATAFORM_RAT_CAPABILITY_STRU      *pstModem0Platform,
             PLATAFORM_RAT_CAPABILITY_STRU      *pstModem1Platform

 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??6??15??
    ??    ??   : w00242748
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_TransferCModeToModem0(
    PLATAFORM_RAT_CAPABILITY_STRU      *pstModem0Platform,
    PLATAFORM_RAT_CAPABILITY_STRU      *pstModem1Platform
)
{
    VOS_UINT32                          ulLength;
    VOS_UINT32                          ulModem1Support1XFlg;
    VOS_UINT32                          ulModem1SupportHrpdFlg;

    ulLength               = 0;
    ulModem1Support1XFlg   = AT_IsPlatformSupport1XMode(pstModem1Platform);
    ulModem1SupportHrpdFlg = AT_IsPlatformSupportHrpdMode(pstModem1Platform);

    /* ??????????????????:modem??????????????????????????????0?????????????? */
    if ( ( (ulModem1Support1XFlg
         && ulModem1SupportHrpdFlg) )
      && (pstModem1Platform->usRatNum == 2) )
    {
        return VOS_FALSE;
    }

    if ( ( (ulModem1Support1XFlg
         || ulModem1SupportHrpdFlg) )
      && (pstModem1Platform->usRatNum == 1) )
    {
        return VOS_FALSE;
    }

    if (VOS_TRUE == ulModem1Support1XFlg )
    {
        (VOS_VOID)AT_AddSpecRatIntoPlatform(PLATFORM_RAT_1X, pstModem0Platform);
        (VOS_VOID)AT_RemoveSpecRatFromPlatform(PLATFORM_RAT_1X, pstModem1Platform);
    }

    if (VOS_TRUE == ulModem1SupportHrpdFlg )
    {
        (VOS_VOID)AT_AddSpecRatIntoPlatform(PLATFORM_RAT_HRPD, pstModem0Platform);
        (VOS_VOID)AT_RemoveSpecRatFromPlatform(PLATFORM_RAT_HRPD, pstModem1Platform);
    }

    (VOS_VOID)NV_GetLength(en_NV_Item_Platform_RAT_CAP, &ulLength);
    if (NV_OK != NV_WriteEx(MODEM_ID_0,
                            en_NV_Item_Platform_RAT_CAP,
                            pstModem0Platform,
                            ulLength))
    {
        return VOS_FALSE;
    }

    if (NV_OK != NV_WriteEx(MODEM_ID_1,
                            en_NV_Item_Platform_RAT_CAP,
                            pstModem1Platform,
                            ulLength))
    {
        return VOS_FALSE;
    }

    return VOS_TRUE;
}

/*****************************************************************************
 ?? ?? ??  : AT_TransferCModeToModem1
 ????????  : ??C????????modem1??(??????????)
 ????????  : PLATAFORM_RAT_CAPABILITY_STRU      *pstModem0Platform,
             PLATAFORM_RAT_CAPABILITY_STRU      *pstModem1Platform

 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??6??15??
    ??    ??   : w00242748
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_TransferCModeToModem1(
    PLATAFORM_RAT_CAPABILITY_STRU      *pstModem0Platform,
    PLATAFORM_RAT_CAPABILITY_STRU      *pstModem1Platform
)
{
    VOS_UINT32                          ulLength;
    VOS_UINT32                          ulModem0Support1XFlg;
    VOS_UINT32                          ulModem0SupportHrpdFlg;

    ulLength               = 0;
    ulModem0Support1XFlg   = AT_IsPlatformSupport1XMode(pstModem0Platform);
    ulModem0SupportHrpdFlg = AT_IsPlatformSupportHrpdMode(pstModem0Platform);

    /* ??????????????????:modem??????????????????????????????0?????????????? */
    if ( ( (ulModem0Support1XFlg
         && ulModem0SupportHrpdFlg) )
      && (pstModem0Platform->usRatNum == 2) )
    {
        return VOS_FALSE;
    }

    if ( ( (ulModem0Support1XFlg
         || ulModem0SupportHrpdFlg) )
      && (pstModem0Platform->usRatNum == 1) )
    {
        return VOS_FALSE;
    }


    if (VOS_TRUE == ulModem0Support1XFlg )
    {
        (VOS_VOID)AT_AddSpecRatIntoPlatform(PLATFORM_RAT_1X, pstModem1Platform);
        (VOS_VOID)AT_RemoveSpecRatFromPlatform(PLATFORM_RAT_1X, pstModem0Platform);
    }

    if (VOS_TRUE == ulModem0SupportHrpdFlg )
    {
        (VOS_VOID)AT_AddSpecRatIntoPlatform(PLATFORM_RAT_HRPD, pstModem1Platform);
        (VOS_VOID)AT_RemoveSpecRatFromPlatform(PLATFORM_RAT_HRPD, pstModem0Platform);
    }

    (VOS_VOID)NV_GetLength(en_NV_Item_Platform_RAT_CAP, &ulLength);
    if (NV_OK != NV_WriteEx(MODEM_ID_1,
                            en_NV_Item_Platform_RAT_CAP,
                            pstModem1Platform,
                            ulLength))
    {
        return VOS_FALSE;
    }

    if (NV_OK != NV_WriteEx(MODEM_ID_0,
                            en_NV_Item_Platform_RAT_CAP,
                            pstModem0Platform,
                            ulLength))
    {
        return VOS_FALSE;
    }

    return VOS_TRUE;
}

/*****************************************************************************
 ?? ?? ??  : AT_SwitchCdmaMode
 ????????  : ????CDMA????
 ????????  : VOS_UINT32                          ulModemId,
             PLATAFORM_RAT_CAPABILITY_STRU      *pstModem0Platform,
             PLATAFORM_RAT_CAPABILITY_STRU      *pstModem1Platform

 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??4??8??
    ??    ??   : w00242748
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SwitchCdmaMode(
    VOS_UINT32                          ulModemId,
    PLATAFORM_RAT_CAPABILITY_STRU      *pstModem0Platform,
    PLATAFORM_RAT_CAPABILITY_STRU      *pstModem1Platform
)
{
    if (0 == ulModemId)
    {
        if (VOS_FALSE == AT_TransferCModeToModem0(pstModem0Platform, pstModem1Platform))
        {
            return VOS_FALSE;
        }
    }
    else
    {
        if (VOS_FALSE == AT_TransferCModeToModem1(pstModem0Platform, pstModem1Platform))
        {
            return VOS_FALSE;
        }
    }

    return VOS_TRUE;
}


/*****************************************************************************
 ?? ?? ??  : At_SetCdmaModemSwitch
 ????????  : ????AT^CDMAMODEMSWITCH??AT????
 ????????  : VOS_UINT8                           ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??4??8??
    ??    ??   : w00242748
    ????????   : ??????????
  2.??    ??   : 2015??12??11??
    ??    ??   : w00242748
    ????????   : DTS2015103000174:????????????????????????????????????C??

*****************************************************************************/
VOS_UINT32 At_SetCdmaModemSwitch(VOS_UINT8 ucIndex)
{

    return AT_OK;
}

/*****************************************************************************
 ?? ?? ??  : At_QryCdmaModemSwitch
 ????????  : ????AT^CDMAMODEMSWITCH???AT????
 ????????  : VOS_UINT8                           ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :

  1.??    ??   : 2016??2??29??
    ??    ??   : h00313353
    ????????   : New
*****************************************************************************/
VOS_UINT32 At_QryCdmaModemSwitch(VOS_UINT8 ucIndex)
{

    return AT_OK;
}


/*****************************************************************************
 ?? ?? ??  : AT_SetCtaPara
 ????????  : ????AT+CTA??AT????
 ????????  : VOS_UINT8                           ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??4??20??
    ??    ??   : c00299063
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetCtaPara(VOS_UINT8 ucIndex)
{
    return AT_ERROR;

}

/*****************************************************************************
 ?? ?? ??  : At_SetFemCtrl
 ????????  : ^FEMCTRL
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2014??12??11??
    ??    ??   : m00217266
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 At_SetFemCtrl(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulRst;
    AT_MTA_SET_FEMCTRL_REQ_STRU         stFemctrlReq;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_ERROR;
    }

    /* ???????? */
    if (gucAtParaIndex > 4)
    {
        return AT_TOO_MANY_PARA;
    }


    stFemctrlReq.ulCtrlType     = gastAtParaList[0].ulParaValue;
    stFemctrlReq.ulPara1        = gastAtParaList[1].ulParaValue;
    stFemctrlReq.ulPara2        = gastAtParaList[2].ulParaValue;
    stFemctrlReq.ulPara3        = gastAtParaList[3].ulParaValue;

    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   At_GetOpId(),
                                   ID_AT_MTA_SET_FEMCTRL_REQ,
                                   (VOS_VOID*)&stFemctrlReq,
                                   sizeof(stFemctrlReq),
                                   I0_UEPS_PID_MTA);

    if (AT_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_FEMCTRL_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }

}
/*****************************************************************************
 ?? ?? ??  : At_SetRatRfSwitch
 ????????  : ????RF Profile Id
 ????????  : ??
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??01??04??
    ??    ??   : z00306637
    ????????   : ????????
*****************************************************************************/
VOS_UINT32 At_SetRatRfSwitch(VOS_UINT8 ucIndex)
{
    NAS_NV_TRI_MODE_ENABLE_STRU                     stTriModeEnableStru;
    NAS_NV_TRI_MODE_FEM_PROFILE_ID_STRU             stTriModeFemProfileIdStru;

    PS_MEM_SET(&stTriModeEnableStru, 0x0, sizeof(stTriModeEnableStru));
    PS_MEM_SET(&stTriModeFemProfileIdStru, 0x0, sizeof(stTriModeFemProfileIdStru));

    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if ((0 == gastAtParaList[0].usParaLen)
     || (1 != gucAtParaIndex))
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /*??????????????????????*/
    if (NV_OK != NV_ReadEx(MODEM_ID_0, en_NV_Item_TRI_MODE_ENABLE, &stTriModeEnableStru, sizeof(stTriModeEnableStru)))
    {
        AT_WARN_LOG("At_SetRatRfSwitch:read en_NV_Item_TRI_MODE_ENABLE failed");
        return AT_ERROR;
    }

    /*????????????*/
    if(0 == stTriModeEnableStru.usEnable)
    {
        AT_WARN_LOG("At_SetRatRfSwitch:uhwEnable is not enabled");
        return AT_CME_OPERATION_NOT_ALLOWED;
    }

    stTriModeFemProfileIdStru.ulProfileId=gastAtParaList[0].ulParaValue;

    /* ????Profile Id*/
    if (NV_OK != NV_WriteEx(MODEM_ID_0, en_NV_Item_TRI_MODE_FEM_PROFILE_ID, &stTriModeFemProfileIdStru, sizeof(stTriModeFemProfileIdStru)))
    {
        AT_WARN_LOG("At_SetRatRfSwitch: MODEM_ID_0 write en_NV_Item_TRI_MODE_FEM_PROFILE_ID failed");
        return AT_ERROR;
    }

    return AT_OK;
}


/*****************************************************************************
 ?? ?? ??  : AT_Set1xChanPara
 ????????  : (AT^1XCHAN)CDMA????channel
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  :
 ????????      :
  1.??    ??   : 2015??05??18??
    ??    ??   : z00316370
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_Set1xChanPara(VOS_UINT8 ucIndex)
{

    return AT_ERROR;

}

/*****************************************************************************
 ?? ?? ??  : AT_SetMccFreqPara
 ????????  : AT_CMD_MCCFREQ??????????????????????????????????????:
             AT^MccFreq=<SEQ>,<VER>,<OPERATION>,<LENGTH>,<BS1>,<BS2>,<BS3>
 ????????  : ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??10??09??
    ??    ??   : l00289540
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetMccFreqPara(
    VOS_UINT8                           ucIndex
)
{
    AT_CSS_MCC_INFO_SET_REQ_STRU       *pstMsg = VOS_NULL_PTR;
    VOS_UINT32                          ulBufLen;
    MODEM_ID_ENUM_UINT16                enModemId;
    VOS_UINT32                          ulRet;

    enModemId = MODEM_ID_0;

    ulRet = AT_GetModemIdFromClient(ucIndex, &enModemId);

    if (VOS_OK != ulRet)
    {
        AT_ERR_LOG("AT_SetMccFreqPara: Get modem id fail.");
        return AT_ERROR;
    }

    /* ???????? */
    if(AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
       return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ????????????VER?????????? */
    if((gucAtParaIndex > 7)
    || (gucAtParaIndex < 4)
    || (MCC_INFO_VERSION_LEN != gastAtParaList[1].usParaLen))
    {
       AT_ERR_LOG("AT_SetMccFreqPara:number of parameter error.");
       return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????????? */
    ulBufLen = sizeof(AT_CSS_MCC_INFO_SET_REQ_STRU);

    if (gastAtParaList[3].ulParaValue > 4)
    {
        ulBufLen += gastAtParaList[3].ulParaValue - 4;
    }

    /* ??????????AT_CSS_MCC_INFO_SET_REQ_STRU */
    pstMsg = (AT_CSS_MCC_INFO_SET_REQ_STRU*)AT_ALLOC_MSG_WITH_HDR(ulBufLen);

    /* ?????????????????? */
    if (VOS_NULL_PTR == pstMsg)
    {
        AT_ERR_LOG("AT_SetMccFreqPara:memory alloc fail.");
        return AT_ERROR;
    }

    PS_MEM_SET((VOS_INT8 *)pstMsg + VOS_MSG_HEAD_LENGTH, 0x00, (VOS_SIZE_T)ulBufLen - VOS_MSG_HEAD_LENGTH);

    /* ?????????? */
    AT_CFG_MSG_HDR(pstMsg, PS_PID_CSS, ID_AT_CSS_MCC_INFO_SET_REQ);

    /* ???????????? */
    pstMsg->usModemId                   = enModemId;
    pstMsg->usClientId                  = gastAtClientTab[ucIndex].usClientId;
    pstMsg->ucSeq                       = (VOS_UINT8)gastAtParaList[0].ulParaValue;
    pstMsg->ucOperateType               = (VOS_UINT8)gastAtParaList[2].ulParaValue;
    pstMsg->ulMccInfoBuffLen            = gastAtParaList[3].ulParaValue;

    PS_MEM_CPY(pstMsg->aucVersionId, gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen);

    if (pstMsg->ulMccInfoBuffLen > 0)
    {
        /* BS1 */
        PS_MEM_CPY(pstMsg->aucMccInfoBuff, gastAtParaList[4].aucPara, gastAtParaList[4].usParaLen);

        /* BS1 ????????????????????????????BS2 ?????????????? */
        if (pstMsg->ulMccInfoBuffLen > gastAtParaList[4].usParaLen)
        {
            PS_MEM_CPY(pstMsg->aucMccInfoBuff + gastAtParaList[4].usParaLen,
                       gastAtParaList[5].aucPara,
                       gastAtParaList[5].usParaLen);

            /* BS1 & BS2 ????????????????????????????BS3 ?????????????? */
            if (pstMsg->ulMccInfoBuffLen > gastAtParaList[4].usParaLen + gastAtParaList[5].usParaLen)
            {
                PS_MEM_CPY(pstMsg->aucMccInfoBuff + gastAtParaList[4].usParaLen + gastAtParaList[5].usParaLen,
                           gastAtParaList[6].aucPara,
                           gastAtParaList[6].usParaLen);
            }
        }
    }
    /* ?????????????????????????????? */

    AT_SEND_MSG(pstMsg);

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_MCCFREQ_SET;

    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : AT_ParseDplmnStringList
 ????????  : ????AT^DPLMNLIST????????????DPLMN LIST??????????
 ????????  : ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??11??06??
    ??    ??   : l00289540
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_ParseDplmnStringList(
    VOS_UINT8                           ucIndex,
    VOS_UINT8                          *pucDplmnString,
    TAF_MMA_DPLMN_INFO_SET_STRU        *pstDplmnInfoSet
)
{
    VOS_UINT8                          *pucSubStr  = VOS_NULL_PTR;
    VOS_UINT8                           aucDilms[] = ",";
    VOS_UINT16                          usSubStrLen;
    VOS_UINT16                          usIndex;
    VOS_UINT32                          ulDplmnNum;
    VOS_UINT32                          ulSimRat;
    TAF_PLMN_ID_STRU                    stPlmnId;

    pucSubStr   = (VOS_UINT8*)VOS_StrTok((VOS_CHAR*)pucDplmnString, (const VOS_CHAR*)aucDilms);
    ulDplmnNum  = 0;
    usIndex     = 0;
    ulSimRat    = 0;

    /* ????????Dplmn & SimRat?????????? */
    if (VOS_NULL_PTR != pucSubStr)
    {
        usSubStrLen = (VOS_UINT16)AT_STRLEN((VOS_CHAR*)pucSubStr);
        AT_String2Hex((TAF_UINT8*)pucSubStr, usSubStrLen, &ulDplmnNum);
        pucSubStr = (VOS_UINT8*)VOS_StrTok(VOS_NULL_PTR, (const VOS_CHAR*)aucDilms);
    }

    pstDplmnInfoSet->usDplmnNum = (VOS_UINT16)ulDplmnNum;

    if (VOS_NULL_PTR == pucSubStr)
    {
        pstDplmnInfoSet->usDplmnNum = 0;
    }

    while (VOS_NULL_PTR != pucSubStr)
    {
        usSubStrLen = (VOS_UINT16)AT_STRLEN((VOS_CHAR*)pucSubStr);

        /* Dplmn?????????? */
        if ((5 != usSubStrLen)
         && (6 != usSubStrLen))
        {
            return AT_ERROR;
        }

        /* Dplmn Mcc*/
        if(VOS_ERR == AT_String2Hex(pucSubStr, 3, &stPlmnId.Mcc))
        {
            return AT_ERROR;
        }

        /* Dplmn Mnc */
        if(VOS_ERR == AT_String2Hex(&pucSubStr[3], usSubStrLen-3, &stPlmnId.Mnc))
        {
            return AT_ERROR;
        }

        stPlmnId.Mcc &= 0x0FFF;

        if (5 == usSubStrLen)
        {
            stPlmnId.Mnc |= 0x0F00;
        }

        stPlmnId.Mnc &= 0x0FFF;

        /* ??????????Dplmn????????Plmn */
        if (VOS_FALSE == AT_PH_IsPlmnValid(&stPlmnId))
        {
            return AT_ERROR;
        }

        /* Dplmn Sim Rat */
        pucSubStr = (VOS_UINT8*)VOS_StrTok(VOS_NULL_PTR, (const VOS_CHAR*)aucDilms);

        if (VOS_NULL_PTR == pucSubStr)
        {
            return AT_ERROR;
        }

        usSubStrLen = (VOS_UINT16)AT_STRLEN((VOS_CHAR*)pucSubStr);

        if (VOS_ERR == AT_String2Hex(pucSubStr, usSubStrLen, &ulSimRat))
        {
            return AT_ERROR;
        }

        /* AP??????Dplmn??Simrat???????? */
        if ((0 == ulSimRat)
         || (7 < ulSimRat))
        {
            return AT_ERROR;
        }

        PS_MEM_CPY(&(pstDplmnInfoSet->astDplmnList[usIndex].stPlmnId), &stPlmnId, sizeof(TAF_PLMN_ID_STRU));
        pstDplmnInfoSet->astDplmnList[usIndex].usSimRat = (VOS_UINT16)ulSimRat;
        usIndex++;

        if (pstDplmnInfoSet->usDplmnNum <= usIndex)
        {
            break;
        }

        pucSubStr = (VOS_UINT8*)VOS_StrTok(VOS_NULL_PTR, (const VOS_CHAR*)aucDilms);
    }

    if (pstDplmnInfoSet->usDplmnNum > usIndex)
    {
        pstDplmnInfoSet->usDplmnNum = usIndex;
    }

    return AT_SUCCESS;
}

/*****************************************************************************
 ?? ?? ??  : AT_ParseEhplmnStringList
 ????????  : ????AT^DPLMNLIST????????????EHPLMN LIST??????????
 ????????  : ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??11??06??
    ??    ??   : l00289540
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_ParseEhplmnStringList(
    VOS_UINT8                           ucIndex,
    TAF_MMA_DPLMN_INFO_SET_STRU        *pstDplmnInfoSet
)
{
    VOS_UINT8                           aucEhplmnStr[TAF_MMA_MAX_EHPLMN_STR] = {0};
    VOS_UINT8                          *pucSubStr  = VOS_NULL_PTR;
    VOS_UINT8                           aucDilms[] = ",";
    VOS_UINT16                          usIndex;
    VOS_UINT16                          usSubStrLen;
    TAF_PLMN_ID_STRU                    stPlmnId;
    VOS_UINT32                          ulLen;

    ulLen = gastAtParaList[3].usParaLen;

    if (TAF_MMA_MAX_EHPLMN_STR < ulLen)
    {
        ulLen = TAF_MMA_MAX_EHPLMN_STR;
    }

    PS_MEM_CPY(aucEhplmnStr, gastAtParaList[3].aucPara, ulLen);


    /* Ehplmn Num */
    pstDplmnInfoSet->ucEhPlmnNum = (VOS_UINT8)gastAtParaList[2].ulParaValue;

    pucSubStr   = (VOS_UINT8*)VOS_StrTok((VOS_CHAR*)aucEhplmnStr, (const VOS_CHAR*)aucDilms);
    usIndex     = 0;

    while (VOS_NULL_PTR != pucSubStr)
    {
        usSubStrLen = (VOS_UINT16)AT_STRLEN((VOS_CHAR*)pucSubStr);

        if ((5 != usSubStrLen)
         && (6 != usSubStrLen))
        {
            return AT_ERROR;
        }

        /* Ehplmn Mcc*/
        if(VOS_ERR == AT_String2Hex(pucSubStr, 3, &stPlmnId.Mcc))
        {
            return AT_ERROR;
        }

        /* Ehplmn Mnc */
        if(VOS_ERR == AT_String2Hex(&pucSubStr[3], usSubStrLen-3, &stPlmnId.Mnc))
        {
            return AT_ERROR;
        }

        stPlmnId.Mcc &= 0x0FFF;

        if (5 == usSubStrLen)
        {
            stPlmnId.Mnc |= 0x0F00;
        }

        stPlmnId.Mnc &= 0x0FFF;

        /* ??????????Ehplmn????????Plmn */
        if (VOS_FALSE == AT_PH_IsPlmnValid(&stPlmnId))
        {
            return AT_ERROR;
        }

        PS_MEM_CPY(&(pstDplmnInfoSet->astEhPlmnInfo[usIndex++]), &stPlmnId, sizeof(TAF_PLMN_ID_STRU));

        if (pstDplmnInfoSet->ucEhPlmnNum <= usIndex)
        {
            break;
        }

        pucSubStr = (VOS_UINT8*)VOS_StrTok(VOS_NULL_PTR, (const VOS_CHAR*)aucDilms);
    }

    if (pstDplmnInfoSet->ucEhPlmnNum > usIndex)
    {
        pstDplmnInfoSet->ucEhPlmnNum = (VOS_UINT8)usIndex;
    }

    return AT_SUCCESS;
}

/*****************************************************************************
 ?? ?? ??  : AT_SetDplmnListPara
 ????????  : AT_CMD_DPLMN??????DPLMN??????
             AT^DPLMNLIST = <SEQ>, <VER>, <EHPLMN NUM>, <EHPLMN>, <BS COUNT>, <BS1>, [<BS2>,<BS3>]
 ????????  : ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??10??12??
    ??    ??   : n00355355
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetDplmnListPara(
    VOS_UINT8                           ucIndex
)
{
    VOS_UINT8                           ucSeq;
    VOS_UINT32                          ulRst;
    VOS_UINT8                           aucVersionId[TAF_MMA_VERSION_INFO_LEN];
    TAF_MMA_DPLMN_INFO_SET_STRU        *pstDplmnInfo = VOS_NULL_PTR;
    VOS_UINT8                          *pucDplmnString = VOS_NULL_PTR;
    VOS_UINT8                           ucNumDplmnSubStr;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
       return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????? */
    if (gucAtParaIndex < 6)
    {
       return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????????????? */
    if (TAF_MMA_VERSION_INFO_LEN != gastAtParaList[1].usParaLen)
    {
        AT_ERR_LOG("AT_SetDplmnListPara: incorrect version length ");

        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_DPLMNLIST_SET;

    /* ?????????? */
    ucSeq                                  = (VOS_UINT8)gastAtParaList[0].ulParaValue;

    /* ?????????? */
    PS_MEM_CPY(aucVersionId, gastAtParaList[1].aucPara, gastAtParaList[1].usParaLen);

    /* ????DPLMN INFO SET?????? */
    pstDplmnInfo = (TAF_MMA_DPLMN_INFO_SET_STRU *)PS_MEM_ALLOC(WUEPS_PID_AT, sizeof(TAF_MMA_DPLMN_INFO_SET_STRU));

    if (VOS_NULL_PTR == pstDplmnInfo)
    {
        AT_ERR_LOG("AT_SetDplmnListPara: Memory malloc failed!");
        return AT_ERROR;
    }

    /* ????????????????Dplmn String?????????????????????? */
    pucDplmnString = (VOS_UINT8*)PS_MEM_ALLOC(WUEPS_PID_AT, TAF_MMA_MAX_STR_LEN*sizeof(VOS_UINT8));

    if (VOS_NULL_PTR == pucDplmnString)
    {
       AT_ERR_LOG("AT_SetDplmnListPara: Memory malloc failed!");
       PS_MEM_FREE(WUEPS_PID_AT, pstDplmnInfo);
       return AT_ERROR;
    }

    PS_MEM_SET(pstDplmnInfo, 0x00, sizeof(TAF_MMA_DPLMN_INFO_SET_STRU));

    PS_MEM_SET(pucDplmnString, 0x00, TAF_MMA_MAX_STR_LEN*sizeof(VOS_UINT8));
    ucNumDplmnSubStr = (VOS_UINT8)gastAtParaList[4].ulParaValue;

    switch (ucNumDplmnSubStr)
    {
        case 1:
            PS_MEM_CPY(pucDplmnString, (VOS_UINT8*)gastAtParaList[5].aucPara, gastAtParaList[5].usParaLen);
            break;

        case 2:
            PS_MEM_CPY(pucDplmnString, (VOS_UINT8*)gastAtParaList[5].aucPara, gastAtParaList[5].usParaLen);
            PS_MEM_CPY(pucDplmnString+gastAtParaList[5].usParaLen,
                       (VOS_UINT8*)gastAtParaList[6].aucPara, gastAtParaList[6].usParaLen);
            break;

        case 3:
            PS_MEM_CPY(pucDplmnString, (VOS_UINT8*)gastAtParaList[5].aucPara, gastAtParaList[5].usParaLen);
            PS_MEM_CPY(pucDplmnString+gastAtParaList[5].usParaLen,
                       (VOS_UINT8*)gastAtParaList[6].aucPara, gastAtParaList[6].usParaLen);
            PS_MEM_CPY(pucDplmnString+gastAtParaList[5].usParaLen+gastAtParaList[6].usParaLen,
                       (VOS_UINT8*)gastAtParaList[7].aucPara, gastAtParaList[7].usParaLen);
            break;

        default:
            PS_MEM_FREE(WUEPS_PID_AT, pstDplmnInfo);
            PS_MEM_FREE(WUEPS_PID_AT, pucDplmnString);
            return AT_ERROR;
    }

    /* Ehplmn */
    if (AT_ERROR == AT_ParseEhplmnStringList(ucIndex, pstDplmnInfo))
    {
        PS_MEM_FREE(WUEPS_PID_AT, pstDplmnInfo);
        PS_MEM_FREE(WUEPS_PID_AT, pucDplmnString);
        return AT_ERROR;
    }

    /* Dplmn */
    if (AT_ERROR == AT_ParseDplmnStringList(ucIndex, pucDplmnString, pstDplmnInfo))
    {
        PS_MEM_FREE(WUEPS_PID_AT, pstDplmnInfo);
        PS_MEM_FREE(WUEPS_PID_AT, pucDplmnString);
        return AT_ERROR;
    }

    ulRst = TAF_MMA_SetDplmnListReq(WUEPS_PID_AT,
                                    gastAtClientTab[ucIndex].usClientId,
                                    ucSeq,
                                    aucVersionId,
                                    pstDplmnInfo);

    if (VOS_TRUE != ulRst)
    {

        PS_MEM_FREE(WUEPS_PID_AT, pstDplmnInfo);
        PS_MEM_FREE(WUEPS_PID_AT, pucDplmnString);
        return AT_ERROR;
    }

    PS_MEM_FREE(WUEPS_PID_AT, pstDplmnInfo);
    PS_MEM_FREE(WUEPS_PID_AT, pucDplmnString);

    return AT_WAIT_ASYNC_RETURN;
}


/*****************************************************************************
 ?? ?? ??  : AT_SetCdmaDormantTimer
 ????????  : AT_CMD_CDORMTIMER
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  --- ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??08??13??
    ??    ??   : y00314741
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetCdmaDormantTimer(VOS_UINT8 ucIndex)
{
    return AT_ERROR;

}

/*****************************************************************************
 ?? ?? ??  : AT_SetUECenterPara
 ????????  : AT_CMD_UE_CENTER
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  --- ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??09??07??
    ??    ??   : lwx277467
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetUECenterPara(VOS_UINT8 ucIndex)
{
    AT_MTA_SET_UE_CENTER_REQ_STRU       stSetUeCenterInfo;
    VOS_UINT32                          ulRst;

    PS_MEM_SET(&stSetUeCenterInfo, 0, sizeof(AT_MTA_SET_UE_CENTER_REQ_STRU));

    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if(gucAtParaIndex > 1)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if(0 == gastAtParaList[0].usParaLen)
    {
        stSetUeCenterInfo.enUeCenter = 0;
    }
    else
    {
        stSetUeCenterInfo.enUeCenter = gastAtParaList[0].ulParaValue;
    }

    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_UE_CENTER_SET_REQ,
                                   &stSetUeCenterInfo,
                                   sizeof(AT_MTA_SET_UE_CENTER_REQ_STRU),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_UE_CENTER_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        return AT_ERROR;
    }
}
/*****************************************************************************
 ?? ?? ??  : AT_SetMipiPara
 ????????  : AT_CMD_MIPIWR
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  --- ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??09??19??
    ??    ??   : l00227485
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetMipiWrPara(VOS_UINT8 ucIndex)
{
    AT_HPA_MIPI_WR_REQ_STRU             *pstMsg;
    VOS_UINT32                          ulLength;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (5 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (AT_TMODE_FTM != g_stAtDevCmdCtrl.ucCurrentTMode)
    {
        return AT_DEVICE_MODE_ERROR;
    }

    ulLength = sizeof(AT_HPA_MIPI_WR_REQ_STRU) - VOS_MSG_HEAD_LENGTH;
    pstMsg   = (AT_HPA_MIPI_WR_REQ_STRU *)PS_ALLOC_MSG(WUEPS_PID_AT, ulLength);

    if (VOS_NULL_PTR == pstMsg)
    {
        AT_WARN_LOG("AT_SetMipiWrPara: alloc msg fail!");
        return AT_ERROR;
    }

    if (AT_RAT_MODE_GSM == gastAtParaList[0].ulParaValue)
    {
        pstMsg->ulReceiverPid               = AT_GetDestPid(ucIndex, I0_DSP_PID_GPHY);
    }
    else
    {
        pstMsg->ulReceiverPid               = AT_GetDestPid(ucIndex, I0_DSP_PID_WPHY);
    }

    pstMsg->usMsgID                         = ID_AT_HPA_MIPI_WR_REQ;
    pstMsg->usSlaveAddr                     = ( VOS_UINT16 )gastAtParaList[1].ulParaValue;
    pstMsg->usRegAddr                       = ( VOS_UINT16 )gastAtParaList[2].ulParaValue;
    pstMsg->usRegData                       = ( VOS_UINT16 )gastAtParaList[3].ulParaValue;
    pstMsg->usMipiChannel                   = ( VOS_UINT16 )gastAtParaList[4].ulParaValue;

    /*GSM and UMTS share the same PID*/
    if (VOS_OK != PS_SEND_MSG(WUEPS_PID_AT, pstMsg))
    {
        AT_WARN_LOG("AT_SetMipiWrPara: Send msg fail!");
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt  = AT_CMD_MIPI_WR;                   /*???????????????? */
    g_stAtDevCmdCtrl.ucIndex                = ucIndex;

    return AT_WAIT_ASYNC_RETURN;                                                /* ???????????????? */
}

/*****************************************************************************
 ?? ?? ??  : AT_SetMipiRdPara
 ????????  : AT_CMD_MIPIRD
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  --- ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??09??19??
    ??    ??   : l00227485
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetMipiRdPara(VOS_UINT8 ucIndex)
{
    AT_HPA_MIPI_RD_REQ_STRU             *pstMsg;
    VOS_UINT32                          ulLength;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (4 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (AT_TMODE_FTM != g_stAtDevCmdCtrl.ucCurrentTMode)
    {
        return AT_DEVICE_MODE_ERROR;
    }

    if (AT_RAT_MODE_FDD_LTE == gastAtParaList[0].ulParaValue || AT_RAT_MODE_TDD_LTE == gastAtParaList[0].ulParaValue)
    {
        return AT_ERROR;
    }

    ulLength = sizeof(AT_HPA_MIPI_RD_REQ_STRU) - VOS_MSG_HEAD_LENGTH;
    pstMsg   = (AT_HPA_MIPI_RD_REQ_STRU *)PS_ALLOC_MSG(WUEPS_PID_AT, ulLength);

    if (VOS_NULL_PTR == pstMsg)
    {
        AT_WARN_LOG("AT_SetMipiRdPara: alloc msg fail!");
        return AT_ERROR;
    }

    if (AT_RAT_MODE_GSM == gastAtParaList[0].ulParaValue)
    {
        pstMsg->ulReceiverPid               = AT_GetDestPid(ucIndex, I0_DSP_PID_GPHY);
    }
    else
    {
        pstMsg->ulReceiverPid               = AT_GetDestPid(ucIndex, I0_DSP_PID_WPHY);
    }

    pstMsg->usMsgID                         = ID_AT_HPA_MIPI_RD_REQ;
    pstMsg->uhwChannel                      = ( VOS_UINT16 )gastAtParaList[1].ulParaValue;
    pstMsg->uhwSlaveAddr                    = ( VOS_UINT16 )gastAtParaList[2].ulParaValue;
    pstMsg->uhwReg                          = ( VOS_UINT16 )gastAtParaList[3].ulParaValue;

    if (VOS_OK != PS_SEND_MSG(WUEPS_PID_AT, pstMsg))
    {
        AT_WARN_LOG("AT_SetMipiRdPara: Send msg fail!");
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt  = AT_CMD_MIPI_RD;                   /*???????????????? */
    g_stAtDevCmdCtrl.ucIndex                = ucIndex;

    return AT_WAIT_ASYNC_RETURN;                                                /* ???????????????? */
}

/*****************************************************************************
 ?? ?? ??  : AT_SetSSIWrPara
 ????????  : AT_CMD_SSI
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  --- ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??09??9??
    ??    ??   : l00227485
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetSSIWrPara(VOS_UINT8 ucIndex)
{
    AT_HPA_SSI_WR_REQ_STRU                  *pstMsg;
    VOS_UINT32                              ulLength;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if ( 4 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (AT_TMODE_FTM != g_stAtDevCmdCtrl.ucCurrentTMode)
    {
        return AT_DEVICE_MODE_ERROR;
    }

    ulLength = sizeof(AT_HPA_SSI_WR_REQ_STRU) - VOS_MSG_HEAD_LENGTH;
    pstMsg   = (AT_HPA_SSI_WR_REQ_STRU *)PS_ALLOC_MSG(WUEPS_PID_AT, ulLength);

    if ( VOS_NULL_PTR == pstMsg )
    {
        AT_WARN_LOG("AT_SetSSIWrPara: alloc msg fail!");
        return AT_ERROR;
    }

    if ( AT_RAT_MODE_GSM == gastAtParaList[0].ulParaValue )
    {
        pstMsg->ulReceiverPid               = AT_GetDestPid(ucIndex, I0_DSP_PID_GPHY);
    }
    else
    {
        pstMsg->ulReceiverPid               = AT_GetDestPid(ucIndex, I0_DSP_PID_WPHY);
    }

    pstMsg->usMsgID                         = ID_AT_HPA_SSI_WR_REQ;
    pstMsg->usRficSsi                       = ( VOS_UINT16 )gastAtParaList[1].ulParaValue;
    pstMsg->usRegAddr                       = ( VOS_UINT16 )gastAtParaList[2].ulParaValue;
    pstMsg->usData                          = ( VOS_UINT16 )gastAtParaList[3].ulParaValue;

    if ( VOS_OK != PS_SEND_MSG( WUEPS_PID_AT, pstMsg ) )
    {
        AT_WARN_LOG("AT_SetSSIWrPara: Send msg fail!");
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt  = AT_CMD_SSI_WR;                    /*???????????????? */
    g_stAtDevCmdCtrl.ucIndex                = ucIndex;

    return AT_WAIT_ASYNC_RETURN;                                                /* ???????????????? */
}

/*****************************************************************************
 ?? ?? ??  : AT_SetSsiRdPara
 ????????  : AT_CMD_MIPIRD
 ????????  : ucIndex --- ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX  --- ATC??????
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??09??19??
    ??    ??   : l00227485
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetSSIRdPara(VOS_UINT8 ucIndex)
{
    AT_HPA_SSI_RD_REQ_STRU                  *pstMsg;
    VOS_UINT32                              ulLength;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????? */
    if (3 != gucAtParaIndex)
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    if (AT_TMODE_FTM != g_stAtDevCmdCtrl.ucCurrentTMode)
    {
        return AT_DEVICE_MODE_ERROR;
    }

    if ( AT_RAT_MODE_FDD_LTE == gastAtParaList[0].ulParaValue
      || AT_RAT_MODE_TDD_LTE == gastAtParaList[0].ulParaValue
      || AT_RAT_MODE_TDSCDMA == gastAtParaList[0].ulParaValue )
    {
        /* ????TL???????? */
        return AT_SetTlRficSsiRdPara( ucIndex );
    }

    ulLength = sizeof(AT_HPA_SSI_RD_REQ_STRU) - VOS_MSG_HEAD_LENGTH;
    pstMsg   = (AT_HPA_SSI_RD_REQ_STRU *)PS_ALLOC_MSG(WUEPS_PID_AT, ulLength);

    if (VOS_NULL_PTR == pstMsg)
    {
        AT_WARN_LOG("AT_SetMipiRdPara: alloc msg fail!");
        return AT_ERROR;
    }

    if (AT_RAT_MODE_GSM == gastAtParaList[0].ulParaValue)
    {
        pstMsg->ulReceiverPid                   = AT_GetDestPid(ucIndex, I0_DSP_PID_GPHY);
    }
    else
    {
        pstMsg->ulReceiverPid                   = AT_GetDestPid(ucIndex, I0_DSP_PID_WPHY);
    }

    pstMsg->usMsgID                             = ID_AT_HPA_SSI_RD_REQ;
    pstMsg->usChannelNo                         = ( VOS_UINT16 )gastAtParaList[1].ulParaValue;
    pstMsg->uwRficReg                           = gastAtParaList[2].ulParaValue;

    if (VOS_OK != PS_SEND_MSG(WUEPS_PID_AT, pstMsg))
    {
        AT_WARN_LOG("AT_SetMipiRdPara: Send msg fail!");
        return AT_ERROR;
    }

    gastAtClientTab[ucIndex].CmdCurrentOpt      = AT_CMD_SSI_RD;                /*???????????????? */
    g_stAtDevCmdCtrl.ucIndex                    = ucIndex;

    return AT_WAIT_ASYNC_RETURN;                                                /* ???????????????? */
}


/*****************************************************************************
 ?? ?? ??  : AT_SetHdrCsqPara
 ????????  : ????AT^HDRCSQ??AT????
 ????????  : VOS_UINT8                           ucIndex
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??10??20??
    ??    ??   : C00299064
    ????????   : ??????????

*****************************************************************************/
VOS_UINT32 AT_SetHdrCsqPara(VOS_UINT8 ucIndex)
{
    return AT_ERROR;


}
/*****************************************************************************
 ?? ?? ??  : AT_SetTlRficSsiRdPara
 ????????  : ????AT^SSIRD????TL????????
 ????????  : ucIndex    -- AT????????
 ????????  : ??
 ?? ?? ??  : VOS_UINT32
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2015??10??29??
    ??    ??   : x00316382
    ????????   : ????????
*****************************************************************************/
VOS_UINT32 AT_SetTlRficSsiRdPara(VOS_UINT8 ucIndex)
{
    VOS_UINT32                          ulResult;
    AT_MTA_RFICSSIRD_REQ_STRU           stRficSsiRdReq;

    /* ???????? */
    if (VOS_FALSE == AT_IsApPort(ucIndex))
    {
        return AT_ERROR;
    }

    /* ?????? */
    PS_MEM_SET(&stRficSsiRdReq, 0, sizeof(stRficSsiRdReq));

    stRficSsiRdReq.usChannelNo            = ( VOS_UINT16 )gastAtParaList[1].ulParaValue;
    stRficSsiRdReq.usRficReg              = ( VOS_UINT16 )gastAtParaList[2].ulParaValue;

    /* ???????? */
    ulResult = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                      gastAtClientTab[ucIndex].opId,
                                      ID_AT_MTA_RFICSSIRD_QRY_REQ,
                                      &stRficSsiRdReq,
                                      sizeof(stRficSsiRdReq),
                                      I0_UEPS_PID_MTA);

    if (TAF_SUCCESS != ulResult)
    {
        AT_WARN_LOG("AT_SetTlRficSsiRdPara: AT_FillAndSndAppReqMsg fail.");
        return AT_ERROR;
    }

    /* ????AT???????????????????????????? */
    gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_RFICSSIRD_SET;
    g_stAtDevCmdCtrl.ucIndex                    = ucIndex;

    return AT_WAIT_ASYNC_RETURN;
}

/*****************************************************************************
 ?? ?? ??  : At_SetSensorPara
 ????????  : ^SENSOR
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2016??03??22??
    ??    ??   : z00347560
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 At_SetSensorPara(VOS_UINT8       ucIndex)
{

    VOS_UINT32                          ulRst;
    AT_MTA_SET_SENSOR_REQ_STRU          stSensorStat;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        AT_WARN_LOG("At_SetSensorPara: Incorrect Cmd Type.");
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if ( (1 != gastAtParaList[0].usParaLen)
       ||(1 != gucAtParaIndex))
    {
        AT_WARN_LOG("At_SetSensorPara: Incorrect Param Length.");
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????? */
    PS_MEM_SET(&stSensorStat, 0, sizeof(stSensorStat));

    stSensorStat.ucSensorStat = ( VOS_UINT8 )gastAtParaList[0].ulParaValue;

    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_SET_SENSOR_REQ,
                                   &stSensorStat,
                                   sizeof(stSensorStat),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SENSOR_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        AT_WARN_LOG("At_SetSensorPara: Send msg fail!");
        return AT_ERROR;
    }
    
}

/*****************************************************************************
 ?? ?? ??  : At_SetScreenPara
 ????????  : ^SCREEN
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2016??03??22??
    ??    ??   : z00347560
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 At_SetScreenPara(VOS_UINT8       ucIndex)
{

    VOS_UINT32                          ulRst;
    AT_MTA_SET_SCREEN_REQ_STRU          stScreenStat;

    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
        AT_WARN_LOG("At_SetScreenPara: Incorrect Cmd Type.");
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if ( (1 != gastAtParaList[0].usParaLen)
       ||(1 != gucAtParaIndex))
    {
        AT_WARN_LOG("At_SetScreenPara: Incorrect Param Length.");
        return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ?????? */
    PS_MEM_SET(&stScreenStat, 0, sizeof(stScreenStat));

    stScreenStat.ucScreenStat = ( VOS_UINT8 )gastAtParaList[0].ulParaValue;

    ulRst = AT_FillAndSndAppReqMsg(gastAtClientTab[ucIndex].usClientId,
                                   0,
                                   ID_AT_MTA_SET_SCREEN_REQ,
                                   &stScreenStat,
                                   sizeof(stScreenStat),
                                   I0_UEPS_PID_MTA);

    if (TAF_SUCCESS == ulRst)
    {
        gastAtClientTab[ucIndex].CmdCurrentOpt = AT_CMD_SCREEN_SET;
        return AT_WAIT_ASYNC_RETURN;
    }
    else
    {
        AT_WARN_LOG("At_SetScreenPara: Send msg fail!");
        return AT_ERROR;
    }
}

/*****************************************************************************
 ?? ?? ??  : AT_SetPcuiCtrlConcurrentFlagForTest
 ????????  : ^PORTCONCURRENT
 ????????  : ucIndex - ????????
 ????????  : ??
 ?? ?? ??  : AT_XXX
 ????????  :
 ????????  :

 ????????      :
  1.??    ??   : 2016??05??19??
    ??    ??   : lwx331495
    ????????   : ??????????
*****************************************************************************/
VOS_UINT32 AT_SetPcuiCtrlConcurrentFlagForTest(VOS_UINT8 ucIndex)
{
    /* ???????? */
    if (AT_CMD_OPT_SET_PARA_CMD != g_stATParseCmd.ucCmdOptType)
    {
       return AT_CME_INCORRECT_PARAMETERS;
    }

    /* ???????????? */
    if ( (1 != gucAtParaIndex)
      || (0 == gastAtParaList[0].usParaLen) )
    {
        return AT_CME_INCORRECT_PARAMETERS;
    }

    AT_SetPcuiCtrlConcurrentFlag((VOS_UINT8)(gastAtParaList[0].ulParaValue));
    return AT_OK;
}


